# ุฑุงูููุง ุงุณุชูุฑุงุฑ ุฑู ูุงุณุช ูุฑูโูุฑฺฉ ุงุฑุงู

ุงู ุฑุงูููุง ุจู ุดูุง ฺฉูฺฉ ูโฺฉูุฏ ุชุง ูพุฑูฺู Next.js ุฑุง ุฑู ูุงุณุช ูุฑูโูุฑฺฉ ุงุฑุงู ุงุณุชูุฑุงุฑ ุฏูุฏ.

## ๐ ูพุดโูุงุฒูุง

ูุจู ุงุฒ ุดุฑูุนุ ูุทูุฆู ุดูุฏ ฺฉู:

- โ Node.js 18 ุง ุจุงูุงุชุฑ ูุตุจ ุงุณุช
- โ pnpm ุง npm ูุตุจ ุงุณุช
- โ ุฏุณุชุฑุณ ุจู PostgreSQL ุฏุฑ ูุงุณุช ุฏุงุฑุฏ
- โ ุงุทูุงุนุงุช ุงุชุตุงู ุจู ุฏุชุงุจุณ ุฑุง ุฏุงุฑุฏ
- โ Merchant ID ุฒุฑูโูพุงู ุฑุง ุฏุงุฑุฏ (ุฏุฑ ุตูุฑุช ุงุณุชูุงุฏู ุงุฒ ุฏุฑฺฏุงู ูพุฑุฏุงุฎุช)

## ๐ ูุฑุงุญู ุงุณุชูุฑุงุฑ

### ูุฑุญูู 1: ุขูุงุฏูโุณุงุฒ ูุงูโูุง ูุญุท

1. ูุงู `env.production.template` ุฑุง ฺฉูพ ฺฉูุฏ ู ุจู `.env.production` ุชุบุฑ ูุงู ุฏูุฏ:

```bash
cp env.production.template .env.production
```

2. ูุงู `.env.production` ุฑุง ุจุงุฒ ฺฉูุฏ ู ููุงุฏุฑ ุฑุง ุจุง ุงุทูุงุนุงุช ูุงูุน ูุงุณุช ุฎูุฏ ุฌุงฺฏุฒู ฺฉูุฏ:

```env
# Database Configuration
DB_HOST=your-db-host          # ุขุฏุฑุณ ูุงุณุช ุฏุชุงุจุณ
DB_PORT=5432                 # ูพูุฑุช ุฏุชุงุจุณ (ูุนูููุงู 5432)
DB_NAME=saded                # ูุงู ุฏุชุงุจุณ
DB_USER=your-db-user         # ูุงู ฺฉุงุฑุจุฑ ุฏุชุงุจุณ
DB_PASSWORD=your-db-password # ุฑูุฒ ุนุจูุฑ ุฏุชุงุจุณ

# Application
NODE_ENV=production
NEXT_PUBLIC_URL=https://yourdomain.com  # ุขุฏุฑุณ ุฏุงููู ุดูุง

# Zarinpal Payment Gateway
ZARINPAL_MERCHANT_ID=your-merchant-id   # Merchant ID ุงุฒ ูพูู ุฒุฑูโูพุงู

# NextAuth (ุฏุฑ ุตูุฑุช ุงุณุชูุงุฏู)
NEXTAUTH_URL=https://yourdomain.com
NEXTAUTH_SECRET=your-secret-key          # ุจุฑุง ุชููุฏ: openssl rand -base64 32

# JWT Secret (ุฏุฑ ุตูุฑุช ุงุณุชูุงุฏู)
JWT_SECRET=your-jwt-secret-key
```

**โ๏ธ ูฺฉุชู ููู:** ูุงู `.env.production` ุฑุง ูุฑฺฏุฒ ุฏุฑ Git commit ูฺฉูุฏ!

### ูุฑุญูู 2: ุณุงุฎุช ูพุฑูฺู

ุฏุฑ ูุญุท ูุญู ุฎูุฏุ ูพุฑูฺู ุฑุง build ฺฉูุฏ:

```bash
# ูุตุจ ูุงุจุณุชฺฏโูุง
pnpm install

# ุณุงุฎุช ูพุฑูฺู ุจุฑุง production
pnpm build
```

ุงู ุฏุณุชูุฑ ูุงูโูุง production ุฑุง ุฏุฑ ูพูุดู `.next` ุงุฌุงุฏ ูโฺฉูุฏ.

### ูุฑุญูู 3: ุขูุงุฏูโุณุงุฒ ุฏุชุงุจุณ

#### ฺฏุฒูู 1: ุงุณุชูุงุฏู ุงุฒ ุงุณฺฉุฑูพุช ุฎูุฏฺฉุงุฑ

ูพุณ ุงุฒ ุขูพููุฏ ูุงูโูุง ุจู ูุงุณุชุ ุงุณฺฉุฑูพุช ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```bash
node scripts/setup-db-production.js
```

ุงู ุงุณฺฉุฑูพุช ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ:
- ุงุชุตุงู ุจู ุฏุชุงุจุณ ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ
- ุฌุฏุงูู ุฑุง ุงุฌุงุฏ ูโฺฉูุฏ
- Index ูุง ุฑุง ุงุฌุงุฏ ูโฺฉูุฏ

#### ฺฏุฒูู 2: ุฑุงูโุงูุฏุงุฒ ุฏุณุช

ุงฺฏุฑ ูโุฎูุงูุฏ ุจู ุตูุฑุช ุฏุณุช ุฏุชุงุจุณ ุฑุง ุฑุงูโุงูุฏุงุฒ ฺฉูุฏ:

1. ุจู ุฏุชุงุจุณ PostgreSQL ูุงุณุช ุฎูุฏ ูุชุตู ุดูุฏ
2. ุฏุชุงุจุณ `saded` ุฑุง ุงุฌุงุฏ ฺฉูุฏ (ุฏุฑ ุตูุฑุช ูุงุฒ)
3. ุฌุฏุงูู ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ูุงู `lib/db/postgres.ts` ุงุฌุงุฏ ฺฉูุฏ

### ูุฑุญูู 4: ุขูพููุฏ ูุงูโูุง ุจู ูุงุณุช

ูุงูโูุง ู ูพูุดูโูุง ุฒุฑ ุฑุง ุจู ูุงุณุช ุขูพููุฏ ฺฉูุฏ:

```
๐ฆ ูุงูโูุง ููุฑุฏ ูุงุฒ ุจุฑุง ุขูพููุฏ:
โโโ .next/              # ูพูุดู build ุดุฏู (ูพุณ ุงุฒ ุงุฌุฑุง pnpm build)
โโโ public/             # ูุงูโูุง ุงุณุชุงุชฺฉ
โโโ package.json        # ูุงู ูุงุจุณุชฺฏโูุง
โโโ package-lock.json    # ุง pnpm-lock.yaml
โโโ next.config.ts       # ุชูุธูุงุช Next.js
โโโ tsconfig.json        # ุชูุธูุงุช TypeScript
โโโ .env.production      # ูุชุบุฑูุง ูุญุท (โ๏ธ ููู!)
โโโ node_modules/       # ุง ุฏุฑ ูุงุณุช ุงุฌุฑุง ฺฉูุฏ: pnpm install --production
```

**ูฺฉุงุช ููู:**
- ูพูุดู `node_modules` ุฑุง ูโุชูุงูุฏ ุฏุฑ ูุงุณุช ุจุง `pnpm install --production` ูุตุจ ฺฉูุฏ
- ูพูุดู `.next` ุจุงุฏ ุญุชูุงู ุขูพููุฏ ุดูุฏ (ุงู ูพูุดู ูพุณ ุงุฒ build ุงุฌุงุฏ ูโุดูุฏ)
- ูุงู `.env.production` ุฑุง ุจู `.env` ุฏุฑ ูุงุณุช ุชุบุฑ ูุงู ุฏูุฏ (ุง ุฏุฑ ูพูู ูุงุณุช ุชูุธู ฺฉูุฏ)

### ูุฑุญูู 5: ูุตุจ ูุงุจุณุชฺฏโูุง ุฏุฑ ูุงุณุช

ุฏุฑ ูุงุณุชุ ูุงุจุณุชฺฏโูุง production ุฑุง ูุตุจ ฺฉูุฏ:

```bash
# ุจุง pnpm
pnpm install --production

# ุง ุจุง npm
npm install --production
```

### ูุฑุญูู 6: ุฑุงูโุงูุฏุงุฒ ุณุฑูุฑ

ุจุณุชู ุจู ููุน ูุงุณุช ู ุฏุณุชุฑุณ ุดูุงุ ฺฉ ุงุฒ ุฑูุดโูุง ุฒุฑ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:

#### ุฑูุด 1: ุงุณุชูุงุฏู ุงุฒ PM2 (ุชูุตู ูโุดูุฏ)

```bash
# ูุตุจ PM2 (ุฏุฑ ุตูุฑุช ูุงุฒ)
npm install -g pm2

# ุฑุงูโุงูุฏุงุฒ ุจุง PM2
pm2 start npm --name "saded" -- start

# ุง ุจุง ุงุณุชูุงุฏู ุงุฒ ูุงู ecosystem
pm2 start ecosystem.config.js

# ุฐุฎุฑู ุชูุธูุงุช PM2
pm2 save
pm2 startup
```

#### ุฑูุด 2: ุงุณุชูุงุฏู ุงุฒ systemd (ุจุฑุง VPS)

ุงุฌุงุฏ ูุงู service:

```bash
sudo nano /etc/systemd/system/saded.service
```

ูุญุชูุง ูุงู:

```ini
[Unit]
Description=Saded Next.js App
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/path/to/your/app
Environment=NODE_ENV=production
ExecStart=/usr/bin/node /path/to/your/app/node_modules/.bin/next start
Restart=always

[Install]
WantedBy=multi-user.target
```

ุณูพุณ:

```bash
sudo systemctl daemon-reload
sudo systemctl enable saded
sudo systemctl start saded
```

#### ุฑูุด 3: ุงุณุชูุงุฏู ุงุฒ Node.js Manager ูุงุณุช

ุงฺฏุฑ ูุงุณุช ุดูุง ูพูู ูุฏุฑุช Node.js ุฏุงุฑุฏ:
1. ุจู ูพูู Node.js ุจุฑูุฏ
2. ูุณุฑ ูพุฑูฺู ุฑุง ูุดุฎุต ฺฉูุฏ
3. ุฏุณุชูุฑ start ุฑุง ุชูุธู ฺฉูุฏ: `npm start` ุง `pnpm start`
4. ูพูุฑุช ุฑุง ุชูุธู ฺฉูุฏ (ูุนูููุงู 3000)

### ูุฑุญูู 7: ุชูุธูุงุช ูุจ ุณุฑูุฑ

#### ุชูุธู Nginx (Reverse Proxy)

ุงฺฏุฑ ุงุฒ Nginx ุงุณุชูุงุฏู ูโฺฉูุฏุ ูุงู ุชูุธูุงุช ุฑุง ุจู ุงู ุตูุฑุช ูพฺฉุฑุจูุฏ ฺฉูุฏ:

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

#### ุชูุธู Apache (Reverse Proxy)

ุงฺฏุฑ ุงุฒ Apache ุงุณุชูุงุฏู ูโฺฉูุฏ:

```apache
<VirtualHost *:80>
    ServerName yourdomain.com
    
    ProxyPreserveHost On
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
    
    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
</VirtualHost>
```

### ูุฑุญูู 8: ุชูุธู SSL Certificate

ุจุฑุง ูุนุงูโุณุงุฒ HTTPS:

1. ุงุฒ Let's Encrypt ุงุณุชูุงุฏู ฺฉูุฏ (ุฑุงฺฏุงู)
2. ุง ุงุฒ SSL ุงุฑุงุฆู ุดุฏู ุชูุณุท ูุงุณุช ุงุณุชูุงุฏู ฺฉูุฏ
3. ุชูุธูุงุช Nginx/Apache ุฑุง ุจุฑุง HTTPS ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ

### ูุฑุญูู 9: ุชูุธูุงุช ูุงูโูุง Upload

ูุทูุฆู ุดูุฏ ฺฉู ูพูุดู `public/uploads` ูุงุจู ููุดุชู ุงุณุช:

```bash
chmod -R 755 public/uploads
```

ุง ุฏุฑ ูพูู ูุงุณุชุ ุฏุณุชุฑุณ ููุดุชู ุฑุง ุจุฑุง ุงู ูพูุดู ูุนุงู ฺฉูุฏ.

## ๐ ุจุฑุฑุณ ู ุชุณุช

### ุจุฑุฑุณ ุงุชุตุงู ุฏุชุงุจุณ

```bash
node scripts/setup-db-production.js
```

### ุจุฑุฑุณ ุงุฌุฑุง ุณุฑูุฑ

```bash
# ุจุฑุฑุณ ูุงฺฏโูุง
pm2 logs saded

# ุง
tail -f /var/log/saded.log
```

### ุชุณุช ุฏุณุชุฑุณ

1. ุจู ุขุฏุฑุณ ุฏุงููู ุฎูุฏ ุจุฑูุฏ
2. ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุตูุญุงุช ุจู ุฏุฑุณุช ููุฏ ูโุดููุฏ
3. ุชุณุช ฺฉูุฏ ฺฉู ุงุชุตุงู ุจู ุฏุชุงุจุณ ฺฉุงุฑ ูโฺฉูุฏ
4. ุชุณุช ฺฉูุฏ ฺฉู ุฏุฑฺฏุงู ูพุฑุฏุงุฎุช (ุฏุฑ ุตูุฑุช ุงุณุชูุงุฏู) ฺฉุงุฑ ูโฺฉูุฏ

## ๐๏ธ ุนุจโุงุจ

### ูุดฺฉู: ุฏุชุงุจุณ ูุชุตู ููโุดูุฏ

- ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุงุทูุงุนุงุช ุงุชุตุงู ุฏุฑ `.env` ุฏุฑุณุช ุงุณุช
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุฏุชุงุจุณ ุฏุฑ ูุงุณุช ุฏุฑ ุฏุณุชุฑุณ ุงุณุช
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู ูุงุฑูุงู ุงุฌุงุฒู ุงุชุตุงู ูโุฏูุฏ

### ูุดฺฉู: ุตูุญุงุช 404 ูโุฏููุฏ

- ุจุฑุฑุณ ฺฉูุฏ ฺฉู ูุงูโูุง `.next` ุจู ุฏุฑุณุช ุขูพููุฏ ุดุฏูโุงูุฏ
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู `next.config.ts` ุฏุฑุณุช ุงุณุช
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู ูุณุฑูุง ุฏุฑุณุช ุชูุธู ุดุฏูโุงูุฏ

### ูุดฺฉู: ุชุตุงูุฑ ููุฏ ููโุดููุฏ

- ุจุฑุฑุณ ฺฉูุฏ ฺฉู ูพูุดู `public` ุขูพููุฏ ุดุฏู ุงุณุช
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุฏุณุชุฑุณ ูุงูโูุง ุฏุฑุณุช ุงุณุช
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู `next.config.ts` ุชูุธูุงุช image ุฏุฑุณุช ุงุณุช

### ูุดฺฉู: ุฏุฑฺฏุงู ูพุฑุฏุงุฎุช ฺฉุงุฑ ููโฺฉูุฏ

- ุจุฑุฑุณ ฺฉูุฏ ฺฉู `ZARINPAL_MERCHANT_ID` ุฏุฑุณุช ุชูุธู ุดุฏู ุงุณุช
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู `NEXT_PUBLIC_URL` ุขุฏุฑุณ ุตุญุญ ุงุณุช
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู Callback URL ุฏุฑ ูพูู ุฒุฑูโูพุงู ุฏุฑุณุช ุงุณุช

## ๐ ูฺฉุงุช ููู

1. **ุงููุช:**
   - ูุฑฺฏุฒ ูุงู `.env.production` ุฑุง ุฏุฑ Git commit ูฺฉูุฏ
   - ุงุฒ ุฑูุฒูุง ูู ุจุฑุง ุฏุชุงุจุณ ุงุณุชูุงุฏู ฺฉูุฏ
   - SSL certificate ุฑุง ูุนุงู ฺฉูุฏ

2. **ุจูููโุณุงุฒ:**
   - ุงุฒ CDN ุจุฑุง ูุงูโูุง ุงุณุชุงุชฺฉ ุงุณุชูุงุฏู ฺฉูุฏ
   - ฺฉุด ุฑุง ูุนุงู ฺฉูุฏ
   - ุชุตุงูุฑ ุฑุง ุจููู ฺฉูุฏ

3. **ูพุดุชุจุงูโฺฏุฑ:**
   - ุจู ุตูุฑุช ููุธู ุงุฒ ุฏุชุงุจุณ ุจฺฉุงูพ ุจฺฏุฑุฏ
   - ุงุฒ ูุงูโูุง ููู ุจฺฉุงูพ ุจฺฏุฑุฏ

4. **ูุงูุชูุฑูฺฏ:**
   - ุงุฒ ุงุจุฒุงุฑูุง ูุงูุชูุฑูฺฏ ุงุณุชูุงุฏู ฺฉูุฏ
   - ูุงฺฏโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ
   - ุนููฺฉุฑุฏ ุฑุง ุจุฑุฑุณ ฺฉูุฏ

## ๐ ูพุดุชุจุงู

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:
1. ูุงฺฏโูุง ุณุฑูุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ
2. ูุงฺฏโูุง ุฏุชุงุจุณ ุฑุง ุจุฑุฑุณ ฺฉูุฏ
3. ุจุง ูพุดุชุจุงู ูุงุณุช ุชูุงุณ ุจฺฏุฑุฏ

## ๐ ููุงุจุน ููุฏ

- [ูุณุชูุฏุงุช Next.js](https://nextjs.org/docs)
- [ูุณุชูุฏุงุช PostgreSQL](https://www.postgresql.org/docs/)
- [ุฑุงูููุง ุฒุฑูโูพุงู](./ZARINPAL_GUIDE.md)
- [ุฑุงูููุง PostgreSQL](./README-POSTGRES.md)


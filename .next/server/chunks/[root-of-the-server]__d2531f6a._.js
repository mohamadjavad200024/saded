module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},40911,e=>{"use strict";let t=new class{isDevelopment=!1;isProduction=!0;shouldLog(e){return"error"===e||"warn"===e||this.isDevelopment}log(...e){this.shouldLog("log")&&console.log(...e)}error(...e){console.error(...e)}warn(...e){console.warn(...e)}info(...e){this.shouldLog("info")&&console.info(...e)}debug(...e){this.shouldLog("debug")&&console.debug(...e)}dbQuery(e,t){this.isDevelopment&&console.log("[DB Query]",e.substring(0,100),t?`[${t.length} params]`:"")}apiRequest(e,t,r){this.isDevelopment&&console.log(`[API] ${e} ${t}${r?` ${r}`:""}`)}};e.s(["logger",0,t])},17939,39142,e=>{"use strict";var t,r=e.i(94028),s=e.i(40911);class a extends Error{status;code;details;constructor(e,t,r,s){super(e),this.name="AppError",this.status=t,this.code=r,this.details=s,Object.setPrototypeOf(this,a.prototype)}}(t={}).TIMEOUT="TIMEOUT",t.NETWORK="NETWORK",t.ABORTED="ABORTED",t.UNKNOWN="UNKNOWN";class n extends Error{type;originalError;constructor(e,t="UNKNOWN",r){super(e),this.name="NetworkError",this.type=t,this.originalError=r,Object.setPrototypeOf(this,n.prototype)}}function o(e,t){let r=e instanceof a?{message:e.message,status:e.status,code:e.code,details:e.details}:e instanceof n?{message:e.message,code:e.type,details:e.originalError}:e instanceof Error?{message:e.message}:"string"==typeof e?{message:e}:{message:"خطای نامشخص رخ داد"},o=t?`[${t}] `:"";s.logger.error(`${o}${r.message}`,{status:r.status,code:r.code,details:r.details})}function i(e,t=500){let s,a="خطای سرور",n=t;return e instanceof Error?(a=e.message,"status"in e&&"number"==typeof e.status&&(n=e.status),"code"in e&&"string"==typeof e.code&&(s=e.code),"details"in e&&e.details):"string"==typeof e?a=e:e&&"object"==typeof e&&"message"in e&&(a=String(e.message),"status"in e&&"number"==typeof e.status&&(n=e.status)),o(e,"API Route"),r.NextResponse.json({success:!1,error:a,...s?{code:s}:{}},{status:n})}function l(e,t=200,s){return r.NextResponse.json({success:!0,data:e,...s&&{pagination:s}},{status:t})}e.s(["AppError",()=>a,"logError",()=>o],39142),e.s(["createErrorResponse",()=>i,"createSuccessResponse",()=>l],17939)},12e3,e=>{"use strict";async function t(r,s=[]){try{let{queryOne:t}=await e.A(6149),n=a(r);return await t(n,s)}catch(e){throw console.error("Database error in getRow:",{sql:r,params:s,error:e?.message,code:e?.code}),e}}async function r(t,s=[]){try{let{queryAll:r}=await e.A(6149),n=a(t);return await r(n,s)}catch(e){throw console.error("Database error in getRows:",{sql:t,params:s,error:e?.message,code:e?.code}),e}}async function s(t,r=[]){let{query:n}=await e.A(6149),o=a(t),i=await n(o,r);return{changes:i.affectedRows||i.rowCount||0,lastInsertRowid:i.insertId||void 0}}function a(e){let t,r=e,s=/\$(\d+)/g,a=[];for(;null!==(t=s.exec(e));)a.push({index:parseInt(t[1],10),position:t.index});if(a.length>0)for(let e of(a.sort((e,t)=>t.position-e.position),a))r=r.substring(0,e.position)+"?"+r.substring(e.position+`$${e.index}`.length);return(r=(r=(r=r.replace(/"([^"]+)"/g,"`$1`")).replace(/ON CONFLICT\s*\(([^)]+)\)\s*DO UPDATE SET\s*(.+)/gi,(e,t,r)=>{let s=r.replace(/EXCLUDED\.(\w+)/gi,"VALUES($1)");return`ON DUPLICATE KEY UPDATE ${s}`})).replace(/::jsonb/g,"")).replace(/::json/g,"")}async function n(){let{ensureDatabase:t,initializeTables:r}=await e.A(6149);await t(),await r()}async function o(){try{let{testConnection:t}=await e.A(6149);return await t()}catch(e){return!1}}function i(){return"mysql"}e.s(["getDatabaseType",()=>i,"getRow",()=>t,"getRows",()=>r,"initializeDatabase",()=>n,"runQuery",()=>s,"testConnection",()=>o])},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},89124,e=>{"use strict";var t=e.i(47909),r=e.i(74017),s=e.i(96250),a=e.i(59756),n=e.i(61916),o=e.i(14444),i=e.i(10680),l=e.i(69741),u=e.i(16795),c=e.i(87718),d=e.i(95169),p=e.i(47587),E=e.i(66012),g=e.i(70101),h=e.i(26937),R=e.i(10372),A=e.i(93695);e.i(52474);var f=e.i(220),w=e.i(12e3),T=e.i(17939),m=e.i(39142),x=e.i(40911),N=e.i(49632);async function y(e){try{let{name:t,phone:r,password:s}=await e.json().catch(()=>{throw new m.AppError("Invalid JSON in request body",400,"INVALID_JSON")});if(!t||"string"!=typeof t||""===t.trim())throw new m.AppError("نام الزامی است",400,"MISSING_NAME");if(!r||"string"!=typeof r||""===r.trim())throw new m.AppError("شماره تماس الزامی است",400,"MISSING_PHONE");if(!s||"string"!=typeof s||s.length<6)throw new m.AppError("رمز عبور باید حداقل 6 کاراکتر باشد",400,"INVALID_PASSWORD");try{await (0,w.runQuery)(`
        CREATE TABLE IF NOT EXISTS users (
          id VARCHAR(255) PRIMARY KEY,
          name VARCHAR(255) NOT NULL,
          phone VARCHAR(255) UNIQUE NOT NULL,
          password VARCHAR(255) NOT NULL,
          role VARCHAR(50) NOT NULL DEFAULT 'user',
          enabled BOOLEAN DEFAULT TRUE,
          createdAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
          updatedAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
        )
      `)}catch(e){if(e?.code!=="ER_TABLE_EXISTS_ERROR"&&!e?.message?.includes("already exists"))throw x.logger.error("Error creating users table:",e),new m.AppError("خطا در ایجاد جدول کاربران",500,"TABLE_CREATION_ERROR")}if(await (0,w.getRow)("SELECT id FROM users WHERE phone = ?",[r.trim()]))throw new m.AppError("شماره تماس قبلاً ثبت شده است",400,"DUPLICATE_PHONE");let a=await N.default.hash(s,10),n=`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=new Date().toISOString().slice(0,19).replace("T"," ");await (0,w.runQuery)(`INSERT INTO users (id, name, phone, password, role, enabled, createdAt, updatedAt)
       VALUES (?, ?, ?, ?, 'user', TRUE, ?, ?)`,[n,t.trim(),r.trim(),a,o,o]);let i=await (0,w.getRow)("SELECT id, name, phone, role, createdAt FROM users WHERE id = ?",[n]);if(!i)throw new m.AppError("خطا در ایجاد کاربر",500,"USER_CREATION_ERROR");return x.logger.info("User registered successfully:",{id:n,phone:r.trim()}),(0,T.createSuccessResponse)({user:{id:i.id,name:i.name,phone:i.phone,createdAt:i.createdAt},message:"ثبت‌نام با موفقیت انجام شد"})}catch(e){if(x.logger.error("POST /api/auth/register error:",e),e instanceof m.AppError)return(0,T.createErrorResponse)(e);if(e?.message?.includes("not available")||e?.code==="DATABASE_NOT_AVAILABLE"||e?.code==="ECONNREFUSED"||e?.message?.includes("connect"))return(0,T.createErrorResponse)(new m.AppError("دیتابیس در دسترس نیست",503,"DATABASE_NOT_AVAILABLE"));return(0,T.createErrorResponse)(e)}}e.s(["POST",()=>y],81450);var v=e.i(81450);let O=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/auth/register/route.ts",nextConfigOutput:"",userland:v}),{workAsyncStorage:C,workUnitAsyncStorage:S,serverHooks:b}=O;function I(){return(0,s.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:S})}async function U(e,t,s){O.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/auth/register/route";w=w.replace(/\/index$/,"")||"/";let T=await O.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!T)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:m,params:x,nextConfig:N,parsedUrl:y,isDraftMode:v,prerenderManifest:C,routerServerContext:S,isOnDemandRevalidate:b,revalidateOnlyGenerated:I,resolvedPathname:U,clientReferenceManifest:_,serverActionsManifest:P}=T,D=(0,l.normalizeAppPath)(w),L=!!(C.dynamicRoutes[D]||C.routes[U]),M=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,y,!1):t.end("This page could not be found"),null);if(L&&!v){let e=!!C.routes[U],t=C.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(N.experimental.adapterPath)return await M();throw new A.NoFallbackError}}let j=null;!L||O.isDev||v||(j="/index"===(j=U)?"/":j);let H=!0===O.isDev||!L,k=L&&!H;P&&_&&(0,o.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:_,serverActionsManifest:P,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:P})});let $=e.method||"GET",q=(0,n.getTracer)(),F=q.getActiveScopeSpan(),B={params:x,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!N.experimental.authInterrupts},cacheComponents:!!N.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:N.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>O.onRequestError(e,t,s,S)},sharedContext:{buildId:m}},K=new u.NodeNextRequest(e),V=new u.NodeNextResponse(t),W=c.NextRequestAdapter.fromNodeNextRequest(K,(0,c.signalFromNodeResponse)(t));try{let o=async e=>O.handle(W,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=q.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${$} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${w}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var n,l;let u=async({previousCacheEntry:r})=>{try{if(!i&&b&&I&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(a);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&s.waitUntil&&(s.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!L)return await (0,E.sendResponse)(K,V,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[R.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,s=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:b})},S),t}},c=await O.handleResponse({req:e,nextConfig:N,cacheKey:j,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:I,responseGenerator:u,waitUntil:s.waitUntil,isMinimalMode:i});if(!L)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",b?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),v&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,g.fromNodeOutgoingHttpHeaders)(c.value.headers);return i&&L||d.delete(R.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,h.getCacheControlHeader)(c.cacheControl)),await (0,E.sendResponse)(K,V,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};F?await l(F):await q.withPropagatedContext(e.headers,()=>q.trace(d.BaseServerSpan.handleRequest,{spanName:`${$} ${w}`,kind:n.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},l))}catch(t){if(t instanceof A.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:b})}),L)throw t;return await (0,E.sendResponse)(K,V,new Response(null,{status:500})),null}}e.s(["handler",()=>U,"patchFetch",()=>I,"routeModule",()=>O,"serverHooks",()=>b,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>S],89124)},6149,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_util_be9989c7._.js","server/chunks/_19ab7056._.js","server/chunks/[root-of-the-server]__473dce0e._.js"].map(t=>e.l(t))).then(()=>t(85238)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d2531f6a._.js.map
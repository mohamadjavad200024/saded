module.exports=[47349,(a,b,c)=>{"use strict";var d=a.r(72131);d.useState,d.useEffect,d.useLayoutEffect,d.useDebugValue,c.useSyncExternalStore=void 0!==d.useSyncExternalStore?d.useSyncExternalStore:function(a,b){return b()}},87610,(a,b,c)=>{"use strict";b.exports=a.r(47349)},97514,(a,b,c)=>{"use strict";var d=a.r(72131),e=a.r(87610),f="function"==typeof Object.is?Object.is:function(a,b){return a===b&&(0!==a||1/a==1/b)||a!=a&&b!=b},g=e.useSyncExternalStore,h=d.useRef,i=d.useEffect,j=d.useMemo,k=d.useDebugValue;c.useSyncExternalStoreWithSelector=function(a,b,c,d,e){var l=h(null);if(null===l.current){var m={hasValue:!1,value:null};l.current=m}else m=l.current;var n=g(a,(l=j(function(){function a(a){if(!i){if(i=!0,g=a,a=d(a),void 0!==e&&m.hasValue){var b=m.value;if(e(b,a))return h=b}return h=a}if(b=h,f(g,a))return b;var c=d(a);return void 0!==e&&e(b,c)?(g=a,b):(g=a,h=c)}var g,h,i=!1,j=void 0===c?null:c;return[function(){return a(b())},null===j?void 0:function(){return a(j())}]},[b,c,d,e]))[0],l[1]);return i(function(){m.hasValue=!0,m.value=n},[n]),k(n),n}},64442,(a,b,c)=>{"use strict";b.exports=a.r(97514)},33915,a=>{"use strict";let b={get url(){return`file://${a.P("node_modules/zustand/esm/vanilla.mjs")}`}},c=a=>{let c,d=new Set,e=(a,b)=>{let e="function"==typeof a?a(c):a;if(!Object.is(e,c)){let a=c;c=(null!=b?b:"object"!=typeof e||null===e)?e:Object.assign({},c,e),d.forEach(b=>b(c,a))}},f=()=>c,g={setState:e,getState:f,getInitialState:()=>h,subscribe:a=>(d.add(a),()=>d.delete(a)),destroy:()=>{(b.env?b.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),d.clear()}},h=c=a(e,f,g);return g};var d=a.i(72131),e=a.i(64442);let f={get url(){return`file://${a.P("node_modules/zustand/esm/index.mjs")}`}},{useDebugValue:g}=d.default,{useSyncExternalStoreWithSelector:h}=e.default,i=!1,j=a=>{(f.env?f.env.MODE:void 0)!=="production"&&"function"!=typeof a&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let b="function"==typeof a?a?c(a):c:a,d=(a,c)=>(function(a,b=a=>a,c){(f.env?f.env.MODE:void 0)!=="production"&&c&&!i&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),i=!0);let d=h(a.subscribe,a.getState,a.getServerState||a.getInitialState,b,c);return g(d),d})(b,a,c);return Object.assign(d,b),d},k=a=>a?j(a):j;a.s(["create",()=>k],33915)},46058,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},39118,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={DEFAULT_SEGMENT_KEY:function(){return l},PAGE_SEGMENT_KEY:function(){return k},addSearchParamsIfPageSegment:function(){return i},computeSelectedLayoutSegment:function(){return j},getSegmentValue:function(){return f},getSelectedLayoutSegmentPath:function(){return function a(b,c,d=!0,e=[]){let g;if(d)g=b[1][c];else{let a=b[1];g=a.children??Object.values(a)[0]}if(!g)return e;let h=f(g[0]);return!h||h.startsWith(k)?e:(e.push(h),a(g,c,!1,e))}},isGroupSegment:function(){return g},isParallelRouteSegment:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a){return Array.isArray(a)?a[1]:a}function g(a){return"("===a[0]&&a.endsWith(")")}function h(a){return a.startsWith("@")&&"@children"!==a}function i(a,b){if(a.includes(k)){let a=JSON.stringify(b);return"{}"!==a?k+"?"+a:k}return a}function j(a,b){if(!a||0===a.length)return null;let c="children"===b?a[0]:a[a.length-1];return c===l?null:c}let k="__PAGE__",l="__DEFAULT__"},54427,(a,b,c)=>{"use strict";function d(){let a,b,c=new Promise((c,d)=>{a=c,b=d});return{resolve:a,reject:b,promise:c}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"createPromiseWithResolvers",{enumerable:!0,get:function(){return d}})},41997,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={BailoutToCSRError:function(){return g},isBailoutToCSRError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="BAILOUT_TO_CLIENT_SIDE_RENDERING";class g extends Error{constructor(a){super(`Bail out to client-side rendering: ${a}`),this.reason=a,this.digest=f}}function h(a){return"object"==typeof a&&null!==a&&"digest"in a&&a.digest===f}},54917,a=>{"use strict";let b=new class{isDevelopment=!1;shouldLog(a){return"error"===a||"warn"===a||this.isDevelopment}log(...a){this.shouldLog("log")&&console.log(...a)}error(...a){console.error(...a)}warn(...a){console.warn(...a)}info(...a){this.shouldLog("info")&&console.info(...a)}debug(...a){this.shouldLog("debug")&&console.debug(...a)}};a.s(["logger",0,b])},60421,98687,37020,a=>{"use strict";var b=a.i(33915),c=a.i(54917);function d(a=600,b=600){let c=encodeURIComponent(`${a}x${b}`);return`https://placehold.co/${a}x${b}/f3f4f6/9ca3af?text=${c}`}function e(a){if(!a||"string"!=typeof a||""===a.trim())return!1;let b=a.trim();if(b.startsWith("data:image")||b.startsWith("data:"))return!!(b.includes(";base64,")&&b.length>50||b.startsWith("data:image")&&b.length>50)||function(a){if(!a||"string"!=typeof a||!a.startsWith("data:image/")||!a.includes(";base64,"))return!1;let b=a.split(";base64,")[1];return!!b&&""!==b.trim()&&!!/^[A-Za-z0-9+/]*={0,2}$/.test(b)&&!(a.length>0xf00000)&&0!==b.trim().length}(b);if(b.startsWith("blob:")||b.startsWith("/"))return!0;try{let a=new URL(b);return"http:"===a.protocol||"https:"===a.protocol}catch{return!1}}function f(a,b){if(!a||"string"!=typeof a||""===a.trim())return"";let c=a.trim();if(c.startsWith("http://")||c.startsWith("https://")||c.startsWith("data:image")||c.startsWith("data:")||c.startsWith("blob:"))return c;if(c.length>100&&/^[A-Za-z0-9+/=]+$/.test(c))return"";if(c.startsWith("/"))return b?`${b}${c}`:c;try{return new URL(c).toString()}catch{return""}}function g(a){return new Promise((b,c)=>{if(!e(a))return void c(Error("Invalid image URL"));if(a.startsWith("data:image")||a.startsWith("blob:"))return void b();let d=new Image;d.onload=()=>b(),d.onerror=()=>c(Error("Failed to load image")),d.src=a})}function h(a){return!(!a||"string"!=typeof a||a.startsWith("data:image")||a.startsWith("blob:"))&&!a.includes("_t=")&&!a.includes("_retry=")}function i(a){if(!a||"string"!=typeof a||a.startsWith("data:image")||a.startsWith("blob:"))return a;let b=a.includes("?")?"&":"?";return`${a}${b}_t=${Date.now()}`}function j(a){if(null==a)return[];if(Array.isArray(a))return a.filter(a=>null!=a&&"string"==typeof a&&""!==a.trim()).map(a=>a.trim());if("string"==typeof a){if(""===a.trim())return[];try{let b=JSON.parse(a);if(Array.isArray(b))return b.filter(a=>null!=a&&"string"==typeof a&&""!==a.trim()).map(a=>a.trim());if("string"==typeof b&&""!==b.trim())return[b.trim()]}catch(b){return[a.trim()]}}return[]}function k(a){if(null==a)return{};if("object"==typeof a&&null!==a&&!Array.isArray(a))return a;if("string"==typeof a){if(""===a.trim())return{};try{let b=JSON.parse(a);if("object"==typeof b&&null!==b&&!Array.isArray(b))return b}catch(a){}}return{}}a.s(["addCacheBusting",()=>i,"getPlaceholderImage",()=>d,"needsCacheBusting",()=>h,"normalizeImageUrl",()=>f,"preloadImage",()=>g,"validateImageUrl",()=>e],98687),a.s(["normalizeImages",()=>j,"normalizeSpecifications",()=>k],37020);let l={},m=(0,b.create)((a,b)=>({products:[],filters:l,setProducts:b=>{a({products:b.map(a=>{let b=j(a.images).map(a=>{if(!a||"string"!=typeof a)return null;let b=a.trim();if(""===b)return null;if(b.startsWith("data:image")||b.startsWith("data:"))return b.includes(";base64,")&&b.length>50||b.startsWith("data:image")&&b.length>50?b:null;let c=f(b);return c&&e(c)?c:null}).filter(a=>null!==a);return{...a,images:b}})})},addProduct:b=>a(a=>{let c=j(b.images).map(a=>{if(!a||"string"!=typeof a)return null;let b=a.trim();if(""===b)return null;if(b.startsWith("data:image")||b.startsWith("data:"))return b.includes(";base64,")&&b.length>50||b.startsWith("data:image")&&b.length>50?b:null;let c=f(b);return c&&e(c)?c:null}).filter(a=>null!==a),d={...b,images:c,inStock:void 0===b.inStock||!!b.inStock,enabled:void 0===b.enabled||!!b.enabled,vinEnabled:void 0!==b.vinEnabled&&!!b.vinEnabled,airShippingEnabled:void 0===b.airShippingEnabled||!!b.airShippingEnabled,seaShippingEnabled:void 0===b.seaShippingEnabled||!!b.seaShippingEnabled},g=a.products.findIndex(a=>a.id===d.id);if(g>=0){let b=[...a.products];return b[g]=d,{products:b}}return{products:[...a.products,d]}}),updateProduct:b=>a(a=>{let c=j(b.images).map(a=>{if(!a||"string"!=typeof a)return null;let b=a.trim();if(""===b)return null;if(b.startsWith("data:image")||b.startsWith("data:"))return b.includes(";base64,")&&b.length>50||b.startsWith("data:image")&&b.length>50?b:null;let c=f(b);return c&&e(c)?c:null}).filter(a=>null!==a),d={...b,images:c,inStock:void 0===b.inStock||!!b.inStock,enabled:void 0===b.enabled||!!b.enabled,vinEnabled:void 0!==b.vinEnabled&&!!b.vinEnabled,airShippingEnabled:void 0===b.airShippingEnabled||!!b.airShippingEnabled,seaShippingEnabled:void 0===b.seaShippingEnabled||!!b.seaShippingEnabled},g=a.products.findIndex(a=>a.id===d.id);if(g>=0){let b=[...a.products];return b[g]=d,{products:b}}return a}),removeProduct:b=>a(a=>({products:a.products.filter(a=>a.id!==b)})),getProduct:a=>b().products.find(b=>b.id===a),getEnabledProducts:()=>b().products.filter(a=>a.enabled),getFilteredProducts:()=>{let{products:a,filters:c}=b(),d=a.filter(a=>a.enabled);if(c.search){let a=c.search.toLowerCase();d=d.filter(b=>!!(b.name?.toLowerCase().includes(a)||b.description?.toLowerCase().includes(a)||b.brand?.toLowerCase().includes(a)||b.category?.toLowerCase().includes(a)||b.vin?.toLowerCase().includes(a)||Array.isArray(b.tags)&&b.tags.some(b=>b?.toLowerCase().includes(a))||b.specifications&&"object"==typeof b.specifications&&JSON.stringify(b.specifications).toLowerCase().includes(a))||!1)}return void 0!==c.minPrice&&(d=d.filter(a=>a.price>=c.minPrice)),void 0!==c.maxPrice&&(d=d.filter(a=>a.price<=c.maxPrice)),c.brands&&c.brands.length>0&&(d=d.filter(a=>a.brand&&c.brands.includes(a.brand))),c.categories&&c.categories.length>0&&(d=d.filter(a=>a.category&&c.categories.includes(a.category))),c.vehicle&&(d=d.filter(a=>a.vehicle===c.vehicle)),void 0!==c.inStock&&(d=d.filter(a=>a.inStock===c.inStock)),d},setFilters:b=>a(a=>{let c={...a.filters};return Object.keys(b).forEach(a=>{let d=b[a];null==d||Array.isArray(d)&&0===d.length?delete c[a]:c[a]=d}),{filters:c}}),clearFilters:()=>a({filters:l}),createProduct:async a=>{let c=await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!c.ok)throw Error((await c.json().catch(()=>({}))).message||"خطا در ایجاد محصول");let d=(await c.json()).data;return b().addProduct(d),d},updateProductInDB:async(a,c)=>{let d=await fetch(`/api/products/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!d.ok)throw Error((await d.json().catch(()=>({}))).message||"خطا در به‌روزرسانی محصول");let e=(await d.json()).data;return b().updateProduct(e),e},deleteProductFromDB:async a=>{let c=await fetch(`/api/products/${a}`,{method:"DELETE"});if(!c.ok)throw Error((await c.json().catch(()=>({}))).message||"خطا در حذف محصول");b().removeProduct(a)},loadProductsFromDB:async(a=!1)=>{try{let c=await fetch(a?"/api/products?limit=1000&all=true":"/api/products?limit=1000");if(!c.ok){let a=await c.json().catch(()=>({})),b=a.error||a.message||"خطا در بارگذاری محصولات";throw Error(b)}let d=((await c.json()).data||[]).map(a=>{let b=j(a.images).map(a=>{if(!a||"string"!=typeof a)return null;let b=a.trim();if(""===b)return null;if(b.startsWith("data:image")||b.startsWith("data:"))if(b.includes(";base64,")&&b.length>50)return b;else if(b.startsWith("data:image")&&b.length>50)return b;else return null;let c=f(b);return c?e(c)?c:null:null}).filter(a=>null!==a);return{...a,images:b,specifications:k(a.specifications),inStock:void 0===a.inStock||!!a.inStock,enabled:void 0===a.enabled||!!a.enabled,vinEnabled:void 0!==a.vinEnabled&&!!a.vinEnabled,airShippingEnabled:void 0===a.airShippingEnabled||!!a.airShippingEnabled,seaShippingEnabled:void 0===a.seaShippingEnabled||!!a.seaShippingEnabled,createdAt:a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt),updatedAt:a.updatedAt instanceof Date?a.updatedAt:new Date(a.updatedAt)}});b().setProducts(d)}catch(a){c.logger.error("Error loading products from DB:",a)}},deleteProduct:async a=>{await b().deleteProductFromDB(a)},deleteProducts:async a=>{await Promise.all(a.map(a=>b().deleteProductFromDB(a)))},toggleProduct:async a=>{let c=b().getProduct(a);c&&await b().updateProductInDB(a,{enabled:!c.enabled})},toggleProducts:async(a,c)=>{await Promise.all(a.map(a=>b().updateProductInDB(a,{enabled:c})))}}));a.s(["useProductStore",0,m],60421)}];

//# sourceMappingURL=_71b18ae7._.js.map
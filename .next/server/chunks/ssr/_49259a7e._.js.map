{"version":3,"sources":["../../../../app/admin/login/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { Lock, Loader2 } from \"lucide-react\";\r\nimport { useAuthStore } from \"@/store/auth-store\";\r\n\r\nexport default function AdminLoginPage() {\r\n  const [password, setPassword] = useState(\"\");\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n  const router = useRouter();\r\n  const { user, isAuthenticated, hasCheckedAuth } = useAuthStore();\r\n\r\n  // Redirect if already authenticated as admin\r\n  useEffect(() => {\r\n    if (hasCheckedAuth && isAuthenticated && user?.role === \"admin\") {\r\n      router.push(\"/admin\");\r\n    }\r\n  }, [hasCheckedAuth, isAuthenticated, user, router]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!password.trim()) {\r\n      toast({\r\n        title: \"خطا\",\r\n        description: \"لطفاً رمز عبور را وارد کنید\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    \r\n    try {\r\n      const response = await fetch(\"/api/admin/login\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        credentials: \"include\",\r\n        body: JSON.stringify({ password }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        toast({\r\n          title: \"موفق\",\r\n          description: \"ورود با موفقیت انجام شد\",\r\n        });\r\n        \r\n        // Update store immediately from response\r\n        const { useAuthStore } = await import(\"@/store/auth-store\");\r\n        if (result.data?.user) {\r\n          useAuthStore.setState({\r\n            user: {\r\n              id: result.data.user.id,\r\n              name: result.data.user.name,\r\n              phone: result.data.user.phone || \"\",\r\n              role: result.data.user.role || \"admin\",\r\n              createdAt: result.data.user.createdAt || new Date().toISOString(),\r\n            },\r\n            isAuthenticated: true,\r\n            hasCheckedAuth: true, // Mark as checked since we got user from server\r\n          });\r\n        }\r\n        \r\n        // Redirect immediately - cookie is set by server\r\n        router.push(\"/admin\");\r\n      } else {\r\n        toast({\r\n          title: \"خطا\",\r\n          description: result.error || \"رمز عبور اشتباه است\",\r\n          variant: \"destructive\",\r\n        });\r\n      }\r\n    } catch (error: any) {\r\n      toast({\r\n        title: \"خطا\",\r\n        description: error.message || \"خطا در اتصال به سرور\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-muted p-4\">\r\n      <Card className=\"w-full max-w-md\">\r\n        <CardHeader className=\"space-y-1 text-center\">\r\n          <div className=\"flex justify-center mb-4\">\r\n            <div className=\"p-3 bg-primary/10 rounded-full\">\r\n              <Lock className=\"h-8 w-8 text-primary\" />\r\n            </div>\r\n          </div>\r\n          <CardTitle className=\"text-2xl font-bold\">ورود ادمین</CardTitle>\r\n          <CardDescription>\r\n            برای دسترسی به پنل مدیریت، رمز عبور ادمین را وارد کنید\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"password\">رمز عبور ادمین</Label>\r\n              <Input\r\n                id=\"password\"\r\n                type=\"password\"\r\n                placeholder=\"رمز عبور را وارد کنید\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                disabled={isLoading}\r\n                autoFocus\r\n                className=\"text-center\"\r\n              />\r\n            </div>\r\n            <Button\r\n              type=\"submit\"\r\n              className=\"w-full\"\r\n              disabled={isLoading}\r\n            >\r\n              {isLoading ? (\r\n                <>\r\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                  در حال ورود...\r\n                </>\r\n              ) : (\r\n                \"ورود\"\r\n              )}\r\n            </Button>\r\n          </form>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACtB,GAAM,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACnC,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAS,IACrC,OAAE,CAAK,CAAE,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,IACpB,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,CAAE,MAAI,iBAAE,CAAe,gBAAE,CAAc,CAAE,CAAG,CAAA,EAAA,EAAA,YAAA,AAAY,IAG9D,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACJ,GAAkB,GAAmB,GAAM,OAAS,SAAS,AAC/D,EAAO,IAAI,CAAC,SAEhB,EAAG,CAAC,EAAgB,EAAiB,EAAM,EAAO,EAElD,IAAM,EAAe,MAAO,IAG1B,GAFA,EAAE,cAAc,GAEZ,CAAC,EAAS,IAAI,GAAI,YACpB,EAAM,CACJ,MAAO,MACP,YAAa,8BACb,QAAS,aACX,GAIF,GAAa,GAEb,GAAI,CACF,IAAM,EAAW,MAAM,MAAM,mBAAoB,CAC/C,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,YAAa,UACb,KAAM,KAAK,SAAS,CAAC,CAAE,UAAS,EAClC,GAEM,EAAS,MAAM,EAAS,IAAI,GAElC,GAAI,EAAO,OAAO,CAAE,CAClB,EAAM,CACJ,MAAO,OACP,YAAa,yBACf,GAGA,GAAM,CAAE,cAAY,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,OACrB,EAAO,IAAI,EAAE,MAAM,AACrB,EAAa,QAAQ,CAAC,CACpB,KAAM,CACJ,GAAI,EAAO,IAAI,CAAC,IAAI,CAAC,EAAE,CACvB,KAAM,EAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAC3B,MAAO,EAAO,IAAI,CAAC,IAAI,CAAC,KAAK,EAAI,GACjC,KAAM,EAAO,IAAI,CAAC,IAAI,CAAC,IAAI,EAAI,QAC/B,UAAW,EAAO,IAAI,CAAC,IAAI,CAAC,SAAS,EAAI,IAAI,OAAO,WAAW,EACjE,EACA,iBAAiB,EACjB,gBAAgB,CAClB,GAIF,EAAO,IAAI,CAAC,SACd,MACE,CADK,CACC,CACJ,MAAO,MACP,YAAa,EAAO,KAAK,EAAI,sBAC7B,QAAS,aACX,EAEJ,CAAE,MAAO,EAAY,CACnB,EAAM,CACJ,MAAO,MACP,YAAa,EAAM,OAAO,EAAI,uBAC9B,QAAS,aACX,EACF,QAAU,CACR,GAAa,EACf,CACF,EAEA,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wGACb,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,4BACd,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,UAAU,CAAA,CAAC,UAAU,kCACpB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,0CACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,6BAGpB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,8BAAqB,eAC1C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,8DAInB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UACV,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,SAAU,EAAc,UAAU,sBACtC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,QAAQ,oBAAW,mBAC1B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CACJ,GAAG,WACH,KAAK,WACL,YAAY,wBACZ,MAAO,EACP,SAAU,AAAC,GAAM,EAAY,EAAE,MAAM,CAAC,KAAK,EAC3C,SAAU,EACV,SAAS,CAAA,CAAA,EACT,UAAU,mBAGd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,KAAK,SACL,UAAU,SACV,SAAU,WAET,EACC,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,UAAU,8BAA8B,oBAInD,kBAQhB"}
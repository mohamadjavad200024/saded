module.exports=[64278,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(88237),e=a.i(40695),f=a.i(54161),g=a.i(46143),h=a.i(76504),i=a.i(17755),j=a.i(24569),k=a.i(81560),l=a.i(77156),m=a.i(41379),n=a.i(60421),o=a.i(77687),p=a.i(38246),q=a.i(32336),r=a.i(65733);function s({products:a,onRefresh:s}){let[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(null),{deleteProduct:z,toggleProduct:A,deleteProducts:B,toggleProducts:C}=(0,n.useProductStore)(),{toast:D}=(0,o.useToast)(),E=async()=>{if(x)try{await z(x),D({title:"موفق",description:"محصول با موفقیت حذف شد"}),w(!1),y(null),s?.()}catch(a){D({title:"خطا",description:a instanceof Error?a.message:"خطا در حذف محصول",variant:"destructive"})}},F=async()=>{if(t.length>0)try{await B(t),D({title:"موفق",description:`${t.length} محصول حذف شد`}),u([]),s?.()}catch(a){D({title:"خطا",description:a instanceof Error?a.message:"خطا در حذف محصولات",variant:"destructive"})}},G=async a=>{try{await A(a),D({title:"موفق",description:"وضعیت محصول تغییر کرد"}),s?.()}catch(a){D({title:"خطا",description:a instanceof Error?a.message:"خطا در تغییر وضعیت محصول",variant:"destructive"})}},H=async a=>{if(t.length>0)try{await C(t,a),D({title:"موفق",description:`${t.length} محصول ${a?"فعال":"غیرفعال"} شد`}),u([]),s?.()}catch(a){D({title:"خطا",description:a instanceof Error?a.message:"خطا در تغییر وضعیت محصولات",variant:"destructive"})}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-4",children:[t.length>0&&(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[(0,b.jsxs)("span",{className:"text-sm font-medium",children:[t.length," محصول انتخاب شده"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>H(!0),children:[(0,b.jsx)(l.Eye,{className:"ml-2 h-4 w-4"}),"فعال کردن"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>H(!1),children:[(0,b.jsx)(m.EyeOff,{className:"ml-2 h-4 w-4"}),"غیرفعال کردن"]}),(0,b.jsxs)(e.Button,{variant:"destructive",size:"sm",onClick:F,children:[(0,b.jsx)(k.Trash2,{className:"ml-2 h-4 w-4"}),"حذف"]})]})]}),(0,b.jsx)("div",{className:"rounded-lg border border-border/30 shadow-sm overflow-hidden",children:(0,b.jsxs)(d.Table,{children:[(0,b.jsx)(d.TableHeader,{className:"bg-muted/50",children:(0,b.jsxs)(d.TableRow,{children:[(0,b.jsx)(d.TableHead,{className:"w-12",children:(0,b.jsx)(g.Checkbox,{checked:a.length>0&&t.length===a.length,onCheckedChange:b=>{b?u(a.map(a=>a.id)):u([])}})}),(0,b.jsx)(d.TableHead,{children:"تصویر"}),(0,b.jsx)(d.TableHead,{children:"نام"}),(0,b.jsx)(d.TableHead,{children:"برند"}),(0,b.jsx)(d.TableHead,{children:"دسته‌بندی"}),(0,b.jsx)(d.TableHead,{children:"قیمت"}),(0,b.jsx)(d.TableHead,{children:"موجودی"}),(0,b.jsx)(d.TableHead,{children:"وضعیت"}),(0,b.jsx)(d.TableHead,{className:"text-left",children:"عملیات"})]})}),(0,b.jsx)(d.TableBody,{children:0===a.length?(0,b.jsx)(d.TableRow,{children:(0,b.jsx)(d.TableCell,{colSpan:9,className:"text-center py-8",children:"محصولی یافت نشد"})}):a.map(a=>{let c;return(0,b.jsxs)(d.TableRow,{children:[(0,b.jsx)(d.TableCell,{children:(0,b.jsx)(g.Checkbox,{checked:t.includes(a.id),onCheckedChange:b=>{var c;return c=a.id,void(b?u([...t,c]):u(t.filter(a=>a!==c)))}})}),(0,b.jsx)(d.TableCell,{children:(0,b.jsx)("div",{className:"relative w-14 h-14 rounded-lg overflow-hidden border-2 border-border/30 shadow-sm group",children:a.images&&Array.isArray(a.images)&&a.images.length>0&&a.images[0]?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.SafeImage,{src:a.images[0],alt:a.name,fill:!0,className:"object-cover transition-transform group-hover:scale-110",productId:a.id,priority:!0,loading:"eager",onError:()=>{}}),a.images.length>1&&(0,b.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-xs px-1 py-0.5 text-center z-10",children:["+",a.images.length-1]})]}):(0,b.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-muted to-muted/50 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs text-muted-foreground font-medium",children:"بدون تصویر"})})})}),(0,b.jsx)(d.TableCell,{className:"font-medium",children:a.name}),(0,b.jsx)(d.TableCell,{children:a.brand}),(0,b.jsx)(d.TableCell,{children:a.category}),(0,b.jsxs)(d.TableCell,{children:[(c=a.price,new Intl.NumberFormat("fa-IR").format(c))," تومان"]}),(0,b.jsx)(d.TableCell,{children:(0,b.jsx)(f.Badge,{variant:a.stockCount<10?"warning":"success",children:a.stockCount})}),(0,b.jsx)(d.TableCell,{children:(0,b.jsx)(f.Badge,{variant:a.enabled?"success":"secondary",children:a.enabled?"فعال":"غیرفعال"})}),(0,b.jsx)(d.TableCell,{children:(0,b.jsxs)(h.DropdownMenu,{children:[(0,b.jsx)(h.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(i.MoreHorizontal,{className:"h-4 w-4"})})}),(0,b.jsxs)(h.DropdownMenuContent,{align:"end",children:[(0,b.jsx)(h.DropdownMenuLabel,{children:"عملیات"}),(0,b.jsx)(h.DropdownMenuSeparator,{}),(0,b.jsx)(h.DropdownMenuItem,{asChild:!0,children:(0,b.jsxs)(p.default,{href:`/admin/products/${a.id}`,children:[(0,b.jsx)(j.Edit,{className:"ml-2 h-4 w-4"}),"ویرایش"]})}),(0,b.jsx)(h.DropdownMenuItem,{onClick:()=>G(a.id),children:a.enabled?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.EyeOff,{className:"ml-2 h-4 w-4"}),"غیرفعال کردن"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Eye,{className:"ml-2 h-4 w-4"}),"فعال کردن"]})}),(0,b.jsx)(h.DropdownMenuSeparator,{}),(0,b.jsxs)(h.DropdownMenuItem,{className:"text-destructive",onClick:()=>{y(a.id),w(!0)},children:[(0,b.jsx)(k.Trash2,{className:"ml-2 h-4 w-4"}),"حذف"]})]})]})})]},a.id)})})]})})]}),(0,b.jsx)(r.Dialog,{open:v,onOpenChange:w,children:(0,b.jsxs)(r.DialogContent,{children:[(0,b.jsxs)(r.DialogHeader,{children:[(0,b.jsx)(r.DialogTitle,{children:"حذف محصول"}),(0,b.jsx)(r.DialogDescription,{children:"آیا از حذف این محصول اطمینان دارید؟ این عمل قابل بازگشت نیست."})]}),(0,b.jsxs)(r.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>w(!1),children:"انصراف"}),(0,b.jsx)(e.Button,{variant:"destructive",onClick:E,children:"حذف"})]})]})})]})}var t=a.i(5522),u=a.i(3130),v=a.i(87682),w=a.i(15618),x=a.i(87532),y=a.i(84505),z=a.i(81464),A=a.i(89078),B=a.i(50944);function C(){let{products:a,setFilters:d,clearFilters:f,filters:g,loadProductsFromDB:h}=(0,n.useProductStore)(),{refreshStats:i}=(0,A.useAdminStore)(),j=(0,B.usePathname)(),[k,l]=(0,c.useState)(g.search||""),[m,o]=(0,c.useState)(g.categories?.[0]||"all"),[q,r]=(0,c.useState)("all"),[C,D]=(0,c.useState)(!0),[E,F]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{D(!0);try{await h(!0)}catch(a){console.error("Error loading products:",a)}finally{D(!1)}})()},[h,j]),(0,c.useEffect)(()=>{let a=()=>{h(!0)},b=()=>{h(!0)},c=a=>{("product-created"===a.key||"product-updated"===a.key)&&h(!0)};return window.addEventListener("product-created",a),window.addEventListener("product-updated",b),window.addEventListener("storage",c),()=>{window.removeEventListener("product-created",a),window.removeEventListener("product-updated",b),window.removeEventListener("storage",c)}},[h]),(0,c.useEffect)(()=>{i()},[i,a]);let G=(0,c.useMemo)(()=>{let b=a;if(b=b.filter(a=>{let b=a.name.toLowerCase();return!(b.includes("test")||b.includes("تست"))}),k){let a=k.toLowerCase();b=b.filter(b=>b.name.toLowerCase().includes(a)||b.brand?.toLowerCase().includes(a)||b.description?.toLowerCase().includes(a))}return"all"!==m&&(b=b.filter(a=>a.category===m)),"active"===q?b=b.filter(a=>a.enabled):"inactive"===q&&(b=b.filter(a=>!a.enabled)),b},[a,k,m,q]),H=Array.from(new Set(a.map(a=>a.category).filter(a=>!!a)));return(0,b.jsxs)("div",{className:"space-y-6",children:[E&&(0,b.jsxs)(u.Card,{className:"shadow-sm",children:[(0,b.jsx)(u.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,b.jsx)(u.CardTitle,{children:"فیلترها و جستجو"})}),(0,b.jsxs)(u.CardContent,{children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"جستجو"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(x.Search,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(t.Input,{placeholder:"جستجو در محصولات...",value:k,onChange:a=>{var b;l(b=a.target.value),b?d({search:b}):f()},className:"pr-10"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"دسته‌بندی"}),(0,b.jsxs)(v.Select,{value:m,onValueChange:o,children:[(0,b.jsx)(v.SelectTrigger,{children:(0,b.jsx)(v.SelectValue,{placeholder:"همه دسته‌بندی‌ها"})}),(0,b.jsxs)(v.SelectContent,{children:[(0,b.jsx)(v.SelectItem,{value:"all",children:"همه دسته‌بندی‌ها"}),H.map(a=>(0,b.jsx)(v.SelectItem,{value:a,children:a},a))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"وضعیت"}),(0,b.jsxs)(v.Select,{value:q,onValueChange:r,children:[(0,b.jsx)(v.SelectTrigger,{children:(0,b.jsx)(v.SelectValue,{placeholder:"همه وضعیت‌ها"})}),(0,b.jsxs)(v.SelectContent,{children:[(0,b.jsx)(v.SelectItem,{value:"all",children:"همه وضعیت‌ها"}),(0,b.jsx)(v.SelectItem,{value:"active",children:"فعال"}),(0,b.jsx)(v.SelectItem,{value:"inactive",children:"غیرفعال"})]})]})]})]}),(k||"all"!==m||"all"!==q)&&(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{l(""),o("all"),r("all"),f()},children:"پاک کردن فیلترها"})})]})]}),(0,b.jsxs)(u.Card,{className:"shadow-sm",children:[(0,b.jsx)(u.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(u.CardTitle,{children:["محصولات (",G.length,")"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(e.Button,{variant:E?"default":"outline",onClick:()=>F(!E),size:"sm",children:[(0,b.jsx)(z.Filter,{className:"ml-2 h-4 w-4"}),"فیلتر"]}),(0,b.jsxs)(e.Button,{variant:"outline",onClick:()=>{let a=new Blob([[["نام","برند","دسته‌بندی","قیمت","موجودی","وضعیت"],...G.map(a=>[a.name,a.brand,a.category,a.price.toString(),a.stockCount.toString(),a.enabled?"فعال":"غیرفعال"])].map(a=>a.join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a");b.href=URL.createObjectURL(a),b.download=`products-${new Date().toISOString()}.csv`,b.click()},size:"sm",children:[(0,b.jsx)(y.Download,{className:"ml-2 h-4 w-4"}),"خروجی CSV"]}),(0,b.jsx)(e.Button,{asChild:!0,size:"sm",children:(0,b.jsxs)(p.default,{href:"/admin/products/new",children:[(0,b.jsx)(w.Plus,{className:"ml-2 h-4 w-4"}),"محصول جدید"]})})]})]})}),(0,b.jsx)(u.CardContent,{children:C?(0,b.jsx)("div",{className:"text-center py-12",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"در حال بارگذاری محصولات..."})}):(0,b.jsx)(s,{products:G,onRefresh:async()=>{await h(!0),i()}})})]})]})}a.s(["default",()=>C],64278)}];

//# sourceMappingURL=app_admin_products_page_tsx_1f5d0787._.js.map
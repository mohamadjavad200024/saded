{"version":3,"sources":["../../../../components/chat/quick-buy-chat.tsx","../../../../node_modules/.pnpm/lucide-react%400.344.0_react%4019.2.0/node_modules/lucide-react/src/icons/pause.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect, useCallback } from \"react\";\nimport {\n  Sheet,\n  SheetTrigger,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n  SheetDescription,\n} from \"@/components/ui/sheet\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Send,\n  MessageCircle,\n  Phone,\n  Mail,\n  Image,\n  Paperclip,\n  MapPin,\n  FileText,\n  X,\n  Mic,\n  Square,\n  Play,\n  Pause,\n  Loader2,\n  Check,\n  CheckCheck,\n  Reply,\n  Edit2,\n  Trash2,\n  MoreVertical,\n  ChevronDown,\n} from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useNotifications } from \"@/hooks/use-notifications\";\nimport { OnlineStatusBadge } from \"@/components/chat/online-status-badge\";\nimport { useAdminPresence } from \"@/hooks/use-admin-presence\";\nimport { usePersistentNotifications } from \"@/hooks/use-persistent-notifications\";\nimport { TypingIndicator } from \"@/components/chat/typing-indicator\";\nimport { logger } from \"@/lib/logger-client\";\n\ntype MessageStatus = \"sending\" | \"sent\" | \"delivered\" | \"read\";\n\ninterface Message {\n  id: string;\n  text: string;\n  sender: \"user\" | \"support\";\n  timestamp: Date;\n  attachments?: Attachment[];\n  status?: MessageStatus;\n}\n\ninterface Attachment {\n  id: string;\n  type: \"image\" | \"file\" | \"location\" | \"audio\";\n  url?: string;\n  name?: string;\n  size?: number;\n  duration?: number;\n}\n\ninterface QuickBuyChatProps {\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  trigger?: React.ReactNode;\n}\n\nexport function QuickBuyChat({ isOpen, onOpenChange, trigger }: QuickBuyChatProps): React.ReactElement {\n  const { toast } = useToast();\n  const { showNotification, requestPermission } = useNotifications();\n  const { showMessageNotification } = usePersistentNotifications();\n  const { isOnline, lastSeen, checkStatus } = useAdminPresence({\n    enabled: true,\n    heartbeatInterval: 20000, // 20 seconds for user side\n  });\n  const [messages, setMessages] = useState<Message[]>([\n    {\n      id: \"1\",\n      text: \"سلام! خوش آمدید. برای خرید سریع لطفاً اطلاعات زیر را وارد کنید:\",\n      sender: \"support\",\n      timestamp: new Date(),\n    },\n  ]);\n  const [message, setMessage] = useState(\"\");\n  const [replyingTo, setReplyingTo] = useState<Message | null>(null);\n  const [editingMessage, setEditingMessage] = useState<Message | null>(null);\n  \n  // Load customer info from localStorage on mount with expiration check\n  const loadCustomerInfo = () => {\n    if (typeof window !== \"undefined\") {\n      const saved = localStorage.getItem(\"quickBuyChat_customerInfo\");\n      const savedTimestamp = localStorage.getItem(\"quickBuyChat_customerInfo_timestamp\");\n      \n      if (saved) {\n        try {\n          const data = JSON.parse(saved);\n          // Check if session is still valid (30 days)\n          if (savedTimestamp) {\n            const timestamp = parseInt(savedTimestamp, 10);\n            const daysSinceSaved = (Date.now() - timestamp) / (1000 * 60 * 60 * 24);\n            \n            if (daysSinceSaved > 30) {\n              // Session expired, clear old data\n              localStorage.removeItem(\"quickBuyChat_customerInfo\");\n              localStorage.removeItem(\"quickBuyChat_customerInfo_timestamp\");\n              localStorage.removeItem(\"quickBuyChat_chatId\");\n              return { name: \"\", phone: \"\", email: \"\" };\n            }\n          }\n          \n          return data;\n        } catch {\n          // Clear corrupted data\n          localStorage.removeItem(\"quickBuyChat_customerInfo\");\n          localStorage.removeItem(\"quickBuyChat_customerInfo_timestamp\");\n          return { name: \"\", phone: \"\", email: \"\" };\n        }\n      }\n    }\n    return { name: \"\", phone: \"\", email: \"\" };\n  };\n\n  // Load chatId from localStorage\n  const loadChatId = () => {\n    if (typeof window !== \"undefined\") {\n      return localStorage.getItem(\"quickBuyChat_chatId\");\n    }\n    return null;\n  };\n\n  const [customerInfo, setCustomerInfo] = useState(loadCustomerInfo);\n  const [step, setStep] = useState<\"info\" | \"chat\">(\"info\");\n  const [attachments, setAttachments] = useState<Attachment[]>([]);\n  const [showAttachmentOptions, setShowAttachmentOptions] = useState(false);\n  \n  // Voice recording states\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordingTime, setRecordingTime] = useState(0);\n  const [audioBlob, setAudioBlob] = useState<Blob | null>(null);\n  const [audioUrl, setAudioUrl] = useState<string | null>(null);\n  const [isPlayingAudio, setIsPlayingAudio] = useState<string | null>(null);\n  const [recordingPermission, setRecordingPermission] = useState<boolean | null>(null);\n  const [showPermissionGuide, setShowPermissionGuide] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [chatId, setChatId] = useState<string | null>(loadChatId());\n  const [isPolling, setIsPolling] = useState(false);\n  const [isSupportTyping, setIsSupportTyping] = useState(false);\n  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const typingPollIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  \n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const pollingIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const recordingIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const audioRefs = useRef<{ [key: string]: HTMLAudioElement }>({});\n  const lastPolledMessageIdRef = useRef<string | null>(null);\n  const processedNotificationIdsRef = useRef<Set<string>>(new Set());\n  const notificationDebounceRef = useRef<Map<string, NodeJS.Timeout>>(new Map());\n  const lastNotificationTimeRef = useRef<Map<string, number>>(new Map());\n  const systemMessageShownRef = useRef<boolean>(false);\n  const systemMessageIdRef = useRef<string | null>(null);\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const imageInputRef = useRef<HTMLInputElement>(null);\n  const hasScrolledOnOpenRef = useRef<boolean>(false);\n  const lastUserMessageIdRef = useRef<string | null>(null);\n  const [showScrollToBottom, setShowScrollToBottom] = useState(false);\n\n  // Check if user is scrolled up\n  const checkScrollPosition = useCallback(() => {\n    if (!messagesContainerRef.current || step !== \"chat\") {\n      setShowScrollToBottom(false);\n      return;\n    }\n    const container = messagesContainerRef.current;\n    const threshold = 150; // 150px threshold\n    const scrollBottom = container.scrollHeight - container.scrollTop - container.clientHeight;\n    const isScrolledUp = scrollBottom > threshold;\n    setShowScrollToBottom(isScrolledUp);\n  }, [step]);\n\n  // Scroll to bottom function\n  const scrollToBottom = useCallback((instant = false) => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ \n        behavior: instant ? \"auto\" : \"smooth\",\n        block: \"end\"\n      });\n      // Hide button after scrolling\n      setTimeout(() => {\n        setShowScrollToBottom(false);\n      }, 300);\n    }\n  }, []);\n\n  // Track scroll position\n  useEffect(() => {\n    const container = messagesContainerRef.current;\n    if (!container || step !== \"chat\") {\n      setShowScrollToBottom(false);\n      return;\n    }\n\n    const handleScroll = () => {\n      checkScrollPosition();\n    };\n\n    // Check position when messages change\n    const checkOnMessagesChange = () => {\n      setTimeout(() => {\n        checkScrollPosition();\n      }, 100);\n    };\n\n    container.addEventListener(\"scroll\", handleScroll, { passive: true });\n    // Check initial position\n    checkScrollPosition();\n    checkOnMessagesChange();\n    \n    return () => {\n      container.removeEventListener(\"scroll\", handleScroll);\n    };\n  }, [step, checkScrollPosition, messages.length]);\n\n  // Scroll to bottom only when chat step is opened (first time)\n  useEffect(() => {\n    if (step === \"chat\" && messages.length > 0 && !hasScrolledOnOpenRef.current) {\n      // Scroll only once when opening chat\n      hasScrolledOnOpenRef.current = true;\n      const timeout = setTimeout(() => {\n        scrollToBottom(true);\n        // Check position after scroll to hide button\n        setTimeout(() => {\n          checkScrollPosition();\n        }, 500);\n      }, 200);\n      return () => clearTimeout(timeout);\n    }\n  }, [step, scrollToBottom, checkScrollPosition]);\n\n  // Reset scroll flag when chat closes\n  useEffect(() => {\n    if (step !== \"chat\") {\n      hasScrolledOnOpenRef.current = false;\n    }\n  }, [step]);\n\n  // Scroll to bottom only when user sends a message\n  useEffect(() => {\n    if (messages.length > 0 && step === \"chat\") {\n      const lastMessage = messages[messages.length - 1];\n      const isNewUserMessage = lastMessage.id === lastUserMessageIdRef.current;\n      \n      // Only scroll if user just sent a message\n      if (isNewUserMessage && lastMessage.sender === \"user\") {\n        const timeout = setTimeout(() => {\n          scrollToBottom(false);\n          // Check position after scroll to hide button\n          setTimeout(() => {\n            checkScrollPosition();\n          }, 500);\n        }, 150);\n        return () => clearTimeout(timeout);\n      } else {\n        // Check position when messages change (for new support messages)\n        const checkTimeout = setTimeout(() => {\n          checkScrollPosition();\n        }, 200);\n        return () => clearTimeout(checkTimeout);\n      }\n    }\n  }, [messages, step, scrollToBottom, checkScrollPosition]);\n\n  // Save customer info and chatId to localStorage whenever they change\n  useEffect(() => {\n    if (typeof window !== \"undefined\" && customerInfo.name && customerInfo.phone) {\n      localStorage.setItem(\"quickBuyChat_customerInfo\", JSON.stringify(customerInfo));\n      // Save timestamp for expiration check\n      localStorage.setItem(\"quickBuyChat_customerInfo_timestamp\", Date.now().toString());\n    }\n  }, [customerInfo]);\n\n  useEffect(() => {\n    if (typeof window !== \"undefined\" && chatId) {\n      localStorage.setItem(\"quickBuyChat_chatId\", chatId);\n    }\n  }, [chatId]);\n\n  useEffect(() => {\n    if (!isOpen) {\n      // Reset state when chat is closed (but keep customer info in localStorage)\n      setStep(\"info\");\n      setMessage(\"\");\n      setAttachments([]);\n      setShowAttachmentOptions(false);\n      setIsRecording(false);\n      setRecordingTime(0);\n      setAudioBlob(null);\n      setAudioUrl(null);\n      setIsPlayingAudio(null);\n      if (recordingIntervalRef.current) {\n        clearInterval(recordingIntervalRef.current);\n      }\n      if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\n        mediaRecorderRef.current.stop();\n      }\n      // Stop polling when chat closes\n      if (pollingIntervalRef.current) {\n        clearInterval(pollingIntervalRef.current);\n        pollingIntervalRef.current = null;\n      }\n      setIsPolling(false);\n      // Don't reset customerInfo, messages, or chatId - keep them for next time\n      // Messages will be loaded from database when chat opens again\n    } else {\n      // When chat opens, load customer info and chat history\n      const savedInfo = loadCustomerInfo();\n      const savedChatId = loadChatId();\n\n      if (savedInfo.name && savedInfo.phone) {\n        // Auto-restore: if we have saved info, go directly to chat\n        setCustomerInfo(savedInfo);\n        setStep(\"chat\"); // Set step to chat immediately\n        // Load chat history from database\n        loadChatHistory(savedInfo, savedChatId);\n      } else {\n        // No saved info, show info form\n        setStep(\"info\");\n        setMessages([\n          {\n            id: \"1\",\n            text: \"سلام! خوش آمدید. برای خرید سریع لطفاً اطلاعات زیر را وارد کنید:\",\n            sender: \"support\",\n            timestamp: new Date(),\n          },\n        ]);\n      }\n    }\n  }, [isOpen]);\n\n  // Check microphone permission\n  const checkMicrophonePermission = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      stream.getTracks().forEach((track) => track.stop());\n      return true;\n    } catch (error) {\n      return false;\n    }\n  };\n\n  // Voice recording functions\n  const startRecording = async () => {\n    try {\n      // Check if browser supports getUserMedia\n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        toast({\n          title: \"مرورگر شما پشتیبانی نمی‌کند\",\n          description: \"مرورگر شما از ضبط صدا پشتیبانی نمی‌کند. لطفاً از مرورگر جدیدتری استفاده کنید.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n        } \n      });\n      setRecordingPermission(true);\n      \n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: MediaRecorder.isTypeSupported(\"audio/webm\") \n          ? \"audio/webm\" \n          : MediaRecorder.isTypeSupported(\"audio/mp4\")\n          ? \"audio/mp4\"\n          : \"audio/webm\",\n      });\n      mediaRecorderRef.current = mediaRecorder;\n      audioChunksRef.current = [];\n\n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n        }\n      };\n\n      mediaRecorder.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, { \n          type: mediaRecorder.mimeType || \"audio/webm\" \n        });\n        setAudioBlob(audioBlob);\n        const url = URL.createObjectURL(audioBlob);\n        setAudioUrl(url);\n        \n        // Stop all tracks\n        stream.getTracks().forEach((track) => track.stop());\n      };\n\n      mediaRecorder.onerror = (event) => {\n        logger.error(\"MediaRecorder error:\", event);\n        toast({\n          title: \"خطا در ضبط صدا\",\n          description: \"خطایی در هنگام ضبط صدا رخ داد. لطفاً دوباره تلاش کنید.\",\n          variant: \"destructive\",\n        });\n        stopRecording();\n      };\n\n      mediaRecorder.start();\n      setIsRecording(true);\n      setRecordingTime(0);\n\n      // Start timer\n      recordingIntervalRef.current = setInterval(() => {\n        setRecordingTime((prev) => prev + 1);\n      }, 1000);\n\n      toast({\n        title: \"ضبط صدا شروع شد\",\n        description: \"در حال ضبط پیام صوتی...\",\n      });\n    } catch (error: any) {\n      logger.error(\"Error starting recording:\", error);\n      setRecordingPermission(false);\n      \n      let errorMessage = \"دسترسی به میکروفون مجاز نیست.\";\n      let errorDescription = \"\";\n\n      if (error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\") {\n        errorMessage = \"دسترسی به میکروفون رد شد\";\n        errorDescription = \"لطفاً در تنظیمات مرورگر خود، دسترسی میکروفون را فعال کنید.\";\n      } else if (error.name === \"NotFoundError\" || error.name === \"DevicesNotFoundError\") {\n        errorMessage = \"میکروفون یافت نشد\";\n        errorDescription = \"لطفاً مطمئن شوید که میکروفون به دستگاه شما متصل است.\";\n      } else if (error.name === \"NotReadableError\" || error.name === \"TrackStartError\") {\n        errorMessage = \"میکروفون در حال استفاده است\";\n        errorDescription = \"میکروفون توسط برنامه دیگری استفاده می‌شود. لطفاً آن را ببندید.\";\n      } else if (error.name === \"OverconstrainedError\" || error.name === \"ConstraintNotSatisfiedError\") {\n        errorMessage = \"تنظیمات میکروفون پشتیبانی نمی‌شود\";\n        errorDescription = \"لطفاً از میکروفون دیگری استفاده کنید.\";\n      } else {\n        errorDescription = \"لطفاً دوباره تلاش کنید یا صفحه را رفرش کنید.\";\n      }\n\n      toast({\n        title: errorMessage,\n        description: errorDescription,\n        variant: \"destructive\",\n        duration: 5000,\n      });\n\n      // Show permission guide for permission errors\n      if (error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\") {\n        setShowPermissionGuide(true);\n      }\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\n      try {\n        mediaRecorderRef.current.stop();\n        setIsRecording(false);\n        if (recordingIntervalRef.current) {\n          clearInterval(recordingIntervalRef.current);\n        }\n        toast({\n          title: \"ضبط صدا متوقف شد\",\n          description: \"پیام صوتی شما آماده است. می‌توانید آن را ذخیره یا لغو کنید.\",\n        });\n      } catch (error) {\n        logger.error(\"Error stopping recording:\", error);\n        toast({\n          title: \"خطا\",\n          description: \"خطایی در توقف ضبط رخ داد.\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const cancelRecording = () => {\n    stopRecording();\n    setAudioBlob(null);\n    if (audioUrl) {\n      URL.revokeObjectURL(audioUrl);\n      setAudioUrl(null);\n    }\n    setRecordingTime(0);\n  };\n\n  const saveRecording = async () => {\n    if (audioBlob && audioUrl) {\n      try {\n        // Determine file extension based on MIME type\n        let extension = \"webm\";\n        let mimeType = audioBlob.type || \"audio/webm\";\n        \n        if (mimeType.includes(\"mp4\") || mimeType.includes(\"m4a\")) {\n          extension = \"m4a\";\n        } else if (mimeType.includes(\"ogg\")) {\n          extension = \"ogg\";\n        } else if (mimeType.includes(\"wav\")) {\n          extension = \"wav\";\n        } else if (mimeType.includes(\"webm\")) {\n          extension = \"webm\";\n        }\n\n        // Convert blob to file with correct MIME type\n        const audioFile = new File([audioBlob], `audio-${Date.now()}.${extension}`, {\n          type: mimeType,\n        });\n\n        // Upload audio file\n        const uploadedUrl = await uploadFile(audioFile, \"audio\");\n\n        const attachment: Attachment = {\n          id: Date.now().toString(),\n          type: \"audio\",\n          url: uploadedUrl,\n          name: `پیام صوتی ${formatTime(recordingTime)}`,\n          size: audioBlob.size,\n          duration: recordingTime,\n        };\n        setAttachments((prev) => [...prev, attachment]);\n        setAudioBlob(null);\n        if (audioUrl) {\n          URL.revokeObjectURL(audioUrl);\n        }\n        setAudioUrl(null);\n        setRecordingTime(0);\n      } catch (error) {\n        // Error already handled in uploadFile\n      }\n    }\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  };\n\n  const loadChatHistory = async (customerInfo: { name: string; phone: string; email?: string }, savedChatId: string | null) => {\n    try {\n      let url = \"/api/chat?\";\n      \n      if (savedChatId) {\n        // Try to load by chatId first\n        url += `chatId=${savedChatId}`;\n      } else {\n        // Find chat by customer info\n        url += `customerPhone=${encodeURIComponent(customerInfo.phone)}`;\n        if (customerInfo.name) {\n          url += `&customerName=${encodeURIComponent(customerInfo.name)}`;\n        }\n      }\n\n      const response = await fetch(url);\n      if (!response.ok) {\n        throw new Error(\"خطا در بارگذاری تاریخچه چت\");\n      }\n\n      const data = await response.json();\n      \n      if (data.success && data.data) {\n        const { chat, messages } = data.data;\n        \n        if (chat && messages && messages.length > 0) {\n          // Set chatId\n          setChatId(chat.id);\n          if (typeof window !== \"undefined\") {\n            localStorage.setItem(\"quickBuyChat_chatId\", chat.id);\n          }\n\n          // Convert database messages to component messages\n          const loadedMessages: Message[] = messages.map((msg: any) => {\n            // The API already merges attachments from JSONB and chat_attachments table\n            // So msg.attachments should be an array already\n            let finalAttachments: any[] = [];\n            \n            if (msg.attachments) {\n              if (Array.isArray(msg.attachments)) {\n                // Already an array from API merge\n                finalAttachments = msg.attachments.map((att: any) => {\n                  const url = att.url || att.fileUrl || att.filePath;\n                      // Auto-detect type from URL if not provided\n                      let detectedType = att.type;\n                      if (!detectedType && url) {\n                        if (url.includes(\"/image-\") || url.includes(\"image-\")) {\n                          detectedType = \"image\";\n                        } else if (url.includes(\"/audio-\") || url.includes(\"audio-\")) {\n                          detectedType = \"audio\";\n                        }\n                      }\n                  \n                  return {\n                    id: att.id || `att-${Date.now()}-${Math.random()}`,\n                    type: (detectedType || att.type || \"file\") as \"image\" | \"file\" | \"location\" | \"audio\",\n                    url: url, // Try multiple URL fields\n                    name: att.name || att.fileName,\n                    size: att.size || att.fileSize,\n                    duration: att.duration,\n                  };\n                });\n              } else if (typeof msg.attachments === 'string') {\n                // Try to parse JSON string\n                try {\n                  const parsed = JSON.parse(msg.attachments);\n                  if (Array.isArray(parsed)) {\n                    finalAttachments = parsed.map((att: any) => {\n                      const url = att.url || att.fileUrl || att.filePath;\n                      // Auto-detect type from URL if not provided\n                      let detectedType = att.type;\n                      if (!detectedType && url) {\n                        if (url.includes(\"/image-\") || url.includes(\"image-\")) {\n                          detectedType = \"image\";\n                        } else if (url.includes(\"/audio-\") || url.includes(\"audio-\")) {\n                          detectedType = \"audio\";\n                        }\n                      }\n                      \n                      return {\n                        id: att.id || `att-${Date.now()}-${Math.random()}`,\n                        type: (detectedType || att.type || \"file\") as \"image\" | \"file\" | \"location\" | \"audio\",\n                        url: url,\n                        name: att.name || att.fileName,\n                        size: att.size || att.fileSize,\n                        duration: att.duration,\n                      };\n                    });\n                  }\n                } catch (e) {\n                  logger.error(\"Error parsing attachments JSON:\", e);\n                }\n              }\n            }\n            \n            // Filter out attachments with temporary URLs (blob/data URLs)\n            const validAttachments = finalAttachments.filter(att => {\n              const url = att.url;\n              // Only keep attachments with valid URLs (not blob or data URLs)\n              return url && \n                     !url.startsWith('blob:') && \n                     !url.startsWith('data:') &&\n                     (url.startsWith('http') || url.startsWith('/'));\n            });\n            \n            // Debug: log all attachments\n            if (finalAttachments.length > 0) {\n              logger.debug(`Loaded message ${msg.id} has ${validAttachments.length} valid attachment(s) out of ${finalAttachments.length} total:`, validAttachments.map(att => ({ \n                id: att.id, \n                type: att.type, \n                url: att.url, \n                name: att.name,\n                hasUrl: !!att.url \n              })));\n            }\n            \n            return {\n              id: msg.id,\n              text: msg.text || \"\",\n              sender: msg.sender as \"user\" | \"support\",\n              timestamp: new Date(msg.createdAt),\n              attachments: validAttachments.length > 0 ? validAttachments : undefined,\n              status: msg.sender === \"user\" ? (msg.status as MessageStatus || \"sent\") : undefined,\n            };\n          });\n\n          // Ensure all user messages have status from database\n          const messagesWithStatus = loadedMessages.map((msg) => {\n            if (msg.sender === \"user\" && !msg.status) {\n              return { ...msg, status: \"sent\" as MessageStatus };\n            }\n            return msg;\n          });\n          \n          setMessages(messagesWithStatus);\n          // Set the last message ID for polling\n          if (loadedMessages.length > 0) {\n            const lastMessageId = loadedMessages[loadedMessages.length - 1].id;\n            lastPolledMessageIdRef.current = lastMessageId;\n            // Also save to localStorage for global polling\n            if (typeof window !== \"undefined\") {\n              localStorage.setItem(\"quickBuyChat_lastMessageId\", lastMessageId);\n            }\n            // Check if admin has already replied - if yes, don't show system message\n            const hasAdminMessage = messagesWithStatus.some(msg => msg.sender === \"support\" && msg.id !== \"1\");\n            if (hasAdminMessage) {\n              systemMessageShownRef.current = true; // Admin already replied, don't show system message\n            } else {\n              systemMessageShownRef.current = false; // Reset for new conversation\n            }\n          } else {\n            systemMessageShownRef.current = false; // Reset for new conversation\n          }\n          setStep(\"chat\");\n        } else {\n          // No chat found, start new chat\n          setStep(\"chat\");\n          setMessages([\n            {\n              id: \"1\",\n              text: `سلام ${customerInfo.name}! خوش آمدید. لطفاً محصول مورد نظر خود را ذکر کنید یا سوال خود را بپرسید.`,\n              sender: \"support\",\n              timestamp: new Date(),\n            },\n          ]);\n          systemMessageShownRef.current = false; // Reset for new chat\n        }\n      } else {\n        // No chat found, start new chat\n        setStep(\"chat\");\n        setMessages([\n          {\n            id: \"1\",\n            text: `سلام ${customerInfo.name}! خوش آمدید. لطفاً محصول مورد نظر خود را ذکر کنید یا سوال خود را بپرسید.`,\n            sender: \"support\",\n            timestamp: new Date(),\n          },\n        ]);\n        systemMessageShownRef.current = false; // Reset for new chat\n      }\n    } catch (error) {\n      logger.error(\"Error loading chat history:\", error);\n      // On error, still go to chat step\n      setStep(\"chat\");\n      setMessages([\n        {\n          id: \"1\",\n          text: `سلام ${customerInfo.name}! خوش آمدید. لطفاً محصول مورد نظر خود را ذکر کنید یا سوال خود را بپرسید.`,\n          sender: \"support\",\n          timestamp: new Date(),\n        },\n      ]);\n      systemMessageShownRef.current = false; // Reset for new chat\n    }\n  };\n\n  // Mark support messages as delivered (when chat is open)\n  const markSupportMessagesAsDelivered = async () => {\n    if (!chatId) return;\n    \n    try {\n      await fetch(\"/api/chat/status\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          chatId,\n          sender: \"user\",\n          action: \"delivered\", // Mark as delivered when chat is open\n        }),\n      });\n    } catch (error) {\n      logger.error(\"Error marking messages as delivered:\", error);\n    }\n  };\n\n  // Mark support messages as read (when user views messages)\n  const markSupportMessagesAsRead = async () => {\n    if (!chatId) return;\n    \n    try {\n      await fetch(\"/api/chat/status\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          chatId,\n          sender: \"user\", // Mark messages from support as read\n          action: \"read\",\n        }),\n      });\n    } catch (error) {\n      logger.error(\"Error marking messages as read:\", error);\n    }\n  };\n\n  // Poll for new messages\n  const pollForNewMessages = async () => {\n    if (!chatId || !isOpen || step !== \"chat\") return;\n\n    try {\n      setIsPolling(true);\n      const lastMessageId = lastPolledMessageIdRef.current;\n\n      let url = `/api/chat?chatId=${chatId}`;\n      if (lastMessageId && lastMessageId !== \"1\") {\n        // Poll for messages after the last one we have\n        url += `&lastMessageId=${lastMessageId}`;\n      }\n\n      const response = await fetch(url);\n      if (!response.ok) {\n        throw new Error(\"خطا در دریافت پیام‌های جدید\");\n      }\n\n      const data = await response.json();\n      \n      if (data.success && data.data?.messages && Array.isArray(data.data.messages)) {\n        const newMessages = data.data.messages;\n        \n        // Mark support messages as delivered when new messages arrive (user is online)\n        if (newMessages.length > 0) {\n          markSupportMessagesAsDelivered();\n          // Mark as read after a short delay\n          setTimeout(() => {\n            markSupportMessagesAsRead();\n          }, 1000);\n        }\n        \n        // Don't show notifications when chat is open - user is already viewing\n        // Global polling handles notifications when chat is closed\n        \n        // Convert database messages to component messages\n        const formattedMessages: Message[] = newMessages.map((msg: any) => {\n            let finalAttachments: any[] = [];\n            \n            if (msg.attachments) {\n              if (Array.isArray(msg.attachments)) {\n                finalAttachments = msg.attachments.map((att: any) => {\n                  const url = att.url || att.fileUrl || att.filePath;\n                      // Auto-detect type from URL if not provided\n                      let detectedType = att.type;\n                      if (!detectedType && url) {\n                        if (url.includes(\"/image-\") || url.includes(\"image-\")) {\n                          detectedType = \"image\";\n                        } else if (url.includes(\"/audio-\") || url.includes(\"audio-\")) {\n                          detectedType = \"audio\";\n                        }\n                      }\n                  \n                  return {\n                    id: att.id || `att-${Date.now()}-${Math.random()}`,\n                    type: (detectedType || att.type || \"file\") as \"image\" | \"file\" | \"location\" | \"audio\",\n                    url: url,\n                    name: att.name || att.fileName,\n                    size: att.size || att.fileSize,\n                    duration: att.duration,\n                  };\n                });\n              }\n            }\n            \n            // Filter out attachments with temporary URLs (blob/data URLs)\n            const validAttachments = finalAttachments.filter(att => {\n              const url = att.url;\n              // Only keep attachments with valid URLs (not blob or data URLs)\n              return url && \n                     !url.startsWith('blob:') && \n                     !url.startsWith('data:') &&\n                     (url.startsWith('http') || url.startsWith('/'));\n            });\n            \n            return {\n              id: msg.id,\n              text: msg.text || \"\",\n              sender: msg.sender as \"user\" | \"support\",\n              timestamp: new Date(msg.createdAt),\n              attachments: validAttachments.length > 0 ? validAttachments : undefined,\n              status: msg.sender === \"user\" ? (msg.status as MessageStatus || \"sent\") : undefined,\n            };\n          });\n\n        // Add only new messages that we don't already have and update status of existing ones\n        setMessages((prev) => {\n            const existingIds = new Set(prev.map((m) => m.id));\n            const uniqueNewMessages = formattedMessages.filter((msg) => !existingIds.has(msg.id));\n            \n            // Update status of existing messages from database (for user messages)\n            // Also remove any system messages (they're not in database)\n            const updatedPrev = prev\n              .filter((existingMsg) => !existingMsg.id.startsWith(\"system-\")) // Remove system messages\n              .map((existingMsg) => {\n                const dbMsg = formattedMessages.find((m) => m.id === existingMsg.id);\n                if (dbMsg && existingMsg.sender === \"user\" && dbMsg.status && existingMsg.status !== dbMsg.status) {\n                  return { ...existingMsg, status: dbMsg.status as MessageStatus };\n                }\n                return existingMsg;\n              });\n            \n            if (uniqueNewMessages.length > 0) {\n              // Remove system message if admin has replied\n              const hasAdminMessage = uniqueNewMessages.some(msg => msg.sender === \"support\");\n              let filteredPrev = updatedPrev;\n              if (hasAdminMessage && systemMessageIdRef.current) {\n                filteredPrev = updatedPrev.filter(msg => msg.id !== systemMessageIdRef.current);\n                systemMessageIdRef.current = null;\n                systemMessageShownRef.current = true; // Admin replied, don't show system message again\n              }\n              \n              // Update last polled message ID to the latest message (not just new ones)\n              const allMessages = [...filteredPrev, ...uniqueNewMessages];\n              const latestMessage = allMessages[allMessages.length - 1];\n              if (latestMessage) {\n                lastPolledMessageIdRef.current = latestMessage.id;\n                // Also save to localStorage for global polling\n                if (typeof window !== \"undefined\") {\n                  localStorage.setItem(\"quickBuyChat_lastMessageId\", latestMessage.id);\n                }\n              }\n              \n              // Don't auto-scroll on polling updates - user controls scroll manually\n              \n              return allMessages;\n            }\n            return updatedPrev;\n          });\n        }\n    } catch (error) {\n      logger.error(\"Error polling for new messages:\", error);\n      // Don't show error toast for polling failures to avoid spamming\n    } finally {\n      setIsPolling(false);\n    }\n  };\n\n  // Check if support is typing\n  const checkSupportTyping = async () => {\n    if (!chatId) return;\n    \n    try {\n      const response = await fetch(`/api/chat/typing?chatId=${chatId}&sender=support`);\n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          setIsSupportTyping(data.data.isTyping || false);\n        }\n      }\n    } catch (error) {\n      logger.error(\"Error checking typing status:\", error);\n    }\n  };\n\n  // Send typing status\n  const sendTypingStatus = async (typing: boolean) => {\n    if (!chatId) return;\n    \n    try {\n      await fetch(\"/api/chat/typing\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          chatId,\n          sender: \"user\",\n          isTyping: typing,\n        }),\n      });\n    } catch (error) {\n      logger.error(\"Error sending typing status:\", error);\n    }\n  };\n\n  // Request notification permission on mount\n  useEffect(() => {\n    requestPermission();\n  }, []);\n\n  // Listen for openChat event from notifications\n  useEffect(() => {\n    const handleOpenChat = (event: Event) => {\n      const customEvent = event as CustomEvent<{ chatId: string; isAdmin?: boolean }>;\n      const { chatId: eventChatId, isAdmin } = customEvent.detail;\n      \n      // Only handle if this is for user (not admin)\n      if (isAdmin === false || isAdmin === undefined) {\n        // Open chat panel\n        if (!isOpen) {\n          onOpenChange(true);\n        }\n        \n        // Navigate to chat step\n        if (step !== \"chat\") {\n          setStep(\"chat\");\n        }\n        \n        // If we have a chatId from localStorage or event, use it\n        if (eventChatId && typeof window !== \"undefined\") {\n          const currentChatId = localStorage.getItem(\"quickBuyChat_chatId\");\n          if (currentChatId !== eventChatId) {\n            localStorage.setItem(\"quickBuyChat_chatId\", eventChatId);\n            // Reload chat messages\n            setTimeout(() => {\n              if (isOpen && step === \"chat\") {\n                pollForNewMessages();\n              }\n            }, 500);\n          }\n        }\n      }\n    };\n\n    window.addEventListener(\"openChat\", handleOpenChat);\n    return () => {\n      window.removeEventListener(\"openChat\", handleOpenChat);\n    };\n  }, [isOpen, onOpenChange, chatId, step, pollForNewMessages]);\n\n  // Start/stop polling based on chat state\n  useEffect(() => {\n    if (isOpen && step === \"chat\" && chatId) {\n      // Mark support messages as delivered when chat opens (user is online)\n      markSupportMessagesAsDelivered();\n      \n      // Mark support messages as read after a short delay (user is viewing)\n      const readTimeout = setTimeout(() => {\n        markSupportMessagesAsRead();\n      }, 2000); // Mark as read after 2 seconds of viewing\n      \n      // Check typing status periodically\n      checkSupportTyping();\n      // Optimized: Check typing status every 3 seconds (reduced from 2s)\n      typingPollIntervalRef.current = setInterval(() => {\n        checkSupportTyping();\n      }, 3000);\n      \n      // Optimized: Poll every 5 seconds for new messages (reduced from 3s to reduce server load)\n      pollingIntervalRef.current = setInterval(() => {\n        pollForNewMessages();\n        // Keep marking as delivered while chat is open (user is online)\n        markSupportMessagesAsDelivered();\n      }, 5000);\n\n      // Also poll immediately when entering chat\n      pollForNewMessages();\n      \n      // Check admin status when chat opens\n      checkStatus();\n\n      return () => {\n        if (pollingIntervalRef.current) {\n          clearInterval(pollingIntervalRef.current);\n          pollingIntervalRef.current = null;\n        }\n        if (typingPollIntervalRef.current) {\n          clearInterval(typingPollIntervalRef.current);\n          typingPollIntervalRef.current = null;\n        }\n        if (typingTimeoutRef.current) {\n          clearTimeout(typingTimeoutRef.current);\n          typingTimeoutRef.current = null;\n        }\n        clearTimeout(readTimeout);\n        sendTypingStatus(false);\n      };\n    }\n  }, [isOpen, step, chatId, checkStatus]);\n\n  const handlePlayAudio = (attachmentId: string, url: string) => {\n    if (isPlayingAudio === attachmentId) {\n      // Pause\n      const audio = audioRefs.current[attachmentId];\n      if (audio) {\n        audio.pause();\n      }\n      setIsPlayingAudio(null);\n    } else {\n      // Play\n      if (isPlayingAudio) {\n        const currentAudio = audioRefs.current[isPlayingAudio];\n        if (currentAudio) {\n          currentAudio.pause();\n          currentAudio.currentTime = 0;\n        }\n      }\n      \n      const audio = new Audio(url);\n      audioRefs.current[attachmentId] = audio;\n      audio.play();\n      setIsPlayingAudio(attachmentId);\n\n      audio.onended = () => {\n        setIsPlayingAudio(null);\n      };\n    }\n  };\n\n  const saveChatToDatabase = async (showToast = true, retryCount = 0) => {\n    if (messages.length === 0) return;\n\n    const MAX_RETRIES = 3;\n    const RETRY_DELAY = 1000; // 1 second\n\n    try {\n      setIsSaving(true);\n\n      const response = await fetch(\"/api/chat\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          chatId: chatId || undefined, // Send chatId if exists\n          customerInfo,\n          messages: messages.map((msg) => ({\n            id: msg.id,\n            text: msg.text,\n            sender: msg.sender,\n            timestamp: msg.timestamp.toISOString(),\n            attachments: msg.attachments ? msg.attachments.filter((att: Attachment) => {\n              const url = att.url;\n              // Only include attachments with valid URLs (not blob or data URLs)\n              return url && \n                     !url.startsWith('blob:') && \n                     !url.startsWith('data:') &&\n                     (url.startsWith('http') || url.startsWith('/'));\n            }) : [],\n          })),\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json().catch(() => ({ error: \"خطا در ذخیره چت\" }));\n        throw new Error(error.error || \"خطا در ذخیره چت\");\n      }\n\n      const data = await response.json();\n      if (data.data.chatId) {\n        setChatId(data.data.chatId);\n        if (typeof window !== \"undefined\") {\n          localStorage.setItem(\"quickBuyChat_chatId\", data.data.chatId);\n        }\n      }\n\n      if (showToast) {\n        toast({\n          title: \"ذخیره شد\",\n          description: \"پیام‌های شما با موفقیت ذخیره شدند\",\n        });\n      }\n    } catch (error: any) {\n      logger.error(\"Error saving chat:\", error);\n      \n      // Retry logic for network errors or 5xx errors\n      if (retryCount < MAX_RETRIES && (\n        error.message?.includes(\"fetch\") || \n        error.message?.includes(\"network\") ||\n        error.message?.includes(\"timeout\") ||\n        error.code === \"NETWORK_ERROR\"\n      )) {\n        // Exponential backoff\n        const delay = RETRY_DELAY * Math.pow(2, retryCount);\n        logger.debug(`Retrying save in ${delay}ms (attempt ${retryCount + 1}/${MAX_RETRIES})`);\n        \n        setTimeout(() => {\n          saveChatToDatabase(showToast, retryCount + 1);\n        }, delay);\n        return;\n      }\n\n      if (showToast) {\n        toast({\n          title: \"خطا در ذخیره\",\n          description: error.message || \"لطفاً دوباره تلاش کنید\",\n          variant: \"destructive\",\n        });\n      }\n    } finally {\n      if (retryCount === 0) {\n        // Only set saving to false if not retrying\n        setIsSaving(false);\n      }\n    }\n  };\n\n  // Handle reply\n  const handleReply = (msg: Message) => {\n    setReplyingTo(msg);\n    setEditingMessage(null);\n  };\n\n  // Handle edit\n  const handleEdit = (msg: Message) => {\n    setEditingMessage(msg);\n    setReplyingTo(null);\n    setMessage(msg.text || \"\");\n  };\n\n  // Handle delete\n  const handleDelete = async (messageId: string) => {\n    try {\n      const response = await fetch(`/api/chat/message/${messageId}`, {\n        method: \"DELETE\",\n      });\n      \n      if (response.ok) {\n        setMessages((prev) => prev.filter((msg) => msg.id !== messageId));\n        toast({\n          title: \"موفق\",\n          description: \"پیام با موفقیت حذف شد\",\n        });\n      } else {\n        throw new Error(\"خطا در حذف پیام\");\n      }\n    } catch (error) {\n      logger.error(\"Error deleting message:\", error);\n      toast({\n        title: \"خطا\",\n        description: \"خطا در حذف پیام\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleSendMessage = async () => {\n    if (!message.trim() && attachments.length === 0) return;\n\n    // If editing, update the message instead of sending new one\n    if (editingMessage) {\n      try {\n        const response = await fetch(`/api/chat/message/${editingMessage.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            text: message,\n            attachments: attachments,\n          }),\n        });\n        \n        if (response.ok) {\n          setMessages((prev) =>\n            prev.map((msg) =>\n              msg.id === editingMessage.id\n                ? { ...msg, text: message, attachments: attachments }\n                : msg\n            )\n          );\n          setEditingMessage(null);\n          setMessage(\"\");\n          setAttachments([]);\n          toast({\n            title: \"موفق\",\n            description: \"پیام ویرایش شد\",\n          });\n        }\n      } catch (error) {\n        logger.error(\"Error editing message:\", error);\n        toast({\n          title: \"خطا\",\n          description: \"خطا در ویرایش پیام\",\n          variant: \"destructive\",\n        });\n      }\n      return;\n    }\n\n    // Filter out attachments with temporary URLs (only keep valid uploaded URLs)\n    const validAttachments = attachments.filter(att => {\n      const url = att.url;\n      // Only keep attachments with valid URLs (not blob or data URLs)\n      return url && \n             !url.startsWith('blob:') && \n             !url.startsWith('data:') &&\n             (url.startsWith('http') || url.startsWith('/'));\n    });\n\n    // Don't send message if no valid attachments and no text\n    if (!message.trim() && validAttachments.length === 0) {\n      toast({\n        title: \"خطا\",\n        description: \"لطفاً یک پیام یا فایل معتبر اضافه کنید\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    let messageText = message;\n    if (replyingTo) {\n      messageText = `در پاسخ به: ${replyingTo.text}\\n\\n${message}`;\n    }\n\n    const newMessage: Message = {\n      id: `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      text: messageText,\n      sender: \"user\",\n      timestamp: new Date(),\n      attachments: validAttachments.length > 0 ? validAttachments : undefined,\n      status: \"sending\",\n    };\n\n    // Add message to state IMMEDIATELY (optimistic update)\n    setMessages((prev) => {\n      const updated = [...prev, newMessage];\n      // Update last polled message ID\n      lastPolledMessageIdRef.current = newMessage.id;\n      // Track user message for scroll behavior\n      lastUserMessageIdRef.current = newMessage.id;\n      // Also save to localStorage for global polling\n      if (typeof window !== \"undefined\") {\n        localStorage.setItem(\"quickBuyChat_lastMessageId\", newMessage.id);\n      }\n      return updated;\n    });\n    \n    // Scroll to bottom after adding message (force scroll for user messages)\n    setTimeout(() => {\n      scrollToBottom(false);\n    }, 150);\n    \n    // Clear input immediately for better UX\n    const messageAttachments = [...attachments];\n    setMessage(\"\");\n    setAttachments([]);\n    setShowAttachmentOptions(false);\n    setReplyingTo(null);\n\n    // Save to database\n    try {\n      setIsSaving(true);\n      \n      // Prepare messages with filtered attachments and status\n      const messagesToSave = [...messages, newMessage].map((msg) => ({\n        id: msg.id,\n        text: msg.text,\n        sender: msg.sender,\n        timestamp: msg.timestamp.toISOString(),\n        status: msg.id === newMessage.id ? \"sent\" : (msg.status || (msg.sender === \"user\" ? \"sent\" : undefined)),\n        attachments: msg.attachments ? msg.attachments.filter((att: Attachment) => {\n          const url = att.url;\n          return url && \n                 !url.startsWith('blob:') && \n                 !url.startsWith('data:') &&\n                 (url.startsWith('http') || url.startsWith('/'));\n        }) : [],\n      }));\n      \n      // Log the new message being sent\n      if (newMessage.attachments && newMessage.attachments.length > 0) {\n        logger.debug(`📤 Sending new message with ${newMessage.attachments.length} attachment(s):`, \n          newMessage.attachments.map(att => ({ \n            id: att.id, \n            type: att.type, \n            url: att.url,\n            name: att.name \n          }))\n        );\n      }\n      \n      const response = await fetch(\"/api/chat\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          chatId: chatId || undefined,\n          customerInfo,\n          messages: messagesToSave,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.message || \"خطا در ذخیره پیام\");\n      }\n\n      const data = await response.json();\n      \n      // Update chatId if provided\n      if (data.data?.chatId) {\n        setChatId(data.data.chatId);\n        if (typeof window !== \"undefined\") {\n          localStorage.setItem(\"quickBuyChat_chatId\", data.data.chatId);\n        }\n      }\n      \n      // Get the actual saved message from response to get real status from database\n      const savedMessage = data.data?.messages?.find((m: any) => m.id === newMessage.id);\n      const actualStatus = savedMessage?.status || \"sent\";\n      \n      // Update message status from database response immediately\n      setMessages((prev) => {\n        return prev.map((msg) => \n          msg.id === newMessage.id \n            ? { ...msg, status: actualStatus as MessageStatus }\n            : msg\n        );\n      });\n      \n      // Check admin status after sending message\n      try {\n        const adminStatusResponse = await fetch(\"/api/admin/presence\");\n        if (adminStatusResponse.ok) {\n          const adminStatusData = await adminStatusResponse.json();\n          if (adminStatusData.success && adminStatusData.data?.admins) {\n            const isAdminOnline = Array.isArray(adminStatusData.data.admins) && adminStatusData.data.admins.length > 0;\n            if (!isAdminOnline) {\n              // Show persistent notification that admin is offline\n              showMessageNotification(\"پشتیبانی\", \"پشتیبان در حال حاضر آنلاین نیست. پیام شما دریافت شده و در اسرع وقت پاسخ داده خواهد شد.\", {\n                onOpen: () => {\n                  if (!isOpen) {\n                    onOpenChange(true);\n                  }\n                },\n                chatId: chatId || undefined,\n                metadata: {\n                  isAdminOffline: true,\n                  isAdmin: false, // This is for user\n                },\n              });\n            }\n          }\n        }\n      } catch (adminError) {\n        // Ignore admin status check errors\n        logger.error(\"Error checking admin status:\", adminError);\n      }\n\n      // Note: Status will be updated to \"delivered\" by admin when they open the chat (admin is online)\n      // and to \"read\" when they view the messages. Status updates come from polling.\n    } catch (error: any) {\n      logger.error(\"Error saving message:\", error);\n      \n      // Update message status to \"sent\" even on error (so user sees it was attempted)\n      setMessages((prev) => {\n        return prev.map((msg) => \n          msg.id === newMessage.id \n            ? { ...msg, status: \"sent\" as MessageStatus }\n            : msg\n        );\n      });\n      \n      // Restore input on error\n      setMessage(messageText);\n      setAttachments(messageAttachments);\n      \n      toast({\n        title: \"خطا\",\n        description: error.message || \"خطا در ذخیره پیام. لطفاً دوباره تلاش کنید.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSaving(false);\n    }\n\n    // پاسخ خودکار - فقط یک بار و فقط اگر قبلاً نمایش داده نشده\n    if (!systemMessageShownRef.current) {\n      setTimeout(async () => {\n        const systemMessageId = `system-${Date.now()}`;\n        systemMessageIdRef.current = systemMessageId;\n        systemMessageShownRef.current = true;\n        \n        const autoReply: Message = {\n          id: systemMessageId,\n          text: \"متشکرم! پیام شما دریافت شد. همکاران ما در اسرع وقت با شما تماس خواهند گرفت.\",\n          sender: \"support\",\n          timestamp: new Date(),\n        };\n        setMessages((prev) => [...prev, autoReply]);\n        \n        // Don't save system message to database - it's temporary\n      }, 1000);\n    }\n  };\n\n  const uploadFile = async (file: File, type: \"image\" | \"file\" | \"audio\", retryCount = 0): Promise<string> => {\n    const MAX_RETRIES = 3;\n    const RETRY_DELAY = 2000; // 2 seconds\n\n    try {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      formData.append(\"type\", type);\n\n      const response = await fetch(\"/api/chat/upload\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const error = await response.json().catch(() => ({ error: \"خطا در آپلود فایل\" }));\n        throw new Error(error.error || \"خطا در آپلود فایل\");\n      }\n\n      const data = await response.json();\n      return data.data.url;\n    } catch (error: any) {\n      logger.error(\"Error uploading file:\", error);\n      \n      // Retry logic for network errors\n      if (retryCount < MAX_RETRIES && (\n        error.message?.includes(\"fetch\") || \n        error.message?.includes(\"network\") ||\n        error.message?.includes(\"timeout\") ||\n        error.code === \"NETWORK_ERROR\" ||\n        error.name === \"TypeError\"\n      )) {\n        const delay = RETRY_DELAY * Math.pow(2, retryCount);\n        logger.debug(`Retrying file upload in ${delay}ms (attempt ${retryCount + 1}/${MAX_RETRIES})`);\n        \n        // Show toast only on first failure\n        if (retryCount === 0) {\n          toast({\n            title: \"در حال تلاش مجدد...\",\n            description: \"خطا در آپلود فایل. در حال تلاش مجدد...\",\n            duration: 2000,\n          });\n        }\n        \n        await new Promise(resolve => setTimeout(resolve, delay));\n        return uploadFile(file, type, retryCount + 1);\n      }\n\n      toast({\n        title: \"خطا در آپلود فایل\",\n        description: error.message || \"لطفاً دوباره تلاش کنید\",\n        variant: \"destructive\",\n      });\n      throw error;\n    }\n  };\n\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>, type: \"image\" | \"file\") => {\n    const files = e.target.files;\n    if (!files || files.length === 0) return;\n\n    for (const file of Array.from(files)) {\n      try {\n        // Upload file to server\n        const fileUrl = await uploadFile(file, type);\n        \n        const attachment: Attachment = {\n          id: Date.now().toString() + Math.random(),\n          type,\n          name: file.name,\n          size: file.size,\n          url: fileUrl,\n        };\n        setAttachments((prev) => [...prev, attachment]);\n      } catch (error) {\n        // Error already handled in uploadFile\n      }\n    }\n\n    e.target.value = \"\";\n  };\n\n  const handleRemoveAttachment = (id: string) => {\n    setAttachments((prev) => {\n      const attachment = prev.find((a) => a.id === id);\n      if (attachment?.url) {\n        URL.revokeObjectURL(attachment.url);\n      }\n      return prev.filter((a) => a.id !== id);\n    });\n  };\n\n  const handleLocationShare = () => {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          const attachment: Attachment = {\n            id: Date.now().toString(),\n            type: \"location\",\n            url: `https://www.google.com/maps?q=${position.coords.latitude},${position.coords.longitude}`,\n            name: \"موقعیت مکانی\",\n          };\n          setAttachments((prev) => [...prev, attachment]);\n          setShowAttachmentOptions(false);\n        },\n        (error) => {\n          logger.error(\"Error getting location:\", error);\n          alert(\"خطا در دریافت موقعیت مکانی\");\n        }\n      );\n    } else {\n      alert(\"مرورگر شما از موقعیت مکانی پشتیبانی نمی‌کند\");\n    }\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024) return bytes + \" B\";\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + \" KB\";\n    return (bytes / (1024 * 1024)).toFixed(1) + \" MB\";\n  };\n\n  const handleSubmitInfo = async () => {\n    if (!customerInfo.name || !customerInfo.phone) {\n      return;\n    }\n\n    // Save customer info to localStorage\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(\"quickBuyChat_customerInfo\", JSON.stringify(customerInfo));\n    }\n\n    // Reset system message flag for new chat\n    systemMessageShownRef.current = false;\n    systemMessageIdRef.current = null;\n\n    setStep(\"chat\");\n    const welcomeMessage: Message = {\n      id: Date.now().toString(),\n      text: `سلام ${customerInfo.name}! اطلاعات شما ثبت شد. لطفاً محصول مورد نظر خود را ذکر کنید یا سوال خود را بپرسید.`,\n      sender: \"support\",\n      timestamp: new Date(),\n    };\n    setMessages((prev) => [...prev, welcomeMessage]);\n\n    // Save initial chat to database\n    await saveChatToDatabase(false); // Don't show toast for welcome message\n  };\n\n\n  const renderContent = () => (\n    <>\n      <SheetHeader className=\"px-4 sm:px-6 py-2 border-b border-border/40\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            <SheetTitle className=\"text-base font-semibold text-foreground flex items-center gap-2\">\n              خرید سریع\n              {step === \"chat\" && (\n                <OnlineStatusBadge isOnline={isOnline} lastSeen={lastSeen} showText={false} />\n              )}\n            </SheetTitle>\n          </div>\n          {step === \"chat\" && customerInfo.name && customerInfo.phone && (\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => {\n                setStep(\"info\");\n                setMessages([\n                  {\n                    id: \"1\",\n                    text: \"سلام! خوش آمدید. برای خرید سریع لطفاً اطلاعات زیر را وارد کنید:\",\n                    sender: \"support\",\n                    timestamp: new Date(),\n                  },\n                ]);\n              }}\n              className=\"h-8 w-8 rounded-lg hover:bg-primary/10 transition-colors\"\n              title=\"تغییر اطلاعات\"\n            >\n              <svg\n                className=\"h-4 w-4\"\n                viewBox=\"0 0 24 24\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <path\n                  d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"2\"\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                />\n                <circle\n                  cx=\"12\"\n                  cy=\"7\"\n                  r=\"4\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"2\"\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                />\n              </svg>\n            </Button>\n          )}\n        </div>\n      </SheetHeader>\n\n      {step === \"info\" ? (\n          <div className=\"flex-1 overflow-y-auto p-6 sm:p-8 space-y-6 bg-gradient-to-b from-background via-background to-muted/10\">\n          {/* Welcome Message */}\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"text-center pb-2\"\n          >\n            <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 mb-3 shadow-lg\">\n              <svg\n                className=\"h-8 w-8 text-primary\"\n                viewBox=\"0 0 24 24\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <path\n                  d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"2\"\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                />\n                <path\n                  d=\"M8 10h.01M12 10h.01M16 10h.01\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"2\"\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                />\n              </svg>\n            </div>\n            <p className=\"text-sm text-muted-foreground leading-relaxed\">\n              لطفاً اطلاعات زیر را برای شروع خرید سریع وارد کنید\n            </p>\n          </motion.div>\n\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"space-y-5\"\n          >\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-semibold text-foreground flex items-center gap-2\">\n                <svg\n                  className=\"h-4 w-4 text-primary\"\n                  viewBox=\"0 0 24 24\"\n                  fill=\"none\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                >\n                  <path\n                    d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"\n                    stroke=\"currentColor\"\n                    strokeWidth=\"2\"\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                  />\n                  <circle\n                    cx=\"12\"\n                    cy=\"7\"\n                    r=\"4\"\n                    stroke=\"currentColor\"\n                    strokeWidth=\"2\"\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                  />\n                </svg>\n                نام و نام خانوادگی\n                <span className=\"text-destructive text-xs\">*</span>\n              </label>\n              <div className=\"relative group\">\n                <Input\n                  type=\"text\"\n                  placeholder=\"مثال: علی احمدی\"\n                  value={customerInfo.name}\n                  onChange={(e) =>\n                    setCustomerInfo({ ...customerInfo, name: e.target.value })\n                  }\n                  className=\"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background\"\n                />\n                <div className=\"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none\">\n                  <svg\n                    className=\"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors\"\n                    viewBox=\"0 0 24 24\"\n                    fill=\"none\"\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                  >\n                    <path\n                      d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"2\"\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                    />\n                    <circle\n                      cx=\"12\"\n                      cy=\"7\"\n                      r=\"4\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"2\"\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-semibold text-foreground flex items-center gap-2\">\n                <Phone className=\"h-4 w-4 text-primary\" />\n                شماره تماس\n                <span className=\"text-destructive text-xs\">*</span>\n              </label>\n              <div className=\"relative group\">\n                <Input\n                  type=\"tel\"\n                  placeholder=\"09123456789\"\n                  value={customerInfo.phone}\n                  onChange={(e) =>\n                    setCustomerInfo({ ...customerInfo, phone: e.target.value })\n                  }\n                  className=\"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background\"\n                />\n                <div className=\"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none\">\n                  <Phone className=\"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors\" />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-semibold text-foreground flex items-center gap-2\">\n                <Mail className=\"h-4 w-4 text-primary\" />\n                ایمیل\n                <span className=\"text-xs text-muted-foreground font-normal\">(اختیاری)</span>\n              </label>\n              <div className=\"relative group\">\n                <Input\n                  type=\"email\"\n                  placeholder=\"example@email.com\"\n                  value={customerInfo.email}\n                  onChange={(e) =>\n                    setCustomerInfo({ ...customerInfo, email: e.target.value })\n                  }\n                  className=\"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background\"\n                />\n                <div className=\"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none\">\n                  <Mail className=\"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors\" />\n                </div>\n              </div>\n            </div>\n          </motion.div>\n\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.15 }}\n            className=\"pt-2\"\n          >\n            <Button\n              onClick={handleSubmitInfo}\n              disabled={!customerInfo.name || !customerInfo.phone}\n              className=\"w-full h-13 text-base font-semibold bg-gradient-to-r from-primary via-primary to-primary/90 hover:from-primary/90 hover:via-primary/80 hover:to-primary/70 shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 transition-all duration-300 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed rounded-xl\"\n            >\n              <span className=\"flex items-center justify-center gap-2\">\n                ادامه\n                <motion.div\n                  animate={{ x: [0, 4, 0] }}\n                  transition={{ repeat: Infinity, duration: 1.5, delay: 0.5 }}\n                >\n                  →\n                </motion.div>\n              </span>\n            </Button>\n            <p className=\"text-xs text-muted-foreground text-center mt-3\">\n              با ادامه، شما شرایط و قوانین ما را می‌پذیرید\n            </p>\n          </motion.div>\n        </div>\n      ) : (\n        <>\n          <div ref={messagesContainerRef} className=\"flex-1 overflow-y-auto p-5 sm:p-6 md:p-8 space-y-5 sm:space-y-6 bg-gradient-to-b from-background via-background/95 to-muted/5 scroll-smooth\">\n            {messages.length === 0 && (\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"flex flex-col items-center justify-center h-full min-h-[200px] text-center px-4\"\n              >\n                <div className=\"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mb-4 shadow-lg\">\n                  <svg\n                    className=\"h-10 w-10 text-primary/60\"\n                    viewBox=\"0 0 24 24\"\n                    fill=\"none\"\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                  >\n                    <path\n                      d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"2\"\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                    />\n                    <path\n                      d=\"M8 10h.01M12 10h.01M16 10h.01\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"2\"\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                    />\n                  </svg>\n                </div>\n                <p className=\"text-muted-foreground text-base font-medium leading-relaxed\">هنوز پیامی ارسال نشده است</p>\n                <p className=\"text-muted-foreground/70 text-sm mt-2 leading-relaxed\">پیام خود را بنویسید...</p>\n              </motion.div>\n            )}\n            {messages.map((msg, index) => (\n              <motion.div\n                key={msg.id}\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0 }}\n                transition={{ \n                  duration: 0.2,\n                  ease: \"easeOut\"\n                }}\n                className={`flex ${msg.sender === \"user\" ? \"justify-end\" : \"justify-start\"} items-end gap-2 group`}\n              >\n                <div\n                    className={`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${\n                      msg.sender === \"user\"\n                        ? \"bg-primary text-primary-foreground\"\n                        : \"bg-muted text-foreground border border-border/40\"\n                    }`}\n                  >\n                    {msg.text && (\n                      <p className=\"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5\">\n                        {msg.text}\n                      </p>\n                    )}\n                    {msg.attachments && msg.attachments.length > 0 && (\n                      <div className={`space-y-2 ${msg.text ? \"mt-2\" : \"\"}`}>\n                        {msg.attachments.map((attachment, attIndex) => (\n                          <motion.div\n                            key={attachment.id || `att-${index}-${attIndex}`}\n                            initial={{ opacity: 0, scale: 0.9 }}\n                            animate={{ opacity: 1, scale: 1 }}\n                            transition={{ delay: attIndex * 0.1 }}\n                            className=\"rounded-xl overflow-hidden\"\n                          >\n                            {attachment.type === \"image\" && attachment.url && (\n                              <img\n                                  src={attachment.url}\n                                  alt={attachment.name || \"تصویر\"}\n                                className=\"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all\"\n                                  onClick={() => window.open(attachment.url, \"_blank\")}\n                                  onError={(e) => {\n                                    logger.error(\"Image load error:\", attachment.url);\n                                    (e.target as HTMLImageElement).style.display = \"none\";\n                                  }}\n                                />\n                            )}\n                            {attachment.type === \"file\" && (\n                              <a\n                                href={attachment.url}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                download={attachment.name}\n                                className=\"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs\"\n                              >\n                                <FileText className=\"h-3.5 w-3.5\" />\n                                <span className=\"font-medium truncate\">{attachment.name || \"فایل\"}</span>\n                              </a>\n                            )}\n                            {attachment.type === \"location\" && (\n                              <a\n                                href={attachment.url}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs\"\n                              >\n                                <MapPin className=\"h-3.5 w-3.5\" />\n                                <span className=\"font-medium\">{attachment.name || \"موقعیت\"}</span>\n                              </a>\n                            )}\n                            {attachment.type === \"audio\" && attachment.url && (\n                              <div className=\"flex items-center gap-2 p-2 bg-background/50 rounded\">\n                                <Mic className=\"h-3.5 w-3.5\" />\n                                <audio controls className=\"flex-1 h-7 text-xs\">\n                                  <source src={attachment.url} />\n                                </audio>\n                              </div>\n                            )}\n                          </motion.div>\n                        ))}\n                      </div>\n                    )}\n                    <div className={`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${\n                      msg.sender === \"user\" \n                        ? \"border-primary-foreground/20 justify-end\" \n                        : \"border-border/30 justify-start\"\n                    }`}>\n                      <span className={`text-[10px] sm:text-xs ${\n                          msg.sender === \"user\" \n                          ? \"text-primary-foreground/70\" \n                          : \"text-muted-foreground\"\n                      }`}>\n                        {new Date(msg.timestamp).toLocaleTimeString(\"fa-IR\", {\n                          hour: \"2-digit\",\n                          minute: \"2-digit\",\n                        })}\n                      </span>\n                      {msg.sender === \"user\" && (\n                        <>\n                          {msg.status === \"sending\" && (\n                            <Loader2 className=\"h-3 w-3 text-primary-foreground/50 animate-spin\" />\n                          )}\n                          {msg.status === \"sent\" && (\n                            <Check className=\"h-3 w-3 text-primary-foreground/40\" />\n                          )}\n                          {msg.status === \"delivered\" && (\n                            <CheckCheck className=\"h-3 w-3 text-primary-foreground/40\" />\n                          )}\n                          {msg.status === \"read\" && (\n                            <CheckCheck className=\"h-3 w-3 text-primary-foreground/70\" />\n                          )}\n                          {!msg.status && (\n                            <Check className=\"h-3 w-3 text-primary-foreground/40\" />\n                          )}\n                        </>\n                      )}\n                      <div className=\"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-6 w-6 hover:bg-background/20\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                              }}\n                              title=\"گزینه‌های بیشتر\"\n                            >\n                              <MoreVertical className=\"h-3.5 w-3.5\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent \n                            align={msg.sender === \"user\" ? \"end\" : \"start\"}\n                            className=\"min-w-[140px]\"\n                            onClick={(e) => e.stopPropagation()}\n                          >\n                            <DropdownMenuItem\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                handleReply(msg);\n                              }}\n                              className=\"cursor-pointer\"\n                            >\n                              <Reply className=\"h-4 w-4 ml-2\" />\n                              <span>پاسخ</span>\n                            </DropdownMenuItem>\n                            {msg.sender === \"user\" && (\n                              <>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem\n                                  onClick={(e) => {\n                                    e.stopPropagation();\n                                    handleEdit(msg);\n                                  }}\n                                  className=\"cursor-pointer\"\n                                >\n                                  <Edit2 className=\"h-4 w-4 ml-2\" />\n                                  <span>ویرایش</span>\n                                </DropdownMenuItem>\n                              </>\n                            )}\n                            <DropdownMenuSeparator />\n                            <DropdownMenuItem\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                if (confirm(\"آیا مطمئن هستید که می‌خواهید این پیام را حذف کنید؟\")) {\n                                  handleDelete(msg.id);\n                                }\n                              }}\n                              className=\"cursor-pointer text-destructive focus:text-destructive focus:bg-destructive/10\"\n                            >\n                              <Trash2 className=\"h-4 w-4 ml-2\" />\n                              <span>حذف</span>\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </div>\n                    </div>\n                  </div>\n                </motion.div>\n              ))}\n            {isSupportTyping && (\n              <motion.div\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: 10 }}\n                className=\"flex justify-start items-end gap-2.5\"\n              >\n                <TypingIndicator />\n              </motion.div>\n            )}\n            <div ref={messagesEndRef} />\n          </div>\n\n          <div className=\"border-t border-border/40 bg-background p-2 sm:p-3 space-y-2 relative\">\n            {/* Scroll to bottom button */}\n            <AnimatePresence>\n              {showScrollToBottom && (\n                <motion.div\n                  initial={{ opacity: 0, y: 10, scale: 0.9 }}\n                  animate={{ opacity: 1, y: 0, scale: 1 }}\n                  exit={{ opacity: 0, y: 10, scale: 0.9 }}\n                  className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-10\"\n                >\n                  <Button\n                    onClick={() => scrollToBottom(false)}\n                    size=\"icon\"\n                    className=\"h-9 w-9 rounded-full shadow-lg hover:shadow-xl bg-primary text-primary-foreground hover:bg-primary/90 transition-all\"\n                    title=\"برو به آخرین پیام\"\n                  >\n                    <ChevronDown className=\"h-4 w-4\" />\n                  </Button>\n                </motion.div>\n              )}\n            </AnimatePresence>\n            {/* Permission Guide */}\n            {showPermissionGuide && (\n              <motion.div\n                initial={{ opacity: 0, y: 5 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: 5 }}\n                className=\"p-3 bg-destructive/5 border-2 border-destructive/20 rounded-xl shadow-sm\"\n              >\n                <div className=\"flex items-start gap-2\">\n                  <Mic className=\"h-3.5 w-3.5 text-destructive mt-0.5 flex-shrink-0\" />\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-semibold text-destructive mb-1.5 leading-tight\">\n                      دسترسی میکروفون نیاز است\n                    </p>\n                    <p className=\"text-xs text-muted-foreground leading-relaxed\">\n                      لطفاً در تنظیمات مرورگر دسترسی میکروفون را فعال کنید\n                    </p>\n                  </div>\n                  <button\n                    onClick={() => setShowPermissionGuide(false)}\n                    className=\"p-0.5 rounded hover:bg-destructive/10 transition-colors flex-shrink-0\"\n                  >\n                    <X className=\"h-3 w-3 text-destructive\" />\n                  </button>\n                </div>\n              </motion.div>\n            )}\n\n            {/* Recording UI */}\n            {(isRecording || audioUrl) && (\n              <motion.div\n                initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                exit={{ opacity: 0, y: 10, scale: 0.95 }}\n                className=\"flex items-center gap-2 p-2 bg-destructive/10 border border-destructive/30 rounded-lg\"\n              >\n                {isRecording ? (\n                  <>\n                    <motion.div\n                      animate={{ scale: [1, 1.1, 1] }}\n                      transition={{ repeat: Infinity, duration: 1 }}\n                      className=\"p-1.5 rounded-full bg-destructive/20\"\n                    >\n                      <Mic className=\"h-3.5 w-3.5 text-destructive\" />\n                    </motion.div>\n                    <div className=\"flex-1\">\n                      <p className=\"text-xs font-medium text-destructive leading-tight\">در حال ضبط</p>\n                      <p className=\"text-xs text-muted-foreground font-mono\">{formatTime(recordingTime)}</p>\n                    </div>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={stopRecording}\n                      className=\"h-7 w-7 text-destructive hover:bg-destructive/10 rounded-lg\"\n                      >\n                      <Square className=\"h-3 w-3 fill-current\" />\n                      </Button>\n                  </>\n                ) : (\n                  <>\n                    <div className=\"p-1.5 rounded-full bg-primary/20\">\n                      <Mic className=\"h-3.5 w-3.5 text-primary\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <p className=\"text-xs font-medium leading-tight\">پیام صوتی آماده است</p>\n                      <p className=\"text-xs text-muted-foreground font-mono\">{formatTime(recordingTime)}</p>\n                    </div>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={cancelRecording}\n                      className=\"h-7 w-7 text-muted-foreground hover:text-destructive rounded-lg\"\n                      >\n                      <X className=\"h-3.5 w-3.5\" />\n                      </Button>\n                      <Button\n                        onClick={saveRecording}\n                        size=\"sm\"\n                      className=\"h-7 px-3 text-xs rounded-lg\"\n                      >\n                        ذخیره\n                      </Button>\n                  </>\n                )}\n              </motion.div>\n            )}\n\n            {/* Attachment Options */}\n            {showAttachmentOptions && (\n              <motion.div\n                initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                exit={{ opacity: 0, y: 10, scale: 0.95 }}\n                className=\"flex gap-2 p-2 bg-card rounded-lg border border-border/50 shadow-lg\"\n              >\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => {\n                      imageInputRef.current?.click();\n                      setShowAttachmentOptions(false);\n                    }}\n                  className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                  >\n                  <Image className=\"h-3.5 w-3.5\" />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => {\n                      fileInputRef.current?.click();\n                      setShowAttachmentOptions(false);\n                    }}\n                  className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                  >\n                  <FileText className=\"h-3.5 w-3.5\" />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => {\n                      handleLocationShare();\n                      setShowAttachmentOptions(false);\n                    }}\n                  className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                  >\n                  <MapPin className=\"h-3.5 w-3.5\" />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={async () => {\n                      setShowAttachmentOptions(false);\n                      if (isRecording) {\n                        stopRecording();\n                      } else {\n                        const hasPermission = await checkMicrophonePermission();\n                        if (!hasPermission) {\n                          toast({\n                            title: \"نیاز به دسترسی میکروفون\",\n                            description: \"برای ضبط صدا، لطفاً دسترسی میکروفون را در تنظیمات مرورگر فعال کنید.\",\n                            variant: \"destructive\",\n                            duration: 5000,\n                          });\n                        }\n                        startRecording();\n                      }\n                    }}\n                  className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                    disabled={isRecording}\n                  >\n                    {isRecording ? (\n                    <Pause className=\"h-3.5 w-3.5 text-destructive\" />\n                    ) : (\n                    <Mic className=\"h-3.5 w-3.5\" />\n                    )}\n                  </Button>\n              </motion.div>\n            )}\n\n            {/* Hidden Inputs */}\n            <input\n              ref={imageInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              multiple\n              className=\"hidden\"\n              onChange={(e) => handleFileSelect(e, \"image\")}\n            />\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              multiple\n              className=\"hidden\"\n              onChange={(e) => handleFileSelect(e, \"file\")}\n            />\n            <div className=\"flex items-end gap-2\">\n              <div className=\"flex-1 relative\">\n                {/* Attachments Preview inside input */}\n                {attachments.length > 0 && (\n                  <div className=\"absolute top-2 right-2 left-2 z-10 pointer-events-none overflow-hidden\">\n                    <div className=\"overflow-x-auto overflow-y-hidden scroll-smooth w-full [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]\">\n                      <div className=\"flex items-center gap-1.5 flex-nowrap\">\n                        {attachments.map((attachment) => (\n                          <div\n                            key={attachment.id}\n                            className=\"relative group pointer-events-auto flex-shrink-0 w-auto\"\n                          >\n                            <div className=\"bg-card/95 backdrop-blur-sm rounded-md p-1 border border-border/40 shadow-sm\">\n                              {attachment.type === \"image\" && attachment.url && (\n                                <img\n                                  src={attachment.url}\n                                  alt={attachment.name || \"تصویر\"}\n                                  className=\"w-10 h-10 object-cover rounded\"\n                                />\n                              )}\n                              {attachment.type === \"file\" && (\n                                <div className=\"flex items-center gap-1 px-1.5 py-1\">\n                                  <FileText className=\"h-3 w-3 flex-shrink-0 text-primary\" />\n                                  <p className=\"text-[10px] truncate max-w-[50px] font-medium leading-tight\">{attachment.name}</p>\n                                </div>\n                              )}\n                              {attachment.type === \"location\" && (\n                                <div className=\"flex items-center gap-1 px-1.5 py-1\">\n                                  <MapPin className=\"h-3 w-3 flex-shrink-0 text-primary\" />\n                                  <span className=\"text-[10px] font-medium whitespace-nowrap leading-tight\">موقعیت</span>\n                                </div>\n                              )}\n                              {attachment.type === \"audio\" && (\n                                <div className=\"flex items-center gap-1 px-1.5 py-1\">\n                                  <Mic className=\"h-3 w-3 flex-shrink-0 text-primary\" />\n                                  <span className=\"text-[10px] font-medium whitespace-nowrap leading-tight\">\n                                    {attachment.duration ? formatTime(attachment.duration) : \"صدا\"}\n                                  </span>\n                                </div>\n                              )}\n                            </div>\n                            <button\n                              onClick={() => handleRemoveAttachment(attachment.id)}\n                              className=\"absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-20 hover:scale-110\"\n                            >\n                              <X className=\"h-2.5 w-2.5\" />\n                            </button>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                <Textarea\n                  ref={textareaRef}\n                  value={message}\n                  onChange={(e) => {\n                    setMessage(e.target.value);\n                    \n                    // Clear existing timeout\n                    if (typingTimeoutRef.current) {\n                      clearTimeout(typingTimeoutRef.current);\n                    }\n                    \n                    // Send typing status\n                    if (e.target.value.trim().length > 0) {\n                      sendTypingStatus(true);\n                      \n                      // Stop typing after 2 seconds of no input\n                      typingTimeoutRef.current = setTimeout(() => {\n                        sendTypingStatus(false);\n                      }, 2000);\n                    } else {\n                      sendTypingStatus(false);\n                    }\n                  }}\n                  onKeyDown={(e) => {\n                    if (e.key === \"Enter\" && !e.shiftKey) {\n                      e.preventDefault();\n                      if (typingTimeoutRef.current) {\n                        clearTimeout(typingTimeoutRef.current);\n                      }\n                      sendTypingStatus(false);\n                      if (message.trim() || attachments.length > 0) {\n                      handleSendMessage();\n                      }\n                    }\n                  }}\n                  placeholder=\"پیام خود را بنویسید...\"\n                  className={`min-h-[44px] max-h-[100px] resize-none text-sm leading-relaxed rounded-lg border pr-20 pl-3 py-2 ${\n                    attachments.length > 0 ? \"pt-12\" : \"\"\n                  }`}\n                />\n\n                {/* Buttons - inside input */}\n                <div className=\"absolute bottom-2 right-2 flex items-center gap-1\">\n                  {/* Attachment Button */}\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => setShowAttachmentOptions(!showAttachmentOptions)}\n                    className={`h-7 w-7 rounded-lg transition-all ${\n                      showAttachmentOptions \n                        ? \"bg-primary/10 text-primary\" \n                        : \"hover:bg-muted/60 text-muted-foreground hover:text-foreground\"\n                    }`}\n                  >\n                    <Paperclip className=\"h-4 w-4\" />\n                  </Button>\n\n                  {/* Send Button - only show when there's content */}\n                  {(message.trim() || attachments.length > 0) && !isRecording && (\n                    <>\n                      {isSaving ? (\n                        <Loader2 className=\"h-4 w-4 text-primary animate-spin\" />\n                      ) : (\n                    <Button\n                      onClick={handleSendMessage}\n                      size=\"icon\"\n                          className=\"h-7 w-7 rounded-lg transition-all\"\n                    >\n                          <Send className=\"h-3.5 w-3.5\" />\n                    </Button>\n                )}\n                    </>\n                )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </>\n  );\n\n  return (\n    <>\n      <div data-chat-open={isOpen && step === \"chat\" ? \"true\" : \"false\"} style={{ display: \"none\" }} />\n      <Sheet open={isOpen} onOpenChange={onOpenChange}>\n        {trigger && <SheetTrigger asChild>{trigger}</SheetTrigger>}\n        <SheetContent\n          side=\"left\"\n          className=\"w-full sm:w-[420px] md:w-[480px] p-0 flex flex-col border-l-2 border-border/40 bg-background shadow-2xl\"\n        >\n          {renderContent()}\n        </SheetContent>\n      </Sheet>\n    </>\n  );\n}\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Pause\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSIxNiIgeD0iNiIgeT0iNCIgLz4KICA8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSIxNiIgeD0iMTQiIHk9IjQiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/pause\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Pause = createLucideIcon('Pause', [\n  ['rect', { width: '4', height: '16', x: '6', y: '4', key: 'iffhe4' }],\n  ['rect', { width: '4', height: '16', x: '14', y: '4', key: 'sjin7j' }],\n]);\n\nexport default Pause;\n"],"names":[],"mappings":"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","ignoreList":[1]}
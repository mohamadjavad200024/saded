module.exports=[52763,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(40695),f=a.i(46893),g=a.i(5522),h=a.i(76504),i=a.i(92759),j=a.i(45222),k=a.i(63519),l=a.i(92258),m=a.i(38632),n=a.i(83952),o=a.i(24987),p=a.i(4720),q=a.i(33508),r=a.i(4975),s=a.i(48124),t=a.i(8549),u=a.i(96221),v=a.i(33441),w=a.i(20610),x=a.i(23808),y=a.i(10448),z=a.i(81560),A=a.i(79360),B=a.i(5784),C=a.i(32860),D=a.i(46271),E=a.i(62036),F=a.i(77687),G=a.i(80794),H=a.i(9655),I=a.i(42964),J=a.i(62478),K=a.i(54917),L=a.i(25173),M=a.i(96628);function N(){let a=(0,d.useRouter)(),{toast:M}=(0,F.useToast)(),{showNotification:N,requestPermission:O}=(0,G.useNotifications)(),{isOnline:P,lastSeen:Q,checkStatus:R}=(0,I.useAdminPresence)({enabled:!0,heartbeatInterval:2e4}),{user:S,isAuthenticated:T}=(0,L.useAuthStore)(),[U,V]=(0,c.useState)([{id:"1",text:"سلام! خوش آمدید. برای خرید سریع لطفاً اطلاعات زیر را وارد کنید:",sender:"support",timestamp:new Date}]),[W,X]=(0,c.useState)(""),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(null),[aa,ab]=(0,c.useState)("chat"),ac=(0,c.useCallback)(()=>({name:"",phone:"",email:""}),[T,S]),[ad,ae]=(0,c.useState)(ac),[af,ag]=(0,c.useState)([]),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(!1),[al,am]=(0,c.useState)(0),[an,ao]=(0,c.useState)(null),[ap,aq]=(0,c.useState)(null),[ar,as]=(0,c.useState)(!1),[at,au]=(0,c.useState)(!1),[av,aw]=(0,c.useState)(!1),[ax,ay]=(0,c.useState)(!1),[az,aA]=(0,c.useState)(null),aB=(0,c.useRef)(null),aC=(0,c.useRef)(null),aD=(0,c.useRef)(null),aE=(0,c.useRef)(null),aF=(0,c.useRef)(null),aG=(0,c.useRef)(null),aH=(0,c.useRef)(null),aI=(0,c.useRef)(null);(0,c.useRef)(!1);let aJ=(0,c.useRef)(!1),aK=(0,c.useCallback)(async a=>{try{let a=await fetch("/api/chat/my",{credentials:"include"}),b=await a.json().catch(()=>null);if(!a.ok||!b?.success||!b?.data?.chatId){let a=b?.error||b?.message||"خطا در دریافت چت";throw Error(a)}let c=String(b.data.chatId);return aA(c),ab("chat"),c}catch(b){return a?.silent||M({title:"خطا",description:b instanceof Error?b.message:"خطا در دریافت چت",variant:"destructive"}),null}},[M]),aL=(0,c.useCallback)(async a=>{let b=a||az;if(b)try{let a=await fetch(`/api/chat?chatId=${b}`,{credentials:"include"});if(!a.ok)return;let c=await a.json();if(c.success&&c.data?.messages){let a=c.data.messages.map(a=>({id:a.id,text:a.text||"",sender:a.sender,timestamp:new Date(a.createdAt),attachments:a.attachments?Array.isArray(a.attachments)?a.attachments:JSON.parse(a.attachments):[],status:a.status||("user"===a.sender?"sent":void 0)}));V(b=>{let c=new Set(b.map(a=>a.id)),d=a.filter(a=>!c.has(a.id)),e=b.map(b=>{let c=a.find(a=>a.id===b.id);return c&&"user"===b.sender&&c.status&&b.status!==c.status?{...b,status:c.status}:b});return d.length>0?[...e,...d]:e})}}catch(a){K.logger.error("Error polling messages:",a)}},[az]);(0,c.useEffect)(()=>{T&&S&&(az||aK({silent:!0}).catch(()=>null))},[T,S,az,aK]),(0,c.useEffect)(()=>{if(!az)return;aL(az);let a=setInterval(()=>aL(az),3e3);return()=>clearInterval(a)},[az,aL]),(0,c.useCallback)(async(a,b)=>{let c=a.name?.trim(),d=a.phone?.trim(),e=a.email?.trim();if(!c||!d)return b?.silent||M({title:"خطا",description:"لطفاً نام و شماره تماس را وارد کنید",variant:"destructive"}),null;try{let a=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({customerInfo:{name:c,phone:d,email:e||void 0},messages:[]})}),b=await a.json().catch(()=>null);if(!a.ok||!b?.success){let c=b?.error||(429===a.status?"درخواست‌های شما زیاد است. لطفاً کمی بعد دوباره تلاش کنید.":null)||"خطا در ایجاد چت";throw Error(c)}let f=b.data?.id;if(!f)throw Error("خطا در ایجاد چت");return aA(f),ab("chat"),aL(f),f}catch(a){return K.logger.error("Error creating chat:",a),b?.silent||M({title:"خطا",description:a instanceof Error?a.message:"خطا در ایجاد چت. لطفاً دوباره تلاش کنید.",variant:"destructive"}),null}},[M,aL]);let aM=(0,c.useCallback)(async()=>{await aK({silent:!1})},[aK]),aN=(0,c.useCallback)(a=>{let b=Math.floor(a/60);return`${b.toString().padStart(2,"0")}:${(a%60).toString().padStart(2,"0")}`},[]),aO=(0,c.useCallback)(async()=>{try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(a=>a.stop()),!0}catch(a){return ay(!0),!1}},[]),aP=(0,c.useCallback)(async()=>{try{if(!await aO())return;let a=await navigator.mediaDevices.getUserMedia({audio:!0}),b=new MediaRecorder(a);aI.current=b;let c=[];b.ondataavailable=a=>{a.data.size>0&&c.push(a.data)},b.onstop=()=>{let b=new Blob(c,{type:"audio/webm"});aq(b);let d=URL.createObjectURL(b);ao(d),a.getTracks().forEach(a=>a.stop())},b.start(),ak(!0),am(0),aH.current=setInterval(()=>{am(a=>a+1)},1e3)}catch(a){K.logger.error("Error starting recording:",a),M({title:"خطا",description:"خطا در شروع ضبط صدا",variant:"destructive"})}},[aO,M]),aQ=(0,c.useCallback)(()=>{aI.current&&aj&&(aI.current.stop(),ak(!1),aH.current&&(clearInterval(aH.current),aH.current=null))},[aj]),aR=(0,c.useCallback)(()=>{aQ(),ao(null),aq(null),am(0)},[aQ]),aS=(0,c.useCallback)(async()=>{if(ap&&an)try{as(!0);let a=new FormData;a.append("file",ap,"recording.webm"),a.append("type","audio");let b=await fetch("/api/chat/upload",{method:"POST",credentials:"include",body:a});if(!b.ok)throw Error("خطا در آپلود فایل");let c=await b.json();if(c.success&&c.data?.url){let a={id:`audio-${Date.now()}`,type:"audio",url:c.data.url,name:"پیام صوتی",duration:al};ag(b=>[...b,a]),ao(null),aq(null),am(0),aJ.current=!0}}catch(a){K.logger.error("Error saving recording:",a),M({title:"خطا",description:"خطا در ذخیره پیام صوتی",variant:"destructive"})}finally{as(!1)}},[ap,an,al,M]),aT=(0,c.useCallback)(async(a,b)=>{let c=a.target.files;if(c&&0!==c.length){try{for(let a=0;a<c.length;a++){let d=c[a],e=new FormData;e.append("file",d),e.append("type",b);let f=await fetch("/api/chat/upload",{method:"POST",body:e});if(!f.ok)throw Error("خطا در آپلود فایل");let g=await f.json();if(g.success&&g.data?.url){let c={id:`${b}-${Date.now()}-${a}`,type:b,url:g.data.url,name:d.name,size:d.size};ag(a=>[...a,c])}}}catch(a){K.logger.error("Error uploading file:",a),M({title:"خطا",description:"خطا در آپلود فایل",variant:"destructive"})}a.target&&(a.target.value="")}},[M]),aU=(0,c.useCallback)(()=>{navigator.geolocation?"https:"!==window.location.protocol&&"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname?M({title:"خطا",description:"برای استفاده از موقعیت‌یابی باید از HTTPS استفاده کنید. لطفاً از آدرس امن سایت استفاده کنید.",variant:"destructive"}):navigator.geolocation.getCurrentPosition(a=>{let{latitude:b,longitude:c}=a.coords,d=`https://www.google.com/maps?q=${b},${c}`,e={id:`location-${Date.now()}`,type:"location",url:d,name:"موقعیت من"};ag(a=>[...a,e]),ai(!1),aJ.current=!0},a=>{K.logger.error("Error getting location:",a);let b="خطا در دریافت موقعیت";1===a.code?b="دسترسی به موقعیت رد شد. لطفاً در تنظیمات مرورگر اجازه دسترسی به موقعیت را فعال کنید.":2===a.code?b="موقعیت در دسترس نیست. لطفاً مطمئن شوید که GPS فعال است.":3===a.code&&(b="دریافت موقعیت زمان‌بر شد. لطفاً دوباره تلاش کنید."),M({title:"خطا",description:b,variant:"destructive"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):M({title:"خطا",description:"مرورگر شما از موقعیت‌یابی پشتیبانی نمی‌کند",variant:"destructive"})},[M]),aV=(0,c.useCallback)(a=>{ag(b=>b.filter(b=>b.id!==a))},[]),aW=(0,c.useCallback)(async a=>{if(az)try{await fetch("/api/chat/typing",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:az,sender:"user",isTyping:a})})}catch(a){}},[az]);(0,c.useEffect)(()=>{T&&S&&ae({name:S.name||"",phone:S.phone||"",email:""})},[T,S]);let aX=(0,c.useCallback)(async()=>{if(az)try{let a=await fetch(`/api/chat/typing?chatId=${az}&sender=support`,{credentials:"include"});if(a.ok){let b=await a.json();b.success&&au(b.data?.isTyping||!1)}}catch(a){}},[az]),aY=(0,c.useCallback)(async()=>{let a=az;if(!a){let b=await aK({silent:!0});if(!b)return void M({title:"خطا",description:"چت آماده نیست. لطفاً دوباره تلاش کنید",variant:"destructive"});a=b}let b=aD.current?.value??W;if(!b.trim()&&0===af.length)return;if(!ad.name||!ad.phone){M({title:"خطا",description:"لطفاً ابتدا اطلاعات خود را وارد کنید",variant:"destructive"}),ab("info");return}if($){try{(await fetch(`/api/chat/message/${$.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({text:b,attachments:af})})).ok&&(V(a=>a.map(a=>a.id===$.id?{...a,text:b,attachments:af}:a)),_(null),X(""),ag([]))}catch(a){K.logger.error("Error editing message:",a)}return}let c=`temp-${Date.now()}`,d={id:c,text:W,sender:"user",timestamp:new Date,attachments:af,status:"sending"};V(a=>[...a,d]),X(""),ag([]),Z(null),aG.current&&(clearTimeout(aG.current),aG.current=null),aW(!1);try{let e={id:c,text:b,sender:"user",timestamp:d.timestamp.toISOString(),attachments:af.filter(a=>{let b=a.url;return b&&!b.startsWith("blob:")&&!b.startsWith("data:")&&(b.startsWith("http")||b.startsWith("/"))}),status:"sent"},f=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:a,customerInfo:{name:ad.name,phone:ad.phone,email:ad.email||void 0},messages:[e]})});if(!f.ok){let a=await f.json().catch(()=>({})),b="string"==typeof a?.error&&a.error||"string"==typeof a?.error?.message&&a.error.message||"string"==typeof a?.message&&a.message||(429===f.status?"درخواست‌های شما زیاد است. لطفاً کمی بعد دوباره تلاش کنید.":null)||`خطا در ارسال پیام (HTTP ${f.status})`;throw Error(b)}let g=await f.json();if(g.success&&g.data?.messages&&g.data.messages.length>0){let b=g.data.messages[0];V(a=>a.map(a=>a.id===c?{...a,id:b.id,text:b.text||a.text,status:b.status||"sent",attachments:b.attachments||a.attachments}:a)),g.data.chatId&&g.data.chatId!==a&&aA(g.data.chatId)}setTimeout(()=>{aL(a)},500)}catch(a){K.logger.error("Error sending message:",a),V(a=>a.filter(a=>a.id!==c)),M({title:"خطا",description:a instanceof Error?a.message:"خطا در ارسال پیام",variant:"destructive"})}setTimeout(()=>{a0(!1)},100)},[az,ad,af,Y,$,aW,M,ab,aK,aL]);(0,c.useEffect)(()=>{if(aJ.current&&af.length>0){aJ.current=!1;let a=setTimeout(()=>{aY()},200);return()=>clearTimeout(a)}},[af,aY]);let aZ=(0,c.useCallback)(a=>{Z(a),_(null)},[]),a$=(0,c.useCallback)(a=>{_(a),Z(null),X(a.text||"")},[]),a_=(0,c.useCallback)(async a=>{try{(await fetch(`/api/chat/message/${a}`,{method:"DELETE",credentials:"include"})).ok&&V(b=>b.filter(b=>b.id!==a))}catch(a){K.logger.error("Error deleting message:",a)}},[]),a0=(0,c.useCallback)((a=!1)=>{aB.current&&aB.current.scrollIntoView({behavior:a?"auto":"smooth",block:"end"})},[]),a1=(0,c.useCallback)(()=>{if(!aC.current)return void aw(!1);let a=aC.current;aw(a.scrollHeight-a.scrollTop-a.clientHeight>150)},[]);return(0,c.useEffect)(()=>{if(!az||"chat"!==aa)return;aL();let a=setInterval(()=>{aL(),aX()},3e3);return()=>clearInterval(a)},[az,aa,aL,aX]),(0,c.useEffect)(()=>{U.length>0&&"chat"===aa&&setTimeout(()=>{a0(!0),a1()},100)},[U.length,aa,a0,a1]),(0,c.useEffect)(()=>{let a=aC.current;if(!a)return;let b=()=>{a1()};return a.addEventListener("scroll",b,{passive:!0}),()=>a.removeEventListener("scroll",b)},[a1]),(0,c.useEffect)(()=>{O()},[O]),(0,c.useEffect)(()=>{let a=document.body.style.overflow,b=document.documentElement.style.overflow;return document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",()=>{document.body.style.overflow=a,document.documentElement.style.overflow=b}},[]),(0,b.jsx)("div",{className:"flex flex-col overflow-hidden",style:{height:"100dvh"},children:(0,b.jsxs)("main",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:[(0,b.jsx)("div",{className:"flex-shrink-0 border-b border-border/40 px-4 sm:px-6 py-3 bg-background/95 backdrop-blur-sm",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>a.back(),className:"h-8 w-8 rounded-lg",children:(0,b.jsx)(C.ArrowRight,{className:"h-4 w-4"})}),(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsxs)("h1",{className:"text-base font-semibold text-foreground flex items-center gap-2",children:["خرید سریع","chat"===aa&&(0,b.jsx)(H.OnlineStatusBadge,{isOnline:P,lastSeen:Q,showText:!1})]})}),"chat"===aa&&ad.name&&ad.phone&&(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{ab("info"),V([{id:"1",text:"سلام! خوش آمدید. برای خرید سریع لطفاً اطلاعات زیر را وارد کنید:",sender:"support",timestamp:new Date}])},className:"h-8 w-8 rounded-lg hover:bg-primary/10 transition-colors",title:"تغییر اطلاعات",children:(0,b.jsxs)("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})}),(0,b.jsx)("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:"info"===aa?(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 sm:p-8 space-y-6 bg-gradient-to-b from-background via-background to-muted/10",children:[(0,b.jsxs)(D.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-center pb-2",children:[(0,b.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 mb-3 shadow-lg",children:(0,b.jsx)(j.MessageCircle,{className:"h-8 w-8 text-primary"})}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"لطفاً اطلاعات زیر را برای شروع خرید سریع وارد کنید"})]}),(0,b.jsxs)(D.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-5",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,b.jsxs)("svg",{className:"h-4 w-4 text-primary",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"نام و نام خانوادگی",(0,b.jsx)("span",{className:"text-destructive text-xs",children:"*"})]}),(0,b.jsx)(g.Input,{type:"text",placeholder:"مثال: علی احمدی",value:ad.name,onChange:a=>ae({...ad,name:a.target.value}),className:"h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,b.jsx)(k.Phone,{className:"h-4 w-4 text-primary"}),"شماره تماس",(0,b.jsx)("span",{className:"text-destructive text-xs",children:"*"})]}),(0,b.jsx)(g.Input,{type:"tel",placeholder:"09123456789",value:ad.phone,onChange:a=>ae({...ad,phone:a.target.value}),className:"h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,b.jsx)(l.Mail,{className:"h-4 w-4 text-primary"}),"ایمیل",(0,b.jsx)("span",{className:"text-xs text-muted-foreground font-normal",children:"(اختیاری)"})]}),(0,b.jsx)(g.Input,{type:"email",placeholder:"example@email.com",value:ad.email,onChange:a=>ae({...ad,email:a.target.value}),className:"h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"})]})]}),(0,b.jsxs)(D.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"pt-2",children:[(0,b.jsx)(e.Button,{onClick:aM,disabled:!ad.name||!ad.phone,className:"w-full h-13 text-base font-semibold bg-gradient-to-r from-primary via-primary to-primary/90 hover:from-primary/90 hover:via-primary/80 hover:to-primary/70 shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 transition-all duration-300 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed rounded-xl",children:(0,b.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["ادامه",(0,b.jsx)(D.motion.div,{animate:{x:[0,4,0]},transition:{repeat:1/0,duration:1.5,delay:.5},children:"→"})]})}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground text-center mt-3",children:"با ادامه، شما شرایط و قوانین ما را می‌پذیرید"})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{ref:aC,className:"flex-1 min-h-0 overflow-y-auto p-5 sm:p-6 md:p-8 space-y-5 sm:space-y-6 bg-gradient-to-b from-background via-background/95 to-muted/5 scroll-smooth",children:[0===U.length&&(0,b.jsxs)(D.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center h-full min-h-[200px] text-center px-4",children:[(0,b.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mb-4 shadow-lg",children:(0,b.jsx)(j.MessageCircle,{className:"h-10 w-10 text-primary/60"})}),(0,b.jsx)("p",{className:"text-muted-foreground text-base font-medium leading-relaxed",children:"هنوز پیامی ارسال نشده است"}),(0,b.jsx)("p",{className:"text-muted-foreground/70 text-sm mt-2 leading-relaxed",children:"پیام خود را بنویسید..."})]}),U.map(a=>(0,b.jsx)(D.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${"user"===a.sender?"justify-end":"justify-start"} items-end gap-2 group`,children:(0,b.jsxs)("div",{className:`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${"user"===a.sender?"bg-primary text-primary-foreground":"bg-muted text-foreground border border-border/40"}`,children:[a.text&&(0,b.jsx)("p",{className:"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5",children:a.text}),a.attachments&&a.attachments.length>0&&(0,b.jsx)("div",{className:`space-y-2 ${a.text?"mt-2":""}`,children:a.attachments.map(a=>(0,b.jsxs)("div",{className:"rounded-xl overflow-hidden",children:["image"===a.type&&a.url&&(0,b.jsx)("img",{src:a.url,alt:a.name||"تصویر",className:"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all",onClick:()=>window.open(a.url,"_blank")}),"file"===a.type&&(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",download:a.name,className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,b.jsx)(p.FileText,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"font-medium truncate",children:a.name||"فایل"})]}),"location"===a.type&&(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,b.jsx)(o.MapPin,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"font-medium",children:a.name||"موقعیت"})]}),"audio"===a.type&&a.url&&(0,b.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-background/50 rounded",children:[(0,b.jsx)(r.Mic,{className:"h-3.5 w-3.5"}),(0,b.jsx)("audio",{controls:!0,className:"flex-1 h-7 text-xs",children:(0,b.jsx)("source",{src:a.url})})]})]},a.id))}),(0,b.jsxs)("div",{className:`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${"user"===a.sender?"border-primary-foreground/20 justify-end":"border-border/30 justify-start"}`,children:[(0,b.jsx)("span",{className:`text-[10px] sm:text-xs ${"user"===a.sender?"text-primary-foreground/70":"text-muted-foreground"}`,children:new Date(a.timestamp).toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}),"user"===a.sender&&(0,b.jsxs)(b.Fragment,{children:["sending"===a.status&&(0,b.jsx)(u.Loader2,{className:"h-3 w-3 text-primary-foreground/50 animate-spin"}),"sent"===a.status&&(0,b.jsx)(v.Check,{className:"h-3 w-3 text-primary-foreground/40"}),"delivered"===a.status&&(0,b.jsx)(w.CheckCheck,{className:"h-3 w-3 text-primary-foreground/40"}),"read"===a.status&&(0,b.jsx)(w.CheckCheck,{className:"h-3 w-3 text-primary-foreground/70"}),!a.status&&(0,b.jsx)(v.Check,{className:"h-3 w-3 text-primary-foreground/40"})]}),(0,b.jsx)("div",{className:"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsxs)(h.DropdownMenu,{children:[(0,b.jsx)(h.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-background/20",children:(0,b.jsx)(A.MoreVertical,{className:"h-3.5 w-3.5"})})}),(0,b.jsxs)(h.DropdownMenuContent,{align:"user"===a.sender?"end":"start",className:"min-w-[140px]",children:[(0,b.jsxs)(h.DropdownMenuItem,{onClick:()=>aZ(a),children:[(0,b.jsx)(x.Reply,{className:"h-4 w-4 ml-2"}),(0,b.jsx)("span",{children:"پاسخ"})]}),"user"===a.sender&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.DropdownMenuSeparator,{}),(0,b.jsxs)(h.DropdownMenuItem,{onClick:()=>a$(a),children:[(0,b.jsx)(y.Edit2,{className:"h-4 w-4 ml-2"}),(0,b.jsx)("span",{children:"ویرایش"})]})]}),(0,b.jsx)(h.DropdownMenuSeparator,{}),(0,b.jsxs)(h.DropdownMenuItem,{onClick:()=>{confirm("آیا مطمئن هستید که می‌خواهید این پیام را حذف کنید؟")&&a_(a.id)},className:"text-destructive focus:text-destructive focus:bg-destructive/10",children:[(0,b.jsx)(z.Trash2,{className:"h-4 w-4 ml-2"}),(0,b.jsx)("span",{children:"حذف"})]})]})]})})]})]})},a.id)),at&&(0,b.jsx)(D.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-start items-end gap-2.5",children:(0,b.jsx)(J.TypingIndicator,{})}),(0,b.jsx)("div",{ref:aB})]}),(0,b.jsxs)("div",{className:"flex-shrink-0 border-t border-border/40 bg-background/95 backdrop-blur-sm p-2 sm:p-3 space-y-2 relative",children:[(0,b.jsx)(E.AnimatePresence,{children:av&&(0,b.jsx)(D.motion.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-10",children:(0,b.jsx)(e.Button,{onClick:()=>a0(!1),size:"icon",className:"h-9 w-9 rounded-full shadow-lg hover:shadow-xl bg-primary text-primary-foreground hover:bg-primary/90 transition-all",title:"برو به آخرین پیام",children:(0,b.jsx)(B.ChevronDown,{className:"h-4 w-4"})})})}),(aj||an)&&(0,b.jsx)(D.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"flex items-center gap-2 p-2 bg-destructive/10 border border-destructive/30 rounded-lg",children:aj?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(D.motion.div,{animate:{scale:[1,1.1,1]},transition:{repeat:1/0,duration:1},className:"p-1.5 rounded-full bg-destructive/20",children:(0,b.jsx)(r.Mic,{className:"h-3.5 w-3.5 text-destructive"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-destructive leading-tight",children:"در حال ضبط"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:aN(al)})]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:aQ,className:"h-7 w-7 text-destructive hover:bg-destructive/10 rounded-lg",children:(0,b.jsx)(s.Square,{className:"h-3 w-3 fill-current"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"p-1.5 rounded-full bg-primary/20",children:(0,b.jsx)(r.Mic,{className:"h-3.5 w-3.5 text-primary"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-xs font-medium leading-tight",children:"پیام صوتی آماده است"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:aN(al)})]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:aR,className:"h-7 w-7 text-muted-foreground hover:text-destructive rounded-lg",children:(0,b.jsx)(q.X,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(e.Button,{onClick:aS,size:"sm",className:"h-7 px-3 text-xs rounded-lg",children:"ذخیره"})]})}),ah&&(0,b.jsxs)(D.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"flex gap-2 p-2 bg-card rounded-lg border border-border/50 shadow-lg",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{aE.current?.click(),ai(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,b.jsx)(m.Image,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{aF.current?.click(),ai(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,b.jsx)(p.FileText,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{aU(),ai(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,b.jsx)(o.MapPin,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:async()=>{ai(!1),aj?aQ():(await aO()||M({title:"نیاز به دسترسی میکروفون",description:"برای ضبط صدا، لطفاً دسترسی میکروفون را در تنظیمات مرورگر فعال کنید.",variant:"destructive",duration:5e3}),aP())},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",disabled:aj,children:aj?(0,b.jsx)(t.Pause,{className:"h-3.5 w-3.5 text-destructive"}):(0,b.jsx)(r.Mic,{className:"h-3.5 w-3.5"})})]}),(0,b.jsx)("input",{ref:aE,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:a=>aT(a,"image")}),(0,b.jsx)("input",{ref:aF,type:"file",multiple:!0,className:"hidden",onChange:a=>aT(a,"file")}),(0,b.jsx)("div",{className:"flex items-end gap-2",children:(0,b.jsxs)("div",{className:"flex-1 relative",children:[af.length>0&&(0,b.jsx)("div",{className:"absolute top-2 right-2 left-2 z-10 pointer-events-none overflow-hidden",children:(0,b.jsx)("div",{className:"overflow-x-auto overflow-y-hidden scroll-smooth w-full [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:(0,b.jsx)("div",{className:"flex items-center gap-1.5 flex-nowrap",children:af.map(a=>(0,b.jsxs)("div",{className:"relative group pointer-events-auto flex-shrink-0 w-auto",children:[(0,b.jsxs)("div",{className:"bg-card/95 backdrop-blur-sm rounded-md p-1 border border-border/40 shadow-sm",children:["image"===a.type&&a.url&&(0,b.jsx)("img",{src:a.url,alt:a.name||"تصویر",className:"w-10 h-10 object-cover rounded"}),"file"===a.type&&(0,b.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,b.jsx)(p.FileText,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,b.jsx)("p",{className:"text-[10px] truncate max-w-[50px] font-medium leading-tight",children:a.name})]}),"location"===a.type&&(0,b.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,b.jsx)(o.MapPin,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,b.jsx)("span",{className:"text-[10px] font-medium whitespace-nowrap leading-tight",children:"موقعیت"})]}),"audio"===a.type&&(0,b.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,b.jsx)(r.Mic,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,b.jsx)("span",{className:"text-[10px] font-medium whitespace-nowrap leading-tight",children:a.duration?aN(a.duration):"صدا"})]})]}),(0,b.jsx)("button",{onClick:()=>aV(a.id),className:"absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-20 hover:scale-110",children:(0,b.jsx)(q.X,{className:"h-2.5 w-2.5"})})]},a.id))})})}),(0,b.jsx)(f.Textarea,{ref:aD,value:W,onChange:a=>{X(a.target.value),aG.current&&clearTimeout(aG.current),a.target.value.trim().length>0?(aW(!0),aG.current=setTimeout(()=>{aW(!1)},2e3)):aW(!1)},onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),aG.current&&clearTimeout(aG.current),aW(!1),aY())},placeholder:"پیام خود را بنویسید...",className:`min-h-[44px] max-h-[100px] resize-none text-sm leading-relaxed rounded-lg border pr-20 pl-3 py-2 ${af.length>0?"pt-12":""}`}),(0,b.jsxs)("div",{className:"absolute bottom-2 right-2 flex items-center gap-1",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>ai(!ah),className:`h-7 w-7 rounded-lg transition-all ${ah?"bg-primary/10 text-primary":"hover:bg-muted/60 text-muted-foreground hover:text-foreground"}`,children:(0,b.jsx)(n.Paperclip,{className:"h-4 w-4"})}),!aj&&(0,b.jsx)(b.Fragment,{children:ar?(0,b.jsx)(u.Loader2,{className:"h-4 w-4 text-primary animate-spin"}):(0,b.jsx)(e.Button,{onClick:aY,size:"icon",className:"h-7 w-7 rounded-lg transition-all",children:(0,b.jsx)(i.Send,{className:"h-3.5 w-3.5"})})})]})]})})]})]})})]})})}function O(){return(0,b.jsx)(M.ProtectedRoute,{requireAuth:!0,children:(0,b.jsx)(N,{})})}a.s(["default",()=>O])}];

//# sourceMappingURL=app_chat_page_tsx_18691586._.js.map
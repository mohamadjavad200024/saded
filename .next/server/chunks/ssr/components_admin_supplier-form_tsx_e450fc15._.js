module.exports=[10836,a=>{"use strict";var b=a.i(87924),c=a.i(95245),d=a.i(59501),e=a.i(99614),f=a.i(40695),g=a.i(5522),h=a.i(17171),i=a.i(46893),j=a.i(80281),k=a.i(3130),l=a.i(92776),m=a.i(49814),n=a.i(77687),o=a.i(50944),p=a.i(72131),q=a.i(33508),r=a.i(96221),s=a.i(63519),t=a.i(83497),u=a.i(54161),v=a.i(87682),w=a.i(65733),x=a.i(88237),y=a.i(60421),z=a.i(15618),A=a.i(81560),B=a.i(24569);function C({supplier:a,onUpdate:c}){let{products:d}=(0,y.useProductStore)(),{getActiveCategories:e}=(0,m.useCategoryStore)(),{toast:i}=(0,n.useToast)(),[j,k]=(0,p.useState)(!1),[l,o]=(0,p.useState)(null),[q,r]=(0,p.useState)(""),[s,t]=(0,p.useState)(0),[C,D]=(0,p.useState)(void 0),[E,F]=(0,p.useState)("all"),G=e(),H=a.products||[],I=(0,p.useMemo)(()=>{let b=d.filter(b=>b.category&&a.categories.includes(b.category));if("all"!==E&&(b=b.filter(a=>a.category===E)),!l){let a=H.map(a=>a.productId);b=b.filter(b=>!a.includes(b.id))}return b},[d,a.categories,E,H,l]),J=(0,p.useMemo)(()=>{let a={};return H.forEach(b=>{a[b.category]||(a[b.category]=[]),a[b.category].push(b)}),a},[H]);return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"مدیریت محصولات"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"محصولات و تعداد موجودی که این تامین‌کننده می‌تواند تامین کند"})]}),(0,b.jsxs)(f.Button,{onClick:()=>k(!0),size:"sm",children:[(0,b.jsx)(z.Plus,{className:"ml-2 h-4 w-4"}),"افزودن محصول"]})]}),0===H.length?(0,b.jsx)("div",{className:"text-center py-8 border border-dashed rounded-lg",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"هیچ محصولی اضافه نشده است"})}):(0,b.jsx)("div",{className:"space-y-4",children:Object.entries(J).map(([a,d])=>(0,b.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-muted/50 px-4 py-2 border-b",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(u.Badge,{variant:"secondary",children:a}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:[d.length," محصول - مجموع:"," ",new Intl.NumberFormat("fa-IR").format(d.reduce((a,b)=>a+b.quantity,0))," ","عدد"]})]})}),(0,b.jsxs)(x.Table,{children:[(0,b.jsx)(x.TableHeader,{children:(0,b.jsxs)(x.TableRow,{children:[(0,b.jsx)(x.TableHead,{children:"محصول"}),(0,b.jsx)(x.TableHead,{children:"تعداد"}),(0,b.jsx)(x.TableHead,{children:"قیمت واحد"}),(0,b.jsx)(x.TableHead,{className:"text-left",children:"عملیات"})]})}),(0,b.jsx)(x.TableBody,{children:d.map(a=>(0,b.jsxs)(x.TableRow,{children:[(0,b.jsx)(x.TableCell,{className:"font-medium",children:a.productName}),(0,b.jsxs)(x.TableCell,{children:[new Intl.NumberFormat("fa-IR").format(a.quantity)," عدد"]}),(0,b.jsx)(x.TableCell,{children:a.unitPrice?`${new Intl.NumberFormat("fa-IR").format(a.unitPrice)} تومان`:"-"}),(0,b.jsx)(x.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>{o(a),r(a.productId),t(a.quantity),D(a.unitPrice),k(!0)},children:(0,b.jsx)(B.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>{var b;return b=a.productId,void(c(H.filter(a=>a.productId!==b)),i({title:"موفق",description:"محصول حذف شد"}))},children:(0,b.jsx)(A.Trash2,{className:"h-4 w-4 text-destructive"})})]})})]},a.productId))})]})]},a))}),(0,b.jsx)(w.Dialog,{open:j,onOpenChange:k,children:(0,b.jsxs)(w.DialogContent,{className:"max-w-md",children:[(0,b.jsxs)(w.DialogHeader,{children:[(0,b.jsx)(w.DialogTitle,{children:l?"ویرایش محصول":"افزودن محصول"}),(0,b.jsx)(w.DialogDescription,{children:"محصول و تعداد موجودی را انتخاب کنید"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"فیلتر دسته‌بندی"}),(0,b.jsxs)(v.Select,{value:E,onValueChange:F,children:[(0,b.jsx)(v.SelectTrigger,{children:(0,b.jsx)(v.SelectValue,{placeholder:"همه دسته‌بندی‌ها"})}),(0,b.jsxs)(v.SelectContent,{children:[(0,b.jsx)(v.SelectItem,{value:"all",children:"همه دسته‌بندی‌ها"}),G.map(a=>(0,b.jsx)(v.SelectItem,{value:a.name,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"محصول *"}),(0,b.jsxs)(v.Select,{value:q,onValueChange:r,children:[(0,b.jsx)(v.SelectTrigger,{children:(0,b.jsx)(v.SelectValue,{placeholder:"انتخاب محصول"})}),(0,b.jsx)(v.SelectContent,{children:I.map(a=>(0,b.jsxs)(v.SelectItem,{value:a.id,children:[a.name," (",a.category,")"]},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"تعداد *"}),(0,b.jsx)(g.Input,{type:"number",min:"1",value:s||"",onChange:a=>t(parseInt(a.target.value)||0),placeholder:"تعداد موجودی"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"قیمت واحد (اختیاری)"}),(0,b.jsx)(g.Input,{type:"number",min:"0",value:C||"",onChange:a=>D(a.target.value?parseFloat(a.target.value):void 0),placeholder:"قیمت واحد از تامین‌کننده"})]})]}),(0,b.jsxs)(w.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{r(""),t(0),D(void 0),o(null),k(!1)},children:"انصراف"}),(0,b.jsx)(f.Button,{onClick:()=>{if(!q||s<=0)return void i({title:"خطا",description:"لطفاً محصول و تعداد را وارد کنید",variant:"destructive"});let a=d.find(a=>a.id===q);if(!a)return;let b={productId:a.id,productName:a.name,category:a.category||"",quantity:s,unitPrice:C||void 0};l?(c(H.map(a=>a.productId===l.productId?b:a)),i({title:"موفق",description:"محصول به‌روزرسانی شد"})):(c([...H,b]),i({title:"موفق",description:"محصول اضافه شد"})),r(""),t(0),D(void 0),o(null),k(!1)},children:l?"ذخیره تغییرات":"افزودن"})]})]})})]})}let D=e.object({name:e.string().min(1,"نام تامین‌کننده الزامی است"),phone:e.string().min(1,"شماره تماس الزامی است"),email:e.string().email("ایمیل معتبر نیست").optional().or(e.literal("")),categories:e.array(e.string()).min(1,"حداقل یک دسته‌بندی الزامی است"),notes:e.string().optional(),isActive:e.boolean(),lowStockThreshold:e.number().min(0).optional()});function E({supplier:a,onSuccess:e}){let v=(0,o.useRouter)(),{addSupplier:w,updateSupplier:x}=(0,l.useSupplierStore)(),{getActiveCategories:y,loadCategoriesFromDB:z}=(0,m.useCategoryStore)(),{toast:A}=(0,n.useToast)(),B=y(),[E,F]=(0,p.useState)(a?.categories||[]);(0,p.useEffect)(()=>{(async()=>{try{await z()}catch(a){console.error("Error loading categories:",a)}})()},[z]);let[G,H]=(0,p.useState)(a?.products||[]),{register:I,handleSubmit:J,formState:{errors:K,isSubmitting:L},setValue:M,watch:N}=(0,c.useForm)({resolver:(0,d.zodResolver)(D),defaultValues:a?{name:a.name,phone:a.phone,email:a.email||"",categories:a.categories,notes:a.notes||"",isActive:a.isActive,lowStockThreshold:a.lowStockThreshold||10}:{name:"",phone:"",email:"",categories:[],notes:"",isActive:!0,lowStockThreshold:10}}),O=N("isActive"),P=a=>{let b=E.includes(a)?E.filter(b=>b!==a):[...E,a];F(b),M("categories",b)},Q=async b=>{try{if(0===E.length)return void A({title:"خطا",description:"حداقل یک دسته‌بندی باید انتخاب شود",variant:"destructive"});let c={...b,categories:E,products:G,email:b.email||void 0,notes:b.notes||void 0};a?(x(a.id,c),A({title:"موفق",description:"تامین‌کننده با موفقیت به‌روزرسانی شد"})):(w(c),A({title:"موفق",description:"تامین‌کننده با موفقیت اضافه شد"})),e?.(),v.push("/admin/suppliers")}catch(a){A({title:"خطا",description:"خطایی رخ داد. لطفاً دوباره تلاش کنید.",variant:"destructive"})}};return(0,b.jsxs)("form",{onSubmit:J(Q),className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,b.jsxs)(k.Card,{className:"shadow-sm",children:[(0,b.jsx)(k.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,b.jsxs)(k.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(s.Phone,{className:"h-5 w-5 text-primary"}),"اطلاعات تماس"]})}),(0,b.jsxs)(k.CardContent,{className:"space-y-4 pt-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"name",children:"نام تامین‌کننده *"}),(0,b.jsx)(g.Input,{id:"name",...I("name"),placeholder:"نام تامین‌کننده"}),K.name&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:K.name.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"phone",children:"شماره تماس *"}),(0,b.jsx)(g.Input,{id:"phone",...I("phone"),placeholder:"09123456789",type:"tel"}),K.phone&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:K.phone.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"email",children:"ایمیل"}),(0,b.jsx)(g.Input,{id:"email",...I("email"),placeholder:"example@email.com",type:"email"}),K.email&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:K.email.message})]})]})]}),(0,b.jsxs)(k.Card,{className:"shadow-sm",children:[(0,b.jsx)(k.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,b.jsxs)(k.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(t.Package,{className:"h-5 w-5 text-primary"}),"دسته‌بندی‌ها و تنظیمات"]})}),(0,b.jsxs)(k.CardContent,{className:"space-y-4 pt-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"دسته‌بندی محصولات *"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2 p-3 border border-border/30 rounded-lg min-h-[120px]",children:B.map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>P(a.name),className:`
                      p-2 rounded text-sm text-right transition-colors
                      ${E.includes(a.name)?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"}
                    `,children:a.name},a.id))}),E.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:E.map(a=>(0,b.jsxs)(u.Badge,{variant:"default",className:"gap-1",children:[a,(0,b.jsx)("button",{type:"button",onClick:()=>P(a),className:"ml-1 hover:opacity-70",children:(0,b.jsx)(q.X,{className:"h-3 w-3"})})]},a))}),K.categories&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:K.categories.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"lowStockThreshold",children:"حد آستانه موجودی کم (عدد)"}),(0,b.jsx)(g.Input,{id:"lowStockThreshold",type:"number",...I("lowStockThreshold",{valueAsNumber:!0}),placeholder:"10"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"وقتی موجودی محصولات به این عدد یا کمتر برسد، هشدار نمایش داده می‌شود"})]})]})]})]}),(0,b.jsxs)(k.Card,{className:"shadow-sm",children:[(0,b.jsx)(k.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,b.jsx)(k.CardTitle,{children:"یادداشت‌ها"})}),(0,b.jsx)(k.CardContent,{className:"pt-6",children:(0,b.jsx)(i.Textarea,{...I("notes"),placeholder:"یادداشت‌های اضافی درباره این تامین‌کننده...",rows:4})})]}),(0,b.jsxs)(k.Card,{className:"shadow-sm",children:[(0,b.jsx)(k.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,b.jsxs)(k.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(t.Package,{className:"h-5 w-5 text-primary"}),"مدیریت محصولات"]})}),(0,b.jsx)(k.CardContent,{className:"pt-6",children:(0,b.jsx)(C,{supplier:{...a,categories:E,products:G},onUpdate:H})})]}),(0,b.jsxs)(k.Card,{className:"shadow-sm",children:[(0,b.jsx)(k.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,b.jsx)(k.CardTitle,{children:"وضعیت"})}),(0,b.jsx)(k.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(h.Label,{children:"فعال"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"تامین‌کننده فعال است و می‌تواند محصولات را تامین کند"})]}),(0,b.jsx)(j.Switch,{checked:O,onCheckedChange:a=>M("isActive",a)})]})})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-4 pt-4 border-t border-border/30",children:[(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>v.back(),size:"lg",children:"انصراف"}),(0,b.jsx)(f.Button,{type:"submit",disabled:L,size:"lg",className:"min-w-[140px]",children:L?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"ml-2 h-4 w-4 animate-spin"}),"در حال ذخیره..."]}):a?"ذخیره تغییرات":"افزودن تامین‌کننده"})]})]})}a.s(["SupplierForm",()=>E],10836)}];

//# sourceMappingURL=components_admin_supplier-form_tsx_e450fc15._.js.map
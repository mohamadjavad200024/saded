{"version":3,"sources":["../../../../node_modules/%40radix-ui/react-scroll-area/dist/index.mjs","../../../../components/ui/scroll-area.tsx","../../../../components/chat/message-bubble.tsx","../../../../hooks/use-chat-messaging.ts","../../../../hooks/use-chat-utils.ts","../../../../node_modules/lucide-react/src/icons/ellipsis-vertical.ts","../../../../node_modules/lucide-react/src/icons/pen.ts","../../../../node_modules/lucide-react/src/icons/reply.ts","../../../../components/admin/admin-chat.tsx"],"sourcesContent":["\"use client\";\n\n// src/scroll-area.tsx\nimport * as React2 from \"react\";\nimport { Primitive } from \"@radix-ui/react-primitive\";\nimport { Presence } from \"@radix-ui/react-presence\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { useComposedRefs } from \"@radix-ui/react-compose-refs\";\nimport { useCallbackRef } from \"@radix-ui/react-use-callback-ref\";\nimport { useDirection } from \"@radix-ui/react-direction\";\nimport { useLayoutEffect } from \"@radix-ui/react-use-layout-effect\";\nimport { clamp } from \"@radix-ui/number\";\nimport { composeEventHandlers } from \"@radix-ui/primitive\";\n\n// src/use-state-machine.ts\nimport * as React from \"react\";\nfunction useStateMachine(initialState, machine) {\n  return React.useReducer((state, event) => {\n    const nextState = machine[state][event];\n    return nextState ?? state;\n  }, initialState);\n}\n\n// src/scroll-area.tsx\nimport { Fragment, jsx, jsxs } from \"react/jsx-runtime\";\nvar SCROLL_AREA_NAME = \"ScrollArea\";\nvar [createScrollAreaContext, createScrollAreaScope] = createContextScope(SCROLL_AREA_NAME);\nvar [ScrollAreaProvider, useScrollAreaContext] = createScrollAreaContext(SCROLL_AREA_NAME);\nvar ScrollArea = React2.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeScrollArea,\n      type = \"hover\",\n      dir,\n      scrollHideDelay = 600,\n      ...scrollAreaProps\n    } = props;\n    const [scrollArea, setScrollArea] = React2.useState(null);\n    const [viewport, setViewport] = React2.useState(null);\n    const [content, setContent] = React2.useState(null);\n    const [scrollbarX, setScrollbarX] = React2.useState(null);\n    const [scrollbarY, setScrollbarY] = React2.useState(null);\n    const [cornerWidth, setCornerWidth] = React2.useState(0);\n    const [cornerHeight, setCornerHeight] = React2.useState(0);\n    const [scrollbarXEnabled, setScrollbarXEnabled] = React2.useState(false);\n    const [scrollbarYEnabled, setScrollbarYEnabled] = React2.useState(false);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setScrollArea(node));\n    const direction = useDirection(dir);\n    return /* @__PURE__ */ jsx(\n      ScrollAreaProvider,\n      {\n        scope: __scopeScrollArea,\n        type,\n        dir: direction,\n        scrollHideDelay,\n        scrollArea,\n        viewport,\n        onViewportChange: setViewport,\n        content,\n        onContentChange: setContent,\n        scrollbarX,\n        onScrollbarXChange: setScrollbarX,\n        scrollbarXEnabled,\n        onScrollbarXEnabledChange: setScrollbarXEnabled,\n        scrollbarY,\n        onScrollbarYChange: setScrollbarY,\n        scrollbarYEnabled,\n        onScrollbarYEnabledChange: setScrollbarYEnabled,\n        onCornerWidthChange: setCornerWidth,\n        onCornerHeightChange: setCornerHeight,\n        children: /* @__PURE__ */ jsx(\n          Primitive.div,\n          {\n            dir: direction,\n            ...scrollAreaProps,\n            ref: composedRefs,\n            style: {\n              position: \"relative\",\n              // Pass corner sizes as CSS vars to reduce re-renders of context consumers\n              [\"--radix-scroll-area-corner-width\"]: cornerWidth + \"px\",\n              [\"--radix-scroll-area-corner-height\"]: cornerHeight + \"px\",\n              ...props.style\n            }\n          }\n        )\n      }\n    );\n  }\n);\nScrollArea.displayName = SCROLL_AREA_NAME;\nvar VIEWPORT_NAME = \"ScrollAreaViewport\";\nvar ScrollAreaViewport = React2.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeScrollArea, children, nonce, ...viewportProps } = props;\n    const context = useScrollAreaContext(VIEWPORT_NAME, __scopeScrollArea);\n    const ref = React2.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref, context.onViewportChange);\n    return /* @__PURE__ */ jsxs(Fragment, { children: [\n      /* @__PURE__ */ jsx(\n        \"style\",\n        {\n          dangerouslySetInnerHTML: {\n            __html: `[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}`\n          },\n          nonce\n        }\n      ),\n      /* @__PURE__ */ jsx(\n        Primitive.div,\n        {\n          \"data-radix-scroll-area-viewport\": \"\",\n          ...viewportProps,\n          ref: composedRefs,\n          style: {\n            /**\n             * We don't support `visible` because the intention is to have at least one scrollbar\n             * if this component is used and `visible` will behave like `auto` in that case\n             * https://developer.mozilla.org/en-US/docs/Web/CSS/overflow#description\n             *\n             * We don't handle `auto` because the intention is for the native implementation\n             * to be hidden if using this component. We just want to ensure the node is scrollable\n             * so could have used either `scroll` or `auto` here. We picked `scroll` to prevent\n             * the browser from having to work out whether to render native scrollbars or not,\n             * we tell it to with the intention of hiding them in CSS.\n             */\n            overflowX: context.scrollbarXEnabled ? \"scroll\" : \"hidden\",\n            overflowY: context.scrollbarYEnabled ? \"scroll\" : \"hidden\",\n            ...props.style\n          },\n          children: /* @__PURE__ */ jsx(\"div\", { ref: context.onContentChange, style: { minWidth: \"100%\", display: \"table\" }, children })\n        }\n      )\n    ] });\n  }\n);\nScrollAreaViewport.displayName = VIEWPORT_NAME;\nvar SCROLLBAR_NAME = \"ScrollAreaScrollbar\";\nvar ScrollAreaScrollbar = React2.forwardRef(\n  (props, forwardedRef) => {\n    const { forceMount, ...scrollbarProps } = props;\n    const context = useScrollAreaContext(SCROLLBAR_NAME, props.__scopeScrollArea);\n    const { onScrollbarXEnabledChange, onScrollbarYEnabledChange } = context;\n    const isHorizontal = props.orientation === \"horizontal\";\n    React2.useEffect(() => {\n      isHorizontal ? onScrollbarXEnabledChange(true) : onScrollbarYEnabledChange(true);\n      return () => {\n        isHorizontal ? onScrollbarXEnabledChange(false) : onScrollbarYEnabledChange(false);\n      };\n    }, [isHorizontal, onScrollbarXEnabledChange, onScrollbarYEnabledChange]);\n    return context.type === \"hover\" ? /* @__PURE__ */ jsx(ScrollAreaScrollbarHover, { ...scrollbarProps, ref: forwardedRef, forceMount }) : context.type === \"scroll\" ? /* @__PURE__ */ jsx(ScrollAreaScrollbarScroll, { ...scrollbarProps, ref: forwardedRef, forceMount }) : context.type === \"auto\" ? /* @__PURE__ */ jsx(ScrollAreaScrollbarAuto, { ...scrollbarProps, ref: forwardedRef, forceMount }) : context.type === \"always\" ? /* @__PURE__ */ jsx(ScrollAreaScrollbarVisible, { ...scrollbarProps, ref: forwardedRef }) : null;\n  }\n);\nScrollAreaScrollbar.displayName = SCROLLBAR_NAME;\nvar ScrollAreaScrollbarHover = React2.forwardRef((props, forwardedRef) => {\n  const { forceMount, ...scrollbarProps } = props;\n  const context = useScrollAreaContext(SCROLLBAR_NAME, props.__scopeScrollArea);\n  const [visible, setVisible] = React2.useState(false);\n  React2.useEffect(() => {\n    const scrollArea = context.scrollArea;\n    let hideTimer = 0;\n    if (scrollArea) {\n      const handlePointerEnter = () => {\n        window.clearTimeout(hideTimer);\n        setVisible(true);\n      };\n      const handlePointerLeave = () => {\n        hideTimer = window.setTimeout(() => setVisible(false), context.scrollHideDelay);\n      };\n      scrollArea.addEventListener(\"pointerenter\", handlePointerEnter);\n      scrollArea.addEventListener(\"pointerleave\", handlePointerLeave);\n      return () => {\n        window.clearTimeout(hideTimer);\n        scrollArea.removeEventListener(\"pointerenter\", handlePointerEnter);\n        scrollArea.removeEventListener(\"pointerleave\", handlePointerLeave);\n      };\n    }\n  }, [context.scrollArea, context.scrollHideDelay]);\n  return /* @__PURE__ */ jsx(Presence, { present: forceMount || visible, children: /* @__PURE__ */ jsx(\n    ScrollAreaScrollbarAuto,\n    {\n      \"data-state\": visible ? \"visible\" : \"hidden\",\n      ...scrollbarProps,\n      ref: forwardedRef\n    }\n  ) });\n});\nvar ScrollAreaScrollbarScroll = React2.forwardRef((props, forwardedRef) => {\n  const { forceMount, ...scrollbarProps } = props;\n  const context = useScrollAreaContext(SCROLLBAR_NAME, props.__scopeScrollArea);\n  const isHorizontal = props.orientation === \"horizontal\";\n  const debounceScrollEnd = useDebounceCallback(() => send(\"SCROLL_END\"), 100);\n  const [state, send] = useStateMachine(\"hidden\", {\n    hidden: {\n      SCROLL: \"scrolling\"\n    },\n    scrolling: {\n      SCROLL_END: \"idle\",\n      POINTER_ENTER: \"interacting\"\n    },\n    interacting: {\n      SCROLL: \"interacting\",\n      POINTER_LEAVE: \"idle\"\n    },\n    idle: {\n      HIDE: \"hidden\",\n      SCROLL: \"scrolling\",\n      POINTER_ENTER: \"interacting\"\n    }\n  });\n  React2.useEffect(() => {\n    if (state === \"idle\") {\n      const hideTimer = window.setTimeout(() => send(\"HIDE\"), context.scrollHideDelay);\n      return () => window.clearTimeout(hideTimer);\n    }\n  }, [state, context.scrollHideDelay, send]);\n  React2.useEffect(() => {\n    const viewport = context.viewport;\n    const scrollDirection = isHorizontal ? \"scrollLeft\" : \"scrollTop\";\n    if (viewport) {\n      let prevScrollPos = viewport[scrollDirection];\n      const handleScroll = () => {\n        const scrollPos = viewport[scrollDirection];\n        const hasScrollInDirectionChanged = prevScrollPos !== scrollPos;\n        if (hasScrollInDirectionChanged) {\n          send(\"SCROLL\");\n          debounceScrollEnd();\n        }\n        prevScrollPos = scrollPos;\n      };\n      viewport.addEventListener(\"scroll\", handleScroll);\n      return () => viewport.removeEventListener(\"scroll\", handleScroll);\n    }\n  }, [context.viewport, isHorizontal, send, debounceScrollEnd]);\n  return /* @__PURE__ */ jsx(Presence, { present: forceMount || state !== \"hidden\", children: /* @__PURE__ */ jsx(\n    ScrollAreaScrollbarVisible,\n    {\n      \"data-state\": state === \"hidden\" ? \"hidden\" : \"visible\",\n      ...scrollbarProps,\n      ref: forwardedRef,\n      onPointerEnter: composeEventHandlers(props.onPointerEnter, () => send(\"POINTER_ENTER\")),\n      onPointerLeave: composeEventHandlers(props.onPointerLeave, () => send(\"POINTER_LEAVE\"))\n    }\n  ) });\n});\nvar ScrollAreaScrollbarAuto = React2.forwardRef((props, forwardedRef) => {\n  const context = useScrollAreaContext(SCROLLBAR_NAME, props.__scopeScrollArea);\n  const { forceMount, ...scrollbarProps } = props;\n  const [visible, setVisible] = React2.useState(false);\n  const isHorizontal = props.orientation === \"horizontal\";\n  const handleResize = useDebounceCallback(() => {\n    if (context.viewport) {\n      const isOverflowX = context.viewport.offsetWidth < context.viewport.scrollWidth;\n      const isOverflowY = context.viewport.offsetHeight < context.viewport.scrollHeight;\n      setVisible(isHorizontal ? isOverflowX : isOverflowY);\n    }\n  }, 10);\n  useResizeObserver(context.viewport, handleResize);\n  useResizeObserver(context.content, handleResize);\n  return /* @__PURE__ */ jsx(Presence, { present: forceMount || visible, children: /* @__PURE__ */ jsx(\n    ScrollAreaScrollbarVisible,\n    {\n      \"data-state\": visible ? \"visible\" : \"hidden\",\n      ...scrollbarProps,\n      ref: forwardedRef\n    }\n  ) });\n});\nvar ScrollAreaScrollbarVisible = React2.forwardRef((props, forwardedRef) => {\n  const { orientation = \"vertical\", ...scrollbarProps } = props;\n  const context = useScrollAreaContext(SCROLLBAR_NAME, props.__scopeScrollArea);\n  const thumbRef = React2.useRef(null);\n  const pointerOffsetRef = React2.useRef(0);\n  const [sizes, setSizes] = React2.useState({\n    content: 0,\n    viewport: 0,\n    scrollbar: { size: 0, paddingStart: 0, paddingEnd: 0 }\n  });\n  const thumbRatio = getThumbRatio(sizes.viewport, sizes.content);\n  const commonProps = {\n    ...scrollbarProps,\n    sizes,\n    onSizesChange: setSizes,\n    hasThumb: Boolean(thumbRatio > 0 && thumbRatio < 1),\n    onThumbChange: (thumb) => thumbRef.current = thumb,\n    onThumbPointerUp: () => pointerOffsetRef.current = 0,\n    onThumbPointerDown: (pointerPos) => pointerOffsetRef.current = pointerPos\n  };\n  function getScrollPosition(pointerPos, dir) {\n    return getScrollPositionFromPointer(pointerPos, pointerOffsetRef.current, sizes, dir);\n  }\n  if (orientation === \"horizontal\") {\n    return /* @__PURE__ */ jsx(\n      ScrollAreaScrollbarX,\n      {\n        ...commonProps,\n        ref: forwardedRef,\n        onThumbPositionChange: () => {\n          if (context.viewport && thumbRef.current) {\n            const scrollPos = context.viewport.scrollLeft;\n            const offset = getThumbOffsetFromScroll(scrollPos, sizes, context.dir);\n            thumbRef.current.style.transform = `translate3d(${offset}px, 0, 0)`;\n          }\n        },\n        onWheelScroll: (scrollPos) => {\n          if (context.viewport) context.viewport.scrollLeft = scrollPos;\n        },\n        onDragScroll: (pointerPos) => {\n          if (context.viewport) {\n            context.viewport.scrollLeft = getScrollPosition(pointerPos, context.dir);\n          }\n        }\n      }\n    );\n  }\n  if (orientation === \"vertical\") {\n    return /* @__PURE__ */ jsx(\n      ScrollAreaScrollbarY,\n      {\n        ...commonProps,\n        ref: forwardedRef,\n        onThumbPositionChange: () => {\n          if (context.viewport && thumbRef.current) {\n            const scrollPos = context.viewport.scrollTop;\n            const offset = getThumbOffsetFromScroll(scrollPos, sizes);\n            thumbRef.current.style.transform = `translate3d(0, ${offset}px, 0)`;\n          }\n        },\n        onWheelScroll: (scrollPos) => {\n          if (context.viewport) context.viewport.scrollTop = scrollPos;\n        },\n        onDragScroll: (pointerPos) => {\n          if (context.viewport) context.viewport.scrollTop = getScrollPosition(pointerPos);\n        }\n      }\n    );\n  }\n  return null;\n});\nvar ScrollAreaScrollbarX = React2.forwardRef((props, forwardedRef) => {\n  const { sizes, onSizesChange, ...scrollbarProps } = props;\n  const context = useScrollAreaContext(SCROLLBAR_NAME, props.__scopeScrollArea);\n  const [computedStyle, setComputedStyle] = React2.useState();\n  const ref = React2.useRef(null);\n  const composeRefs = useComposedRefs(forwardedRef, ref, context.onScrollbarXChange);\n  React2.useEffect(() => {\n    if (ref.current) setComputedStyle(getComputedStyle(ref.current));\n  }, [ref]);\n  return /* @__PURE__ */ jsx(\n    ScrollAreaScrollbarImpl,\n    {\n      \"data-orientation\": \"horizontal\",\n      ...scrollbarProps,\n      ref: composeRefs,\n      sizes,\n      style: {\n        bottom: 0,\n        left: context.dir === \"rtl\" ? \"var(--radix-scroll-area-corner-width)\" : 0,\n        right: context.dir === \"ltr\" ? \"var(--radix-scroll-area-corner-width)\" : 0,\n        [\"--radix-scroll-area-thumb-width\"]: getThumbSize(sizes) + \"px\",\n        ...props.style\n      },\n      onThumbPointerDown: (pointerPos) => props.onThumbPointerDown(pointerPos.x),\n      onDragScroll: (pointerPos) => props.onDragScroll(pointerPos.x),\n      onWheelScroll: (event, maxScrollPos) => {\n        if (context.viewport) {\n          const scrollPos = context.viewport.scrollLeft + event.deltaX;\n          props.onWheelScroll(scrollPos);\n          if (isScrollingWithinScrollbarBounds(scrollPos, maxScrollPos)) {\n            event.preventDefault();\n          }\n        }\n      },\n      onResize: () => {\n        if (ref.current && context.viewport && computedStyle) {\n          onSizesChange({\n            content: context.viewport.scrollWidth,\n            viewport: context.viewport.offsetWidth,\n            scrollbar: {\n              size: ref.current.clientWidth,\n              paddingStart: toInt(computedStyle.paddingLeft),\n              paddingEnd: toInt(computedStyle.paddingRight)\n            }\n          });\n        }\n      }\n    }\n  );\n});\nvar ScrollAreaScrollbarY = React2.forwardRef((props, forwardedRef) => {\n  const { sizes, onSizesChange, ...scrollbarProps } = props;\n  const context = useScrollAreaContext(SCROLLBAR_NAME, props.__scopeScrollArea);\n  const [computedStyle, setComputedStyle] = React2.useState();\n  const ref = React2.useRef(null);\n  const composeRefs = useComposedRefs(forwardedRef, ref, context.onScrollbarYChange);\n  React2.useEffect(() => {\n    if (ref.current) setComputedStyle(getComputedStyle(ref.current));\n  }, [ref]);\n  return /* @__PURE__ */ jsx(\n    ScrollAreaScrollbarImpl,\n    {\n      \"data-orientation\": \"vertical\",\n      ...scrollbarProps,\n      ref: composeRefs,\n      sizes,\n      style: {\n        top: 0,\n        right: context.dir === \"ltr\" ? 0 : void 0,\n        left: context.dir === \"rtl\" ? 0 : void 0,\n        bottom: \"var(--radix-scroll-area-corner-height)\",\n        [\"--radix-scroll-area-thumb-height\"]: getThumbSize(sizes) + \"px\",\n        ...props.style\n      },\n      onThumbPointerDown: (pointerPos) => props.onThumbPointerDown(pointerPos.y),\n      onDragScroll: (pointerPos) => props.onDragScroll(pointerPos.y),\n      onWheelScroll: (event, maxScrollPos) => {\n        if (context.viewport) {\n          const scrollPos = context.viewport.scrollTop + event.deltaY;\n          props.onWheelScroll(scrollPos);\n          if (isScrollingWithinScrollbarBounds(scrollPos, maxScrollPos)) {\n            event.preventDefault();\n          }\n        }\n      },\n      onResize: () => {\n        if (ref.current && context.viewport && computedStyle) {\n          onSizesChange({\n            content: context.viewport.scrollHeight,\n            viewport: context.viewport.offsetHeight,\n            scrollbar: {\n              size: ref.current.clientHeight,\n              paddingStart: toInt(computedStyle.paddingTop),\n              paddingEnd: toInt(computedStyle.paddingBottom)\n            }\n          });\n        }\n      }\n    }\n  );\n});\nvar [ScrollbarProvider, useScrollbarContext] = createScrollAreaContext(SCROLLBAR_NAME);\nvar ScrollAreaScrollbarImpl = React2.forwardRef((props, forwardedRef) => {\n  const {\n    __scopeScrollArea,\n    sizes,\n    hasThumb,\n    onThumbChange,\n    onThumbPointerUp,\n    onThumbPointerDown,\n    onThumbPositionChange,\n    onDragScroll,\n    onWheelScroll,\n    onResize,\n    ...scrollbarProps\n  } = props;\n  const context = useScrollAreaContext(SCROLLBAR_NAME, __scopeScrollArea);\n  const [scrollbar, setScrollbar] = React2.useState(null);\n  const composeRefs = useComposedRefs(forwardedRef, (node) => setScrollbar(node));\n  const rectRef = React2.useRef(null);\n  const prevWebkitUserSelectRef = React2.useRef(\"\");\n  const viewport = context.viewport;\n  const maxScrollPos = sizes.content - sizes.viewport;\n  const handleWheelScroll = useCallbackRef(onWheelScroll);\n  const handleThumbPositionChange = useCallbackRef(onThumbPositionChange);\n  const handleResize = useDebounceCallback(onResize, 10);\n  function handleDragScroll(event) {\n    if (rectRef.current) {\n      const x = event.clientX - rectRef.current.left;\n      const y = event.clientY - rectRef.current.top;\n      onDragScroll({ x, y });\n    }\n  }\n  React2.useEffect(() => {\n    const handleWheel = (event) => {\n      const element = event.target;\n      const isScrollbarWheel = scrollbar?.contains(element);\n      if (isScrollbarWheel) handleWheelScroll(event, maxScrollPos);\n    };\n    document.addEventListener(\"wheel\", handleWheel, { passive: false });\n    return () => document.removeEventListener(\"wheel\", handleWheel, { passive: false });\n  }, [viewport, scrollbar, maxScrollPos, handleWheelScroll]);\n  React2.useEffect(handleThumbPositionChange, [sizes, handleThumbPositionChange]);\n  useResizeObserver(scrollbar, handleResize);\n  useResizeObserver(context.content, handleResize);\n  return /* @__PURE__ */ jsx(\n    ScrollbarProvider,\n    {\n      scope: __scopeScrollArea,\n      scrollbar,\n      hasThumb,\n      onThumbChange: useCallbackRef(onThumbChange),\n      onThumbPointerUp: useCallbackRef(onThumbPointerUp),\n      onThumbPositionChange: handleThumbPositionChange,\n      onThumbPointerDown: useCallbackRef(onThumbPointerDown),\n      children: /* @__PURE__ */ jsx(\n        Primitive.div,\n        {\n          ...scrollbarProps,\n          ref: composeRefs,\n          style: { position: \"absolute\", ...scrollbarProps.style },\n          onPointerDown: composeEventHandlers(props.onPointerDown, (event) => {\n            const mainPointer = 0;\n            if (event.button === mainPointer) {\n              const element = event.target;\n              element.setPointerCapture(event.pointerId);\n              rectRef.current = scrollbar.getBoundingClientRect();\n              prevWebkitUserSelectRef.current = document.body.style.webkitUserSelect;\n              document.body.style.webkitUserSelect = \"none\";\n              if (context.viewport) context.viewport.style.scrollBehavior = \"auto\";\n              handleDragScroll(event);\n            }\n          }),\n          onPointerMove: composeEventHandlers(props.onPointerMove, handleDragScroll),\n          onPointerUp: composeEventHandlers(props.onPointerUp, (event) => {\n            const element = event.target;\n            if (element.hasPointerCapture(event.pointerId)) {\n              element.releasePointerCapture(event.pointerId);\n            }\n            document.body.style.webkitUserSelect = prevWebkitUserSelectRef.current;\n            if (context.viewport) context.viewport.style.scrollBehavior = \"\";\n            rectRef.current = null;\n          })\n        }\n      )\n    }\n  );\n});\nvar THUMB_NAME = \"ScrollAreaThumb\";\nvar ScrollAreaThumb = React2.forwardRef(\n  (props, forwardedRef) => {\n    const { forceMount, ...thumbProps } = props;\n    const scrollbarContext = useScrollbarContext(THUMB_NAME, props.__scopeScrollArea);\n    return /* @__PURE__ */ jsx(Presence, { present: forceMount || scrollbarContext.hasThumb, children: /* @__PURE__ */ jsx(ScrollAreaThumbImpl, { ref: forwardedRef, ...thumbProps }) });\n  }\n);\nvar ScrollAreaThumbImpl = React2.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeScrollArea, style, ...thumbProps } = props;\n    const scrollAreaContext = useScrollAreaContext(THUMB_NAME, __scopeScrollArea);\n    const scrollbarContext = useScrollbarContext(THUMB_NAME, __scopeScrollArea);\n    const { onThumbPositionChange } = scrollbarContext;\n    const composedRef = useComposedRefs(\n      forwardedRef,\n      (node) => scrollbarContext.onThumbChange(node)\n    );\n    const removeUnlinkedScrollListenerRef = React2.useRef(void 0);\n    const debounceScrollEnd = useDebounceCallback(() => {\n      if (removeUnlinkedScrollListenerRef.current) {\n        removeUnlinkedScrollListenerRef.current();\n        removeUnlinkedScrollListenerRef.current = void 0;\n      }\n    }, 100);\n    React2.useEffect(() => {\n      const viewport = scrollAreaContext.viewport;\n      if (viewport) {\n        const handleScroll = () => {\n          debounceScrollEnd();\n          if (!removeUnlinkedScrollListenerRef.current) {\n            const listener = addUnlinkedScrollListener(viewport, onThumbPositionChange);\n            removeUnlinkedScrollListenerRef.current = listener;\n            onThumbPositionChange();\n          }\n        };\n        onThumbPositionChange();\n        viewport.addEventListener(\"scroll\", handleScroll);\n        return () => viewport.removeEventListener(\"scroll\", handleScroll);\n      }\n    }, [scrollAreaContext.viewport, debounceScrollEnd, onThumbPositionChange]);\n    return /* @__PURE__ */ jsx(\n      Primitive.div,\n      {\n        \"data-state\": scrollbarContext.hasThumb ? \"visible\" : \"hidden\",\n        ...thumbProps,\n        ref: composedRef,\n        style: {\n          width: \"var(--radix-scroll-area-thumb-width)\",\n          height: \"var(--radix-scroll-area-thumb-height)\",\n          ...style\n        },\n        onPointerDownCapture: composeEventHandlers(props.onPointerDownCapture, (event) => {\n          const thumb = event.target;\n          const thumbRect = thumb.getBoundingClientRect();\n          const x = event.clientX - thumbRect.left;\n          const y = event.clientY - thumbRect.top;\n          scrollbarContext.onThumbPointerDown({ x, y });\n        }),\n        onPointerUp: composeEventHandlers(props.onPointerUp, scrollbarContext.onThumbPointerUp)\n      }\n    );\n  }\n);\nScrollAreaThumb.displayName = THUMB_NAME;\nvar CORNER_NAME = \"ScrollAreaCorner\";\nvar ScrollAreaCorner = React2.forwardRef(\n  (props, forwardedRef) => {\n    const context = useScrollAreaContext(CORNER_NAME, props.__scopeScrollArea);\n    const hasBothScrollbarsVisible = Boolean(context.scrollbarX && context.scrollbarY);\n    const hasCorner = context.type !== \"scroll\" && hasBothScrollbarsVisible;\n    return hasCorner ? /* @__PURE__ */ jsx(ScrollAreaCornerImpl, { ...props, ref: forwardedRef }) : null;\n  }\n);\nScrollAreaCorner.displayName = CORNER_NAME;\nvar ScrollAreaCornerImpl = React2.forwardRef((props, forwardedRef) => {\n  const { __scopeScrollArea, ...cornerProps } = props;\n  const context = useScrollAreaContext(CORNER_NAME, __scopeScrollArea);\n  const [width, setWidth] = React2.useState(0);\n  const [height, setHeight] = React2.useState(0);\n  const hasSize = Boolean(width && height);\n  useResizeObserver(context.scrollbarX, () => {\n    const height2 = context.scrollbarX?.offsetHeight || 0;\n    context.onCornerHeightChange(height2);\n    setHeight(height2);\n  });\n  useResizeObserver(context.scrollbarY, () => {\n    const width2 = context.scrollbarY?.offsetWidth || 0;\n    context.onCornerWidthChange(width2);\n    setWidth(width2);\n  });\n  return hasSize ? /* @__PURE__ */ jsx(\n    Primitive.div,\n    {\n      ...cornerProps,\n      ref: forwardedRef,\n      style: {\n        width,\n        height,\n        position: \"absolute\",\n        right: context.dir === \"ltr\" ? 0 : void 0,\n        left: context.dir === \"rtl\" ? 0 : void 0,\n        bottom: 0,\n        ...props.style\n      }\n    }\n  ) : null;\n});\nfunction toInt(value) {\n  return value ? parseInt(value, 10) : 0;\n}\nfunction getThumbRatio(viewportSize, contentSize) {\n  const ratio = viewportSize / contentSize;\n  return isNaN(ratio) ? 0 : ratio;\n}\nfunction getThumbSize(sizes) {\n  const ratio = getThumbRatio(sizes.viewport, sizes.content);\n  const scrollbarPadding = sizes.scrollbar.paddingStart + sizes.scrollbar.paddingEnd;\n  const thumbSize = (sizes.scrollbar.size - scrollbarPadding) * ratio;\n  return Math.max(thumbSize, 18);\n}\nfunction getScrollPositionFromPointer(pointerPos, pointerOffset, sizes, dir = \"ltr\") {\n  const thumbSizePx = getThumbSize(sizes);\n  const thumbCenter = thumbSizePx / 2;\n  const offset = pointerOffset || thumbCenter;\n  const thumbOffsetFromEnd = thumbSizePx - offset;\n  const minPointerPos = sizes.scrollbar.paddingStart + offset;\n  const maxPointerPos = sizes.scrollbar.size - sizes.scrollbar.paddingEnd - thumbOffsetFromEnd;\n  const maxScrollPos = sizes.content - sizes.viewport;\n  const scrollRange = dir === \"ltr\" ? [0, maxScrollPos] : [maxScrollPos * -1, 0];\n  const interpolate = linearScale([minPointerPos, maxPointerPos], scrollRange);\n  return interpolate(pointerPos);\n}\nfunction getThumbOffsetFromScroll(scrollPos, sizes, dir = \"ltr\") {\n  const thumbSizePx = getThumbSize(sizes);\n  const scrollbarPadding = sizes.scrollbar.paddingStart + sizes.scrollbar.paddingEnd;\n  const scrollbar = sizes.scrollbar.size - scrollbarPadding;\n  const maxScrollPos = sizes.content - sizes.viewport;\n  const maxThumbPos = scrollbar - thumbSizePx;\n  const scrollClampRange = dir === \"ltr\" ? [0, maxScrollPos] : [maxScrollPos * -1, 0];\n  const scrollWithoutMomentum = clamp(scrollPos, scrollClampRange);\n  const interpolate = linearScale([0, maxScrollPos], [0, maxThumbPos]);\n  return interpolate(scrollWithoutMomentum);\n}\nfunction linearScale(input, output) {\n  return (value) => {\n    if (input[0] === input[1] || output[0] === output[1]) return output[0];\n    const ratio = (output[1] - output[0]) / (input[1] - input[0]);\n    return output[0] + ratio * (value - input[0]);\n  };\n}\nfunction isScrollingWithinScrollbarBounds(scrollPos, maxScrollPos) {\n  return scrollPos > 0 && scrollPos < maxScrollPos;\n}\nvar addUnlinkedScrollListener = (node, handler = () => {\n}) => {\n  let prevPosition = { left: node.scrollLeft, top: node.scrollTop };\n  let rAF = 0;\n  (function loop() {\n    const position = { left: node.scrollLeft, top: node.scrollTop };\n    const isHorizontalScroll = prevPosition.left !== position.left;\n    const isVerticalScroll = prevPosition.top !== position.top;\n    if (isHorizontalScroll || isVerticalScroll) handler();\n    prevPosition = position;\n    rAF = window.requestAnimationFrame(loop);\n  })();\n  return () => window.cancelAnimationFrame(rAF);\n};\nfunction useDebounceCallback(callback, delay) {\n  const handleCallback = useCallbackRef(callback);\n  const debounceTimerRef = React2.useRef(0);\n  React2.useEffect(() => () => window.clearTimeout(debounceTimerRef.current), []);\n  return React2.useCallback(() => {\n    window.clearTimeout(debounceTimerRef.current);\n    debounceTimerRef.current = window.setTimeout(handleCallback, delay);\n  }, [handleCallback, delay]);\n}\nfunction useResizeObserver(element, onResize) {\n  const handleResize = useCallbackRef(onResize);\n  useLayoutEffect(() => {\n    let rAF = 0;\n    if (element) {\n      const resizeObserver = new ResizeObserver(() => {\n        cancelAnimationFrame(rAF);\n        rAF = window.requestAnimationFrame(handleResize);\n      });\n      resizeObserver.observe(element);\n      return () => {\n        window.cancelAnimationFrame(rAF);\n        resizeObserver.unobserve(element);\n      };\n    }\n  }, [element, handleResize]);\n}\nvar Root = ScrollArea;\nvar Viewport = ScrollAreaViewport;\nvar Scrollbar = ScrollAreaScrollbar;\nvar Thumb = ScrollAreaThumb;\nvar Corner = ScrollAreaCorner;\nexport {\n  Corner,\n  Root,\n  ScrollArea,\n  ScrollAreaCorner,\n  ScrollAreaScrollbar,\n  ScrollAreaThumb,\n  ScrollAreaViewport,\n  Scrollbar,\n  Thumb,\n  Viewport,\n  createScrollAreaScope\n};\n//# sourceMappingURL=index.mjs.map\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst ScrollArea = React.forwardRef<\r\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\r\n>(({ className, children, ...props }, ref) => (\r\n  <ScrollAreaPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\"relative overflow-hidden\", className)}\r\n    {...props}\r\n  >\r\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\r\n      {children}\r\n    </ScrollAreaPrimitive.Viewport>\r\n    <ScrollBar />\r\n    <ScrollAreaPrimitive.Corner />\r\n  </ScrollAreaPrimitive.Root>\r\n));\r\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName;\r\n\r\nconst ScrollBar = React.forwardRef<\r\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\r\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\r\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\r\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\r\n    ref={ref}\r\n    orientation={orientation}\r\n    className={cn(\r\n      \"flex touch-none select-none transition-colors\",\r\n      orientation === \"vertical\" &&\r\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\r\n      orientation === \"horizontal\" &&\r\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\r\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\r\n));\r\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName;\r\n\r\nexport { ScrollArea, ScrollBar };\r\n\r\n\r\n","\"use client\";\n\nimport { motion } from \"framer-motion\";\nimport { CheckCheck, FileText, MapPin, Mic, Reply, Edit2, Trash2, MoreVertical } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport type { Attachment } from \"@/hooks/use-chat-utils\";\nimport type { Message } from \"@/hooks/use-chat-messaging\";\nimport { AudioPlayer } from \"@/components/chat/audio-player\";\n\ninterface MessageBubbleProps {\n  message: Message;\n  index: number;\n  totalMessages: number;\n  onReply?: (message: Message) => void;\n  onEdit?: (message: Message) => void;\n  onDelete?: (messageId: string) => void;\n}\n\nexport function MessageBubble({ message, index, totalMessages, onReply, onEdit, onDelete }: MessageBubbleProps) {\n  return (\n    <motion.div\n      key={message.id}\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0 }}\n      transition={{ \n        duration: 0.2,\n        ease: \"easeOut\"\n      }}\n      className={`flex ${message.sender === \"user\" ? \"justify-end\" : \"justify-start\"} items-end gap-2 group mb-3`}\n    >\n      <div\n        className={`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${\n          message.sender === \"user\"\n            ? \"bg-primary text-primary-foreground\"\n            : \"bg-muted text-foreground border border-border/40\"\n        }`}\n      >\n        {message.text && (\n          <p className=\"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5\">\n            {message.text}\n          </p>\n        )}\n        {message.attachments && message.attachments.length > 0 && (\n          <div className={`space-y-2 ${message.text ? \"mt-2\" : \"\"}`}>\n            {message.attachments.map((attachment: Attachment, idx: number) => (\n              <div key={attachment.id || idx} className=\"rounded overflow-hidden\">\n                {attachment.type === \"image\" && attachment.url && (\n                  <img\n                    src={attachment.url}\n                    alt={attachment.name || \"تصویر\"}\n                    className=\"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all\"\n                    onClick={() => window.open(attachment.url, \"_blank\")}\n                  />\n                )}\n                {attachment.type === \"file\" && (\n                  <a\n                    href={attachment.url}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    download={attachment.name}\n                    className=\"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs\"\n                  >\n                    <FileText className=\"h-3.5 w-3.5\" />\n                    <span className=\"font-medium truncate\">{attachment.name || \"فایل\"}</span>\n                  </a>\n                )}\n                {attachment.type === \"location\" && (\n                  <a\n                    href={attachment.url}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs\"\n                  >\n                    <MapPin className=\"h-3.5 w-3.5\" />\n                    <span className=\"font-medium\">{attachment.name || \"موقعیت\"}</span>\n                  </a>\n                )}\n                {attachment.type === \"audio\" && attachment.url && (\n                  <AudioPlayer url={attachment.url} duration={attachment.duration} />\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n        <div className={`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${\n          message.sender === \"user\" \n            ? \"border-primary-foreground/20 justify-end\" \n            : \"border-border/30 justify-start\"\n        }`}>\n          <span className={`text-[10px] sm:text-xs ${\n            message.sender === \"user\" \n              ? \"text-primary-foreground/70\" \n              : \"text-muted-foreground\"\n          }`}>\n            {new Date(message.timestamp).toLocaleTimeString(\"fa-IR\", {\n              hour: \"2-digit\",\n              minute: \"2-digit\",\n            })}\n          </span>\n          {message.status && message.sender === \"user\" && (\n            <CheckCheck className={`h-3 w-3 ${\n              message.status === \"read\" ? \"text-primary-foreground/70\" : \"text-primary-foreground/40\"\n            }`} />\n          )}\n          {/* آیکون حذف مستقیم برای همه پیام‌ها - همیشه قابل مشاهده */}\n          {onDelete && (message.sender === \"support\" || message.sender === \"user\") && (\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-6 w-6 hover:bg-destructive/10 text-destructive hover:text-destructive opacity-70 hover:opacity-100 transition-opacity\"\n              onClick={(e) => {\n                e.stopPropagation();\n                if (confirm(\"آیا مطمئن هستید که می‌خواهید این پیام را حذف کنید؟\")) {\n                  onDelete(message.id);\n                }\n              }}\n              title=\"حذف پیام\"\n            >\n              <Trash2 className=\"h-3.5 w-3.5\" />\n            </Button>\n          )}\n          {/* منوی 3 نقطه برای سایر گزینه‌ها (پاسخ و ویرایش) */}\n          {(onReply || onEdit) && (\n            <div className=\"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity\">\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-6 w-6 hover:bg-background/20\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                    }}\n                    title=\"گزینه‌های بیشتر\"\n                  >\n                    <MoreVertical className=\"h-3.5 w-3.5\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent \n                  align={message.sender === \"user\" ? \"end\" : \"start\"}\n                  className=\"min-w-[140px]\"\n                  onClick={(e) => e.stopPropagation()}\n                >\n                  {onReply && (\n                    <DropdownMenuItem\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onReply(message);\n                      }}\n                      className=\"cursor-pointer\"\n                    >\n                      <Reply className=\"h-4 w-4 ml-2\" />\n                      <span>پاسخ</span>\n                    </DropdownMenuItem>\n                  )}\n                  {onEdit && message.sender === \"user\" && (\n                    <>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onEdit(message);\n                        }}\n                        className=\"cursor-pointer\"\n                      >\n                        <Edit2 className=\"h-4 w-4 ml-2\" />\n                        <span>ویرایش</span>\n                      </DropdownMenuItem>\n                    </>\n                  )}\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n          )}\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n\n","\"use client\";\n\nimport { useState, useRef, useCallback, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Attachment } from \"./use-chat-utils\";\nimport { logger } from \"@/lib/logger-client\";\n\nexport interface Message {\n  id: string;\n  text: string;\n  sender: \"user\" | \"support\";\n  timestamp: Date;\n  attachments?: Attachment[];\n  status?: \"sending\" | \"sent\" | \"delivered\" | \"read\";\n}\n\ninterface UseChatMessagingOptions {\n  chatId: string | null;\n  sender: \"user\" | \"support\";\n  customerInfo?: {\n    name: string;\n    phone: string;\n    email?: string;\n  };\n  onMessageSent?: () => void;\n}\n\nexport function useChatMessaging({\n  chatId,\n  sender,\n  customerInfo,\n  onMessageSent,\n}: UseChatMessagingOptions) {\n  const { toast } = useToast();\n  const [message, setMessage] = useState(\"\");\n  const [isSending, setIsSending] = useState(false);\n  const [isTyping, setIsTyping] = useState(false);\n  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const typingPollIntervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  const sendTypingStatus = useCallback(async (typing: boolean) => {\n    if (!chatId) return;\n    \n    try {\n      await fetch(\"/api/chat/typing\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: \"include\",\n        body: JSON.stringify({\n          chatId,\n          sender,\n          isTyping: typing,\n        }),\n      });\n    } catch (error) {\n      logger.error(\"Error sending typing status:\", error);\n    }\n  }, [chatId, sender]);\n\n  const handleMessageChange = useCallback((e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setMessage(e.target.value);\n    \n    if (!chatId) return;\n    \n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    \n    if (e.target.value.trim().length > 0) {\n      sendTypingStatus(true);\n      typingTimeoutRef.current = setTimeout(() => {\n        sendTypingStatus(false);\n      }, 2000);\n    } else {\n      sendTypingStatus(false);\n    }\n  }, [chatId, sendTypingStatus]);\n\n  const checkTypingStatus = useCallback(async () => {\n    if (!chatId) return;\n    \n    try {\n      const response = await fetch(\n        `/api/chat/typing?chatId=${chatId}&sender=${sender === \"user\" ? \"support\" : \"user\"}`,\n        { credentials: \"include\" }\n      );\n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          setIsTyping(data.data.isTyping || false);\n        }\n      }\n    } catch (error) {\n      logger.error(\"Error checking typing status:\", error);\n    }\n  }, [chatId, sender]);\n\n  useEffect(() => {\n    if (!chatId) {\n      setIsTyping(false);\n      if (typingPollIntervalRef.current) {\n        clearInterval(typingPollIntervalRef.current);\n        typingPollIntervalRef.current = null;\n      }\n      return;\n    }\n\n    checkTypingStatus();\n    typingPollIntervalRef.current = setInterval(() => {\n      checkTypingStatus();\n    }, 2000);\n\n    return () => {\n      if (typingPollIntervalRef.current) {\n        clearInterval(typingPollIntervalRef.current);\n        typingPollIntervalRef.current = null;\n      }\n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n        typingTimeoutRef.current = null;\n      }\n      sendTypingStatus(false);\n    };\n  }, [chatId, checkTypingStatus, sendTypingStatus]);\n\n  const sendMessage = useCallback(async (\n    text: string,\n    attachments: Attachment[] = []\n  ): Promise<Message | null> => {\n    if ((!text.trim() && attachments.length === 0) || !chatId) return null;\n\n    const validAttachments = attachments.filter(att => {\n      const url = att.url;\n      return url && \n             !url.startsWith('blob:') && \n             !url.startsWith('data:') &&\n             (url.startsWith('http') || url.startsWith('/'));\n    });\n\n    if (!text.trim() && validAttachments.length === 0) {\n      toast({\n        title: \"خطا\",\n        description: \"لطفاً یک پیام یا فایل معتبر اضافه کنید\",\n        variant: \"destructive\",\n      });\n      return null;\n    }\n\n    const newMessage: Message = {\n      id: `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      text,\n      sender,\n      timestamp: new Date(),\n      attachments: validAttachments.length > 0 ? validAttachments : undefined,\n    };\n\n    try {\n      setIsSending(true);\n      \n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n      }\n      sendTypingStatus(false);\n\n      const body: any = {\n        chatId,\n        messages: [{\n          id: newMessage.id,\n          text: newMessage.text,\n          sender: newMessage.sender,\n          timestamp: newMessage.timestamp.toISOString(),\n          attachments: newMessage.attachments || [],\n        }],\n      };\n\n      if (customerInfo) {\n        body.customerInfo = customerInfo;\n      }\n\n      const response = await fetch(\"/api/chat\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: \"include\",\n        body: JSON.stringify(body),\n      });\n\n      if (!response.ok) {\n        const errJson = await response.json().catch(() => null);\n        const msg =\n          errJson?.error ||\n          (response.status === 429 ? \"درخواست‌های شما زیاد است. لطفاً کمی بعد دوباره تلاش کنید.\" : null) ||\n          \"خطا در ارسال پیام\";\n        throw new Error(msg);\n      }\n\n      if (onMessageSent) {\n        onMessageSent();\n      }\n\n      return newMessage;\n    } catch (error) {\n      if (process.env.NODE_ENV === \"development\") {\n        logger.error(\"Error sending message:\", error);\n      }\n      toast({\n        title: \"خطا\",\n        description: error instanceof Error ? error.message : \"خطا در ارسال پیام\",\n        variant: \"destructive\",\n      });\n      return null;\n    } finally {\n      setIsSending(false);\n    }\n  }, [chatId, sender, customerInfo, toast, onMessageSent, sendTypingStatus]);\n\n  const handleSend = useCallback(async (attachments: Attachment[] = [], replyTo?: Message | null) => {\n    let messageText = message;\n    if (replyTo) {\n      messageText = `در پاسخ به: ${replyTo.text}\\n\\n${message}`;\n    }\n    const sentMessage = await sendMessage(messageText, attachments);\n    if (sentMessage) {\n      setMessage(\"\");\n      return sentMessage;\n    }\n    return null;\n  }, [message, sendMessage]);\n\n  return {\n    message,\n    setMessage,\n    isSending,\n    isTyping,\n    handleMessageChange,\n    sendMessage,\n    handleSend,\n  };\n}\n\n\n","\"use client\";\r\n\r\nimport { useState, useRef, useCallback } from \"react\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { logger } from \"@/lib/logger-client\";\r\nimport { useAuthStore } from \"@/store/auth-store\";\r\n\r\n// Helper to generate unique IDs\r\nfunction generateUniqueId(prefix: string = ''): string {\r\n  if (typeof crypto !== 'undefined' && crypto.randomUUID) {\r\n    return prefix ? `${prefix}-${crypto.randomUUID()}` : crypto.randomUUID();\r\n  }\r\n  return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}-${performance.now()}`;\r\n}\r\n\r\nexport interface Attachment {\r\n  id: string;\r\n  type: \"image\" | \"file\" | \"location\" | \"audio\";\r\n  url: string;\r\n  name?: string;\r\n  size?: number;\r\n  duration?: number;\r\n}\r\n\r\nexport interface UseChatUtilsReturn {\r\n  attachments: Attachment[];\r\n  setAttachments: React.Dispatch<React.SetStateAction<Attachment[]>>;\r\n  isRecording: boolean;\r\n  recordingTime: number;\r\n  audioBlob: Blob | null;\r\n  audioUrl: string | null;\r\n  showAttachmentOptions: boolean;\r\n  setShowAttachmentOptions: React.Dispatch<React.SetStateAction<boolean>>;\r\n  uploadFile: (file: File, type: \"image\" | \"file\" | \"audio\") => Promise<string>;\r\n  handleFileSelect: (e: React.ChangeEvent<HTMLInputElement>, type: \"image\" | \"file\") => Promise<void>;\r\n  handleRemoveAttachment: (id: string) => void;\r\n  handleLocationShare: () => void;\r\n  startRecording: () => Promise<void>;\r\n  stopRecording: () => void;\r\n  cancelRecording: () => void;\r\n  saveRecording: () => Promise<Attachment | null>;\r\n  formatTime: (seconds: number) => string;\r\n  formatFileSize: (bytes: number) => string;\r\n  checkMicrophonePermission: () => Promise<boolean>;\r\n  imageInputRef: React.RefObject<HTMLInputElement | null>;\r\n  fileInputRef: React.RefObject<HTMLInputElement | null>;\r\n}\r\n\r\nexport function useChatUtils(): UseChatUtilsReturn {\r\n  const { toast } = useToast();\r\n  const { user } = useAuthStore();\r\n  const [attachments, setAttachments] = useState<Attachment[]>([]);\r\n  const isSavingRef = useRef(false);\r\n  const [isRecording, setIsRecording] = useState(false);\r\n  const [recordingTime, setRecordingTime] = useState(0);\r\n  const [audioBlob, setAudioBlob] = useState<Blob | null>(null);\r\n  const [audioUrl, setAudioUrl] = useState<string | null>(null);\r\n  const [showAttachmentOptions, setShowAttachmentOptions] = useState(false);\r\n  \r\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n  const audioChunksRef = useRef<Blob[]>([]);\r\n  const recordingIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const uploadFile = useCallback(async (file: File, type: \"image\" | \"file\" | \"audio\", retryCount = 0): Promise<string> => {\r\n    const MAX_RETRIES = 3;\r\n    const RETRY_DELAY = 2000;\r\n\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append(\"file\", file);\r\n      formData.append(\"type\", type);\r\n\r\n      // Add userId header if user is available (fallback for session issues)\r\n      const headers: Record<string, string> = {};\r\n      if (user?.id) {\r\n        headers['x-user-id'] = user.id;\r\n      }\r\n\r\n      const response = await fetch(\"/api/chat/upload\", {\r\n        method: \"POST\",\r\n        credentials: \"include\", // Include cookies for session\r\n        headers,\r\n        body: formData,\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json().catch(() => ({ error: \"خطا در آپلود فایل\" }));\r\n        throw new Error(error.error || \"خطا در آپلود فایل\");\r\n      }\r\n\r\n      const data = await response.json();\r\n      return data.data.url;\r\n    } catch (error: any) {\r\n      if (retryCount < MAX_RETRIES && (\r\n        error.message?.includes(\"fetch\") || \r\n        error.message?.includes(\"network\") ||\r\n        error.message?.includes(\"timeout\") ||\r\n        error.code === \"NETWORK_ERROR\" ||\r\n        error.name === \"TypeError\"\r\n      )) {\r\n        const delay = RETRY_DELAY * Math.pow(2, retryCount);\r\n        if (retryCount === 0) {\r\n          toast({\r\n            title: \"در حال تلاش مجدد...\",\r\n            description: \"خطا در آپلود فایل. در حال تلاش مجدد...\",\r\n            duration: 2000,\r\n          });\r\n        }\r\n        await new Promise(resolve => setTimeout(resolve, delay));\r\n        return uploadFile(file, type, retryCount + 1);\r\n      }\r\n\r\n      toast({\r\n        title: \"خطا در آپلود فایل\",\r\n        description: error.message || \"لطفاً دوباره تلاش کنید\",\r\n        variant: \"destructive\",\r\n      });\r\n      throw error;\r\n    }\r\n  }, [toast]);\r\n\r\n  const handleFileSelect = useCallback(async (e: React.ChangeEvent<HTMLInputElement>, type: \"image\" | \"file\") => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    for (const file of Array.from(files)) {\r\n      try {\r\n        const fileUrl = await uploadFile(file, type);\r\n        const attachment: Attachment = {\r\n          id: Date.now().toString() + Math.random(),\r\n          type,\r\n          name: file.name,\r\n          size: file.size,\r\n          url: fileUrl,\r\n        };\r\n        setAttachments((prev) => [...prev, attachment]);\r\n      } catch (error) {\r\n        // Error already handled in uploadFile\r\n      }\r\n    }\r\n\r\n    e.target.value = \"\";\r\n  }, [uploadFile]);\r\n\r\n  const handleRemoveAttachment = useCallback((id: string) => {\r\n    setAttachments((prev) => prev.filter((a) => a.id !== id));\r\n  }, []);\r\n\r\n  const handleLocationShare = useCallback(() => {\r\n    if (navigator.geolocation) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          const attachment: Attachment = {\r\n            id: `location-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n            type: \"location\",\r\n            url: `https://www.google.com/maps?q=${position.coords.latitude},${position.coords.longitude}`,\r\n            name: \"موقعیت مکانی\",\r\n          };\r\n          setAttachments((prev) => [...prev, attachment]);\r\n          setShowAttachmentOptions(false);\r\n        },\r\n        (error) => {\r\n          logger.error(\"Error getting location:\", error);\r\n          toast({\r\n            title: \"خطا\",\r\n            description: \"خطا در دریافت موقعیت مکانی\",\r\n            variant: \"destructive\",\r\n          });\r\n        }\r\n      );\r\n    } else {\r\n      toast({\r\n        title: \"خطا\",\r\n        description: \"مرورگر شما از موقعیت مکانی پشتیبانی نمی‌کند\",\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  }, [toast]);\r\n\r\n  const checkMicrophonePermission = useCallback(async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      stream.getTracks().forEach((track) => track.stop());\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }, []);\r\n\r\n  const startRecording = useCallback(async () => {\r\n    try {\r\n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n        toast({\r\n          title: \"مرورگر شما پشتیبانی نمی‌کند\",\r\n          description: \"مرورگر شما از ضبط صدا پشتیبانی نمی‌کند. لطفاً از مرورگر جدیدتری استفاده کنید.\",\r\n          variant: \"destructive\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      const stream = await navigator.mediaDevices.getUserMedia({ \r\n        audio: {\r\n          echoCancellation: true,\r\n          noiseSuppression: true,\r\n          autoGainControl: true,\r\n        } \r\n      });\r\n      \r\n      const mediaRecorder = new MediaRecorder(stream, {\r\n        mimeType: MediaRecorder.isTypeSupported(\"audio/webm\") \r\n          ? \"audio/webm\" \r\n          : MediaRecorder.isTypeSupported(\"audio/mp4\")\r\n          ? \"audio/mp4\"\r\n          : \"audio/webm\",\r\n      });\r\n      mediaRecorderRef.current = mediaRecorder;\r\n      audioChunksRef.current = [];\r\n\r\n      mediaRecorder.ondataavailable = (event) => {\r\n        if (event.data.size > 0) {\r\n          audioChunksRef.current.push(event.data);\r\n        }\r\n      };\r\n\r\n      mediaRecorder.onstop = () => {\r\n        const blob = new Blob(audioChunksRef.current, { \r\n          type: mediaRecorder.mimeType || \"audio/webm\" \r\n        });\r\n        setAudioBlob(blob);\r\n        const url = URL.createObjectURL(blob);\r\n        setAudioUrl(url);\r\n        stream.getTracks().forEach((track) => track.stop());\r\n      };\r\n\r\n      mediaRecorder.onerror = (event) => {\r\n        logger.error(\"MediaRecorder error:\", event);\r\n        toast({\r\n          title: \"خطا در ضبط صدا\",\r\n          description: \"خطایی در هنگام ضبط صدا رخ داد. لطفاً دوباره تلاش کنید.\",\r\n          variant: \"destructive\",\r\n        });\r\n        stopRecording();\r\n      };\r\n\r\n      mediaRecorder.start();\r\n      setIsRecording(true);\r\n      setRecordingTime(0);\r\n      setShowAttachmentOptions(false);\r\n\r\n      recordingIntervalRef.current = setInterval(() => {\r\n        setRecordingTime((prev) => prev + 1);\r\n      }, 1000);\r\n\r\n      toast({\r\n        title: \"ضبط صدا شروع شد\",\r\n        description: \"در حال ضبط پیام صوتی...\",\r\n      });\r\n    } catch (error: any) {\r\n      let errorMessage = \"دسترسی به میکروفون مجاز نیست.\";\r\n      let errorDescription = \"\";\r\n\r\n      if (error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\") {\r\n        errorMessage = \"دسترسی به میکروفون رد شد\";\r\n        errorDescription = \"لطفاً در تنظیمات مرورگر خود، دسترسی میکروفون را فعال کنید.\";\r\n      } else if (error.name === \"NotFoundError\" || error.name === \"DevicesNotFoundError\") {\r\n        errorMessage = \"میکروفون یافت نشد\";\r\n        errorDescription = \"لطفاً مطمئن شوید که میکروفون به دستگاه شما متصل است.\";\r\n      } else if (error.name === \"NotReadableError\" || error.name === \"TrackStartError\") {\r\n        errorMessage = \"میکروفون در حال استفاده است\";\r\n        errorDescription = \"میکروفون توسط برنامه دیگری استفاده می‌شود. لطفاً آن را ببندید.\";\r\n      } else {\r\n        errorDescription = \"لطفاً دوباره تلاش کنید یا صفحه را رفرش کنید.\";\r\n      }\r\n\r\n      toast({\r\n        title: errorMessage,\r\n        description: errorDescription,\r\n        variant: \"destructive\",\r\n        duration: 5000,\r\n      });\r\n    }\r\n  }, [toast]);\r\n\r\n  const stopRecording = useCallback(() => {\r\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\r\n      try {\r\n        mediaRecorderRef.current.stop();\r\n        setIsRecording(false);\r\n        if (recordingIntervalRef.current) {\r\n          clearInterval(recordingIntervalRef.current);\r\n        }\r\n        toast({\r\n          title: \"ضبط صدا متوقف شد\",\r\n          description: \"پیام صوتی شما آماده است. می‌توانید آن را ذخیره یا لغو کنید.\",\r\n        });\r\n      } catch (error) {\r\n        logger.error(\"Error stopping recording:\", error);\r\n        toast({\r\n          title: \"خطا\",\r\n          description: \"خطایی در توقف ضبط رخ داد.\",\r\n          variant: \"destructive\",\r\n        });\r\n      }\r\n    }\r\n  }, [toast]);\r\n\r\n  const cancelRecording = useCallback(() => {\r\n    stopRecording();\r\n    setAudioBlob(null);\r\n    if (audioUrl) {\r\n      URL.revokeObjectURL(audioUrl);\r\n      setAudioUrl(null);\r\n    }\r\n    setRecordingTime(0);\r\n  }, [audioUrl, stopRecording]);\r\n\r\n  const formatTime = useCallback((seconds: number) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\r\n  }, []);\r\n\r\n  const saveRecording = useCallback(async (): Promise<Attachment | null> => {\r\n    // Prevent concurrent saves\r\n    if (isSavingRef.current) {\r\n      logger.warn(\"saveRecording already in progress, skipping\");\r\n      return null;\r\n    }\r\n    \r\n    if (!audioBlob || !audioUrl) {\r\n      return null;\r\n    }\r\n    \r\n    isSavingRef.current = true;\r\n    \r\n    try {\r\n      let extension = \"webm\";\r\n      let mimeType = audioBlob.type || \"audio/webm\";\r\n      \r\n      if (mimeType.includes(\"mp4\") || mimeType.includes(\"m4a\")) {\r\n        extension = \"m4a\";\r\n      } else if (mimeType.includes(\"ogg\")) {\r\n        extension = \"ogg\";\r\n      } else if (mimeType.includes(\"wav\")) {\r\n        extension = \"wav\";\r\n      }\r\n\r\n      const audioFile = new File([audioBlob], `audio-${Date.now()}.${extension}`, {\r\n        type: mimeType,\r\n      });\r\n\r\n      const uploadedUrl = await uploadFile(audioFile, \"audio\");\r\n\r\n      // Generate truly unique ID\r\n      const uniqueId = generateUniqueId(\"audio\");\r\n      \r\n      const attachment: Attachment = {\r\n        id: uniqueId,\r\n        type: \"audio\",\r\n        url: uploadedUrl,\r\n        name: `پیام صوتی ${formatTime(recordingTime)}`,\r\n        size: audioBlob.size,\r\n        duration: recordingTime,\r\n      };\r\n      \r\n      // Clean up recording state\r\n      setAudioBlob(null);\r\n      if (audioUrl) {\r\n        URL.revokeObjectURL(audioUrl);\r\n      }\r\n      setAudioUrl(null);\r\n      setRecordingTime(0);\r\n      \r\n      // Return attachment - caller should add it to state\r\n      return attachment;\r\n    } catch (error) {\r\n      logger.error(\"Error saving recording:\", error);\r\n      return null;\r\n    } finally {\r\n      isSavingRef.current = false;\r\n    }\r\n  }, [audioBlob, audioUrl, recordingTime, uploadFile, formatTime]);\r\n\r\n  const formatFileSize = useCallback((bytes: number) => {\r\n    if (bytes < 1024) return bytes + \" B\";\r\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + \" KB\";\r\n    return (bytes / (1024 * 1024)).toFixed(1) + \" MB\";\r\n  }, []);\r\n\r\n  return {\r\n    attachments,\r\n    setAttachments,\r\n    isRecording,\r\n    recordingTime,\r\n    audioBlob,\r\n    audioUrl,\r\n    showAttachmentOptions,\r\n    setShowAttachmentOptions,\r\n    uploadFile,\r\n    handleFileSelect,\r\n    handleRemoveAttachment,\r\n    handleLocationShare,\r\n    startRecording,\r\n    stopRecording,\r\n    cancelRecording,\r\n    saveRecording,\r\n    formatTime,\r\n    formatFileSize,\r\n    checkMicrophonePermission,\r\n    imageInputRef,\r\n    fileInputRef,\r\n  };\r\n}\r\n\r\n\r\n\r\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name EllipsisVertical\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxIiAvPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iNSIgcj0iMSIgLz4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjE5IiByPSIxIiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/ellipsis-vertical\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst EllipsisVertical = createLucideIcon('EllipsisVertical', [\n  ['circle', { cx: '12', cy: '12', r: '1', key: '41hilf' }],\n  ['circle', { cx: '12', cy: '5', r: '1', key: 'gxeob9' }],\n  ['circle', { cx: '12', cy: '19', r: '1', key: 'lyex9k' }],\n]);\n\nexport default EllipsisVertical;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Pen\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjEuMTc0IDYuODEyYTEgMSAwIDAgMC0zLjk4Ni0zLjk4N0wzLjg0MiAxNi4xNzRhMiAyIDAgMCAwLS41LjgzbC0xLjMyMSA0LjM1MmEuNS41IDAgMCAwIC42MjMuNjIybDQuMzUzLTEuMzJhMiAyIDAgMCAwIC44My0uNDk3eiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/pen\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Pen = createLucideIcon('Pen', [\n  [\n    'path',\n    {\n      d: 'M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z',\n      key: '1a8usu',\n    },\n  ],\n]);\n\nexport default Pen;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Reply\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cG9seWxpbmUgcG9pbnRzPSI5IDE3IDQgMTIgOSA3IiAvPgogIDxwYXRoIGQ9Ik0yMCAxOHYtMmE0IDQgMCAwIDAtNC00SDQiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/reply\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Reply = createLucideIcon('Reply', [\n  ['polyline', { points: '9 17 4 12 9 7', key: 'hvgpf2' }],\n  ['path', { d: 'M20 18v-2a4 4 0 0 0-4-4H4', key: '5vmcpk' }],\n]);\n\nexport default Reply;\n","\"use client\";\n\nimport { useState, useEffect, useRef, useCallback } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  MessageCircle,\n  Search,\n  User,\n  Phone,\n  Mail,\n  X,\n  Loader2,\n  ChevronDown,\n  Send,\n  Ban,\n} from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAdminPresence } from \"@/hooks/use-admin-presence\";\nimport { OnlineStatusBadge } from \"@/components/chat/online-status-badge\";\nimport { TypingIndicator } from \"@/components/chat/typing-indicator\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useChatUtils } from \"@/hooks/use-chat-utils\";\nimport { useChatMessaging, type Message } from \"@/hooks/use-chat-messaging\";\nimport { MessageBubble } from \"@/components/chat/message-bubble\";\nimport { ChatInput } from \"@/components/chat/chat-input\";\nimport { logger } from \"@/lib/logger-client\";\nimport { useAuthStore } from \"@/store/auth-store\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport * as VisuallyHiddenPrimitive from \"@radix-ui/react-visually-hidden\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { format } from \"date-fns\";\nimport { faIR } from \"date-fns/locale\";\n\ninterface Chat {\n  id: string;\n  userId?: string;\n  customerName: string;\n  customerPhone: string;\n  customerEmail?: string;\n  status: string;\n  createdAt: string;\n  updatedAt: string;\n  lastMessage?: string;\n  lastMessageTime?: string;\n  unreadCount?: number;\n  isRegisteredUser?: boolean; // Flag for registered users without chat\n  isUserWithoutChat?: boolean; // Alternative flag name from API\n}\n\ninterface AdminChatProps {\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  initialCustomerPhone?: string;\n}\n\nexport function AdminChat({ isOpen, onOpenChange, initialCustomerPhone }: AdminChatProps) {\n  const { toast } = useToast();\n  const { user } = useAuthStore();\n  const { setOnline, isOnline } = useAdminPresence({\n    enabled: true,\n    heartbeatInterval: 15000,\n  });\n  \n  const [chats, setChats] = useState<Chat[]>([]);\n  const [selectedChat, setSelectedChat] = useState<Chat | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [isLoadingChats, setIsLoadingChats] = useState(false);\n  const [isLoadingMessages, setIsLoadingMessages] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isUserTyping, setIsUserTyping] = useState(false);\n  const [replyingTo, setReplyingTo] = useState<Message | null>(null);\n  const [editingMessage, setEditingMessage] = useState<Message | null>(null);\n  const [blockDialogOpen, setBlockDialogOpen] = useState(false);\n  const [isBlocking, setIsBlocking] = useState(false);\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\n  const lastMessageIdRef = useRef<string | null>(null);\n  const typingPollIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const [showScrollToBottom, setShowScrollToBottom] = useState(false);\n  const isSavingRecordingRef = useRef(false);\n\n  // Use shared hooks\n  const chatUtils = useChatUtils();\n  const chatMessaging = useChatMessaging({\n    chatId: selectedChat?.id || null,\n    sender: \"support\",\n    customerInfo: selectedChat ? {\n      name: selectedChat.customerName,\n      phone: selectedChat.customerPhone,\n      email: selectedChat.customerEmail,\n    } : undefined,\n    onMessageSent: () => {\n      // Silent refresh - no loading state\n      // Delay to avoid conflict with immediate message addition in handleSend\n      // Only refresh chats list, don't reload messages (handleSend already adds message to UI)\n      setTimeout(() => {\n        loadChats(false);\n        // Don't reload messages here - handleSend already adds the message to UI\n        // This prevents duplicate messages and state conflicts\n      }, 2000); // Longer delay to let handleSend finish completely\n    },\n  });\n\n  // Load chats list - includes all registered users\n  const loadChats = useCallback(async (showLoading = true) => {\n    try {\n      if (showLoading) setIsLoadingChats(true);\n      console.log(\"[AdminChat] Loading chats...\");\n      // Add userId header for fallback mechanism (works in both dev and prod)\n      const headers: HeadersInit = {\n        \"Content-Type\": \"application/json\",\n      };\n      if (user?.id) {\n        headers['x-user-id'] = user.id;\n        console.log(\"[AdminChat] Adding x-user-id header:\", user.id);\n      }\n      \n      const response = await fetch(\"/api/chat\", { \n        credentials: \"include\",\n        headers,\n      });\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error(\"[AdminChat] Failed to load chats:\", response.status, errorText);\n        logger.error(\"Failed to load chats:\", response.status, errorText);\n        throw new Error(\"خطا در بارگذاری چت‌ها\");\n      }\n      \n      const data = await response.json();\n      console.log(\"[AdminChat] API Response:\", {\n        success: data.success,\n        hasData: !!data.data,\n        chatsCount: data.data?.chats?.length || 0,\n        chats: data.data?.chats?.slice(0, 3), // Log first 3 for debugging\n      });\n      logger.info(\"Loaded chats:\", data.success ? data.data.chats?.length : 0, \"chats\");\n      if (data.success && data.data?.chats && Array.isArray(data.data.chats)) {\n        console.log(\"[AdminChat] Processing\", data.data.chats.length, \"chats...\");\n        const chatsWithLastMessage = await Promise.all(\n          data.data.chats.map(async (chat: Chat) => {\n            // If it's a registered user without chat, skip loading messages\n            if (chat.isRegisteredUser || chat.isUserWithoutChat) {\n              return {\n                ...chat,\n                lastMessage: \"هنوز پیامی ارسال نشده است\",\n                lastMessageTime: chat.updatedAt || chat.createdAt,\n                unreadCount: undefined,\n                isRegisteredUser: true, // Normalize flag\n              };\n            }\n            \n            try {\n              const msgResponse = await fetch(`/api/chat?chatId=${chat.id}`, { credentials: \"include\" });\n              if (msgResponse.ok) {\n                const msgData = await msgResponse.json();\n                if (msgData.success && msgData.data.messages) {\n                  const msgs = msgData.data.messages;\n                  const lastMsg = msgs[msgs.length - 1];\n                  const unreadCount = chat.unreadCount && chat.unreadCount > 0 ? chat.unreadCount : undefined;\n                  return {\n                    ...chat,\n                    lastMessage: lastMsg?.text || \"\",\n                    lastMessageTime: lastMsg?.createdAt || chat.updatedAt,\n                    unreadCount: unreadCount,\n                  };\n                }\n              }\n            } catch (error) {\n              logger.error(\"Error loading last message:\", error);\n            }\n            const unreadCount = chat.unreadCount && chat.unreadCount > 0 ? chat.unreadCount : undefined;\n            return { ...chat, unreadCount: unreadCount };\n          })\n        );\n        console.log(\"[AdminChat] Setting chats:\", chatsWithLastMessage.length, \"chats\");\n        setChats(chatsWithLastMessage);\n      } else {\n        console.warn(\"[AdminChat] No chats in response or success=false:\", data);\n        setChats([]);\n      }\n    } catch (error) {\n      console.error(\"[AdminChat] Error loading chats:\", error);\n      logger.error(\"Error loading chats:\", error);\n      if (showLoading) {\n        toast({\n          title: \"خطا\",\n          description: \"خطا در بارگذاری چت‌ها\",\n          variant: \"destructive\",\n        });\n      }\n      setChats([]);\n    } finally {\n      if (showLoading) setIsLoadingChats(false);\n    }\n  }, [toast]);\n\n  // Load messages\n  const loadMessages = useCallback(async (chatId: string, isInitial = false) => {\n    try {\n      if (isInitial) setIsLoadingMessages(true);\n      \n      let url = `/api/chat?chatId=${chatId}`;\n      if (!isInitial && lastMessageIdRef.current) {\n        url += `&lastMessageId=${lastMessageIdRef.current}`;\n      }\n      \n      const response = await fetch(url);\n      if (!response.ok) throw new Error(\"خطا در بارگذاری پیام‌ها\");\n      \n      const data = await response.json();\n      if (data.success && data.data.messages) {\n        const formattedMessages: Message[] = data.data.messages.map((msg: any) => {\n          let attachments: any[] = [];\n          if (msg.attachments) {\n            if (Array.isArray(msg.attachments)) {\n              attachments = msg.attachments;\n            } else if (typeof msg.attachments === 'string') {\n              try {\n                const parsed = JSON.parse(msg.attachments);\n                attachments = Array.isArray(parsed) ? parsed : [parsed];\n              } catch (e) {\n                logger.error(\"Error parsing attachments:\", e);\n              }\n            }\n          }\n          \n          return {\n            id: msg.id,\n            text: msg.text || \"\",\n            sender: msg.sender as \"user\" | \"support\",\n            timestamp: new Date(msg.createdAt),\n            attachments: attachments,\n            status: msg.status || (msg.sender === \"user\" ? \"sent\" : undefined),\n          };\n        });\n        \n        if (selectedChat) {\n          try {\n            const unreadResponse = await fetch(`/api/chat/unread-count?chatId=${selectedChat.id}`);\n            if (unreadResponse.ok) {\n              const unreadData = await unreadResponse.json();\n              if (unreadData.success && unreadData.data) {\n                const unreadCount = unreadData.data.unreadCount && unreadData.data.unreadCount > 0 \n                  ? unreadData.data.unreadCount \n                  : undefined;\n                setChats((prevChats) =>\n                  prevChats.map((c) =>\n                    c.id === selectedChat.id ? { ...c, unreadCount } : c\n                  )\n                );\n              }\n            }\n          } catch (error) {\n            // Silent fail\n          }\n        }\n        \n        if (isInitial) {\n          setMessages(formattedMessages);\n          if (formattedMessages.length > 0) {\n            lastMessageIdRef.current = formattedMessages[formattedMessages.length - 1].id;\n          }\n        } else {\n          setMessages((prev) => {\n            // Only update if we have messages from DB (avoid clearing on empty response during polling)\n            if (formattedMessages.length === 0 && prev.length > 0) {\n              return prev; // Keep existing messages if DB returns empty (might be polling issue)\n            }\n            \n            const dbMessageIds = new Set(formattedMessages.map((m) => m.id));\n            const existingIds = new Set(prev.map((m) => m.id));\n            const newMessages = formattedMessages.filter((msg) => !existingIds.has(msg.id));\n            \n            // Remove messages that were deleted from database (but keep temp messages)\n            const filteredPrev = prev.filter((msg) => \n              msg.id.startsWith(\"temp-\") || dbMessageIds.has(msg.id)\n            );\n            \n            // Update status of existing messages\n            const updatedPrev = filteredPrev.map((msg) => {\n              const dbMsg = formattedMessages.find((m) => m.id === msg.id);\n              if (dbMsg && msg.sender === \"user\" && dbMsg.status && msg.status !== dbMsg.status) {\n                return { ...msg, status: dbMsg.status };\n              }\n              return msg;\n            });\n            \n            if (newMessages.length > 0) {\n              lastMessageIdRef.current = newMessages[newMessages.length - 1].id;\n              return [...updatedPrev, ...newMessages];\n            }\n            // Only update if we actually removed deleted messages or updated status\n            const hasChanges = filteredPrev.length !== prev.length || \n              updatedPrev.some((msg, idx) => {\n                const origMsg = prev.find((m) => m.id === msg.id);\n                return !origMsg || origMsg.status !== msg.status;\n              });\n            if (hasChanges) {\n              return updatedPrev;\n            }\n            return prev; // No changes, return previous state to avoid unnecessary re-render\n          });\n        }\n      } else if (data.success && selectedChat?.isRegisteredUser) {\n        // For registered users without chat, start with empty messages\n        setMessages([]);\n      }\n    } catch (error) {\n      logger.error(\"Error loading messages:\", error);\n      if (isInitial) {\n        toast({\n          title: \"خطا\",\n          description: \"خطا در بارگذاری پیام‌ها\",\n          variant: \"destructive\",\n        });\n      }\n    } finally {\n      if (isInitial) setIsLoadingMessages(false);\n    }\n  }, [selectedChat, toast]);\n\n  // Mark messages as delivered/read\n  const markUserMessagesAsDelivered = useCallback(async (chatId: string) => {\n    try {\n      await fetch(\"/api/chat/status\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ chatId, sender: \"support\", action: \"delivered\" }),\n      });\n    } catch (error) {\n      // Silent fail\n    }\n  }, []);\n\n  const markUserMessagesAsRead = useCallback(async (chatId: string) => {\n    try {\n      await fetch(\"/api/chat/status\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ chatId, sender: \"support\", action: \"read\" }),\n      });\n    } catch (error) {\n      // Silent fail\n    }\n  }, []);\n\n  // Handle chat selection\n  const handleSelectChat = useCallback(async (chat: Chat) => {\n    // Reset state before selecting new chat to prevent flickering\n    setMessages([]);\n    lastMessageIdRef.current = null;\n    setSelectedChat(chat);\n    \n    if (typeof window !== \"undefined\") {\n      localStorage.setItem('admin_selected_chat_id', chat.id);\n      window.dispatchEvent(new CustomEvent('chatOpened', { detail: { chatId: chat.id } }));\n    }\n    \n    // If it's a registered user without chat, create chat on first message\n    if ((chat.isRegisteredUser || chat.isUserWithoutChat) && chat.userId) {\n      // Load empty messages for now\n      setMessages([]);\n    } else {\n      markUserMessagesAsRead(chat.id).catch(() => {});\n      markUserMessagesAsDelivered(chat.id);\n      loadMessages(chat.id, true);\n    }\n    \n    setChats((prevChats) =>\n      prevChats.map((c) =>\n        c.id === chat.id ? { ...c, unreadCount: undefined } : c\n      )\n    );\n  }, [loadMessages, markUserMessagesAsRead, markUserMessagesAsDelivered]);\n\n  // Check typing status\n  const checkUserTyping = useCallback(async () => {\n    if (!selectedChat || selectedChat.isRegisteredUser || selectedChat.isUserWithoutChat) return;\n    try {\n      const response = await fetch(`/api/chat/typing?chatId=${selectedChat.id}&sender=user`, { credentials: \"include\" });\n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          setIsUserTyping(data.data.isTyping || false);\n        }\n      }\n    } catch (error) {\n      // Silent fail\n    }\n  }, [selectedChat]);\n\n  // Handle reply\n  const handleReply = useCallback((message: Message) => {\n    setReplyingTo(message);\n    setEditingMessage(null);\n  }, []);\n\n  // Handle edit\n  const handleEdit = useCallback((message: Message) => {\n    setEditingMessage(message);\n    setReplyingTo(null);\n    chatMessaging.handleMessageChange({ target: { value: message.text || \"\" } } as React.ChangeEvent<HTMLTextAreaElement>);\n  }, [chatMessaging]);\n\n  // Handle delete\n  const handleDelete = useCallback(async (messageId: string) => {\n    if (!selectedChat) {\n      console.error(\"[AdminChat] handleDelete: No selected chat\");\n      return;\n    }\n    \n    console.log(\"[AdminChat] Deleting message:\", messageId);\n    \n    try {\n      const response = await fetch(`/api/chat/message/${messageId}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      });\n      \n      console.log(\"[AdminChat] Delete response status:\", response.status);\n      \n      let data;\n      try {\n        data = await response.json();\n      } catch (e) {\n        const text = await response.text();\n        console.error(\"[AdminChat] Failed to parse response:\", text);\n        data = {};\n      }\n      \n      console.log(\"[AdminChat] Delete response data:\", data);\n      \n      if (response.ok) {\n        setMessages((prev) => prev.filter((msg) => msg.id !== messageId));\n        // Refresh chats to update last message (silent - no loading)\n        loadChats(false);\n        // Force immediate message reload to sync with other clients (silent - no loading)\n        if (selectedChat) {\n          setTimeout(() => {\n            loadMessages(selectedChat.id, false).catch(() => {\n              // Silent fail\n            });\n          }, 500);\n        }\n        toast({\n          title: \"موفق\",\n          description: data.message || \"پیام با موفقیت حذف شد\",\n        });\n      } else {\n        const errorMessage = data.error || data.message || `خطا در حذف پیام (${response.status})`;\n        console.error(\"[AdminChat] Delete error:\", errorMessage, data);\n        logger.error(\"Error deleting message:\", errorMessage, data);\n        throw new Error(errorMessage);\n      }\n    } catch (error) {\n      console.error(\"[AdminChat] Delete exception:\", error);\n      logger.error(\"Error deleting message:\", error);\n      toast({\n        title: \"خطا\",\n        description: error instanceof Error ? error.message : \"خطا در حذف پیام\",\n        variant: \"destructive\",\n      });\n    }\n  }, [selectedChat, toast, loadChats, loadMessages]);\n\n  // Handle block user\n  const handleBlockUser = useCallback(async () => {\n    if (!selectedChat) return;\n    \n    setIsBlocking(true);\n    try {\n      const response = await fetch(`/api/chat/block`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          chatId: selectedChat.id,\n          customerPhone: selectedChat.customerPhone,\n        }),\n      });\n      \n      if (response.ok) {\n        toast({\n          title: \"موفق\",\n          description: \"کاربر با موفقیت مسدود شد\",\n        });\n        setBlockDialogOpen(false);\n        // Remove chat from list\n        setChats((prev) => prev.filter((chat) => chat.id !== selectedChat.id));\n        setSelectedChat(null);\n        setMessages([]);\n      } else {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || \"خطا در مسدود کردن کاربر\");\n      }\n    } catch (error) {\n      logger.error(\"Error blocking user:\", error);\n      toast({\n        title: \"خطا\",\n        description: error instanceof Error ? error.message : \"خطا در مسدود کردن کاربر\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsBlocking(false);\n    }\n  }, [selectedChat, toast]);\n\n  // Handle send message\n  const handleSend = useCallback(async () => {\n    if (!selectedChat) return;\n    \n    // If editing, update the message instead of sending new one\n    if (editingMessage) {\n      try {\n        const response = await fetch(`/api/chat/message/${editingMessage.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            text: chatMessaging.message,\n            attachments: chatUtils.attachments,\n          }),\n        });\n        \n        if (response.ok) {\n          setMessages((prev) =>\n            prev.map((msg) =>\n              msg.id === editingMessage.id\n                ? { ...msg, text: chatMessaging.message, attachments: chatUtils.attachments }\n                : msg\n            )\n          );\n          setEditingMessage(null);\n          chatMessaging.handleMessageChange({ target: { value: \"\" } } as React.ChangeEvent<HTMLTextAreaElement>);\n          chatUtils.setAttachments([]);\n          toast({\n            title: \"موفق\",\n            description: \"پیام ویرایش شد\",\n          });\n        }\n      } catch (error) {\n        logger.error(\"Error editing message:\", error);\n        toast({\n          title: \"خطا\",\n          description: \"خطا در ویرایش پیام\",\n          variant: \"destructive\",\n        });\n      }\n      return;\n    }\n    \n    // If it's a registered user without chat, create chat first\n    if ((selectedChat.isRegisteredUser || selectedChat.isUserWithoutChat) && selectedChat.userId) {\n      try {\n        // Create chat for this user\n        const createResponse = await fetch(\"/api/chat\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          credentials: \"include\",\n          body: JSON.stringify({\n            customerInfo: {\n              name: selectedChat.customerName,\n              phone: selectedChat.customerPhone,\n              email: selectedChat.customerEmail,\n            },\n            messages: [{\n              text: chatMessaging.message,\n              sender: \"support\",\n              attachments: chatUtils.attachments,\n            }],\n          }),\n        });\n        \n        if (createResponse.ok) {\n          const createData = await createResponse.json();\n          if (createData.success && createData.data.chat) {\n            const newChat = createData.data.chat;\n            // Update selected chat\n            const updatedChat: Chat = {\n              ...selectedChat,\n              id: newChat.id,\n              isRegisteredUser: false,\n              isUserWithoutChat: false,\n            };\n            setSelectedChat(updatedChat);\n            \n            // Update UI smoothly without visible reload\n            // Add the sent message to UI immediately\n            if (createData.success && createData.data.messages && createData.data.messages.length > 0) {\n              const sentMessage = createData.data.messages[0];\n              setMessages((prev) => [...prev, sentMessage]);\n            }\n            \n            // Reload chats and messages in background (silent)\n            loadChats(false).catch(() => {});\n            loadMessages(newChat.id, false).catch(() => {});\n            \n            // Scroll to bottom smoothly\n            setTimeout(() => {\n              scrollToBottom(false);\n            }, 100);\n            \n            // Clear attachments and UI state smoothly\n            chatUtils.setAttachments([]);\n            chatUtils.setShowAttachmentOptions(false);\n            setReplyingTo(null);\n            \n            toast({\n              title: \"موفق\",\n              description: \"پیام ارسال شد\",\n            });\n          }\n        }\n      } catch (error) {\n        logger.error(\"Error creating chat:\", error);\n        toast({\n          title: \"خطا\",\n          description: \"خطا در ارسال پیام\",\n          variant: \"destructive\",\n        });\n      }\n      return;\n    }\n    \n    const sentMessage = await chatMessaging.handleSend(chatUtils.attachments, replyingTo);\n    if (sentMessage) {\n      // Add message to UI smoothly (no flash/reload)\n      setMessages((prev) => {\n        // Check if message already exists (avoid duplicates)\n        const exists = prev.some((msg) => msg.id === sentMessage.id);\n        if (exists) return prev;\n        return [...prev, sentMessage];\n      });\n      \n      // Clear attachments and UI state smoothly\n      chatUtils.setAttachments([]);\n      chatUtils.setShowAttachmentOptions(false);\n      setReplyingTo(null);\n      \n      // Update last message ID for polling\n      if (sentMessage.id && !sentMessage.id.startsWith(\"temp-\")) {\n        lastMessageIdRef.current = sentMessage.id;\n      }\n      \n      // Refresh chats list silently (without loading) to update last message\n      // Delay to avoid conflict with message addition\n      setTimeout(() => {\n        loadChats(false);\n      }, 500);\n      \n      // Scroll to bottom smoothly after sending message\n      setTimeout(() => {\n        scrollToBottom(false);\n        setTimeout(() => {\n          checkScrollPosition();\n        }, 500);\n      }, 100);\n    }\n  }, [selectedChat, chatMessaging, chatUtils, editingMessage, replyingTo, toast, loadChats, loadMessages]);\n\n  // Check if user is scrolled up\n  const checkScrollPosition = useCallback(() => {\n    if (!messagesContainerRef.current || !selectedChat) {\n      setShowScrollToBottom(false);\n      return;\n    }\n    const container = messagesContainerRef.current;\n    const threshold = 150;\n    const scrollBottom = container.scrollHeight - container.scrollTop - container.clientHeight;\n    const isScrolledUp = scrollBottom > threshold;\n    setShowScrollToBottom(isScrolledUp);\n  }, [selectedChat]);\n\n  // Scroll to bottom function\n  const scrollToBottom = useCallback((instant = false) => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ \n        behavior: instant ? \"auto\" : \"smooth\",\n        block: \"end\"\n      });\n      setTimeout(() => {\n        setShowScrollToBottom(false);\n      }, 300);\n    }\n  }, []);\n\n  // Track scroll position\n  useEffect(() => {\n    const container = messagesContainerRef.current;\n    if (!container || !selectedChat) {\n      setShowScrollToBottom(false);\n      return;\n    }\n\n    const handleScroll = () => {\n      checkScrollPosition();\n    };\n\n    container.addEventListener(\"scroll\", handleScroll, { passive: true });\n    checkScrollPosition();\n    \n    return () => {\n      container.removeEventListener(\"scroll\", handleScroll);\n    };\n  }, [selectedChat, checkScrollPosition, messages.length]);\n\n  // Scroll to bottom when chat is selected\n  const hasScrolledOnSelectRef = useRef<boolean>(false);\n  useEffect(() => {\n    if (selectedChat && messages.length > 0 && !hasScrolledOnSelectRef.current) {\n      hasScrolledOnSelectRef.current = true;\n      const timeout = setTimeout(() => {\n        scrollToBottom(true);\n        setTimeout(() => {\n          checkScrollPosition();\n        }, 500);\n      }, 200);\n      return () => clearTimeout(timeout);\n    } else if (!selectedChat) {\n      hasScrolledOnSelectRef.current = false;\n    }\n  }, [selectedChat, messages.length, scrollToBottom, checkScrollPosition]);\n\n  // Poll for new messages\n  useEffect(() => {\n    if (!selectedChat || !isOpen || selectedChat.isRegisteredUser || selectedChat.isUserWithoutChat) {\n      setIsUserTyping(false);\n      if (typingPollIntervalRef.current) {\n        clearInterval(typingPollIntervalRef.current);\n        typingPollIntervalRef.current = null;\n      }\n      return;\n    }\n\n    markUserMessagesAsDelivered(selectedChat.id);\n    markUserMessagesAsRead(selectedChat.id).catch(() => {});\n\n    checkUserTyping();\n    typingPollIntervalRef.current = setInterval(() => {\n      checkUserTyping();\n    }, 3000);\n\n    const interval = setInterval(() => {\n      // Silent polling - no loading state\n      loadMessages(selectedChat.id, false).catch(() => {\n        // Silent fail for polling\n      });\n      markUserMessagesAsDelivered(selectedChat.id);\n      markUserMessagesAsRead(selectedChat.id).catch(() => {});\n    }, 5000);\n\n    return () => {\n      clearInterval(interval);\n      if (typingPollIntervalRef.current) {\n        clearInterval(typingPollIntervalRef.current);\n        typingPollIntervalRef.current = null;\n      }\n    };\n  }, [selectedChat, isOpen, checkUserTyping, loadMessages, markUserMessagesAsDelivered, markUserMessagesAsRead]);\n\n  // Load chats on open\n  useEffect(() => {\n    if (isOpen) {\n      console.log(\"[AdminChat] Dialog opened, loading chats...\");\n      loadChats(true);\n      // اگر شماره تلفن اولیه وجود نداشت، چت را null کن\n      if (!initialCustomerPhone) {\n        setSelectedChat(null);\n        setMessages([]);\n      }\n      if (typeof window !== \"undefined\") {\n        localStorage.removeItem('admin_selected_chat_id');\n        window.dispatchEvent(new CustomEvent('chatClosed'));\n      }\n      setOnline(true);\n      \n      const chatListInterval = setInterval(() => {\n        console.log(\"[AdminChat] Refreshing chats...\");\n        loadChats(false);\n      }, 15000);\n      \n      return () => {\n        clearInterval(chatListInterval);\n      };\n    } else {\n      setOnline(false);\n      if (typeof window !== \"undefined\") {\n        localStorage.removeItem('admin_selected_chat_id');\n        window.dispatchEvent(new CustomEvent('chatClosed'));\n      }\n    }\n  }, [isOpen, setOnline, loadChats]);\n\n  // انتخاب خودکار چت بر اساس شماره تلفن اولیه\n  useEffect(() => {\n    if (initialCustomerPhone && chats.length > 0 && !selectedChat) {\n      const matchingChat = chats.find(\n        (chat) => chat.customerPhone === initialCustomerPhone\n      );\n      if (matchingChat) {\n        console.log(\"[AdminChat] Auto-selecting chat for phone:\", initialCustomerPhone);\n        setSelectedChat(matchingChat);\n        loadMessages(matchingChat.id, true);\n      }\n    }\n  }, [initialCustomerPhone, chats, selectedChat, loadMessages]);\n\n  const filteredChats = chats.filter((chat) =>\n    chat.customerName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    chat.customerPhone.includes(searchQuery) ||\n    chat.customerEmail?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-[95vw] w-full h-[90vh] p-0 flex flex-col gap-0 overflow-hidden\">\n        <VisuallyHiddenPrimitive.Root>\n          <DialogHeader>\n            <DialogTitle>چت با کاربران</DialogTitle>\n          </DialogHeader>\n        </VisuallyHiddenPrimitive.Root>\n        <div className=\"flex h-full overflow-hidden\">\n          {/* Left Sidebar - Contact List */}\n          <div className=\"w-full md:w-1/3 lg:w-1/4 border-l border-border flex flex-col bg-background\">\n            {/* Header */}\n            <div className=\"p-4 border-b border-border bg-muted/30\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"relative flex-1\">\n                  <Search className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    type=\"search\"\n                    placeholder=\"جستجوی کاربر...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"pr-10\"\n                  />\n                </div>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => onOpenChange(false)}\n                  className=\"h-10 w-10 flex-shrink-0\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n\n            {/* Contact List */}\n            <ScrollArea className=\"flex-1\">\n              {isLoadingChats ? (\n                <div className=\"flex items-center justify-center h-full p-8\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                </div>\n              ) : filteredChats.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center h-full text-center px-6 py-12\">\n                  <MessageCircle className=\"h-14 w-14 text-muted-foreground/50 mb-4\" />\n                  <p className=\"text-muted-foreground\">چتی یافت نشد</p>\n                  {chats.length > 0 && (\n                    <p className=\"text-xs text-muted-foreground mt-2\">\n                      (تعداد کل: {chats.length} - فیلتر شده: {filteredChats.length})\n                    </p>\n                  )}\n                </div>\n              ) : (\n                <div className=\"divide-y divide-border\">\n                  {filteredChats.map((chat) => (\n                    <button\n                      key={chat.id}\n                      onClick={() => handleSelectChat(chat)}\n                      className={`w-full p-4 text-right hover:bg-muted/50 transition-all ${\n                        selectedChat?.id === chat.id ? \"bg-primary/10 border-r-4 border-primary\" : \"\"\n                      } ${chat.unreadCount && chat.unreadCount > 0 ? \"font-semibold\" : \"\"}`}\n                    >\n                      <div className=\"flex items-start gap-3\">\n                        <div className=\"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                          <User className=\"h-6 w-6 text-primary\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between mb-1\">\n                            <p className=\"font-semibold text-sm truncate\">{chat.customerName}</p>\n                            {chat.unreadCount && chat.unreadCount > 0 && (\n                              <Badge variant=\"destructive\" className=\"h-5 w-5 px-0 text-xs flex items-center justify-center\">\n                                !\n                              </Badge>\n                            )}\n                          </div>\n                          <div className=\"flex items-center gap-2 text-xs text-muted-foreground mb-1\">\n                            <Phone className=\"h-3 w-3\" />\n                            <span>{chat.customerPhone}</span>\n                          </div>\n                          {chat.lastMessage && (\n                            <p className=\"text-xs text-muted-foreground truncate mt-1\">\n                              {chat.lastMessage}\n                            </p>\n                          )}\n                          {chat.lastMessageTime && (\n                            <p className=\"text-xs text-muted-foreground mt-1\">\n                              {format(new Date(chat.lastMessageTime), \"HH:mm\", { locale: faIR })}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </button>\n                  ))}\n                </div>\n              )}\n            </ScrollArea>\n          </div>\n\n          {/* Right Side - Chat Area */}\n          <div className=\"flex-1 flex flex-col bg-background\">\n            {selectedChat ? (\n              <>\n                {/* Chat Header */}\n                <div className=\"p-4 border-b border-border bg-muted/30 flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                      <User className=\"h-5 w-5 text-primary\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold\">{selectedChat.customerName}</h3>\n                      <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                        <Phone className=\"h-3 w-3\" />\n                        <span>{selectedChat.customerPhone}</span>\n                        {selectedChat.customerEmail && (\n                          <>\n                            <Mail className=\"h-3 w-3 mr-2\" />\n                            <span>{selectedChat.customerEmail}</span>\n                          </>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-4\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setBlockDialogOpen(true)}\n                      className=\"flex items-center gap-2 text-destructive hover:text-destructive\"\n                    >\n                      <Ban className=\"h-4 w-4\" />\n                      <span className=\"hidden sm:inline\">مسدود کردن</span>\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => {\n                        setSelectedChat(null);\n                        setMessages([]);\n                        lastMessageIdRef.current = null;\n                      }}\n                      className=\"mr-4\"\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n\n                {/* Messages Area */}\n                <ScrollArea ref={messagesContainerRef} className=\"flex-1 p-4\">\n                  {isLoadingMessages ? (\n                    <div className=\"flex items-center justify-center h-full\">\n                      <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                    </div>\n                  ) : messages.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center h-full text-center\">\n                      <MessageCircle className=\"h-14 w-14 text-muted-foreground/50 mb-4\" />\n                      <p className=\"text-muted-foreground\">\n                        {(selectedChat.isRegisteredUser || selectedChat.isUserWithoutChat)\n                          ? \"هنوز پیامی ارسال نشده است. می‌توانید اولین پیام را ارسال کنید.\"\n                          : \"هنوز پیامی ارسال نشده است\"}\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-3\">\n                      {messages.map((msg, index) => (\n                        <MessageBubble\n                          key={msg.id}\n                          message={msg}\n                          index={index}\n                          totalMessages={messages.length}\n                          onReply={handleReply}\n                          onEdit={handleEdit}\n                          onDelete={handleDelete}\n                        />\n                      ))}\n                      {isUserTyping && (\n                        <motion.div\n                          initial={{ opacity: 0, y: 10 }}\n                          animate={{ opacity: 1, y: 0 }}\n                          exit={{ opacity: 0, y: 10 }}\n                          className=\"flex justify-start items-end gap-2.5\"\n                        >\n                          <TypingIndicator />\n                        </motion.div>\n                      )}\n                    </div>\n                  )}\n                  <div ref={messagesEndRef} />\n                </ScrollArea>\n\n                {/* Chat Input */}\n                <div className=\"p-4 border-t border-border bg-muted/30\">\n                  <ChatInput\n                    message={chatMessaging.message}\n                    onMessageChange={chatMessaging.handleMessageChange}\n                    onSend={handleSend}\n                    isSending={chatMessaging.isSending}\n                    attachments={chatUtils.attachments}\n                    onRemoveAttachment={chatUtils.handleRemoveAttachment}\n                    showAttachmentOptions={chatUtils.showAttachmentOptions}\n                    onToggleAttachmentOptions={() => chatUtils.setShowAttachmentOptions(!chatUtils.showAttachmentOptions)}\n                    isRecording={chatUtils.isRecording}\n                    recordingTime={chatUtils.recordingTime}\n                    audioUrl={chatUtils.audioUrl}\n                    onStartRecording={chatUtils.startRecording}\n                    onStopRecording={chatUtils.stopRecording}\n                    onCancelRecording={chatUtils.cancelRecording}\n                    onSaveRecording={async () => {\n                      // Prevent concurrent saves\n                      if (isSavingRecordingRef.current) {\n                        return;\n                      }\n                      isSavingRecordingRef.current = true;\n                      \n                      try {\n                        const attachment = await chatUtils.saveRecording();\n                        if (attachment) {\n                          // Check if attachment already exists to avoid duplicates\n                          chatUtils.setAttachments((prev) => {\n                            const exists = prev.some(att => att.id === attachment.id);\n                            if (exists) {\n                              return prev; // Already exists, don't add again\n                            }\n                            return [...prev, attachment];\n                          });\n                        }\n                      } finally {\n                        isSavingRecordingRef.current = false;\n                      }\n                    }}\n                    formatTime={chatUtils.formatTime}\n                    imageInputRef={chatUtils.imageInputRef}\n                    fileInputRef={chatUtils.fileInputRef}\n                    onFileSelect={chatUtils.handleFileSelect}\n                    onLocationShare={chatUtils.handleLocationShare}\n                    onCheckMicrophonePermission={chatUtils.checkMicrophonePermission}\n                    toast={toast}\n                  />\n                </div>\n              </>\n            ) : (\n              <div className=\"flex-1 flex items-center justify-center\">\n                <div className=\"text-center\">\n                  <MessageCircle className=\"h-16 w-16 text-muted-foreground/50 mx-auto mb-4\" />\n                  <p className=\"text-muted-foreground\">یک مخاطب را انتخاب کنید</p>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </DialogContent>\n\n      {/* Block User Confirmation Dialog */}\n      <Dialog open={blockDialogOpen} onOpenChange={setBlockDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>مسدود کردن کاربر</DialogTitle>\n            <DialogDescription>\n              آیا مطمئن هستید که می‌خواهید کاربر {selectedChat?.customerName} ({selectedChat?.customerPhone}) را مسدود کنید؟\n              <br />\n              <span className=\"text-destructive font-medium\">این عمل قابل بازگشت نیست.</span>\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setBlockDialogOpen(false)}\n              disabled={isBlocking}\n            >\n              انصراف\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleBlockUser}\n              disabled={isBlocking}\n            >\n              {isBlocking ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 ml-2 animate-spin\" />\n                  در حال مسدود کردن...\n                </>\n              ) : (\n                <>\n                  <Ban className=\"h-4 w-4 ml-2\" />\n                  مسدود کردن\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </Dialog>\n  );\n}\n"],"names":[],"mappings":"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","ignoreList":[0,5,6,7]}
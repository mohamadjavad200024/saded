module.exports=[15468,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(410),e=a.i(3130),f=a.i(40695),g=a.i(54161),h=a.i(83497),i=a.i(41710),j=a.i(67453),k=a.i(62722),l=a.i(11156),m=a.i(38246),n=a.i(50944),o=a.i(77687),p=a.i(25173),q=a.i(96628);function r(){let{orders:a,loadOrdersFromDB:q,isLoading:r}=(0,d.useOrderStore)(),s=(0,n.useRouter)(),{toast:t}=(0,o.useToast)(),{user:u,isAuthenticated:v,hasCheckedAuth:w}=(0,p.useAuthStore)();(0,c.useEffect)(()=>{w&&v&&u?.id&&(console.log("[Orders Page] Loading orders, user:",{id:u?.id,name:u?.name,phone:u?.phone,isAuthenticated:v,hasCheckedAuth:w}),q().then(()=>{setTimeout(()=>{let a=d.useOrderStore.getState().orders;console.log("[Orders Page] Orders loaded, count:",a.length),a.length>0?console.log("[Orders Page] First order:",{orderNumber:a[0].orderNumber,userId:a[0].userId,customerName:a[0].customerName}):console.log("[Orders Page] ⚠️ No orders found. User:",{id:u?.id,phone:u?.phone})},100)}).catch(a=>{console.error("[Orders Page] Error loading orders:",a),a?.status!==401&&t({title:"خطا",description:"خطا در بارگذاری سفارش‌ها",variant:"destructive"})}))},[w,v,u?.id,q,t]),(0,c.useEffect)(()=>{let a=()=>{"visible"===document.visibilityState&&w&&q()};return document.addEventListener("visibilitychange",a),()=>document.removeEventListener("visibilitychange",a)},[w,q]),(0,c.useEffect)(()=>{if(!w||!v)return;let a=setInterval(()=>{q().catch(a=>{console.error("[Orders Page] Error polling orders:",a)})},3e4);return()=>clearInterval(a)},[w,v,q]);let x=(0,c.useMemo)(()=>{let b=a.filter(a=>"pending"===a.paymentStatus),c=a.filter(a=>"paid"===a.paymentStatus);return{pending:b,paid:c,failed:a.filter(a=>"failed"===a.paymentStatus),cancelled:a.filter(a=>"cancelled"===a.status)}},[a]),y=async a=>{try{let b=localStorage.getItem("checkoutData"),c=localStorage.getItem("pendingOrder");if(!b&&!c)return void t({title:"خطا",description:"اطلاعات سفارش یافت نشد. لطفاً سفارش جدیدی ثبت کنید.",variant:"destructive"});if(c){let b=JSON.parse(c),d=b.total,e=await fetch("/api/payment/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:d,description:`سفارش ${a.items.length} محصول - ${a.orderNumber}`,callbackUrl:`${window.location.origin}/payment/verify`,mobile:a.customerPhone,email:a.customerEmail})}),f=await e.json();if(f.success&&f.paymentUrl){let a={...b,authority:f.authority};localStorage.setItem("pendingOrder",JSON.stringify(a)),window.location.href=f.paymentUrl}else t({title:"خطا",description:f.error||"خطا در اتصال به درگاه پرداخت",variant:"destructive"})}else s.push("/checkout")}catch(a){console.error("Continue payment error:",a),t({title:"خطا",description:"خطایی در پردازش درخواست رخ داد",variant:"destructive"})}};return(0,b.jsx)("div",{className:"container mx-auto px-3 sm:px-4 py-4 sm:py-6 md:py-8 lg:py-12",children:(0,b.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,b.jsx)("div",{className:"flex items-center gap-2 sm:gap-4 mb-4 sm:mb-6",children:(0,b.jsxs)("div",{className:"flex-1 flex items-center gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold",children:"سفارش‌های من"}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5 sm:mt-1 hidden sm:block",children:"مدیریت و پیگیری سفارش‌های خود"})]}),(0,b.jsx)("div",{className:"flex-1 h-0.5 sm:h-1 bg-background dark:bg-foreground"})]})}),x.pending.length>0&&(0,b.jsxs)(e.Card,{className:"mb-4 sm:mb-6 border-yellow-200 dark:border-yellow-800",children:[(0,b.jsx)(e.CardHeader,{className:"bg-yellow-50 dark:bg-yellow-950/20 pb-3 sm:pb-6",children:(0,b.jsxs)(e.CardTitle,{className:"flex items-center gap-2 text-base sm:text-lg",children:[(0,b.jsx)(i.Clock,{className:"h-4 w-4 sm:h-5 sm:w-5 text-yellow-600"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"سفارش‌های در انتظار پرداخت"}),(0,b.jsx)("span",{className:"sm:hidden",children:"در انتظار پرداخت"}),(0,b.jsxs)("span",{className:"text-sm sm:text-base",children:["(",x.pending.length,")"]})]})}),(0,b.jsx)(e.CardContent,{className:"pt-3 sm:pt-6",children:(0,b.jsx)("div",{className:"space-y-3 sm:space-y-4",children:x.pending.map(a=>(0,b.jsx)(e.Card,{className:"border-l-4 border-l-yellow-500",children:(0,b.jsx)(e.CardContent,{className:"pt-3 sm:pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("div",{className:"bg-muted/50 dark:bg-muted/30 rounded-lg p-3 flex items-center justify-between gap-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,b.jsx)(h.Package,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary flex-shrink-0"}),(0,b.jsxs)("p",{className:"font-semibold text-sm sm:text-base truncate font-mono",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"شماره سفارش:"})," ",(0,b.jsx)("span",{className:"text-foreground",children:a.orderNumber})]})]})}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground mt-2",children:new Date(a.createdAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-2 sm:mt-3",children:[(0,b.jsxs)("div",{className:"text-xs sm:text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"مبلغ کل: "}),(0,b.jsxs)("span",{className:"font-bold",children:[(a.total+a.shippingCost).toLocaleString("fa-IR")," تومان"]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(g.Badge,{variant:"outline",className:"bg-yellow-100 text-yellow-800 border-yellow-300 text-xs",children:"در انتظار پرداخت"})})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(f.Button,{onClick:()=>y(a),className:"flex-1 sm:flex-none text-xs sm:text-sm h-9 sm:h-10 bg-gradient-to-r from-black via-purple-600 to-black text-white hover:from-black/90 hover:via-purple-700 hover:to-black/90 border-0",size:"sm",children:[(0,b.jsx)(l.CreditCard,{className:"ml-1.5 sm:ml-2 h-3.5 w-3.5 sm:h-4 sm:w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"ادامه پرداخت"}),(0,b.jsx)("span",{className:"sm:hidden",children:"پرداخت"})]}),(0,b.jsx)(m.default,{href:`/order/track?orderNumber=${a.orderNumber}`,className:"flex-1 sm:flex-none",children:(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",className:"w-full sm:w-auto text-xs sm:text-sm h-9 sm:h-10",children:[(0,b.jsx)(h.Package,{className:"ml-1.5 sm:ml-2 h-3.5 w-3.5 sm:h-4 sm:w-4"}),"جزئیات"]})})]})]})})},a.id))})})]}),x.paid.length>0&&(0,b.jsxs)(e.Card,{className:"mb-4 sm:mb-6",children:[(0,b.jsx)(e.CardHeader,{className:"pb-3 sm:pb-6",children:(0,b.jsxs)(e.CardTitle,{className:"flex items-center gap-2 text-base sm:text-lg",children:[(0,b.jsx)(j.CheckCircle2,{className:"h-4 w-4 sm:h-5 sm:w-5 text-green-600"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"سفارش‌های پرداخت شده"}),(0,b.jsx)("span",{className:"sm:hidden",children:"پرداخت شده"}),(0,b.jsxs)("span",{className:"text-sm sm:text-base",children:["(",x.paid.length,")"]})]})}),(0,b.jsx)(e.CardContent,{className:"pt-3 sm:pt-6",children:(0,b.jsx)("div",{className:"space-y-3 sm:space-y-4",children:x.paid.map(a=>(0,b.jsx)(e.Card,{className:"border-l-4 border-l-green-500",children:(0,b.jsx)(e.CardContent,{className:"pt-3 sm:pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("div",{className:"bg-muted/50 dark:bg-muted/30 rounded-lg p-3 flex items-center justify-between gap-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,b.jsx)(h.Package,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary flex-shrink-0"}),(0,b.jsxs)("p",{className:"font-semibold text-sm sm:text-base truncate font-mono",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"شماره سفارش:"})," ",(0,b.jsx)("span",{className:"text-foreground",children:a.orderNumber})]})]})}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground mt-2",children:new Date(a.createdAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric"})})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-2 sm:mt-3",children:[(0,b.jsxs)("div",{className:"text-xs sm:text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"مبلغ کل: "}),(0,b.jsxs)("span",{className:"font-bold",children:[(a.total+a.shippingCost).toLocaleString("fa-IR")," تومان"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)(g.Badge,{className:"bg-green-100 text-green-800 text-xs",children:"پرداخت شده"}),(0,b.jsxs)(g.Badge,{variant:"outline",className:"text-xs",children:["pending"===a.status&&"در انتظار پردازش","processing"===a.status&&"در حال پردازش","shipped"===a.status&&"ارسال شده","delivered"===a.status&&"تحویل داده شده","cancelled"===a.status&&"لغو شده"]})]})]})]}),(0,b.jsx)(m.default,{href:`/order/track?orderNumber=${a.orderNumber}`,className:"w-full sm:w-auto",children:(0,b.jsxs)(f.Button,{size:"sm",className:`w-full sm:w-auto text-xs sm:text-sm h-9 sm:h-10 text-white border-0 ${"delivered"===a.status?"bg-gradient-to-r from-black via-green-600 to-black hover:from-black/90 hover:via-green-700 hover:to-black/90":"bg-gradient-to-r from-black via-purple-600 to-black hover:from-black/90 hover:via-purple-700 hover:to-black/90"}`,children:[(0,b.jsx)(h.Package,{className:"ml-1.5 sm:ml-2 h-3.5 w-3.5 sm:h-4 sm:w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"پیگیری سفارش"}),(0,b.jsx)("span",{className:"sm:hidden",children:"پیگیری"})]})})]})})},a.id))})})]}),x.failed.length>0&&(0,b.jsxs)(e.Card,{className:"mb-4 sm:mb-6",children:[(0,b.jsx)(e.CardHeader,{className:"pb-3 sm:pb-6",children:(0,b.jsxs)(e.CardTitle,{className:"flex items-center gap-2 text-base sm:text-lg",children:[(0,b.jsx)(k.XCircle,{className:"h-4 w-4 sm:h-5 sm:w-5 text-red-600"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"سفارش‌های ناموفق"}),(0,b.jsx)("span",{className:"sm:hidden",children:"ناموفق"}),(0,b.jsxs)("span",{className:"text-sm sm:text-base",children:["(",x.failed.length,")"]})]})}),(0,b.jsx)(e.CardContent,{className:"pt-3 sm:pt-6",children:(0,b.jsx)("div",{className:"space-y-3 sm:space-y-4",children:x.failed.map(a=>(0,b.jsx)(e.Card,{className:"border-l-4 border-l-red-500",children:(0,b.jsx)(e.CardContent,{className:"pt-3 sm:pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("div",{className:"bg-muted/50 dark:bg-muted/30 rounded-lg p-3 flex items-center justify-between gap-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,b.jsx)(h.Package,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary flex-shrink-0"}),(0,b.jsxs)("p",{className:"font-semibold text-sm sm:text-base truncate font-mono",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"شماره سفارش:"})," ",(0,b.jsx)("span",{className:"text-foreground",children:a.orderNumber})]})]})}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground mt-2",children:new Date(a.createdAt).toLocaleDateString("fa-IR")})]}),(0,b.jsx)(g.Badge,{variant:"destructive",className:"mt-2 text-xs",children:"پرداخت ناموفق"})]}),(0,b.jsxs)(f.Button,{onClick:()=>y(a),size:"sm",className:"w-full sm:w-auto text-xs sm:text-sm h-9 sm:h-10 bg-gradient-to-r from-black via-purple-600 to-black text-white hover:from-black/90 hover:via-purple-700 hover:to-black/90 border-0",children:[(0,b.jsx)(l.CreditCard,{className:"ml-1.5 sm:ml-2 h-3.5 w-3.5 sm:h-4 sm:w-4"}),"تلاش مجدد"]})]})})},a.id))})})]}),x.cancelled.length>0&&(0,b.jsxs)(e.Card,{className:"mb-4 sm:mb-6 border-red-200 dark:border-red-800",children:[(0,b.jsx)(e.CardHeader,{className:"bg-red-50 dark:bg-red-950/20 pb-3 sm:pb-6",children:(0,b.jsxs)(e.CardTitle,{className:"flex items-center gap-2 text-base sm:text-lg",children:[(0,b.jsx)(k.XCircle,{className:"h-4 w-4 sm:h-5 sm:w-5 text-red-600"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"سفارش‌های لغو شده"}),(0,b.jsx)("span",{className:"sm:hidden",children:"لغو شده"}),(0,b.jsxs)("span",{className:"text-sm sm:text-base",children:["(",x.cancelled.length,")"]})]})}),(0,b.jsx)(e.CardContent,{className:"pt-3 sm:pt-6",children:(0,b.jsx)("div",{className:"space-y-3 sm:space-y-4",children:x.cancelled.map(a=>(0,b.jsx)(e.Card,{className:"border-l-4 border-l-red-500",children:(0,b.jsx)(e.CardContent,{className:"pt-3 sm:pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("div",{className:"bg-muted/50 dark:bg-muted/30 rounded-lg p-3 flex items-center justify-between gap-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,b.jsx)(h.Package,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary flex-shrink-0"}),(0,b.jsxs)("p",{className:"font-semibold text-sm sm:text-base truncate font-mono",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"شماره سفارش:"})," ",(0,b.jsx)("span",{className:"text-foreground",children:a.orderNumber})]})]})}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground mt-2",children:new Date(a.createdAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-2 sm:mt-3",children:[(0,b.jsxs)("div",{className:"text-xs sm:text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"مبلغ کل: "}),(0,b.jsxs)("span",{className:"font-bold",children:[(a.total+a.shippingCost).toLocaleString("fa-IR")," تومان"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)(g.Badge,{variant:"destructive",className:"bg-red-100 text-red-800 border-red-300 text-xs",children:"لغو شده"}),"paid"===a.paymentStatus&&(0,b.jsx)(g.Badge,{variant:"outline",className:"bg-green-100 text-green-800 border-green-300 text-xs",children:"پرداخت شده"})]})]})]}),(0,b.jsx)(m.default,{href:`/order/track?orderNumber=${a.orderNumber}`,className:"w-full sm:w-auto",children:(0,b.jsxs)(f.Button,{size:"sm",className:"w-full sm:w-auto text-xs sm:text-sm h-9 sm:h-10 bg-gradient-to-r from-black via-purple-600 to-black text-white hover:from-black/90 hover:via-purple-700 hover:to-black/90 border-0",children:[(0,b.jsx)(h.Package,{className:"ml-1.5 sm:ml-2 h-3.5 w-3.5 sm:h-4 sm:w-4"}),"جزئیات"]})})]})})},a.id))})})]}),0===a.length&&(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardContent,{className:"pt-4 sm:pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 sm:py-12",children:[(0,b.jsx)(h.Package,{className:"h-12 w-12 sm:h-16 sm:w-16 text-muted-foreground mb-3 sm:mb-4"}),(0,b.jsx)("h2",{className:"text-lg sm:text-xl font-bold mb-1.5 sm:mb-2 text-center px-4",children:"شما هنوز سفارشی ثبت نکرده‌اید"}),(0,b.jsx)("p",{className:"text-sm sm:text-base text-muted-foreground text-center mb-4 sm:mb-6 px-4",children:"برای ثبت سفارش جدید، به صفحه محصولات بروید"}),(0,b.jsx)(m.default,{href:"/products",children:(0,b.jsx)(f.Button,{size:"sm",className:"sm:size-lg text-xs sm:text-sm",children:"مشاهده محصولات"})})]})})})]})})}function s(){return(0,b.jsx)(q.ProtectedRoute,{requireAuth:!0,children:(0,b.jsx)(r,{})})}a.s(["default",()=>s])}];

//# sourceMappingURL=app_orders_page_tsx_118043b9._.js.map
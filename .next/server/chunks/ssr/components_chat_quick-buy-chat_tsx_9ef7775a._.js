module.exports=[2342,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(53071),e=a.i(40695),f=a.i(46893),g=a.i(5522),h=a.i(76504),i=a.i(92759),j=a.i(63519),k=a.i(92258),l=a.i(38632),m=a.i(83952),n=a.i(24987),o=a.i(4720),p=a.i(33508),q=a.i(4975),r=a.i(48124);let s=(0,a.i(70106).default)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);var t=a.i(96221),u=a.i(33441),v=a.i(20610),w=a.i(23808),x=a.i(10448),y=a.i(81560),z=a.i(79360),A=a.i(5784),B=a.i(46271),C=a.i(62036),D=a.i(77687),E=a.i(80794),F=a.i(9655),G=a.i(42964),H=a.i(99209),I=a.i(62478),J=a.i(54917);function K({isOpen:a,onOpenChange:K,trigger:L}){let{toast:M}=(0,D.useToast)(),{showNotification:N,requestPermission:O}=(0,E.useNotifications)(),{showMessageNotification:P}=(0,H.usePersistentNotifications)(),{isOnline:Q,lastSeen:R,checkStatus:S}=(0,G.useAdminPresence)({enabled:!0,heartbeatInterval:2e4}),[T,U]=(0,c.useState)([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}]),[V,W]=(0,c.useState)(""),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(null),_=()=>({name:"",phone:"",email:""}),[aa,ab]=(0,c.useState)(_),[ac,ad]=(0,c.useState)("info"),[ae,af]=(0,c.useState)([]),[ag,ah]=(0,c.useState)(!1),[ai,aj]=(0,c.useState)(!1),[ak,al]=(0,c.useState)(0),[am,an]=(0,c.useState)(null),[ao,ap]=(0,c.useState)(null),[aq,ar]=(0,c.useState)(null),[as,at]=(0,c.useState)(null),[au,av]=(0,c.useState)(!1),[aw,ax]=(0,c.useState)(!1),[ay,az]=(0,c.useState)(null),[aA,aB]=(0,c.useState)(!1),[aC,aD]=(0,c.useState)(!1),aE=(0,c.useRef)(null),aF=(0,c.useRef)(null),aG=(0,c.useRef)(null),aH=(0,c.useRef)(null),aI=(0,c.useRef)([]),aJ=(0,c.useRef)(null);(0,c.useRef)({});let aK=(0,c.useRef)(null);(0,c.useRef)(new Set),(0,c.useRef)(new Map),(0,c.useRef)(new Map);let aL=(0,c.useRef)(!1),aM=(0,c.useRef)(null),aN=(0,c.useRef)(null),aO=(0,c.useRef)(null),aP=(0,c.useRef)(null),aQ=(0,c.useRef)(null),aR=(0,c.useRef)(null),aS=(0,c.useRef)(!1),aT=(0,c.useRef)(null),[aU,aV]=(0,c.useState)(!1),aW=(0,c.useCallback)(()=>{if(!aO.current||"chat"!==ac)return void aV(!1);let a=aO.current;aV(a.scrollHeight-a.scrollTop-a.clientHeight>150)},[ac]),aX=(0,c.useCallback)((a=!1)=>{aN.current&&(aN.current.scrollIntoView({behavior:a?"auto":"smooth",block:"end"}),setTimeout(()=>{aV(!1)},300))},[]);(0,c.useEffect)(()=>{let a=aO.current;if(!a||"chat"!==ac)return void aV(!1);let b=()=>{aW()};return a.addEventListener("scroll",b,{passive:!0}),aW(),setTimeout(()=>{aW()},100),()=>{a.removeEventListener("scroll",b)}},[ac,aW,T.length]),(0,c.useEffect)(()=>{if("chat"===ac&&T.length>0&&!aS.current){aS.current=!0;let a=setTimeout(()=>{aX(!0),setTimeout(()=>{aW()},500)},200);return()=>clearTimeout(a)}},[ac,aX,aW]),(0,c.useEffect)(()=>{"chat"!==ac&&(aS.current=!1)},[ac]),(0,c.useEffect)(()=>{if(T.length>0&&"chat"===ac){let a=T[T.length-1];if(a.id===aT.current&&"user"===a.sender){let a=setTimeout(()=>{aX(!1),setTimeout(()=>{aW()},500)},150);return()=>clearTimeout(a)}{let a=setTimeout(()=>{aW()},200);return()=>clearTimeout(a)}}},[T,ac,aX,aW]),(0,c.useEffect)(()=>{},[aa]),(0,c.useEffect)(()=>{},[ay]),(0,c.useEffect)(()=>{if(a){let a=_();a.name&&a.phone?(ab(a),ad("chat"),a1(a,null)):(ad("info"),U([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}]))}else ad("info"),W(""),af([]),ah(!1),aj(!1),al(0),an(null),ap(null),ar(null),aJ.current&&clearInterval(aJ.current),aG.current&&"inactive"!==aG.current.state&&aG.current.stop(),aH.current&&(clearInterval(aH.current),aH.current=null),aB(!1)},[a]);let aY=async()=>{try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(a=>a.stop()),!0}catch(a){return!1}},aZ=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void M({title:"Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯",description:"Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ø¶Ø¨Ø· ØµØ¯Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…Ø±ÙˆØ±Ú¯Ø± Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",variant:"destructive"});let a=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});at(!0);let b=new MediaRecorder(a,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":"audio/webm"});aG.current=b,aI.current=[],b.ondataavailable=a=>{a.data.size>0&&aI.current.push(a.data)},b.onstop=()=>{let c=new Blob(aI.current,{type:b.mimeType||"audio/webm"});an(c);let d=URL.createObjectURL(c);ap(d),a.getTracks().forEach(a=>a.stop())},b.onerror=a=>{J.logger.error("MediaRecorder error:",a),M({title:"Ø®Ø·Ø§ Ø¯Ø± Ø¶Ø¨Ø· ØµØ¯Ø§",description:"Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¶Ø¨Ø· ØµØ¯Ø§ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",variant:"destructive"}),a$()},b.start(),aj(!0),al(0),aJ.current=setInterval(()=>{al(a=>a+1)},1e3),M({title:"Ø¶Ø¨Ø· ØµØ¯Ø§ Ø´Ø±ÙˆØ¹ Ø´Ø¯",description:"Ø¯Ø± Ø­Ø§Ù„ Ø¶Ø¨Ø· Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ..."})}catch(c){J.logger.error("Error starting recording:",c),at(!1);let a="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª.",b="";"NotAllowedError"===c.name||"PermissionDeniedError"===c.name?(a="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø¯ Ø´Ø¯",b="Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø®ÙˆØ¯ØŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯."):"NotFoundError"===c.name||"DevicesNotFoundError"===c.name?(a="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ÛŒØ§ÙØª Ù†Ø´Ø¯",b="Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¨Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø´Ù…Ø§ Ù…ØªØµÙ„ Ø§Ø³Øª."):"NotReadableError"===c.name||"TrackStartError"===c.name?(a="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª",b="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ØªÙˆØ³Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ Ø¨Ø¨Ù†Ø¯ÛŒØ¯."):"OverconstrainedError"===c.name||"ConstraintNotSatisfiedError"===c.name?(a="ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯",b="Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯."):b="Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯ ÛŒØ§ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.",M({title:a,description:b,variant:"destructive",duration:5e3}),("NotAllowedError"===c.name||"PermissionDeniedError"===c.name)&&av(!0)}},a$=()=>{if(aG.current&&"inactive"!==aG.current.state)try{aG.current.stop(),aj(!1),aJ.current&&clearInterval(aJ.current),M({title:"Ø¶Ø¨Ø· ØµØ¯Ø§ Ù…ØªÙˆÙ‚Ù Ø´Ø¯",description:"Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ Ø´Ù…Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§ Ù„ØºÙˆ Ú©Ù†ÛŒØ¯."})}catch(a){J.logger.error("Error stopping recording:",a),M({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± ØªÙˆÙ‚Ù Ø¶Ø¨Ø· Ø±Ø® Ø¯Ø§Ø¯.",variant:"destructive"})}},a_=async()=>{if(am&&ao)try{let a="webm",b=am.type||"audio/webm";b.includes("mp4")||b.includes("m4a")?a="m4a":b.includes("ogg")?a="ogg":b.includes("wav")?a="wav":b.includes("webm")&&(a="webm");let c=new File([am],`audio-${Date.now()}.${a}`,{type:b}),d=await ba(c,"audio"),e={id:Date.now().toString(),type:"audio",url:d,name:`Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ ${a0(ak)}`,size:am.size,duration:ak};af(a=>[...a,e]),an(null),ao&&URL.revokeObjectURL(ao),ap(null),al(0)}catch(a){}},a0=a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`},a1=async(a,b)=>{try{let c="/api/chat?";b?c+=`chatId=${b}`:(c+=`customerPhone=${encodeURIComponent(a.phone)}`,a.name&&(c+=`&customerName=${encodeURIComponent(a.name)}`));let d=await fetch(c);if(!d.ok)throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª");let e=await d.json();if(e.success&&e.data){let{chat:b,messages:c}=e.data;if(b&&c&&c.length>0){az(b.id);let a=c.map(a=>{let b=[];if(a.attachments){if(Array.isArray(a.attachments))b=a.attachments.map(a=>{let b=a.url||a.fileUrl||a.filePath,c=a.type;return!c&&b&&(b.includes("/image-")||b.includes("image-")?c="image":(b.includes("/audio-")||b.includes("audio-"))&&(c="audio")),{id:a.id||`att-${Date.now()}-${Math.random()}`,type:c||a.type||"file",url:b,name:a.name||a.fileName,size:a.size||a.fileSize,duration:a.duration}});else if("string"==typeof a.attachments)try{let c=JSON.parse(a.attachments);Array.isArray(c)&&(b=c.map(a=>{let b=a.url||a.fileUrl||a.filePath,c=a.type;return!c&&b&&(b.includes("/image-")||b.includes("image-")?c="image":(b.includes("/audio-")||b.includes("audio-"))&&(c="audio")),{id:a.id||`att-${Date.now()}-${Math.random()}`,type:c||a.type||"file",url:b,name:a.name||a.fileName,size:a.size||a.fileSize,duration:a.duration}}))}catch(a){J.logger.error("Error parsing attachments JSON:",a)}}let c=b.filter(a=>{let b=a.url;return b&&!b.startsWith("blob:")&&!b.startsWith("data:")&&(b.startsWith("http")||b.startsWith("/"))});return b.length>0&&J.logger.debug(`Loaded message ${a.id} has ${c.length} valid attachment(s) out of ${b.length} total:`,c.map(a=>({id:a.id,type:a.type,url:a.url,name:a.name,hasUrl:!!a.url}))),{id:a.id,text:a.text||"",sender:a.sender,timestamp:new Date(a.createdAt),attachments:c.length>0?c:void 0,status:"user"===a.sender?a.status||"sent":void 0}}),d=a.map(a=>"user"!==a.sender||a.status?a:{...a,status:"sent"});(U(d),a.length>0)?(aK.current=a[a.length-1].id,d.some(a=>"support"===a.sender&&"1"!==a.id)?aL.current=!0:aL.current=!1):aL.current=!1,ad("chat")}else ad("chat"),U([{id:"1",text:`Ø³Ù„Ø§Ù… ${a.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),aL.current=!1}else ad("chat"),U([{id:"1",text:`Ø³Ù„Ø§Ù… ${a.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),aL.current=!1}catch(b){J.logger.error("Error loading chat history:",b),ad("chat"),U([{id:"1",text:`Ø³Ù„Ø§Ù… ${a.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),aL.current=!1}},a2=async()=>{if(ay)try{await fetch("/api/chat/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ay,sender:"user",action:"delivered"})})}catch(a){J.logger.error("Error marking messages as delivered:",a)}},a3=async()=>{if(ay)try{await fetch("/api/chat/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ay,sender:"user",action:"read"})})}catch(a){J.logger.error("Error marking messages as read:",a)}},a4=async()=>{if(ay&&a&&"chat"===ac)try{aB(!0);let a=aK.current,b=`/api/chat?chatId=${ay}`;a&&"1"!==a&&(b+=`&lastMessageId=${a}`);let c=await fetch(b);if(!c.ok)throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯");let d=await c.json();if(d.success&&d.data?.messages&&Array.isArray(d.data.messages)){let a=d.data.messages;a.length>0&&(a2(),setTimeout(()=>{a3()},1e3));let b=a.map(a=>{let b=[];a.attachments&&Array.isArray(a.attachments)&&(b=a.attachments.map(a=>{let b=a.url||a.fileUrl||a.filePath,c=a.type;return!c&&b&&(b.includes("/image-")||b.includes("image-")?c="image":(b.includes("/audio-")||b.includes("audio-"))&&(c="audio")),{id:a.id||`att-${Date.now()}-${Math.random()}`,type:c||a.type||"file",url:b,name:a.name||a.fileName,size:a.size||a.fileSize,duration:a.duration}}));let c=b.filter(a=>{let b=a.url;return b&&!b.startsWith("blob:")&&!b.startsWith("data:")&&(b.startsWith("http")||b.startsWith("/"))});return{id:a.id,text:a.text||"",sender:a.sender,timestamp:new Date(a.createdAt),attachments:c.length>0?c:void 0,status:"user"===a.sender?a.status||"sent":void 0}});U(a=>{let c=new Set(a.map(a=>a.id)),d=b.filter(a=>!c.has(a.id)),e=a.filter(a=>!a.id.startsWith("system-")).map(a=>{let c=b.find(b=>b.id===a.id);return c&&"user"===a.sender&&c.status&&a.status!==c.status?{...a,status:c.status}:a});if(d.length>0){let a=d.some(a=>"support"===a.sender),b=e;a&&aM.current&&(b=e.filter(a=>a.id!==aM.current),aM.current=null,aL.current=!0);let c=[...b,...d],f=c[c.length-1];return f&&(aK.current=f.id),c}return e})}}catch(a){J.logger.error("Error polling for new messages:",a)}finally{aB(!1)}},a5=async()=>{if(ay)try{let a=await fetch(`/api/chat/typing?chatId=${ay}&sender=support`);if(a.ok){let b=await a.json();b.success&&aD(b.data.isTyping||!1)}}catch(a){J.logger.error("Error checking typing status:",a)}},a6=async a=>{if(ay)try{await fetch("/api/chat/typing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ay,sender:"user",isTyping:a})})}catch(a){J.logger.error("Error sending typing status:",a)}};(0,c.useEffect)(()=>{O()},[]),(0,c.useEffect)(()=>{let b=b=>{let{chatId:c,isAdmin:d}=b.detail;(!1===d||void 0===d)&&(a||K(!0),"chat"!==ac&&ad("chat"))};return window.addEventListener("openChat",b),()=>{window.removeEventListener("openChat",b)}},[a,K,ay,ac,a4]),(0,c.useEffect)(()=>{if(a&&"chat"===ac&&ay){a2();let a=setTimeout(()=>{a3()},2e3);return a5(),aF.current=setInterval(()=>{a5()},3e3),aH.current=setInterval(()=>{a4(),a2()},5e3),a4(),S(),()=>{aH.current&&(clearInterval(aH.current),aH.current=null),aF.current&&(clearInterval(aF.current),aF.current=null),aE.current&&(clearTimeout(aE.current),aE.current=null),clearTimeout(a),a6(!1)}}},[a,ac,ay,S]);let a7=async(a=!0,b=0)=>{if(0!==T.length)try{ax(!0);let b=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ay||void 0,customerInfo:aa,messages:T.map(a=>({id:a.id,text:a.text,sender:a.sender,timestamp:a.timestamp.toISOString(),attachments:a.attachments?a.attachments.filter(a=>{let b=a.url;return b&&!b.startsWith("blob:")&&!b.startsWith("data:")&&(b.startsWith("http")||b.startsWith("/"))}):[]}))})});if(!b.ok){let a=await b.json().catch(()=>({error:"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ú†Øª"}));throw Error(a.error||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ú†Øª")}let c=await b.json();c.data.chatId&&az(c.data.chatId),a&&M({title:"Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",description:"Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯"})}catch(c){if(J.logger.error("Error saving chat:",c),b<3&&(c.message?.includes("fetch")||c.message?.includes("network")||c.message?.includes("timeout")||"NETWORK_ERROR"===c.code)){let c=1e3*Math.pow(2,b);J.logger.debug(`Retrying save in ${c}ms (attempt ${b+1}/3)`),setTimeout(()=>{a7(a,b+1)},c);return}a&&M({title:"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡",description:c.message||"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯",variant:"destructive"})}finally{0===b&&ax(!1)}},a8=async a=>{try{if((await fetch(`/api/chat/message/${a}`,{method:"DELETE"})).ok)U(b=>b.filter(b=>b.id!==a)),M({title:"Ù…ÙˆÙÙ‚",description:"Ù¾ÛŒØ§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯"});else throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…")}catch(a){J.logger.error("Error deleting message:",a),M({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…",variant:"destructive"})}},a9=async()=>{if(!V.trim()&&0===ae.length)return;if(Z){try{(await fetch(`/api/chat/message/${Z.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:V,attachments:ae})})).ok&&(U(a=>a.map(a=>a.id===Z.id?{...a,text:V,attachments:ae}:a)),$(null),W(""),af([]),M({title:"Ù…ÙˆÙÙ‚",description:"Ù¾ÛŒØ§Ù… ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯"}))}catch(a){J.logger.error("Error editing message:",a),M({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…",variant:"destructive"})}return}let b=ae.filter(a=>{let b=a.url;return b&&!b.startsWith("blob:")&&!b.startsWith("data:")&&(b.startsWith("http")||b.startsWith("/"))});if(!V.trim()&&0===b.length)return void M({title:"Ø®Ø·Ø§",description:"Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù¾ÛŒØ§Ù… ÛŒØ§ ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯",variant:"destructive"});let c=V;X&&(c=`Ø¯Ø± Ù¾Ø§Ø³Ø® Ø¨Ù‡: ${X.text}

${V}`);let d={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,text:c,sender:"user",timestamp:new Date,attachments:b.length>0?b:void 0,status:"sending"};U(a=>{let b=[...a,d];return aK.current=d.id,aT.current=d.id,b}),setTimeout(()=>{aX(!1)},150);let e=[...ae];W(""),af([]),ah(!1),Y(null);try{ax(!0);let b=[...T,d].map(a=>({id:a.id,text:a.text,sender:a.sender,timestamp:a.timestamp.toISOString(),status:a.id===d.id?"sent":a.status||("user"===a.sender?"sent":void 0),attachments:a.attachments?a.attachments.filter(a=>{let b=a.url;return b&&!b.startsWith("blob:")&&!b.startsWith("data:")&&(b.startsWith("http")||b.startsWith("/"))}):[]}));d.attachments&&d.attachments.length>0&&J.logger.debug(`ğŸ“¤ Sending new message with ${d.attachments.length} attachment(s):`,d.attachments.map(a=>({id:a.id,type:a.type,url:a.url,name:a.name})));let c=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ay||void 0,customerInfo:aa,messages:b})});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(a.message||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…")}let e=await c.json();e.data?.chatId&&az(e.data.chatId);let f=e.data?.messages?.find(a=>a.id===d.id),g=f?.status||"sent";U(a=>a.map(a=>a.id===d.id?{...a,status:g}:a));try{let b=await fetch("/api/admin/presence");if(b.ok){let c=await b.json();c.success&&c.data?.admins&&(Array.isArray(c.data.admins)&&c.data.admins.length>0||P("Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ","Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¢Ù†Ù„Ø§ÛŒÙ† Ù†ÛŒØ³Øª. Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡ Ùˆ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",{onOpen:()=>{a||K(!0)},chatId:ay||void 0,metadata:{isAdminOffline:!0,isAdmin:!1}}))}}catch(a){J.logger.error("Error checking admin status:",a)}}catch(a){J.logger.error("Error saving message:",a),U(a=>a.map(a=>a.id===d.id?{...a,status:"sent"}:a)),W(c),af(e),M({title:"Ø®Ø·Ø§",description:a.message||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",variant:"destructive"})}finally{ax(!1)}aL.current||setTimeout(async()=>{let a=`system-${Date.now()}`;aM.current=a,aL.current=!0;let b={id:a,text:"Ù…ØªØ´Ú©Ø±Ù…! Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯. Ù‡Ù…Ú©Ø§Ø±Ø§Ù† Ù…Ø§ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¨Ø§ Ø´Ù…Ø§ ØªÙ…Ø§Ø³ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ú¯Ø±ÙØª.",sender:"support",timestamp:new Date};U(a=>[...a,b])},1e3)},ba=async(a,b,c=0)=>{try{let c=new FormData;c.append("file",a),c.append("type",b);let d=await fetch("/api/chat/upload",{method:"POST",body:c});if(!d.ok){let a=await d.json().catch(()=>({error:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„"}));throw Error(a.error||"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„")}return(await d.json()).data.url}catch(d){if(J.logger.error("Error uploading file:",d),c<3&&(d.message?.includes("fetch")||d.message?.includes("network")||d.message?.includes("timeout")||"NETWORK_ERROR"===d.code||"TypeError"===d.name)){let d=2e3*Math.pow(2,c);return J.logger.debug(`Retrying file upload in ${d}ms (attempt ${c+1}/3)`),0===c&&M({title:"Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...",description:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„. Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...",duration:2e3}),await new Promise(a=>setTimeout(a,d)),ba(a,b,c+1)}throw M({title:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„",description:d.message||"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯",variant:"destructive"}),d}},bb=async(a,b)=>{let c=a.target.files;if(c&&0!==c.length){for(let a of Array.from(c))try{let c=await ba(a,b),d={id:Date.now().toString()+Math.random(),type:b,name:a.name,size:a.size,url:c};af(a=>[...a,d])}catch(a){}a.target.value=""}},bc=async()=>{if(!aa.name||!aa.phone)return;aL.current=!1,aM.current=null,ad("chat");let a={id:Date.now().toString(),text:`Ø³Ù„Ø§Ù… ${aa.name}! Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date};U(b=>[...b,a]),await a7(!1)};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{"data-chat-open":a&&"chat"===ac?"true":"false",style:{display:"none"}}),(0,b.jsxs)(d.Sheet,{open:a,onOpenChange:K,children:[L&&(0,b.jsx)(d.SheetTrigger,{asChild:!0,children:L}),(0,b.jsx)(d.SheetContent,{side:"left",className:"w-full sm:w-[420px] md:w-[480px] p-0 flex flex-col border-l-2 border-border/40 bg-background shadow-2xl",children:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.SheetHeader,{className:"px-4 sm:px-6 py-2 border-b border-border/40",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsxs)(d.SheetTitle,{className:"text-base font-semibold text-foreground flex items-center gap-2",children:["Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹","chat"===ac&&(0,b.jsx)(F.OnlineStatusBadge,{isOnline:Q,lastSeen:R,showText:!1})]})}),"chat"===ac&&aa.name&&aa.phone&&(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{ad("info"),U([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}])},className:"h-8 w-8 rounded-lg hover:bg-primary/10 transition-colors",title:"ØªØºÛŒÛŒØ± Ø§Ø·Ù„Ø§Ø¹Ø§Øª",children:(0,b.jsxs)("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})}),"info"===ac?(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 sm:p-8 space-y-6 bg-gradient-to-b from-background via-background to-muted/10",children:[(0,b.jsxs)(B.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-center pb-2",children:[(0,b.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 mb-3 shadow-lg",children:(0,b.jsxs)("svg",{className:"h-8 w-8 text-primary",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M8 10h.01M12 10h.01M16 10h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"})]}),(0,b.jsxs)(B.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-5",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,b.jsxs)("svg",{className:"h-4 w-4 text-primary",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ",(0,b.jsx)("span",{className:"text-destructive text-xs",children:"*"})]}),(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)(g.Input,{type:"text",placeholder:"Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ",value:aa.name,onChange:a=>ab({...aa,name:a.target.value}),className:"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"}),(0,b.jsx)("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,b.jsxs)("svg",{className:"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,b.jsx)(j.Phone,{className:"h-4 w-4 text-primary"}),"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³",(0,b.jsx)("span",{className:"text-destructive text-xs",children:"*"})]}),(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)(g.Input,{type:"tel",placeholder:"09123456789",value:aa.phone,onChange:a=>ab({...aa,phone:a.target.value}),className:"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"}),(0,b.jsx)("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,b.jsx)(j.Phone,{className:"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors"})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,b.jsx)(k.Mail,{className:"h-4 w-4 text-primary"}),"Ø§ÛŒÙ…ÛŒÙ„",(0,b.jsx)("span",{className:"text-xs text-muted-foreground font-normal",children:"(Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"})]}),(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)(g.Input,{type:"email",placeholder:"example@email.com",value:aa.email,onChange:a=>ab({...aa,email:a.target.value}),className:"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"}),(0,b.jsx)("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,b.jsx)(k.Mail,{className:"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors"})})]})]})]}),(0,b.jsxs)(B.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"pt-2",children:[(0,b.jsx)(e.Button,{onClick:bc,disabled:!aa.name||!aa.phone,className:"w-full h-13 text-base font-semibold bg-gradient-to-r from-primary via-primary to-primary/90 hover:from-primary/90 hover:via-primary/80 hover:to-primary/70 shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 transition-all duration-300 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed rounded-xl",children:(0,b.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["Ø§Ø¯Ø§Ù…Ù‡",(0,b.jsx)(B.motion.div,{animate:{x:[0,4,0]},transition:{repeat:1/0,duration:1.5,delay:.5},children:"â†’"})]})}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground text-center mt-3",children:"Ø¨Ø§ Ø§Ø¯Ø§Ù…Ù‡ØŒ Ø´Ù…Ø§ Ø´Ø±Ø§ÛŒØ· Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ù…Ø§ Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒØ¯"})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{ref:aO,className:"flex-1 overflow-y-auto p-5 sm:p-6 md:p-8 space-y-5 sm:space-y-6 bg-gradient-to-b from-background via-background/95 to-muted/5 scroll-smooth",children:[0===T.length&&(0,b.jsxs)(B.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center h-full min-h-[200px] text-center px-4",children:[(0,b.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mb-4 shadow-lg",children:(0,b.jsxs)("svg",{className:"h-10 w-10 text-primary/60",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M8 10h.01M12 10h.01M16 10h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,b.jsx)("p",{className:"text-muted-foreground text-base font-medium leading-relaxed",children:"Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"}),(0,b.jsx)("p",{className:"text-muted-foreground/70 text-sm mt-2 leading-relaxed",children:"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."})]}),T.map((a,c)=>(0,b.jsx)(B.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},className:`flex ${"user"===a.sender?"justify-end":"justify-start"} items-end gap-2 group`,children:(0,b.jsxs)("div",{className:`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${"user"===a.sender?"bg-primary text-primary-foreground":"bg-muted text-foreground border border-border/40"}`,children:[a.text&&(0,b.jsx)("p",{className:"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5",children:a.text}),a.attachments&&a.attachments.length>0&&(0,b.jsx)("div",{className:`space-y-2 ${a.text?"mt-2":""}`,children:a.attachments.map((a,d)=>(0,b.jsxs)(B.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*d},className:"rounded-xl overflow-hidden",children:["image"===a.type&&a.url&&(0,b.jsx)("img",{src:a.url,alt:a.name||"ØªØµÙˆÛŒØ±",className:"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all",onClick:()=>window.open(a.url,"_blank"),onError:b=>{J.logger.error("Image load error:",a.url),b.target.style.display="none"}}),"file"===a.type&&(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",download:a.name,className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,b.jsx)(o.FileText,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"font-medium truncate",children:a.name||"ÙØ§ÛŒÙ„"})]}),"location"===a.type&&(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,b.jsx)(n.MapPin,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"font-medium",children:a.name||"Ù…ÙˆÙ‚Ø¹ÛŒØª"})]}),"audio"===a.type&&a.url&&(0,b.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-background/50 rounded",children:[(0,b.jsx)(q.Mic,{className:"h-3.5 w-3.5"}),(0,b.jsx)("audio",{controls:!0,className:"flex-1 h-7 text-xs",children:(0,b.jsx)("source",{src:a.url})})]})]},a.id||`att-${c}-${d}`))}),(0,b.jsxs)("div",{className:`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${"user"===a.sender?"border-primary-foreground/20 justify-end":"border-border/30 justify-start"}`,children:[(0,b.jsx)("span",{className:`text-[10px] sm:text-xs ${"user"===a.sender?"text-primary-foreground/70":"text-muted-foreground"}`,children:new Date(a.timestamp).toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}),"user"===a.sender&&(0,b.jsxs)(b.Fragment,{children:["sending"===a.status&&(0,b.jsx)(t.Loader2,{className:"h-3 w-3 text-primary-foreground/50 animate-spin"}),"sent"===a.status&&(0,b.jsx)(u.Check,{className:"h-3 w-3 text-primary-foreground/40"}),"delivered"===a.status&&(0,b.jsx)(v.CheckCheck,{className:"h-3 w-3 text-primary-foreground/40"}),"read"===a.status&&(0,b.jsx)(v.CheckCheck,{className:"h-3 w-3 text-primary-foreground/70"}),!a.status&&(0,b.jsx)(u.Check,{className:"h-3 w-3 text-primary-foreground/40"})]}),(0,b.jsx)("div",{className:"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsxs)(h.DropdownMenu,{children:[(0,b.jsx)(h.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-background/20",onClick:a=>{a.stopPropagation()},title:"Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±",children:(0,b.jsx)(z.MoreVertical,{className:"h-3.5 w-3.5"})})}),(0,b.jsxs)(h.DropdownMenuContent,{align:"user"===a.sender?"end":"start",className:"min-w-[140px]",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)(h.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),Y(a),$(null)},className:"cursor-pointer",children:[(0,b.jsx)(w.Reply,{className:"h-4 w-4 ml-2"}),(0,b.jsx)("span",{children:"Ù¾Ø§Ø³Ø®"})]}),"user"===a.sender&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.DropdownMenuSeparator,{}),(0,b.jsxs)(h.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),$(a),Y(null),W(a.text||"")},className:"cursor-pointer",children:[(0,b.jsx)(x.Edit2,{className:"h-4 w-4 ml-2"}),(0,b.jsx)("span",{children:"ÙˆÛŒØ±Ø§ÛŒØ´"})]})]}),(0,b.jsx)(h.DropdownMenuSeparator,{}),(0,b.jsxs)(h.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ")&&a8(a.id)},className:"cursor-pointer text-destructive focus:text-destructive focus:bg-destructive/10",children:[(0,b.jsx)(y.Trash2,{className:"h-4 w-4 ml-2"}),(0,b.jsx)("span",{children:"Ø­Ø°Ù"})]})]})]})})]})]})},a.id)),aC&&(0,b.jsx)(B.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"flex justify-start items-end gap-2.5",children:(0,b.jsx)(I.TypingIndicator,{})}),(0,b.jsx)("div",{ref:aN})]}),(0,b.jsxs)("div",{className:"border-t border-border/40 bg-background p-2 sm:p-3 space-y-2 relative",children:[(0,b.jsx)(C.AnimatePresence,{children:aU&&(0,b.jsx)(B.motion.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-10",children:(0,b.jsx)(e.Button,{onClick:()=>aX(!1),size:"icon",className:"h-9 w-9 rounded-full shadow-lg hover:shadow-xl bg-primary text-primary-foreground hover:bg-primary/90 transition-all",title:"Ø¨Ø±Ùˆ Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…",children:(0,b.jsx)(A.ChevronDown,{className:"h-4 w-4"})})})}),au&&(0,b.jsx)(B.motion.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},className:"p-3 bg-destructive/5 border-2 border-destructive/20 rounded-xl shadow-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(q.Mic,{className:"h-3.5 w-3.5 text-destructive mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-destructive mb-1.5 leading-tight",children:"Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù†ÛŒØ§Ø² Ø§Ø³Øª"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯"})]}),(0,b.jsx)("button",{onClick:()=>av(!1),className:"p-0.5 rounded hover:bg-destructive/10 transition-colors flex-shrink-0",children:(0,b.jsx)(p.X,{className:"h-3 w-3 text-destructive"})})]})}),(ai||ao)&&(0,b.jsx)(B.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"flex items-center gap-2 p-2 bg-destructive/10 border border-destructive/30 rounded-lg",children:ai?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B.motion.div,{animate:{scale:[1,1.1,1]},transition:{repeat:1/0,duration:1},className:"p-1.5 rounded-full bg-destructive/20",children:(0,b.jsx)(q.Mic,{className:"h-3.5 w-3.5 text-destructive"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-destructive leading-tight",children:"Ø¯Ø± Ø­Ø§Ù„ Ø¶Ø¨Ø·"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:a0(ak)})]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:a$,className:"h-7 w-7 text-destructive hover:bg-destructive/10 rounded-lg",children:(0,b.jsx)(r.Square,{className:"h-3 w-3 fill-current"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"p-1.5 rounded-full bg-primary/20",children:(0,b.jsx)(q.Mic,{className:"h-3.5 w-3.5 text-primary"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-xs font-medium leading-tight",children:"Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:a0(ak)})]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{a$(),an(null),ao&&(URL.revokeObjectURL(ao),ap(null)),al(0)},className:"h-7 w-7 text-muted-foreground hover:text-destructive rounded-lg",children:(0,b.jsx)(p.X,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(e.Button,{onClick:a_,size:"sm",className:"h-7 px-3 text-xs rounded-lg",children:"Ø°Ø®ÛŒØ±Ù‡"})]})}),ag&&(0,b.jsxs)(B.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"flex gap-2 p-2 bg-card rounded-lg border border-border/50 shadow-lg",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{aR.current?.click(),ah(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,b.jsx)(l.Image,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{aQ.current?.click(),ah(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,b.jsx)(o.FileText,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{let b={id:Date.now().toString(),type:"location",url:`https://www.google.com/maps?q=${a.coords.latitude},${a.coords.longitude}`,name:"Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ"};af(a=>[...a,b]),ah(!1)},a=>{J.logger.error("Error getting location:",a),alert("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ")}):alert("Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯"),ah(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,b.jsx)(n.MapPin,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:async()=>{ah(!1),ai?a$():(await aY()||M({title:"Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†",description:"Ø¨Ø±Ø§ÛŒ Ø¶Ø¨Ø· ØµØ¯Ø§ØŒ Ù„Ø·ÙØ§Ù‹ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.",variant:"destructive",duration:5e3}),aZ())},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",disabled:ai,children:ai?(0,b.jsx)(s,{className:"h-3.5 w-3.5 text-destructive"}):(0,b.jsx)(q.Mic,{className:"h-3.5 w-3.5"})})]}),(0,b.jsx)("input",{ref:aR,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:a=>bb(a,"image")}),(0,b.jsx)("input",{ref:aQ,type:"file",multiple:!0,className:"hidden",onChange:a=>bb(a,"file")}),(0,b.jsx)("div",{className:"flex items-end gap-2",children:(0,b.jsxs)("div",{className:"flex-1 relative",children:[ae.length>0&&(0,b.jsx)("div",{className:"absolute top-2 right-2 left-2 z-10 pointer-events-none overflow-hidden",children:(0,b.jsx)("div",{className:"overflow-x-auto overflow-y-hidden scroll-smooth w-full [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:(0,b.jsx)("div",{className:"flex items-center gap-1.5 flex-nowrap",children:ae.map(a=>(0,b.jsxs)("div",{className:"relative group pointer-events-auto flex-shrink-0 w-auto",children:[(0,b.jsxs)("div",{className:"bg-card/95 backdrop-blur-sm rounded-md p-1 border border-border/40 shadow-sm",children:["image"===a.type&&a.url&&(0,b.jsx)("img",{src:a.url,alt:a.name||"ØªØµÙˆÛŒØ±",className:"w-10 h-10 object-cover rounded"}),"file"===a.type&&(0,b.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,b.jsx)(o.FileText,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,b.jsx)("p",{className:"text-[10px] truncate max-w-[50px] font-medium leading-tight",children:a.name})]}),"location"===a.type&&(0,b.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,b.jsx)(n.MapPin,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,b.jsx)("span",{className:"text-[10px] font-medium whitespace-nowrap leading-tight",children:"Ù…ÙˆÙ‚Ø¹ÛŒØª"})]}),"audio"===a.type&&(0,b.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,b.jsx)(q.Mic,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,b.jsx)("span",{className:"text-[10px] font-medium whitespace-nowrap leading-tight",children:a.duration?a0(a.duration):"ØµØ¯Ø§"})]})]}),(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void af(a=>{let c=a.find(a=>a.id===b);return c?.url&&URL.revokeObjectURL(c.url),a.filter(a=>a.id!==b)})},className:"absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-20 hover:scale-110",children:(0,b.jsx)(p.X,{className:"h-2.5 w-2.5"})})]},a.id))})})}),(0,b.jsx)(f.Textarea,{ref:aP,value:V,onChange:a=>{W(a.target.value),aE.current&&clearTimeout(aE.current),a.target.value.trim().length>0?(a6(!0),aE.current=setTimeout(()=>{a6(!1)},2e3)):a6(!1)},onKeyDown:a=>{"Enter"===a.key&&!a.shiftKey&&(a.preventDefault(),aE.current&&clearTimeout(aE.current),a6(!1),(V.trim()||ae.length>0)&&a9())},placeholder:"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...",className:`min-h-[44px] max-h-[100px] resize-none text-sm leading-relaxed rounded-lg border pr-20 pl-3 py-2 ${ae.length>0?"pt-12":""}`}),(0,b.jsxs)("div",{className:"absolute bottom-2 right-2 flex items-center gap-1",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>ah(!ag),className:`h-7 w-7 rounded-lg transition-all ${ag?"bg-primary/10 text-primary":"hover:bg-muted/60 text-muted-foreground hover:text-foreground"}`,children:(0,b.jsx)(m.Paperclip,{className:"h-4 w-4"})}),(V.trim()||ae.length>0)&&!ai&&(0,b.jsx)(b.Fragment,{children:aw?(0,b.jsx)(t.Loader2,{className:"h-4 w-4 text-primary animate-spin"}):(0,b.jsx)(e.Button,{onClick:a9,size:"icon",className:"h-7 w-7 rounded-lg transition-all",children:(0,b.jsx)(i.Send,{className:"h-3.5 w-3.5"})})})]})]})})]})]})]})})]})]})}a.s(["QuickBuyChat",()=>K],2342)}];

//# sourceMappingURL=components_chat_quick-buy-chat_tsx_9ef7775a._.js.map
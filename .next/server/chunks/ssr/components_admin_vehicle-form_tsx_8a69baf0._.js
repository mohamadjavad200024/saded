module.exports=[71472,a=>{"use strict";var b=a.i(87924),c=a.i(95245),d=a.i(59501),e=a.i(99614),f=a.i(40695),g=a.i(5522),h=a.i(17171),i=a.i(80281),j=a.i(3130),k=a.i(21366),l=a.i(77687),m=a.i(50944),n=a.i(72131),o=a.i(96221),p=a.i(48464),q=a.i(15618),r=a.i(33508),s=a.i(37927),t=a.i(73320),u=a.i(38632),v=a.i(32336),w=a.i(97895);function x({image:a,onChange:c,className:d,label:e="لوگو"}){let[g,h]=(0,n.useState)(!1),i=(0,n.useRef)(null),{toast:j}=(0,l.useToast)(),k=async a=>{let b=a.target.files?.[0];if(b){if(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:27",message:"File selected",data:{fileName:b.name,fileSize:b.size,fileType:b.type},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{}),!b.type.startsWith("image/"))return void j({title:"خطا",description:"فقط فایل‌های تصویری مجاز هستند",variant:"destructive"});if(b.size>5242880)return void j({title:"خطا",description:"حجم فایل نباید بیشتر از 5 مگابایت باشد",variant:"destructive"});h(!0);try{let a=await new Promise((a,c)=>{let d=new FileReader;d.onload=b=>{let d=new Image;d.onload=()=>{fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:60",message:"Image loaded for compression",data:{originalWidth:d.width,originalHeight:d.height},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{});let b=document.createElement("canvas"),e=b.getContext("2d");if(!e)return void c(Error("Could not get canvas context"));let f=d.width,g=d.height;(f>800||g>800)&&(f>g?(g=g/f*800,f=800):(f=f/g*800,g=800)),b.width=f,b.height=g,e.drawImage(d,0,0,f,g);let h=b.toDataURL("image/jpeg",.85);if(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:90",message:"First compression done",data:{compressedWidth:f,compressedHeight:g,base64Length:h.length,isTooLarge:h.length>1048576},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{}),h.length>1048576){let c=b.toDataURL("image/jpeg",.7);fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:94",message:"Second compression done",data:{finalBase64Length:c.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{}),a(c)}else a(h)},d.onerror=()=>c(Error("Failed to load image")),d.src=b.target?.result},d.onerror=()=>c(Error("Failed to read file")),d.readAsDataURL(b)});fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:108",message:"Compression complete, calling onChange",data:{finalLength:a.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{}),c(a),h(!1),j({title:"موفق",description:"تصویر با موفقیت آپلود شد"})}catch(a){fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:115",message:"Compression error",data:{error:a instanceof Error?a.message:String(a)},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{}),h(!1),j({title:"خطا",description:a instanceof Error?a.message:"خطا در آپلود تصویر",variant:"destructive"})}}};return(0,b.jsxs)("div",{className:(0,w.cn)("space-y-2",d),children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:e}),(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[a?(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)("div",{className:"w-24 h-24 rounded-lg border-2 border-border overflow-hidden bg-muted flex items-center justify-center",children:(0,b.jsx)(v.SafeImage,{src:a,alt:e,className:"w-full h-full object-contain",fallback:(0,b.jsx)(u.Image,{className:"h-8 w-8 text-muted-foreground"})})}),(0,b.jsx)(f.Button,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{c(null),i.current&&(i.current.value="")},children:(0,b.jsx)(r.X,{className:"h-3 w-3"})})]}):(0,b.jsx)("div",{className:"w-24 h-24 rounded-lg border-2 border-dashed border-border flex items-center justify-center bg-muted/30",children:(0,b.jsx)(u.Image,{className:"h-8 w-8 text-muted-foreground"})}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>i.current?.click(),disabled:g,className:"w-full",children:g?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.Loader2,{className:"ml-2 h-4 w-4 animate-spin"}),"در حال آپلود..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.Upload,{className:"ml-2 h-4 w-4"}),a?"تغییر لوگو":"آپلود لوگو"]})}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"فرمت‌های مجاز: JPG, PNG, GIF (حداکثر 5MB)"})]})]}),(0,b.jsx)("input",{ref:i,type:"file",accept:"image/*",onChange:k,className:"hidden"})]})}let y=e.object({name:e.string().min(1,"نام خودرو الزامی است"),logo:e.string().optional().nullable(),models:e.array(e.string()).default([]),enabled:e.boolean()});function z({vehicle:a,onSuccess:e}){let t=(0,m.useRouter)(),{addVehicle:u,updateVehicle:v,loadVehiclesFromDB:w}=(0,k.useVehicleStore)(),{toast:z}=(0,l.useToast)(),A=(0,s.useQueryClient)(),[B,C]=(0,n.useState)(""),{register:D,handleSubmit:E,formState:{errors:F,isSubmitting:G},setValue:H,watch:I}=(0,c.useForm)({resolver:(0,d.zodResolver)(y),defaultValues:a?{name:a.name,logo:a.logo||"",models:a.models||[],enabled:a.enabled}:{name:"",logo:"",models:[],enabled:!0}}),J=I("models")||[],K=I("enabled"),L=I("logo"),M=()=>{if(B.trim()){let a=I("models")||[];a.includes(B.trim())||(H("models",[...a,B.trim()]),C(""))}},N=async b=>{fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:83",message:"onSubmit entry",data:{hasVehicle:!!a,vehicleId:a?.id,logoType:typeof b.logo,logoLength:b.logo?b.logo.length:0},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{});try{let c=b.logo&&""!==b.logo.trim()?b.logo:null;if(c&&c.length>1048576){fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:120",message:"Logo too large, compressing",data:{originalLength:c.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{});try{c=await ((a,b=1048576)=>new Promise((c,d)=>{if(a.length<=b)return void c(a);let e=new Image;e.onload=()=>{let a=document.createElement("canvas"),f=a.getContext("2d");if(!f)return void d(Error("Could not get canvas context"));let g=e.width,h=e.height;for(let d of((g>800||h>800)&&(g>h?(h=h/g*800,g=800):(g=g/h*800,h=800)),a.width=g,a.height=h,f.drawImage(e,0,0,g,h),[.85,.7,.6,.5])){let e=a.toDataURL("image/jpeg",d);if(e.length<=b)return void c(e)}c(a.toDataURL("image/jpeg",.4))},e.onerror=()=>d(Error("Failed to load image")),e.src=a}))(c,1048576),fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:125",message:"Logo compressed",data:{compressedLength:c.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{})}catch(a){fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:128",message:"Compression failed",data:{error:a instanceof Error?a.message:String(a)},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{}),c=null}}let d={...b,logo:c};if(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:140",message:"Payload prepared",data:{payloadLogoType:typeof d.logo,payloadLogoLength:d.logo?d.logo.length:0,payloadLogoIsNull:null===d.logo},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{}),a){let b;try{b=JSON.stringify(d),fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:102",message:"Before fetch PUT",data:{jsonLength:b.length,vehicleId:a.id},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{})}catch(a){throw fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:102",message:"JSON.stringify error",data:{error:a?.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),a}let c=await fetch(`/api/vehicles/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:b});if(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:110",message:"After fetch PUT",data:{responseOk:c.ok,responseStatus:c.status,responseStatusText:c.statusText},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),!c.ok){fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:110",message:"Response not OK",data:{status:c.status,statusText:c.statusText},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{});let a=await c.json().catch(a=>(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:111",message:"Error response JSON parse failed",data:{error:a?.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),{}));throw fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:112",message:"Error data parsed",data:{errorMessage:a.error||a.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),Error(a.error||a.message||"خطا در به‌روزرسانی خودرو")}let e=await c.json();v(a.id,e.data),await w(),z({title:"موفق",description:"خودرو با موفقیت به‌روزرسانی شد"})}else{let a=await fetch("/api/vehicles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||b.message||"خطا در ایجاد خودرو")}let b=await a.json();u(b.data),await w(),z({title:"موفق",description:"خودرو با موفقیت اضافه شد"})}A.invalidateQueries({queryKey:["vehicles"]}),e?.(),t.push("/admin/vehicles")}catch(a){z({title:"خطا",description:a instanceof Error?a.message:"خطایی رخ داد. لطفاً دوباره تلاش کنید.",variant:"destructive"})}};return(0,b.jsxs)("form",{onSubmit:E(N),className:"space-y-6",children:[(0,b.jsxs)(j.Card,{className:"shadow-sm",children:[(0,b.jsx)(j.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,b.jsxs)(j.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(p.Car,{className:"h-5 w-5 text-primary"}),"اطلاعات خودرو"]})}),(0,b.jsxs)(j.CardContent,{className:"space-y-6 pt-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"name",children:"نام خودرو *"}),(0,b.jsx)(g.Input,{id:"name",...D("name"),placeholder:"مثال: BMW",className:"h-11"}),F.name&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:F.name.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x,{image:L||null,onChange:a=>H("logo",a||null),label:"لوگو خودرو"}),F.logo&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:F.logo.message})]})]}),(0,b.jsxs)("div",{className:"space-y-3 pt-4 border-t border-border/30",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(h.Label,{className:"text-base font-semibold",children:"مدل‌های خودرو"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:[J.length," مدل"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(g.Input,{value:B,onChange:a=>C(a.target.value),onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),M())},placeholder:"نام مدل (مثال: X5)",className:"h-11"}),(0,b.jsxs)(f.Button,{type:"button",onClick:M,variant:"outline",className:"h-11 px-4",disabled:!B.trim(),children:[(0,b.jsx)(q.Plus,{className:"ml-2 h-4 w-4"}),"افزودن"]})]}),J.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2 mt-3 p-4 bg-muted/30 rounded-lg border border-border/30",children:J.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-background border border-border px-3 py-2 rounded-md shadow-sm hover:shadow-md transition-shadow",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:a}),(0,b.jsx)(f.Button,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-destructive/10 hover:text-destructive",onClick:()=>{H("models",(I("models")||[]).filter((a,b)=>b!==c))},children:(0,b.jsx)(r.X,{className:"h-3.5 w-3.5"})})]},c))}),0===J.length&&(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground border border-dashed border-border/30 rounded-lg bg-muted/20",children:[(0,b.jsx)(p.Car,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"هنوز مدلی اضافه نشده است"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-border/30",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(h.Label,{children:"فعال"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"خودرو فعال است و در لیست‌ها نمایش داده می‌شود"})]}),(0,b.jsx)(i.Switch,{checked:K,onCheckedChange:a=>H("enabled",a)})]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-4 pt-4 border-t border-border/30",children:[(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>t.back(),size:"lg",children:"انصراف"}),(0,b.jsx)(f.Button,{type:"submit",disabled:G,size:"lg",className:"min-w-[140px]",children:G?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.Loader2,{className:"ml-2 h-4 w-4 animate-spin"}),"در حال ذخیره..."]}):a?"ذخیره تغییرات":"افزودن خودرو"})]})]})}a.s(["VehicleForm",()=>z],71472)}];

//# sourceMappingURL=components_admin_vehicle-form_tsx_8a69baf0._.js.map
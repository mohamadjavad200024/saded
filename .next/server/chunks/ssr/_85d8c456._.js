module.exports=[62435,a=>{"use strict";let b={get url(){return`file://${a.P("node_modules/zustand/esm/middleware.mjs")}`}};function c(a,b){let c;try{c=a()}catch(a){return}return{getItem:a=>{var d;let e=a=>null===a?null:JSON.parse(a,null==b?void 0:b.reviver),f=null!=(d=c.getItem(a))?d:null;return f instanceof Promise?f.then(e):e(f)},setItem:(a,d)=>c.setItem(a,JSON.stringify(d,null==b?void 0:b.replacer)),removeItem:a=>c.removeItem(a)}}let d=a=>b=>{try{let c=a(b);if(c instanceof Promise)return c;return{then:a=>d(a)(c),catch(a){return this}}}catch(a){return{then(a){return this},catch:b=>d(b)(a)}}},e=(a,e)=>{if("getStorage"in e||"serialize"in e||"deserialize"in e)return(b.env?b.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),(b,c,f)=>{let g,h,i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:a=>a,version:0,merge:(a,b)=>({...b,...a}),...e},j=!1,k=new Set,l=new Set;try{g=i.getStorage()}catch(a){}if(!g)return a((...a)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),b(...a)},c,f);let m=d(i.serialize),n=()=>{let a,b=m({state:i.partialize({...c()}),version:i.version}).then(a=>g.setItem(i.name,a)).catch(b=>{a=b});if(a)throw a;return b},o=f.setState;f.setState=(a,b)=>{o(a,b),n()};let p=a((...a)=>{b(...a),n()},c,f),q=()=>{var a;if(!g)return;j=!1,k.forEach(a=>a(c()));let e=(null==(a=i.onRehydrateStorage)?void 0:a.call(i,c()))||void 0;return d(g.getItem.bind(g))(i.name).then(a=>{if(a)return i.deserialize(a)}).then(a=>{if(a)if("number"!=typeof a.version||a.version===i.version)return a.state;else{if(i.migrate)return i.migrate(a.state,a.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}}).then(a=>{var d;return b(h=i.merge(a,null!=(d=c())?d:p),!0),n()}).then(()=>{null==e||e(h,void 0),j=!0,l.forEach(a=>a(h))}).catch(a=>{null==e||e(void 0,a)})};return f.persist={setOptions:a=>{i={...i,...a},a.getStorage&&(g=a.getStorage())},clearStorage:()=>{null==g||g.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>q(),hasHydrated:()=>j,onHydrate:a=>(k.add(a),()=>{k.delete(a)}),onFinishHydration:a=>(l.add(a),()=>{l.delete(a)})},q(),h||p};return(b,f,g)=>{let h,i={storage:c(()=>localStorage),partialize:a=>a,version:0,merge:(a,b)=>({...b,...a}),...e},j=!1,k=new Set,l=new Set,m=i.storage;if(!m)return a((...a)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),b(...a)},f,g);let n=()=>{let a=i.partialize({...f()});return m.setItem(i.name,{state:a,version:i.version})},o=g.setState;g.setState=(a,b)=>{o(a,b),n()};let p=a((...a)=>{b(...a),n()},f,g);g.getInitialState=()=>p;let q=()=>{var a,c;if(!m)return;j=!1,k.forEach(a=>{var b;return a(null!=(b=f())?b:p)});let e=(null==(c=i.onRehydrateStorage)?void 0:c.call(i,null!=(a=f())?a:p))||void 0;return d(m.getItem.bind(m))(i.name).then(a=>{if(a)if("number"!=typeof a.version||a.version===i.version)return[!1,a.state];else{if(i.migrate)return[!0,i.migrate(a.state,a.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(a=>{var c;let[d,e]=a;if(b(h=i.merge(e,null!=(c=f())?c:p),!0),d)return n()}).then(()=>{null==e||e(h,void 0),h=f(),j=!0,l.forEach(a=>a(h))}).catch(a=>{null==e||e(void 0,a)})};return g.persist={setOptions:a=>{i={...i,...a},a.storage&&(m=a.storage)},clearStorage:()=>{null==m||m.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>q(),hasHydrated:()=>j,onHydrate:a=>(k.add(a),()=>{k.delete(a)}),onFinishHydration:a=>(l.add(a),()=>{l.delete(a)})},i.skipHydration||q(),h||p}};a.s(["createJSONStorage",()=>c,"persist",()=>e])},25173,a=>{"use strict";var b=a.i(33915),c=a.i(62435);let d=(0,b.create)()((0,c.persist)((a,b)=>({user:null,isAuthenticated:!1,isCheckingAuth:!1,hasCheckedAuth:!1,register:async(b,c,d)=>{let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:b,phone:c,password:d})}),f=await e.json();if(!f.success)throw Error(f.error||f.message||"خطا در ثبت‌نام");a({user:{id:f.data.user.id,name:f.data.user.name,phone:f.data.user.phone,role:f.data.user.role||"user",createdAt:f.data.user.createdAt},isAuthenticated:!0,hasCheckedAuth:!0})},login:async(b,c)=>{let d=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({phone:b,password:c})}),e=await d.json();return!!e.success&&(a({user:{id:e.data.user.id,name:e.data.user.name,phone:e.data.user.phone,role:e.data.user.role||"user",createdAt:e.data.user.createdAt},isAuthenticated:!0,hasCheckedAuth:!0}),!0)},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch{}finally{a({user:null,isAuthenticated:!1,hasCheckedAuth:!0})}},checkAuth:async()=>{let{isCheckingAuth:c}=b();if(!c){a({isCheckingAuth:!0});try{let b=new AbortController,c=setTimeout(()=>b.abort(),1e4),d=await fetch("/api/auth/me",{method:"GET",credentials:"include",cache:"no-store",headers:{"Cache-Control":"no-cache"},signal:b.signal});clearTimeout(c);let e=await d.json().catch(()=>null);if(d.ok&&e?.success)if(e.data?.authenticated&&e.data?.user){let b=e.data.user;a({user:{id:b.id,name:b.name,phone:b.phone,role:b.role||"user",createdAt:b.createdAt},isAuthenticated:!0,hasCheckedAuth:!0})}else a({user:null,isAuthenticated:!1,hasCheckedAuth:!0});else a({user:null,isAuthenticated:!1,hasCheckedAuth:!0})}catch(b){a({user:null,isAuthenticated:!1,hasCheckedAuth:!0,isCheckingAuth:!1})}finally{a({isCheckingAuth:!1})}}},updateUser:c=>{let{user:d}=b();d&&a({user:{...d,...c}})}}),{name:"saded_auth",storage:(0,c.createJSONStorage)(()=>localStorage),partialize:a=>({user:a.user,isAuthenticated:a.isAuthenticated})}));a.s(["useAuthStore",0,d])},410,a=>{"use strict";var b=a.i(33915),c=a.i(54917),d=a.i(25173);let e={},f=(0,b.create)((b,f)=>({orders:[],filters:e,isLoading:!1,setOrders:a=>b({orders:a}),addOrder:a=>b(b=>{let c=b.orders.findIndex(b=>b.id===a.id);if(c>=0){let d=[...b.orders];return d[c]=a,{orders:d}}return{orders:[...b.orders,a]}}),updateOrder:(a,c)=>b(b=>{let d=b.orders.findIndex(b=>b.id===a);if(d>=0){let a=[...b.orders];return a[d]={...a[d],...c},{orders:a}}return b}),updateOrderStatus:(a,c)=>b(b=>({orders:b.orders.map(b=>b.id===a?{...b,status:c,updatedAt:new Date}:b)})),updatePaymentStatus:(a,c)=>b(b=>({orders:b.orders.map(b=>b.id===a?{...b,paymentStatus:c,updatedAt:new Date}:b)})),deleteOrder:a=>b(b=>({orders:b.orders.filter(b=>b.id!==a)})),getOrder:a=>f().orders.find(b=>b.id===a),setFilters:a=>b(b=>({filters:{...b.filters,...a}})),clearFilters:()=>b({filters:e}),loadOrdersFromDB:async()=>{b({isLoading:!0});try{let e=new AbortController,f=setTimeout(()=>e.abort(),15e3),{fetchWithAuth:g}=await a.A(17056);c.logger.debug("Loading orders from database...");let h=d.useAuthStore.getState();console.log("[OrderStore] Auth state before request:",{isAuthenticated:h.isAuthenticated,hasUser:!!h.user,userId:h.user?.id,hasCheckedAuth:h.hasCheckedAuth});let i={"Cache-Control":"no-cache"};h.user?.id&&(i["x-user-id"]=h.user.id,console.log("[OrderStore] Adding userId header (fallback):",h.user.id));let j=await g("/api/orders",{signal:e.signal,credentials:"include",cache:"no-store",headers:i});if(console.log("[OrderStore] Response status:",j.status),clearTimeout(f),j.ok){let a;try{a=await j.json()}catch(a){c.logger.error("Error parsing orders response:",a),b({orders:[],isLoading:!1});return}if(console.log("[OrderStore] Response from /api/orders:",{success:a.success,dataLength:a.data?.length||0,hasData:!!a.data}),a.success&&a.data)try{let d=a.data.map(a=>{let b=[],d={};try{b=Array.isArray(a.items)?a.items:"string"==typeof a.items?JSON.parse(a.items):[]}catch(d){c.logger.warn("Error parsing items for order:",a.id,d),b=[]}try{d="object"==typeof a.shippingAddress&&null!==a.shippingAddress?a.shippingAddress:"string"==typeof a.shippingAddress?JSON.parse(a.shippingAddress):{}}catch(b){c.logger.warn("Error parsing shippingAddress for order:",a.id,b),d={}}return{...a,items:b,shippingAddress:d,total:Number(a.total)||0,shippingCost:Number(a.shippingCost)||0,createdAt:a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt),updatedAt:a.updatedAt instanceof Date?a.updatedAt:new Date(a.updatedAt)}});c.logger.info(`✅ Loaded ${d.length} orders from database`),b({orders:d,isLoading:!1})}catch(a){c.logger.error("Error parsing orders data:",a),b({orders:[],isLoading:!1})}else c.logger.info("No orders found in database"),b({orders:[],isLoading:!1})}else{let a=await j.text().catch(()=>"Unknown error");if(c.logger.error(`Failed to load orders: ${j.status} - ${a}`),401===j.status)return void b({orders:[],isLoading:!1});b({orders:[],isLoading:!1})}}catch(a){a instanceof Error&&"AbortError"!==a.name&&c.logger.error("Error loading orders from DB:",a),b({orders:[],isLoading:!1})}}}));a.s(["useOrderStore",0,f])},33508,a=>{"use strict";let b=(0,a.i(70106).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);a.s(["X",()=>b],33508)},45222,a=>{"use strict";let b=(0,a.i(70106).default)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);a.s(["MessageCircle",()=>b],45222)}];

//# sourceMappingURL=_85d8c456._.js.map
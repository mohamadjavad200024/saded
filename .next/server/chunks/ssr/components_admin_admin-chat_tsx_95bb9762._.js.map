{"version":3,"sources":["../../../../components/admin/admin-chat.tsx","../../../../hooks/use-chat-utils.ts","../../../../hooks/use-chat-messaging.ts","../../../../components/chat/message-bubble.tsx","../../../../components/chat/chat-input.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef, useCallback } from \"react\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  MessageCircle,\n  Search,\n  User,\n  Phone,\n  Mail,\n  X,\n  Loader2,\n  ChevronDown,\n} from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAdminPresence } from \"@/hooks/use-admin-presence\";\nimport { OnlineStatusBadge } from \"@/components/chat/online-status-badge\";\nimport { TypingIndicator } from \"@/components/chat/typing-indicator\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useChatUtils } from \"@/hooks/use-chat-utils\";\nimport { useChatMessaging, type Message } from \"@/hooks/use-chat-messaging\";\nimport { MessageBubble } from \"@/components/chat/message-bubble\";\nimport { ChatInput } from \"@/components/chat/chat-input\";\nimport { logger } from \"@/lib/logger-client\";\n\ninterface Chat {\n  id: string;\n  customerName: string;\n  customerPhone: string;\n  customerEmail?: string;\n  status: string;\n  createdAt: string;\n  updatedAt: string;\n  lastMessage?: string;\n  lastMessageTime?: string;\n  unreadCount?: number;\n}\n\ninterface AdminChatProps {\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function AdminChat({ isOpen, onOpenChange }: AdminChatProps) {\n  const { toast } = useToast();\n  const { setOnline, isOnline } = useAdminPresence({\n    enabled: true,\n    heartbeatInterval: 15000,\n  });\n  \n  const [chats, setChats] = useState<Chat[]>([]);\n  const [selectedChat, setSelectedChat] = useState<Chat | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isUserTyping, setIsUserTyping] = useState(false);\n  const [replyingTo, setReplyingTo] = useState<Message | null>(null);\n  const [editingMessage, setEditingMessage] = useState<Message | null>(null);\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\n  const lastMessageIdRef = useRef<string | null>(null);\n  const typingPollIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const [showScrollToBottom, setShowScrollToBottom] = useState(false);\n\n  // Use shared hooks\n  const chatUtils = useChatUtils();\n  const chatMessaging = useChatMessaging({\n    chatId: selectedChat?.id || null,\n    sender: \"support\",\n    customerInfo: selectedChat ? {\n      name: selectedChat.customerName,\n      phone: selectedChat.customerPhone,\n      email: selectedChat.customerEmail,\n    } : undefined,\n    onMessageSent: () => {\n      loadChats();\n      if (selectedChat) {\n        loadMessages(selectedChat.id, false);\n      }\n    },\n  });\n\n  // Load chats list\n  const loadChats = useCallback(async (showLoading = true) => {\n    try {\n      if (showLoading) setIsLoading(true);\n      const response = await fetch(\"/api/chat\", { credentials: \"include\" });\n      if (!response.ok) throw new Error(\"خطا در بارگذاری چت‌ها\");\n      \n      const data = await response.json();\n      if (data.success && data.data.chats) {\n        const chatsWithLastMessage = await Promise.all(\n          data.data.chats.map(async (chat: Chat) => {\n            try {\n              const msgResponse = await fetch(`/api/chat?chatId=${chat.id}`, { credentials: \"include\" });\n              if (msgResponse.ok) {\n                const msgData = await msgResponse.json();\n                if (msgData.success && msgData.data.messages) {\n                  const msgs = msgData.data.messages;\n                  const lastMsg = msgs[msgs.length - 1];\n                  return {\n                    ...chat,\n                    lastMessage: lastMsg?.text || \"\",\n                    lastMessageTime: lastMsg?.createdAt || chat.updatedAt,\n                    unreadCount: chat.unreadCount || 0,\n                  };\n                }\n              }\n            } catch (error) {\n              logger.error(\"Error loading last message:\", error);\n            }\n            return { ...chat, unreadCount: chat.unreadCount || 0 };\n          })\n        );\n        setChats(chatsWithLastMessage);\n      }\n    } catch (error) {\n      logger.error(\"Error loading chats:\", error);\n      if (showLoading) {\n        toast({\n          title: \"خطا\",\n          description: \"خطا در بارگذاری چت‌ها\",\n          variant: \"destructive\",\n        });\n      }\n    } finally {\n      if (showLoading) setIsLoading(false);\n    }\n  }, [toast]);\n\n  // Silent refresh\n  const silentRefreshChats = useCallback(async () => {\n    try {\n      const response = await fetch(\"/api/chat\", { credentials: \"include\" });\n      if (!response.ok) return;\n      \n      const data = await response.json();\n      if (data.success && data.data.chats) {\n        const chatPromises = data.data.chats.map(async (chat: Chat) => {\n          try {\n            const msgResponse = await fetch(`/api/chat?chatId=${chat.id}`, { credentials: \"include\" });\n            if (msgResponse.ok) {\n              const msgData = await msgResponse.json();\n              if (msgData.success && msgData.data.messages) {\n                const msgs = msgData.data.messages;\n                const lastMsg = msgs[msgs.length - 1];\n                return {\n                  ...chat,\n                  lastMessage: lastMsg?.text || \"\",\n                  lastMessageTime: lastMsg?.createdAt || chat.updatedAt,\n                  unreadCount: chat.unreadCount || 0,\n                };\n              }\n            }\n          } catch (error) {\n            // Silent fail\n          }\n          return { ...chat, unreadCount: chat.unreadCount || 0 };\n        });\n        \n        const results = await Promise.allSettled(chatPromises);\n        const updatedChats = results\n          .filter((r): r is PromiseFulfilledResult<Chat> => r.status === \"fulfilled\")\n          .map((r) => r.value);\n        \n        setChats((prevChats) => {\n          const chatMap = new Map(updatedChats.map((c) => [c.id, c]));\n          const existingIds = new Set(prevChats.map((c) => c.id));\n          \n          const mergedChats = prevChats.map((c) => {\n            const updated = chatMap.get(c.id);\n            if (updated && (\n              updated.unreadCount !== c.unreadCount ||\n              updated.lastMessage !== c.lastMessage ||\n              updated.lastMessageTime !== c.lastMessageTime\n            )) {\n              return { ...c, ...updated };\n            }\n            return c;\n          });\n          \n          updatedChats.forEach((c) => {\n            if (!existingIds.has(c.id)) {\n              mergedChats.push(c);\n            }\n          });\n          \n          return mergedChats;\n        });\n      }\n    } catch (error) {\n      // Silent fail\n    }\n  }, []);\n\n  // Load messages\n  const loadMessages = useCallback(async (chatId: string, isInitial = false) => {\n    try {\n      if (isInitial) setIsLoading(true);\n      \n      let url = `/api/chat?chatId=${chatId}`;\n      if (!isInitial && lastMessageIdRef.current) {\n        url += `&lastMessageId=${lastMessageIdRef.current}`;\n      }\n      \n      const response = await fetch(url);\n      if (!response.ok) throw new Error(\"خطا در بارگذاری پیام‌ها\");\n      \n      const data = await response.json();\n      if (data.success && data.data.messages) {\n        const formattedMessages: Message[] = data.data.messages.map((msg: any) => {\n          let attachments: any[] = [];\n          if (msg.attachments) {\n            if (Array.isArray(msg.attachments)) {\n              attachments = msg.attachments;\n            } else if (typeof msg.attachments === 'string') {\n              try {\n                const parsed = JSON.parse(msg.attachments);\n                attachments = Array.isArray(parsed) ? parsed : [parsed];\n              } catch (e) {\n                logger.error(\"Error parsing attachments:\", e);\n              }\n            }\n          }\n          \n          return {\n            id: msg.id,\n            text: msg.text || \"\",\n            sender: msg.sender as \"user\" | \"support\",\n            timestamp: new Date(msg.createdAt),\n            attachments: attachments,\n            status: msg.status || (msg.sender === \"user\" ? \"sent\" : undefined),\n          };\n        });\n        \n        if (selectedChat) {\n          try {\n            const unreadResponse = await fetch(`/api/chat/unread-count?chatId=${selectedChat.id}`);\n            if (unreadResponse.ok) {\n              const unreadData = await unreadResponse.json();\n              if (unreadData.success && unreadData.data) {\n                const unreadCount = unreadData.data.unreadCount || 0;\n                setChats((prevChats) =>\n                  prevChats.map((c) =>\n                    c.id === selectedChat.id ? { ...c, unreadCount } : c\n                  )\n                );\n              }\n            }\n          } catch (error) {\n            // Silent fail\n          }\n        }\n        \n        if (isInitial) {\n          setMessages(formattedMessages);\n          if (formattedMessages.length > 0) {\n            lastMessageIdRef.current = formattedMessages[formattedMessages.length - 1].id;\n          }\n        } else {\n          setMessages((prev) => {\n            const existingIds = new Set(prev.map((m) => m.id));\n            const newMessages = formattedMessages.filter((msg) => !existingIds.has(msg.id));\n            if (newMessages.length > 0) {\n              lastMessageIdRef.current = newMessages[newMessages.length - 1].id;\n              return [...prev, ...newMessages];\n            }\n            return prev;\n          });\n        }\n      }\n    } catch (error) {\n      logger.error(\"Error loading messages:\", error);\n      if (isInitial) {\n        toast({\n          title: \"خطا\",\n          description: \"خطا در بارگذاری پیام‌ها\",\n          variant: \"destructive\",\n        });\n      }\n    } finally {\n      if (isInitial) setIsLoading(false);\n    }\n  }, [selectedChat, toast]);\n\n  // Mark messages as delivered/read\n  const markUserMessagesAsDelivered = useCallback(async (chatId: string) => {\n    try {\n      await fetch(\"/api/chat/status\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ chatId, sender: \"support\", action: \"delivered\" }),\n      });\n    } catch (error) {\n      // Silent fail\n    }\n  }, []);\n\n  const markUserMessagesAsRead = useCallback(async (chatId: string) => {\n    try {\n      await fetch(\"/api/chat/status\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ chatId, sender: \"support\", action: \"read\" }),\n      });\n    } catch (error) {\n      // Silent fail\n    }\n  }, []);\n\n  // Handle chat selection\n  const handleSelectChat = useCallback(async (chat: Chat) => {\n    setSelectedChat(chat);\n    lastMessageIdRef.current = null;\n    \n    if (typeof window !== \"undefined\") {\n      localStorage.setItem('admin_selected_chat_id', chat.id);\n      window.dispatchEvent(new CustomEvent('chatOpened', { detail: { chatId: chat.id } }));\n    }\n    \n    markUserMessagesAsRead(chat.id).catch(() => {});\n    markUserMessagesAsDelivered(chat.id);\n    loadMessages(chat.id, true);\n    \n    setChats((prevChats) =>\n      prevChats.map((c) =>\n        c.id === chat.id ? { ...c, unreadCount: 0 } : c\n      )\n    );\n  }, [loadMessages, markUserMessagesAsRead, markUserMessagesAsDelivered]);\n\n  // Check typing status\n  const checkUserTyping = useCallback(async () => {\n    if (!selectedChat) return;\n    try {\n      const response = await fetch(`/api/chat/typing?chatId=${selectedChat.id}&sender=user`, { credentials: \"include\" });\n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          setIsUserTyping(data.data.isTyping || false);\n        }\n      }\n    } catch (error) {\n      // Silent fail\n    }\n  }, [selectedChat]);\n\n  // Handle reply\n  const handleReply = useCallback((message: Message) => {\n    setReplyingTo(message);\n    setEditingMessage(null);\n  }, []);\n\n  // Handle edit\n  const handleEdit = useCallback((message: Message) => {\n    setEditingMessage(message);\n    setReplyingTo(null);\n    chatMessaging.handleMessageChange({ target: { value: message.text || \"\" } } as React.ChangeEvent<HTMLTextAreaElement>);\n  }, [chatMessaging]);\n\n  // Handle delete\n  const handleDelete = useCallback(async (messageId: string) => {\n    if (!selectedChat) return;\n    \n    try {\n      const response = await fetch(`/api/chat/message/${messageId}`, {\n        method: \"DELETE\",\n      });\n      \n      if (response.ok) {\n        setMessages((prev) => prev.filter((msg) => msg.id !== messageId));\n        toast({\n          title: \"موفق\",\n          description: \"پیام با موفقیت حذف شد\",\n        });\n      } else {\n        throw new Error(\"خطا در حذف پیام\");\n      }\n    } catch (error) {\n      logger.error(\"Error deleting message:\", error);\n      toast({\n        title: \"خطا\",\n        description: \"خطا در حذف پیام\",\n        variant: \"destructive\",\n      });\n    }\n  }, [selectedChat, toast]);\n\n\n  // Handle send message\n  const handleSend = useCallback(async () => {\n    if (!selectedChat) return;\n    \n    // If editing, update the message instead of sending new one\n    if (editingMessage) {\n      try {\n        const response = await fetch(`/api/chat/message/${editingMessage.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            text: chatMessaging.message,\n            attachments: chatUtils.attachments,\n          }),\n        });\n        \n        if (response.ok) {\n          setMessages((prev) =>\n            prev.map((msg) =>\n              msg.id === editingMessage.id\n                ? { ...msg, text: chatMessaging.message, attachments: chatUtils.attachments }\n                : msg\n            )\n          );\n          setEditingMessage(null);\n          chatMessaging.handleMessageChange({ target: { value: \"\" } } as React.ChangeEvent<HTMLTextAreaElement>);\n          chatUtils.setAttachments([]);\n          toast({\n            title: \"موفق\",\n            description: \"پیام ویرایش شد\",\n          });\n        }\n      } catch (error) {\n        logger.error(\"Error editing message:\", error);\n        toast({\n          title: \"خطا\",\n          description: \"خطا در ویرایش پیام\",\n          variant: \"destructive\",\n        });\n      }\n      return;\n    }\n    \n    const sentMessage = await chatMessaging.handleSend(chatUtils.attachments, replyingTo);\n    if (sentMessage) {\n      setMessages((prev) => [...prev, sentMessage]);\n      chatUtils.setAttachments([]);\n      chatUtils.setShowAttachmentOptions(false);\n      setReplyingTo(null);\n      \n      // Scroll to bottom after sending message\n      setTimeout(() => {\n        scrollToBottom(false);\n        // Check position after scroll to hide button\n        setTimeout(() => {\n          checkScrollPosition();\n        }, 500);\n      }, 150);\n      \n      // Save audio recording if exists\n      if (chatUtils.audioBlob && chatUtils.audioUrl) {\n        const audioAttachment = await chatUtils.saveRecording();\n        if (audioAttachment) {\n          // Audio will be added to next message\n        }\n      }\n    }\n  }, [selectedChat, chatMessaging, chatUtils, editingMessage, replyingTo, toast]);\n\n  // Check if user is scrolled up\n  const checkScrollPosition = useCallback(() => {\n    if (!messagesContainerRef.current || !selectedChat) {\n      setShowScrollToBottom(false);\n      return;\n    }\n    const container = messagesContainerRef.current;\n    const threshold = 150; // 150px threshold\n    const scrollBottom = container.scrollHeight - container.scrollTop - container.clientHeight;\n    const isScrolledUp = scrollBottom > threshold;\n    setShowScrollToBottom(isScrolledUp);\n  }, [selectedChat]);\n\n  // Scroll to bottom function\n  const scrollToBottom = useCallback((instant = false) => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ \n        behavior: instant ? \"auto\" : \"smooth\",\n        block: \"end\"\n      });\n      // Hide button after scrolling\n      setTimeout(() => {\n        setShowScrollToBottom(false);\n      }, 300);\n    }\n  }, []);\n\n  // Track scroll position\n  useEffect(() => {\n    const container = messagesContainerRef.current;\n    if (!container || !selectedChat) {\n      setShowScrollToBottom(false);\n      return;\n    }\n\n    const handleScroll = () => {\n      checkScrollPosition();\n    };\n\n    // Check position when messages change\n    const checkOnMessagesChange = () => {\n      setTimeout(() => {\n        checkScrollPosition();\n      }, 100);\n    };\n\n    container.addEventListener(\"scroll\", handleScroll, { passive: true });\n    // Check initial position\n    checkScrollPosition();\n    checkOnMessagesChange();\n    \n    return () => {\n      container.removeEventListener(\"scroll\", handleScroll);\n    };\n  }, [selectedChat, checkScrollPosition, messages.length]);\n\n  // Scroll to bottom when chat is selected (first time)\n  const hasScrolledOnSelectRef = useRef<boolean>(false);\n  useEffect(() => {\n    if (selectedChat && messages.length > 0 && !hasScrolledOnSelectRef.current) {\n      hasScrolledOnSelectRef.current = true;\n      // Instant scroll when opening a chat\n      const timeout = setTimeout(() => {\n        scrollToBottom(true);\n        // Check position after scroll to hide button\n        setTimeout(() => {\n          checkScrollPosition();\n        }, 500);\n      }, 200);\n      return () => clearTimeout(timeout);\n    } else if (!selectedChat) {\n      hasScrolledOnSelectRef.current = false;\n    }\n  }, [selectedChat, messages.length, scrollToBottom, checkScrollPosition]);\n\n  // Check position when messages change\n  useEffect(() => {\n    if (messages.length > 0 && selectedChat) {\n      const timeout = setTimeout(() => {\n        checkScrollPosition();\n      }, 200);\n      return () => clearTimeout(timeout);\n    }\n  }, [messages.length, checkScrollPosition, selectedChat]);\n\n  // Poll for new messages\n  useEffect(() => {\n    if (!selectedChat || !isOpen) {\n      setIsUserTyping(false);\n      if (typingPollIntervalRef.current) {\n        clearInterval(typingPollIntervalRef.current);\n        typingPollIntervalRef.current = null;\n      }\n      return;\n    }\n\n    markUserMessagesAsDelivered(selectedChat.id);\n    markUserMessagesAsRead(selectedChat.id).catch(() => {});\n\n    checkUserTyping();\n    // Optimized: Check typing status every 3 seconds (reduced from 2s)\n    typingPollIntervalRef.current = setInterval(() => {\n      checkUserTyping();\n    }, 3000);\n\n    // Optimized: Poll messages every 5 seconds (reduced from 3s to reduce server load)\n    const interval = setInterval(() => {\n      loadMessages(selectedChat.id, false);\n      markUserMessagesAsDelivered(selectedChat.id);\n      markUserMessagesAsRead(selectedChat.id).catch(() => {});\n    }, 5000);\n\n    return () => {\n      clearInterval(interval);\n      if (typingPollIntervalRef.current) {\n        clearInterval(typingPollIntervalRef.current);\n        typingPollIntervalRef.current = null;\n      }\n    };\n  }, [selectedChat, isOpen, checkUserTyping, loadMessages, markUserMessagesAsDelivered, markUserMessagesAsRead]);\n\n  // Load chats on open\n  useEffect(() => {\n    if (isOpen) {\n      loadChats(true);\n      setSelectedChat(null);\n      setMessages([]);\n      if (typeof window !== \"undefined\") {\n        localStorage.removeItem('admin_selected_chat_id');\n        window.dispatchEvent(new CustomEvent('chatClosed'));\n      }\n      setOnline(true);\n      \n      // Optimized: Refresh chat list every 15 seconds (reduced from 10s)\n      const chatListInterval = setInterval(() => {\n        silentRefreshChats();\n      }, 15000);\n      \n      return () => {\n        clearInterval(chatListInterval);\n      };\n    } else {\n      setOnline(false);\n      if (typeof window !== \"undefined\") {\n        localStorage.removeItem('admin_selected_chat_id');\n        window.dispatchEvent(new CustomEvent('chatClosed'));\n      }\n    }\n  }, [isOpen, setOnline, silentRefreshChats, loadChats]);\n\n  // Listen for openChat event\n  useEffect(() => {\n    const handleOpenChat = async (event: Event) => {\n      const customEvent = event as CustomEvent<{ chatId: string }>;\n      const { chatId } = customEvent.detail;\n      if (!chatId) return;\n\n      if (!isOpen) {\n        onOpenChange(true);\n      }\n\n      setTimeout(async () => {\n        if (chats.length === 0) {\n          await loadChats();\n        }\n        const chat = chats.find((c) => c.id === chatId);\n        if (chat) {\n          handleSelectChat(chat);\n        } else {\n          try {\n            const response = await fetch(`/api/chat?chatId=${chatId}`, { credentials: \"include\" });\n            if (response.ok) {\n              const data = await response.json();\n              if (data.success && data.data) {\n                const chatInfo: Chat = {\n                  id: data.data.id,\n                  customerName: data.data.customerName || \"کاربر\",\n                  customerPhone: data.data.customerPhone || \"\",\n                  status: data.data.status || \"active\",\n                  createdAt: data.data.createdAt || new Date().toISOString(),\n                  updatedAt: data.data.updatedAt || new Date().toISOString(),\n                  lastMessage: data.data.lastMessage || \"\",\n                  lastMessageTime: data.data.lastMessageTime,\n                };\n                handleSelectChat(chatInfo);\n              }\n            }\n          } catch (error) {\n            logger.error(\"Error loading chat:\", error);\n          }\n        }\n      }, 300);\n    };\n\n    window.addEventListener(\"openChat\", handleOpenChat as EventListener);\n    return () => {\n      window.removeEventListener(\"openChat\", handleOpenChat as EventListener);\n    };\n  }, [isOpen, chats, onOpenChange, loadChats, handleSelectChat]);\n\n  // Request notification permission\n  useEffect(() => {\n    if (typeof window !== \"undefined\" && \"Notification\" in window) {\n      if (Notification.permission === \"default\") {\n        Notification.requestPermission();\n      }\n    }\n  }, []);\n\n  const filteredChats = chats.filter((chat) =>\n    chat.customerName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    chat.customerPhone.includes(searchQuery)\n  );\n\n  return (\n    <Sheet \n      open={isOpen} \n      onOpenChange={onOpenChange}\n      data-admin-chat-open={isOpen ? \"true\" : \"false\"}\n      data-selected-chat-id={selectedChat?.id || \"\"}\n    >\n      <SheetContent\n        side=\"left\"\n        className=\"w-full sm:w-[500px] md:w-[600px] p-0 flex flex-col shadow-2xl !h-screen !max-h-screen overflow-hidden\"\n      >\n        {!selectedChat ? (\n          <>\n            <SheetHeader className=\"sticky top-0 z-10 bg-background/95 backdrop-blur-sm border-b border-border/40 px-4 sm:px-6 py-2\">\n              <SheetTitle className=\"flex items-center gap-2 text-base font-semibold\">\n                <MessageCircle className=\"h-5 w-5\" />\n                چت‌های کاربران\n              </SheetTitle>\n              <div className=\"mt-2\">\n                <div className=\"relative\">\n                  <Search className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    type=\"search\"\n                    placeholder=\"جستجوی کاربر...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"pr-10 h-9 text-sm border rounded-lg\"\n                  />\n                </div>\n              </div>\n            </SheetHeader>\n\n            <div className=\"flex-1 min-h-0 overflow-y-auto bg-gradient-to-b from-background to-muted/5\">\n              {isLoading ? (\n                <div className=\"flex items-center justify-center h-full\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                </div>\n              ) : filteredChats.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center h-full text-center px-6\">\n                  <MessageCircle className=\"h-14 w-14 text-muted-foreground/50 mb-5\" />\n                  <p className=\"text-muted-foreground text-base font-medium leading-relaxed\">چتی یافت نشد</p>\n                </div>\n              ) : (\n                <div className=\"divide-y divide-border/50\">\n                  {filteredChats.map((chat) => (\n                    <motion.button\n                      key={chat.id}\n                      onClick={() => handleSelectChat(chat)}\n                      className={`w-full p-5 text-right hover:bg-muted/50 transition-all duration-200 rounded-lg ${\n                        chat.unreadCount && chat.unreadCount > 0 \n                          ? \"bg-primary/5 border-r-4 border-primary shadow-md\" \n                          : \"hover:shadow-sm\"\n                      }`}\n                      whileHover={{ backgroundColor: chat.unreadCount && chat.unreadCount > 0 ? \"rgba(var(--primary), 0.1)\" : \"rgba(0,0,0,0.05)\" }}\n                      initial={{ opacity: 0, x: -20 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ duration: 0.2 }}\n                    >\n                      <div className=\"flex items-start gap-4\">\n                        <div className=\"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 shadow-md border-2 border-primary/30\">\n                          <User className=\"h-5 w-5 sm:h-6 sm:w-6 text-primary\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between mb-2\">\n                            <div className=\"flex items-center gap-2.5 flex-1 min-w-0\">\n                              <p className={`font-semibold text-sm sm:text-base truncate leading-tight ${\n                                chat.unreadCount && chat.unreadCount > 0 ? \"font-bold\" : \"\"\n                              }`}>\n                                {chat.customerName}\n                              </p>\n                              {chat.unreadCount && chat.unreadCount > 0 && (\n                                <motion.div\n                                  initial={{ scale: 0 }}\n                                  animate={{ scale: 1 }}\n                                  transition={{ type: \"spring\", stiffness: 500, damping: 15 }}\n                                >\n                                  <Badge\n                                    variant=\"destructive\"\n                                    className=\"h-6 w-6 px-0 text-xs font-bold flex-shrink-0 shadow-lg animate-pulse flex items-center justify-center\"\n                                  >\n                                    !\n                                  </Badge>\n                                </motion.div>\n                              )}\n                            </div>\n                            {chat.lastMessageTime && (\n                              <span className=\"text-xs text-muted-foreground flex-shrink-0 mr-2 font-medium\">\n                                {new Date(chat.lastMessageTime).toLocaleDateString(\"fa-IR\", {\n                                  month: \"short\",\n                                  day: \"numeric\",\n                                })}\n                              </span>\n                            )}\n                          </div>\n                          <div className=\"flex items-center gap-2.5 text-sm text-muted-foreground mb-1.5\">\n                            <Phone className=\"h-4 w-4\" />\n                            <span className=\"font-medium\">{chat.customerPhone}</span>\n                          </div>\n                          {chat.lastMessage && (\n                            <p className=\"text-sm text-muted-foreground mt-2 truncate leading-relaxed\">\n                              {chat.lastMessage}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </motion.button>\n                  ))}\n                </div>\n              )}\n            </div>\n          </>\n        ) : (\n          <>\n            <SheetHeader className=\"sticky top-0 z-10 bg-background/95 backdrop-blur-sm border-b border-border/40 px-4 sm:px-6 py-2\">\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={async () => {\n                    setSelectedChat(null);\n                    setMessages([]);\n                    lastMessageIdRef.current = null;\n                    if (typeof window !== \"undefined\") {\n                      localStorage.removeItem('admin_selected_chat_id');\n                      window.dispatchEvent(new CustomEvent('chatClosed'));\n                    }\n                    await loadChats();\n                  }}\n                  className=\"h-8 w-8 rounded-lg hover:bg-muted/60 transition-all\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-2\">\n                    <SheetTitle className=\"text-base font-semibold truncate\">{selectedChat.customerName}</SheetTitle>\n                    <OnlineStatusBadge isOnline={isOnline} showText={false} />\n                  </div>\n                </div>\n              </div>\n            </SheetHeader>\n\n            <div ref={messagesContainerRef} className=\"flex-1 min-h-0 overflow-y-auto p-4 sm:p-5 md:p-6 space-y-4 sm:space-y-5 bg-gradient-to-b from-background via-background to-muted/5\">\n              {isLoading ? (\n                <div className=\"flex items-center justify-center h-full\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                </div>\n              ) : messages.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center h-full text-center px-6\">\n                  <MessageCircle className=\"h-14 w-14 text-muted-foreground/50 mb-5\" />\n                  <p className=\"text-muted-foreground text-base font-medium leading-relaxed\">هنوز پیامی ارسال نشده است</p>\n                </div>\n              ) : (\n                <>\n                  {messages.map((msg, index) => (\n                    <MessageBubble\n                      key={msg.id}\n                      message={msg}\n                      index={index}\n                      totalMessages={messages.length}\n                      onReply={handleReply}\n                      onEdit={handleEdit}\n                      onDelete={handleDelete}\n                    />\n                  ))}\n                  {isUserTyping && (\n                    <motion.div\n                      initial={{ opacity: 0, y: 10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: 10 }}\n                      className=\"flex justify-start items-end gap-2.5\"\n                    >\n                      <TypingIndicator />\n                    </motion.div>\n                  )}\n                </>\n              )}\n              <div ref={messagesEndRef} />\n            </div>\n\n            <div className=\"sticky bottom-0 z-10 bg-background/95 backdrop-blur-sm border-t border-border/40 flex-shrink-0 relative pb-safe\" style={{ paddingBottom: 'max(0.5rem, env(safe-area-inset-bottom))' }}>\n              {/* Scroll to bottom button */}\n              <AnimatePresence>\n                {showScrollToBottom && (\n                  <motion.div\n                    initial={{ opacity: 0, y: 10, scale: 0.9 }}\n                    animate={{ opacity: 1, y: 0, scale: 1 }}\n                    exit={{ opacity: 0, y: 10, scale: 0.9 }}\n                    className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-10\"\n                  >\n                    <Button\n                      onClick={() => scrollToBottom(false)}\n                      size=\"icon\"\n                      className=\"h-9 w-9 rounded-full shadow-lg hover:shadow-xl bg-primary text-primary-foreground hover:bg-primary/90 transition-all\"\n                      title=\"برو به آخرین پیام\"\n                    >\n                      <ChevronDown className=\"h-4 w-4\" />\n                    </Button>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n              <ChatInput\n                message={chatMessaging.message}\n              onMessageChange={chatMessaging.handleMessageChange}\n              onSend={handleSend}\n              isSending={chatMessaging.isSending}\n              attachments={chatUtils.attachments}\n              onRemoveAttachment={chatUtils.handleRemoveAttachment}\n              showAttachmentOptions={chatUtils.showAttachmentOptions}\n              onToggleAttachmentOptions={() => chatUtils.setShowAttachmentOptions(!chatUtils.showAttachmentOptions)}\n              isRecording={chatUtils.isRecording}\n              recordingTime={chatUtils.recordingTime}\n              audioUrl={chatUtils.audioUrl}\n              onStartRecording={chatUtils.startRecording}\n              onStopRecording={chatUtils.stopRecording}\n              onCancelRecording={chatUtils.cancelRecording}\n              onSaveRecording={async () => {\n                const attachment = await chatUtils.saveRecording();\n                if (attachment) {\n                  chatUtils.setAttachments((prev) => [...prev, attachment]);\n                }\n              }}\n              formatTime={chatUtils.formatTime}\n              imageInputRef={chatUtils.imageInputRef}\n              fileInputRef={chatUtils.fileInputRef}\n              onFileSelect={chatUtils.handleFileSelect}\n              onLocationShare={chatUtils.handleLocationShare}\n              onCheckMicrophonePermission={chatUtils.checkMicrophonePermission}\n              toast={toast}\n              />\n            </div>\n          </>\n        )}\n      </SheetContent>\n    </Sheet>\n  );\n}\n","\"use client\";\r\n\r\nimport { useState, useRef, useCallback } from \"react\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { logger } from \"@/lib/logger-client\";\r\n\r\nexport interface Attachment {\r\n  id: string;\r\n  type: \"image\" | \"file\" | \"location\" | \"audio\";\r\n  url: string;\r\n  name?: string;\r\n  size?: number;\r\n  duration?: number;\r\n}\r\n\r\nexport interface UseChatUtilsReturn {\r\n  attachments: Attachment[];\r\n  setAttachments: React.Dispatch<React.SetStateAction<Attachment[]>>;\r\n  isRecording: boolean;\r\n  recordingTime: number;\r\n  audioBlob: Blob | null;\r\n  audioUrl: string | null;\r\n  showAttachmentOptions: boolean;\r\n  setShowAttachmentOptions: React.Dispatch<React.SetStateAction<boolean>>;\r\n  uploadFile: (file: File, type: \"image\" | \"file\" | \"audio\") => Promise<string>;\r\n  handleFileSelect: (e: React.ChangeEvent<HTMLInputElement>, type: \"image\" | \"file\") => Promise<void>;\r\n  handleRemoveAttachment: (id: string) => void;\r\n  handleLocationShare: () => void;\r\n  startRecording: () => Promise<void>;\r\n  stopRecording: () => void;\r\n  cancelRecording: () => void;\r\n  saveRecording: () => Promise<Attachment | null>;\r\n  formatTime: (seconds: number) => string;\r\n  formatFileSize: (bytes: number) => string;\r\n  checkMicrophonePermission: () => Promise<boolean>;\r\n  imageInputRef: React.RefObject<HTMLInputElement | null>;\r\n  fileInputRef: React.RefObject<HTMLInputElement | null>;\r\n}\r\n\r\nexport function useChatUtils(): UseChatUtilsReturn {\r\n  const { toast } = useToast();\r\n  const [attachments, setAttachments] = useState<Attachment[]>([]);\r\n  const [isRecording, setIsRecording] = useState(false);\r\n  const [recordingTime, setRecordingTime] = useState(0);\r\n  const [audioBlob, setAudioBlob] = useState<Blob | null>(null);\r\n  const [audioUrl, setAudioUrl] = useState<string | null>(null);\r\n  const [showAttachmentOptions, setShowAttachmentOptions] = useState(false);\r\n  \r\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n  const audioChunksRef = useRef<Blob[]>([]);\r\n  const recordingIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const uploadFile = useCallback(async (file: File, type: \"image\" | \"file\" | \"audio\", retryCount = 0): Promise<string> => {\r\n    const MAX_RETRIES = 3;\r\n    const RETRY_DELAY = 2000;\r\n\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append(\"file\", file);\r\n      formData.append(\"type\", type);\r\n\r\n      const response = await fetch(\"/api/chat/upload\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json().catch(() => ({ error: \"خطا در آپلود فایل\" }));\r\n        throw new Error(error.error || \"خطا در آپلود فایل\");\r\n      }\r\n\r\n      const data = await response.json();\r\n      return data.data.url;\r\n    } catch (error: any) {\r\n      if (retryCount < MAX_RETRIES && (\r\n        error.message?.includes(\"fetch\") || \r\n        error.message?.includes(\"network\") ||\r\n        error.message?.includes(\"timeout\") ||\r\n        error.code === \"NETWORK_ERROR\" ||\r\n        error.name === \"TypeError\"\r\n      )) {\r\n        const delay = RETRY_DELAY * Math.pow(2, retryCount);\r\n        if (retryCount === 0) {\r\n          toast({\r\n            title: \"در حال تلاش مجدد...\",\r\n            description: \"خطا در آپلود فایل. در حال تلاش مجدد...\",\r\n            duration: 2000,\r\n          });\r\n        }\r\n        await new Promise(resolve => setTimeout(resolve, delay));\r\n        return uploadFile(file, type, retryCount + 1);\r\n      }\r\n\r\n      toast({\r\n        title: \"خطا در آپلود فایل\",\r\n        description: error.message || \"لطفاً دوباره تلاش کنید\",\r\n        variant: \"destructive\",\r\n      });\r\n      throw error;\r\n    }\r\n  }, [toast]);\r\n\r\n  const handleFileSelect = useCallback(async (e: React.ChangeEvent<HTMLInputElement>, type: \"image\" | \"file\") => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    for (const file of Array.from(files)) {\r\n      try {\r\n        const fileUrl = await uploadFile(file, type);\r\n        const attachment: Attachment = {\r\n          id: Date.now().toString() + Math.random(),\r\n          type,\r\n          name: file.name,\r\n          size: file.size,\r\n          url: fileUrl,\r\n        };\r\n        setAttachments((prev) => [...prev, attachment]);\r\n      } catch (error) {\r\n        // Error already handled in uploadFile\r\n      }\r\n    }\r\n\r\n    e.target.value = \"\";\r\n  }, [uploadFile]);\r\n\r\n  const handleRemoveAttachment = useCallback((id: string) => {\r\n    setAttachments((prev) => prev.filter((a) => a.id !== id));\r\n  }, []);\r\n\r\n  const handleLocationShare = useCallback(() => {\r\n    if (navigator.geolocation) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          const attachment: Attachment = {\r\n            id: Date.now().toString(),\r\n            type: \"location\",\r\n            url: `https://www.google.com/maps?q=${position.coords.latitude},${position.coords.longitude}`,\r\n            name: \"موقعیت مکانی\",\r\n          };\r\n          setAttachments((prev) => [...prev, attachment]);\r\n          setShowAttachmentOptions(false);\r\n        },\r\n        (error) => {\r\n          logger.error(\"Error getting location:\", error);\r\n          toast({\r\n            title: \"خطا\",\r\n            description: \"خطا در دریافت موقعیت مکانی\",\r\n            variant: \"destructive\",\r\n          });\r\n        }\r\n      );\r\n    } else {\r\n      toast({\r\n        title: \"خطا\",\r\n        description: \"مرورگر شما از موقعیت مکانی پشتیبانی نمی‌کند\",\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  }, [toast]);\r\n\r\n  const checkMicrophonePermission = useCallback(async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      stream.getTracks().forEach((track) => track.stop());\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }, []);\r\n\r\n  const startRecording = useCallback(async () => {\r\n    try {\r\n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n        toast({\r\n          title: \"مرورگر شما پشتیبانی نمی‌کند\",\r\n          description: \"مرورگر شما از ضبط صدا پشتیبانی نمی‌کند. لطفاً از مرورگر جدیدتری استفاده کنید.\",\r\n          variant: \"destructive\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      const stream = await navigator.mediaDevices.getUserMedia({ \r\n        audio: {\r\n          echoCancellation: true,\r\n          noiseSuppression: true,\r\n          autoGainControl: true,\r\n        } \r\n      });\r\n      \r\n      const mediaRecorder = new MediaRecorder(stream, {\r\n        mimeType: MediaRecorder.isTypeSupported(\"audio/webm\") \r\n          ? \"audio/webm\" \r\n          : MediaRecorder.isTypeSupported(\"audio/mp4\")\r\n          ? \"audio/mp4\"\r\n          : \"audio/webm\",\r\n      });\r\n      mediaRecorderRef.current = mediaRecorder;\r\n      audioChunksRef.current = [];\r\n\r\n      mediaRecorder.ondataavailable = (event) => {\r\n        if (event.data.size > 0) {\r\n          audioChunksRef.current.push(event.data);\r\n        }\r\n      };\r\n\r\n      mediaRecorder.onstop = () => {\r\n        const blob = new Blob(audioChunksRef.current, { \r\n          type: mediaRecorder.mimeType || \"audio/webm\" \r\n        });\r\n        setAudioBlob(blob);\r\n        const url = URL.createObjectURL(blob);\r\n        setAudioUrl(url);\r\n        stream.getTracks().forEach((track) => track.stop());\r\n      };\r\n\r\n      mediaRecorder.onerror = (event) => {\r\n        logger.error(\"MediaRecorder error:\", event);\r\n        toast({\r\n          title: \"خطا در ضبط صدا\",\r\n          description: \"خطایی در هنگام ضبط صدا رخ داد. لطفاً دوباره تلاش کنید.\",\r\n          variant: \"destructive\",\r\n        });\r\n        stopRecording();\r\n      };\r\n\r\n      mediaRecorder.start();\r\n      setIsRecording(true);\r\n      setRecordingTime(0);\r\n      setShowAttachmentOptions(false);\r\n\r\n      recordingIntervalRef.current = setInterval(() => {\r\n        setRecordingTime((prev) => prev + 1);\r\n      }, 1000);\r\n\r\n      toast({\r\n        title: \"ضبط صدا شروع شد\",\r\n        description: \"در حال ضبط پیام صوتی...\",\r\n      });\r\n    } catch (error: any) {\r\n      let errorMessage = \"دسترسی به میکروفون مجاز نیست.\";\r\n      let errorDescription = \"\";\r\n\r\n      if (error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\") {\r\n        errorMessage = \"دسترسی به میکروفون رد شد\";\r\n        errorDescription = \"لطفاً در تنظیمات مرورگر خود، دسترسی میکروفون را فعال کنید.\";\r\n      } else if (error.name === \"NotFoundError\" || error.name === \"DevicesNotFoundError\") {\r\n        errorMessage = \"میکروفون یافت نشد\";\r\n        errorDescription = \"لطفاً مطمئن شوید که میکروفون به دستگاه شما متصل است.\";\r\n      } else if (error.name === \"NotReadableError\" || error.name === \"TrackStartError\") {\r\n        errorMessage = \"میکروفون در حال استفاده است\";\r\n        errorDescription = \"میکروفون توسط برنامه دیگری استفاده می‌شود. لطفاً آن را ببندید.\";\r\n      } else {\r\n        errorDescription = \"لطفاً دوباره تلاش کنید یا صفحه را رفرش کنید.\";\r\n      }\r\n\r\n      toast({\r\n        title: errorMessage,\r\n        description: errorDescription,\r\n        variant: \"destructive\",\r\n        duration: 5000,\r\n      });\r\n    }\r\n  }, [toast]);\r\n\r\n  const stopRecording = useCallback(() => {\r\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\r\n      try {\r\n        mediaRecorderRef.current.stop();\r\n        setIsRecording(false);\r\n        if (recordingIntervalRef.current) {\r\n          clearInterval(recordingIntervalRef.current);\r\n        }\r\n        toast({\r\n          title: \"ضبط صدا متوقف شد\",\r\n          description: \"پیام صوتی شما آماده است. می‌توانید آن را ذخیره یا لغو کنید.\",\r\n        });\r\n      } catch (error) {\r\n        logger.error(\"Error stopping recording:\", error);\r\n        toast({\r\n          title: \"خطا\",\r\n          description: \"خطایی در توقف ضبط رخ داد.\",\r\n          variant: \"destructive\",\r\n        });\r\n      }\r\n    }\r\n  }, [toast]);\r\n\r\n  const cancelRecording = useCallback(() => {\r\n    stopRecording();\r\n    setAudioBlob(null);\r\n    if (audioUrl) {\r\n      URL.revokeObjectURL(audioUrl);\r\n      setAudioUrl(null);\r\n    }\r\n    setRecordingTime(0);\r\n  }, [audioUrl, stopRecording]);\r\n\r\n  const saveRecording = useCallback(async (): Promise<Attachment | null> => {\r\n    if (audioBlob && audioUrl) {\r\n      try {\r\n        let extension = \"webm\";\r\n        let mimeType = audioBlob.type || \"audio/webm\";\r\n        \r\n        if (mimeType.includes(\"mp4\") || mimeType.includes(\"m4a\")) {\r\n          extension = \"m4a\";\r\n        } else if (mimeType.includes(\"ogg\")) {\r\n          extension = \"ogg\";\r\n        } else if (mimeType.includes(\"wav\")) {\r\n          extension = \"wav\";\r\n        }\r\n\r\n        const audioFile = new File([audioBlob], `audio-${Date.now()}.${extension}`, {\r\n          type: mimeType,\r\n        });\r\n\r\n        const uploadedUrl = await uploadFile(audioFile, \"audio\");\r\n\r\n        const attachment: Attachment = {\r\n          id: Date.now().toString(),\r\n          type: \"audio\",\r\n          url: uploadedUrl,\r\n          name: `پیام صوتی ${formatTime(recordingTime)}`,\r\n          size: audioBlob.size,\r\n          duration: recordingTime,\r\n        };\r\n        setAttachments((prev) => [...prev, attachment]);\r\n        setAudioBlob(null);\r\n        if (audioUrl) {\r\n          URL.revokeObjectURL(audioUrl);\r\n        }\r\n        setAudioUrl(null);\r\n        setRecordingTime(0);\r\n        return attachment;\r\n      } catch (error) {\r\n        return null;\r\n      }\r\n    }\r\n    return null;\r\n  }, [audioBlob, audioUrl, recordingTime, uploadFile]);\r\n\r\n  const formatTime = useCallback((seconds: number) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\r\n  }, []);\r\n\r\n  const formatFileSize = useCallback((bytes: number) => {\r\n    if (bytes < 1024) return bytes + \" B\";\r\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + \" KB\";\r\n    return (bytes / (1024 * 1024)).toFixed(1) + \" MB\";\r\n  }, []);\r\n\r\n  return {\r\n    attachments,\r\n    setAttachments,\r\n    isRecording,\r\n    recordingTime,\r\n    audioBlob,\r\n    audioUrl,\r\n    showAttachmentOptions,\r\n    setShowAttachmentOptions,\r\n    uploadFile,\r\n    handleFileSelect,\r\n    handleRemoveAttachment,\r\n    handleLocationShare,\r\n    startRecording,\r\n    stopRecording,\r\n    cancelRecording,\r\n    saveRecording,\r\n    formatTime,\r\n    formatFileSize,\r\n    checkMicrophonePermission,\r\n    imageInputRef,\r\n    fileInputRef,\r\n  };\r\n}\r\n\r\n\r\n\r\n","\"use client\";\n\nimport { useState, useRef, useCallback, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Attachment } from \"./use-chat-utils\";\nimport { logger } from \"@/lib/logger-client\";\n\nexport interface Message {\n  id: string;\n  text: string;\n  sender: \"user\" | \"support\";\n  timestamp: Date;\n  attachments?: Attachment[];\n  status?: \"sending\" | \"sent\" | \"delivered\" | \"read\";\n}\n\ninterface UseChatMessagingOptions {\n  chatId: string | null;\n  sender: \"user\" | \"support\";\n  customerInfo?: {\n    name: string;\n    phone: string;\n    email?: string;\n  };\n  onMessageSent?: () => void;\n}\n\nexport function useChatMessaging({\n  chatId,\n  sender,\n  customerInfo,\n  onMessageSent,\n}: UseChatMessagingOptions) {\n  const { toast } = useToast();\n  const [message, setMessage] = useState(\"\");\n  const [isSending, setIsSending] = useState(false);\n  const [isTyping, setIsTyping] = useState(false);\n  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const typingPollIntervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  const sendTypingStatus = useCallback(async (typing: boolean) => {\n    if (!chatId) return;\n    \n    try {\n      await fetch(\"/api/chat/typing\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: \"include\",\n        body: JSON.stringify({\n          chatId,\n          sender,\n          isTyping: typing,\n        }),\n      });\n    } catch (error) {\n      logger.error(\"Error sending typing status:\", error);\n    }\n  }, [chatId, sender]);\n\n  const handleMessageChange = useCallback((e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setMessage(e.target.value);\n    \n    if (!chatId) return;\n    \n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    \n    if (e.target.value.trim().length > 0) {\n      sendTypingStatus(true);\n      typingTimeoutRef.current = setTimeout(() => {\n        sendTypingStatus(false);\n      }, 2000);\n    } else {\n      sendTypingStatus(false);\n    }\n  }, [chatId, sendTypingStatus]);\n\n  const checkTypingStatus = useCallback(async () => {\n    if (!chatId) return;\n    \n    try {\n      const response = await fetch(\n        `/api/chat/typing?chatId=${chatId}&sender=${sender === \"user\" ? \"support\" : \"user\"}`,\n        { credentials: \"include\" }\n      );\n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          setIsTyping(data.data.isTyping || false);\n        }\n      }\n    } catch (error) {\n      logger.error(\"Error checking typing status:\", error);\n    }\n  }, [chatId, sender]);\n\n  useEffect(() => {\n    if (!chatId) {\n      setIsTyping(false);\n      if (typingPollIntervalRef.current) {\n        clearInterval(typingPollIntervalRef.current);\n        typingPollIntervalRef.current = null;\n      }\n      return;\n    }\n\n    checkTypingStatus();\n    typingPollIntervalRef.current = setInterval(() => {\n      checkTypingStatus();\n    }, 2000);\n\n    return () => {\n      if (typingPollIntervalRef.current) {\n        clearInterval(typingPollIntervalRef.current);\n        typingPollIntervalRef.current = null;\n      }\n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n        typingTimeoutRef.current = null;\n      }\n      sendTypingStatus(false);\n    };\n  }, [chatId, checkTypingStatus, sendTypingStatus]);\n\n  const sendMessage = useCallback(async (\n    text: string,\n    attachments: Attachment[] = []\n  ): Promise<Message | null> => {\n    if ((!text.trim() && attachments.length === 0) || !chatId) return null;\n\n    const validAttachments = attachments.filter(att => {\n      const url = att.url;\n      return url && \n             !url.startsWith('blob:') && \n             !url.startsWith('data:') &&\n             (url.startsWith('http') || url.startsWith('/'));\n    });\n\n    if (!text.trim() && validAttachments.length === 0) {\n      toast({\n        title: \"خطا\",\n        description: \"لطفاً یک پیام یا فایل معتبر اضافه کنید\",\n        variant: \"destructive\",\n      });\n      return null;\n    }\n\n    const newMessage: Message = {\n      id: `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      text,\n      sender,\n      timestamp: new Date(),\n      attachments: validAttachments.length > 0 ? validAttachments : undefined,\n    };\n\n    try {\n      setIsSending(true);\n      \n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n      }\n      sendTypingStatus(false);\n\n      const body: any = {\n        chatId,\n        messages: [{\n          id: newMessage.id,\n          text: newMessage.text,\n          sender: newMessage.sender,\n          timestamp: newMessage.timestamp.toISOString(),\n          attachments: newMessage.attachments || [],\n        }],\n      };\n\n      if (customerInfo) {\n        body.customerInfo = customerInfo;\n      }\n\n      const response = await fetch(\"/api/chat\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: \"include\",\n        body: JSON.stringify(body),\n      });\n\n      if (!response.ok) {\n        const errJson = await response.json().catch(() => null);\n        const msg =\n          errJson?.error ||\n          (response.status === 429 ? \"درخواست‌های شما زیاد است. لطفاً کمی بعد دوباره تلاش کنید.\" : null) ||\n          \"خطا در ارسال پیام\";\n        throw new Error(msg);\n      }\n\n      if (onMessageSent) {\n        onMessageSent();\n      }\n\n      return newMessage;\n    } catch (error) {\n      if (process.env.NODE_ENV === \"development\") {\n        logger.error(\"Error sending message:\", error);\n      }\n      toast({\n        title: \"خطا\",\n        description: error instanceof Error ? error.message : \"خطا در ارسال پیام\",\n        variant: \"destructive\",\n      });\n      return null;\n    } finally {\n      setIsSending(false);\n    }\n  }, [chatId, sender, customerInfo, toast, onMessageSent, sendTypingStatus]);\n\n  const handleSend = useCallback(async (attachments: Attachment[] = [], replyTo?: Message | null) => {\n    let messageText = message;\n    if (replyTo) {\n      messageText = `در پاسخ به: ${replyTo.text}\\n\\n${message}`;\n    }\n    const sentMessage = await sendMessage(messageText, attachments);\n    if (sentMessage) {\n      setMessage(\"\");\n      return sentMessage;\n    }\n    return null;\n  }, [message, sendMessage]);\n\n  return {\n    message,\n    setMessage,\n    isSending,\n    isTyping,\n    handleMessageChange,\n    sendMessage,\n    handleSend,\n  };\n}\n\n\n","\"use client\";\n\nimport { motion } from \"framer-motion\";\nimport { CheckCheck, FileText, MapPin, Mic, Reply, Edit2, Trash2, MoreVertical } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport type { Attachment } from \"@/hooks/use-chat-utils\";\nimport type { Message } from \"@/hooks/use-chat-messaging\";\n\ninterface MessageBubbleProps {\n  message: Message;\n  index: number;\n  totalMessages: number;\n  onReply?: (message: Message) => void;\n  onEdit?: (message: Message) => void;\n  onDelete?: (messageId: string) => void;\n}\n\nexport function MessageBubble({ message, index, totalMessages, onReply, onEdit, onDelete }: MessageBubbleProps) {\n  return (\n    <motion.div\n      key={message.id}\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0 }}\n      transition={{ \n        duration: 0.2,\n        ease: \"easeOut\"\n      }}\n      className={`flex ${message.sender === \"user\" ? \"justify-end\" : \"justify-start\"} items-end gap-2 group`}\n    >\n      <div\n        className={`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${\n          message.sender === \"user\"\n            ? \"bg-primary text-primary-foreground\"\n            : \"bg-muted text-foreground border border-border/40\"\n        }`}\n      >\n        {message.text && (\n          <p className=\"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5\">\n            {message.text}\n          </p>\n        )}\n        {message.attachments && message.attachments.length > 0 && (\n          <div className={`space-y-2 ${message.text ? \"mt-2\" : \"\"}`}>\n            {message.attachments.map((attachment: Attachment, idx: number) => (\n              <div key={attachment.id || idx} className=\"rounded overflow-hidden\">\n                {attachment.type === \"image\" && attachment.url && (\n                  <img\n                    src={attachment.url}\n                    alt={attachment.name || \"تصویر\"}\n                    className=\"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all\"\n                    onClick={() => window.open(attachment.url, \"_blank\")}\n                  />\n                )}\n                {attachment.type === \"file\" && (\n                  <a\n                    href={attachment.url}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    download={attachment.name}\n                    className=\"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs\"\n                  >\n                    <FileText className=\"h-3.5 w-3.5\" />\n                    <span className=\"font-medium truncate\">{attachment.name || \"فایل\"}</span>\n                  </a>\n                )}\n                {attachment.type === \"location\" && (\n                  <a\n                    href={attachment.url}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs\"\n                  >\n                    <MapPin className=\"h-3.5 w-3.5\" />\n                    <span className=\"font-medium\">{attachment.name || \"موقعیت\"}</span>\n                  </a>\n                )}\n                {attachment.type === \"audio\" && attachment.url && (\n                  <div className=\"flex items-center gap-2 p-2 bg-background/50 rounded\">\n                    <Mic className=\"h-3.5 w-3.5\" />\n                    <audio controls className=\"flex-1 h-7 text-xs\">\n                      <source src={attachment.url} />\n                    </audio>\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n        <div className={`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${\n          message.sender === \"user\" \n            ? \"border-primary-foreground/20 justify-end\" \n            : \"border-border/30 justify-start\"\n        }`}>\n          <span className={`text-[10px] sm:text-xs ${\n            message.sender === \"user\" \n              ? \"text-primary-foreground/70\" \n              : \"text-muted-foreground\"\n          }`}>\n            {new Date(message.timestamp).toLocaleTimeString(\"fa-IR\", {\n              hour: \"2-digit\",\n              minute: \"2-digit\",\n            })}\n          </span>\n          {message.status && message.sender === \"user\" && (\n            <CheckCheck className={`h-3 w-3 ${\n              message.status === \"read\" ? \"text-primary-foreground/70\" : \"text-primary-foreground/40\"\n            }`} />\n          )}\n          <div className=\"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity\">\n            {(onReply || onEdit || onDelete) && (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-6 w-6 hover:bg-background/20\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                    }}\n                    title=\"گزینه‌های بیشتر\"\n                  >\n                    <MoreVertical className=\"h-3.5 w-3.5\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent \n                  align={message.sender === \"user\" ? \"end\" : \"start\"}\n                  className=\"min-w-[140px]\"\n                  onClick={(e) => e.stopPropagation()}\n                >\n                  {onReply && (\n                    <DropdownMenuItem\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onReply(message);\n                      }}\n                      className=\"cursor-pointer\"\n                    >\n                      <Reply className=\"h-4 w-4 ml-2\" />\n                      <span>پاسخ</span>\n                    </DropdownMenuItem>\n                  )}\n                  {onEdit && message.sender === \"user\" && (\n                    <>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onEdit(message);\n                        }}\n                        className=\"cursor-pointer\"\n                      >\n                        <Edit2 className=\"h-4 w-4 ml-2\" />\n                        <span>ویرایش</span>\n                      </DropdownMenuItem>\n                    </>\n                  )}\n                  {onDelete && (\n                    <>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          if (confirm(\"آیا مطمئن هستید که می‌خواهید این پیام را حذف کنید؟\")) {\n                            onDelete(message.id);\n                          }\n                        }}\n                        className=\"cursor-pointer text-destructive focus:text-destructive focus:bg-destructive/10\"\n                      >\n                        <Trash2 className=\"h-4 w-4 ml-2\" />\n                        <span>حذف</span>\n                      </DropdownMenuItem>\n                    </>\n                  )}\n                </DropdownMenuContent>\n              </DropdownMenu>\n            )}\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n\n","\"use client\";\n\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Send, Loader2, Image, FileText, MapPin, Mic, Paperclip, X, Square } from \"lucide-react\";\nimport type { Attachment } from \"@/hooks/use-chat-utils\";\n\ninterface ChatInputProps {\n  message: string;\n  onMessageChange: (e: React.ChangeEvent<HTMLTextAreaElement>) => void;\n  onSend: () => void;\n  isSending: boolean;\n  attachments: Attachment[];\n  onRemoveAttachment: (id: string) => void;\n  showAttachmentOptions: boolean;\n  onToggleAttachmentOptions: () => void;\n  isRecording: boolean;\n  recordingTime: number;\n  audioUrl: string | null;\n  onStartRecording: () => void;\n  onStopRecording: () => void;\n  onCancelRecording: () => void;\n  onSaveRecording: () => Promise<void>;\n  formatTime: (seconds: number) => string;\n  imageInputRef: React.RefObject<HTMLInputElement | null>;\n  fileInputRef: React.RefObject<HTMLInputElement | null>;\n  onFileSelect: (e: React.ChangeEvent<HTMLInputElement>, type: \"image\" | \"file\") => Promise<void>;\n  onLocationShare: () => void;\n  onCheckMicrophonePermission: () => Promise<boolean>;\n  toast: any;\n}\n\nexport function ChatInput({\n  message,\n  onMessageChange,\n  onSend,\n  isSending,\n  attachments,\n  onRemoveAttachment,\n  showAttachmentOptions,\n  onToggleAttachmentOptions,\n  isRecording,\n  recordingTime,\n  audioUrl,\n  onStartRecording,\n  onStopRecording,\n  onCancelRecording,\n  onSaveRecording,\n  formatTime,\n  imageInputRef,\n  fileInputRef,\n  onFileSelect,\n  onLocationShare,\n  onCheckMicrophonePermission,\n  toast,\n}: ChatInputProps) {\n  return (\n    <div className=\"border-t border-border/40 p-2 sm:p-3 bg-background\">\n      {/* Recording UI */}\n      {(isRecording || audioUrl) && (\n        <motion.div\n          initial={{ opacity: 0, y: 10, scale: 0.95 }}\n          animate={{ opacity: 1, y: 0, scale: 1 }}\n          exit={{ opacity: 0, y: 10, scale: 0.95 }}\n          className=\"flex items-center gap-2 p-2 mb-2 bg-destructive/10 border border-destructive/30 rounded-lg\"\n        >\n          {isRecording ? (\n            <>\n              <motion.div\n                animate={{ scale: [1, 1.1, 1] }}\n                transition={{ repeat: Infinity, duration: 1 }}\n                className=\"p-1.5 rounded-full bg-destructive/20\"\n              >\n                <Mic className=\"h-3.5 w-3.5 text-destructive\" />\n              </motion.div>\n              <div className=\"flex-1\">\n                <p className=\"text-xs font-medium text-destructive leading-tight\">در حال ضبط</p>\n                <p className=\"text-xs text-muted-foreground font-mono\">{formatTime(recordingTime)}</p>\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={onStopRecording}\n                className=\"h-7 w-7 text-destructive hover:bg-destructive/10 rounded-lg\"\n              >\n                <Square className=\"h-3 w-3 fill-current\" />\n              </Button>\n            </>\n          ) : (\n            <>\n              <div className=\"p-1.5 rounded-full bg-primary/20\">\n                <Mic className=\"h-3.5 w-3.5 text-primary\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-xs font-medium leading-tight\">پیام صوتی آماده است</p>\n                <p className=\"text-xs text-muted-foreground font-mono\">{formatTime(recordingTime)}</p>\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={onCancelRecording}\n                className=\"h-7 w-7 text-muted-foreground hover:text-destructive rounded-lg\"\n              >\n                <X className=\"h-3.5 w-3.5\" />\n              </Button>\n              <Button\n                onClick={onSaveRecording}\n                size=\"sm\"\n                className=\"h-7 px-3 text-xs rounded-lg\"\n              >\n                ذخیره\n              </Button>\n            </>\n          )}\n        </motion.div>\n      )}\n\n\n      <div className=\"flex items-end gap-2\">\n        <div className=\"flex-1 relative\">\n          {/* Attachments Preview inside input */}\n          {attachments.length > 0 && (\n            <div className=\"absolute top-2 right-2 left-2 z-10 pointer-events-none overflow-hidden\">\n              <div className=\"overflow-x-auto overflow-y-hidden scroll-smooth w-full [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]\">\n                <div className=\"flex items-center gap-1.5 flex-nowrap\">\n                  {attachments.map((attachment) => (\n                    <div\n                      key={attachment.id}\n                      className=\"relative group pointer-events-auto flex-shrink-0 w-auto\"\n                    >\n                      <div className=\"bg-card/95 backdrop-blur-sm rounded-md p-1 border border-border/40 shadow-sm\">\n                        {attachment.type === \"image\" && attachment.url && (\n                          <img\n                            src={attachment.url}\n                            alt={attachment.name || \"تصویر\"}\n                            className=\"w-10 h-10 object-cover rounded\"\n                          />\n                        )}\n                        {attachment.type === \"file\" && (\n                          <div className=\"flex items-center gap-1 px-1.5 py-1\">\n                            <FileText className=\"h-3 w-3 flex-shrink-0 text-primary\" />\n                            <p className=\"text-[10px] truncate max-w-[50px] font-medium leading-tight\">{attachment.name}</p>\n                          </div>\n                        )}\n                        {attachment.type === \"location\" && (\n                          <div className=\"flex items-center gap-1 px-1.5 py-1\">\n                            <MapPin className=\"h-3 w-3 flex-shrink-0 text-primary\" />\n                            <span className=\"text-[10px] font-medium whitespace-nowrap leading-tight\">موقعیت</span>\n                          </div>\n                        )}\n                        {attachment.type === \"audio\" && (\n                          <div className=\"flex items-center gap-1 px-1.5 py-1\">\n                            <Mic className=\"h-3 w-3 flex-shrink-0 text-primary\" />\n                            <span className=\"text-[10px] font-medium whitespace-nowrap leading-tight\">\n                              {(attachment as any).duration ? formatTime((attachment as any).duration) : \"صدا\"}\n                            </span>\n                          </div>\n                        )}\n                      </div>\n                      <button\n                        onClick={() => onRemoveAttachment(attachment.id)}\n                        className=\"absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-20 hover:scale-110\"\n                      >\n                        <X className=\"h-2.5 w-2.5\" />\n                      </button>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </div>\n          )}\n\n          <Textarea\n            value={message}\n            onChange={onMessageChange}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\" && !e.shiftKey) {\n                e.preventDefault();\n                if (message.trim() || attachments.length > 0) {\n                  onSend();\n                }\n              }\n            }}\n            placeholder=\"پیام خود را بنویسید...\"\n            className={`min-h-[44px] max-h-[100px] resize-none text-sm leading-relaxed rounded-lg border pr-20 pl-3 py-2 ${\n              attachments.length > 0 ? \"pt-12\" : \"\"\n            }`}\n          />\n          \n          {/* Attachment Options */}\n          <AnimatePresence>\n            {showAttachmentOptions && (\n              <motion.div\n                initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                exit={{ opacity: 0, y: 10, scale: 0.95 }}\n                className=\"absolute bottom-full right-0 mb-2 flex gap-2 p-2 bg-card rounded-lg border border-border/50 shadow-lg z-10\"\n              >\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => {\n                    imageInputRef.current?.click();\n                    onToggleAttachmentOptions();\n                  }}\n                  className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                  disabled={isRecording}\n                >\n                  <Image className=\"h-3.5 w-3.5\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => {\n                    fileInputRef.current?.click();\n                    onToggleAttachmentOptions();\n                  }}\n                  className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                  disabled={isRecording}\n                >\n                  <FileText className=\"h-3.5 w-3.5\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={onLocationShare}\n                  className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                  disabled={isRecording}\n                >\n                  <MapPin className=\"h-3.5 w-3.5\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={async () => {\n                    onToggleAttachmentOptions();\n                    if (isRecording) {\n                      onStopRecording();\n                    } else {\n                      const hasPermission = await onCheckMicrophonePermission();\n                      if (!hasPermission) {\n                        toast({\n                          title: \"نیاز به دسترسی میکروفون\",\n                          description: \"برای ضبط صدا، لطفاً دسترسی میکروفون را در تنظیمات مرورگر فعال کنید.\",\n                          variant: \"destructive\",\n                          duration: 5000,\n                        });\n                      }\n                      onStartRecording();\n                    }\n                  }}\n                  className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                  disabled={isRecording}\n                >\n                  {isRecording ? (\n                    <Mic className=\"h-3.5 w-3.5 text-destructive\" />\n                  ) : (\n                    <Mic className=\"h-3.5 w-3.5\" />\n                  )}\n                </Button>\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          {/* Hidden Inputs */}\n          <input\n            ref={imageInputRef}\n            type=\"file\"\n            accept=\"image/*\"\n            multiple\n            className=\"hidden\"\n            onChange={(e) => onFileSelect(e, \"image\")}\n          />\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            className=\"hidden\"\n            onChange={(e) => onFileSelect(e, \"file\")}\n          />\n          \n          {/* Buttons - inside input */}\n          <div className=\"absolute bottom-2 right-2 flex items-center gap-1\">\n            {/* Attachment Button */}\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={onToggleAttachmentOptions}\n              className={`h-7 w-7 rounded-lg transition-all ${\n                showAttachmentOptions \n                  ? \"bg-primary/10 text-primary\" \n                  : \"hover:bg-muted/60 text-muted-foreground hover:text-foreground\"\n              }`}\n            >\n              <Paperclip className=\"h-4 w-4\" />\n            </Button>\n\n            {/* Send Button - only show when there's content */}\n            {(message.trim() || attachments.length > 0) && !isRecording && (\n              <>\n                {isSending ? (\n                  <Loader2 className=\"h-4 w-4 text-primary animate-spin\" />\n                ) : (\n                  <Button\n                    onClick={onSend}\n                    size=\"icon\"\n                    className=\"h-7 w-7 rounded-lg transition-all\"\n                  >\n                    <Send className=\"h-3.5 w-3.5\" />\n                  </Button>\n                )}\n              </>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n\n"],"names":[],"mappings":"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"}
{"version":3,"sources":["../../../../components/layout/header.tsx/__nextjs-internal-proxy.mjs","../../../../components/layout/footer.tsx/__nextjs-internal-proxy.mjs","../../../../components/product/product-detail.tsx/__nextjs-internal-proxy.mjs","../../../../app/products/%5Bid%5D/page.tsx","../../../../lib/db/index.ts","../../../../lib/image-utils.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Header = registerClientReference(\n    function() { throw new Error(\"Attempted to call Header() from the server but Header is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/layout/header.tsx\",\n    \"Header\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Footer = registerClientReference(\n    function() { throw new Error(\"Attempted to call Footer() from the server but Footer is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/layout/footer.tsx\",\n    \"Footer\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProductDetail = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProductDetail() from the server but ProductDetail is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/product/product-detail.tsx\",\n    \"ProductDetail\",\n);\n","import type { Metadata } from \"next\";\r\nimport { Header } from \"@/components/layout/header\";\r\nimport { Footer } from \"@/components/layout/footer\";\r\nimport { ProductDetail } from \"@/components/product/product-detail\";\r\nimport { getRow } from \"@/lib/db/index\";\r\nimport type { Product } from \"@/types/product\";\r\nimport { getPlaceholderImage } from \"@/lib/image-utils\";\r\n\r\nconst baseUrl = process.env.NEXT_PUBLIC_URL || \"https://saded.ir\";\r\n\r\nasync function getProduct(id: string): Promise<Product | null> {\r\n  try {\r\n    const product = await getRow<any>(\r\n      \"SELECT * FROM products WHERE id = ? AND enabled = TRUE\",\r\n      [id]\r\n    );\r\n\r\n    if (!product) {\r\n      return null;\r\n    }\r\n\r\n    // Parse JSON fields\r\n    const parsedProduct: Product = {\r\n      ...product,\r\n      images: Array.isArray(product.images) \r\n        ? product.images \r\n        : (typeof product.images === 'string' ? JSON.parse(product.images) : []),\r\n      tags: Array.isArray(product.tags) \r\n        ? product.tags \r\n        : (typeof product.tags === 'string' ? JSON.parse(product.tags) : []),\r\n      specifications: typeof product.specifications === 'object' && product.specifications !== null \r\n        ? product.specifications \r\n        : (typeof product.specifications === 'string' ? JSON.parse(product.specifications) : {}),\r\n      price: Number(product.price),\r\n      originalPrice: product.originalPrice ? Number(product.originalPrice) : undefined,\r\n      stockCount: Number(product.stockCount),\r\n      inStock: Boolean(product.inStock),\r\n      enabled: Boolean(product.enabled),\r\n      vinEnabled: Boolean(product.vinEnabled),\r\n      airShippingEnabled: Boolean(product.airShippingEnabled),\r\n      seaShippingEnabled: Boolean(product.seaShippingEnabled),\r\n      airShippingCost: product.airShippingCost !== null && product.airShippingCost !== undefined \r\n        ? Number(product.airShippingCost) \r\n        : null,\r\n      seaShippingCost: product.seaShippingCost !== null && product.seaShippingCost !== undefined \r\n        ? Number(product.seaShippingCost) \r\n        : null,\r\n      createdAt: product.createdAt instanceof Date ? product.createdAt : new Date(product.createdAt),\r\n      updatedAt: product.updatedAt instanceof Date ? product.updatedAt : new Date(product.updatedAt),\r\n    };\r\n\r\n    return parsedProduct;\r\n  } catch (error) {\r\n    console.error(\"Error fetching product for metadata:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function generateMetadata({\r\n  params,\r\n}: {\r\n  params: Promise<{ id: string }>;\r\n}): Promise<Metadata> {\r\n  const { id } = await params;\r\n  const product = await getProduct(id);\r\n\r\n  if (!product) {\r\n    return {\r\n      title: \"محصول یافت نشد - ساد\",\r\n      description: \"محصول مورد نظر شما یافت نشد\",\r\n    };\r\n  }\r\n\r\n  const productImage = product.images?.[0] || getPlaceholderImage(1200, 630);\r\n  const productUrl = `${baseUrl}/products/${id}`;\r\n  const price = product.price / 1000; // Convert from Rials to Tomans for display\r\n  const description = product.description || `${product.name} - قطعه خودرو ${product.brand} با بهترین کیفیت و قیمت`;\r\n\r\n  return {\r\n    title: `${product.name} - ساد`,\r\n    description: description.substring(0, 160),\r\n    keywords: [\r\n      product.name,\r\n      product.brand || \"\",\r\n      product.category || \"\",\r\n      \"قطعات خودرو\",\r\n      \"قطعات وارداتی\",\r\n      ...(product.tags || []),\r\n    ],\r\n    alternates: {\r\n      canonical: productUrl,\r\n    },\r\n    openGraph: {\r\n      title: product.name,\r\n      description: description.substring(0, 160),\r\n      url: productUrl,\r\n      siteName: \"ساد - فروشگاه قطعات خودرو\",\r\n      images: [\r\n        {\r\n          url: productImage,\r\n          width: 1200,\r\n          height: 630,\r\n          alt: product.name,\r\n        },\r\n      ],\r\n      locale: \"fa_IR\",\r\n      type: \"website\",\r\n    },\r\n    twitter: {\r\n      card: \"summary_large_image\",\r\n      title: product.name,\r\n      description: description.substring(0, 160),\r\n      images: [productImage],\r\n    },\r\n    robots: {\r\n      index: true,\r\n      follow: true,\r\n      googleBot: {\r\n        index: true,\r\n        follow: true,\r\n        \"max-video-preview\": -1,\r\n        \"max-image-preview\": \"large\",\r\n        \"max-snippet\": -1,\r\n      },\r\n    },\r\n  };\r\n}\r\n\r\nexport default async function ProductDetailPage({\r\n  params,\r\n}: {\r\n  params: Promise<{ id: string }>;\r\n}) {\r\n  const { id } = await params;\r\n  \r\n  return (\r\n    <div className=\"flex min-h-screen flex-col\">\r\n      <Header />\r\n      <main className=\"flex-1 container py-4 sm:py-6 md:py-8\">\r\n        <ProductDetail productId={id} />\r\n      </main>\r\n      <Footer />\r\n    </div>\r\n  );\r\n}\r\n\r\n","/**\n * Database Wrapper\n * \n * این فایل یک interface یکپارچه برای استفاده از MySQL فراهم می‌کند\n */\n\n/**\n * Get single row from database\n */\nexport async function getRow<T extends Record<string, any> = any>(\n  sql: string,\n  params: any[] = []\n): Promise<T | null> {\n  try {\n    const { queryOne } = await import(\"./mysql\");\n    // Convert double-quoted column names to backticks for MySQL\n    const mysqlSql = convertToMySQLSQL(sql);\n    return await queryOne<T>(mysqlSql, params);\n  } catch (error: any) {\n    console.error(\"Database error in getRow:\", {\n      sql,\n      params,\n      error: error?.message,\n      code: error?.code,\n    });\n    throw error;\n  }\n}\n\n/**\n * Get multiple rows from database\n */\nexport async function getRows<T extends Record<string, any> = any>(\n  sql: string,\n  params: any[] = []\n): Promise<T[]> {\n  try {\n    const { queryAll } = await import(\"./mysql\");\n    // Convert double-quoted column names to backticks for MySQL\n    const mysqlSql = convertToMySQLSQL(sql);\n    return await queryAll<T>(mysqlSql, params);\n  } catch (error: any) {\n    console.error(\"Database error in getRows:\", {\n      sql,\n      params,\n      error: error?.message,\n      code: error?.code,\n    });\n    throw error;\n  }\n}\n\n/**\n * Run a query (INSERT, UPDATE, DELETE)\n */\nexport async function runQuery(\n  sql: string,\n  params: any[] = []\n): Promise<{ changes: number; lastInsertRowid?: number }> {\n  const { query } = await import(\"./mysql\");\n  const mysqlSql = convertToMySQLSQL(sql);\n  const result = await query(mysqlSql, params);\n  return {\n    changes: result.affectedRows || result.rowCount || 0,\n    lastInsertRowid: result.insertId || undefined,\n  };\n}\n\n/**\n * Convert SQL to MySQL SQL\n * - Converts double-quoted column names to backticks\n * - Converts PostgreSQL $1, $2, etc. placeholders to MySQL ? placeholders\n * - Converts ON CONFLICT to ON DUPLICATE KEY UPDATE\n * - MySQL uses ? placeholders (already correct)\n */\nfunction convertToMySQLSQL(sql: string): string {\n  let mysqlSql = sql;\n\n  // Convert PostgreSQL $1, $2, etc. placeholders to MySQL ? placeholders\n  // First, extract all $N placeholders and their positions\n  const placeholderRegex = /\\$(\\d+)/g;\n  const placeholders: Array<{ index: number; position: number }> = [];\n  let match;\n  while ((match = placeholderRegex.exec(sql)) !== null) {\n    placeholders.push({\n      index: parseInt(match[1], 10),\n      position: match.index,\n    });\n  }\n\n  // Replace placeholders in reverse order to maintain positions\n  if (placeholders.length > 0) {\n    // Sort by position in reverse order\n    placeholders.sort((a, b) => b.position - a.position);\n    \n    // Replace each $N with ?\n    for (const placeholder of placeholders) {\n      mysqlSql = mysqlSql.substring(0, placeholder.position) + \n                 '?' + \n                 mysqlSql.substring(placeholder.position + `$${placeholder.index}`.length);\n    }\n  }\n\n  // Convert double-quoted column names to backticks for MySQL\n  // Match \"columnName\" and replace with `columnName`\n  mysqlSql = mysqlSql.replace(/\"([^\"]+)\"/g, '`$1`');\n\n  // Convert PostgreSQL ON CONFLICT to MySQL ON DUPLICATE KEY UPDATE\n  mysqlSql = mysqlSql.replace(\n    /ON CONFLICT\\s*\\(([^)]+)\\)\\s*DO UPDATE SET\\s*(.+)/gi,\n    (match, conflictColumns, updateClause) => {\n      // Convert EXCLUDED.columnName to VALUES(columnName)\n      const convertedUpdate = updateClause.replace(/EXCLUDED\\.(\\w+)/gi, 'VALUES($1)');\n      return `ON DUPLICATE KEY UPDATE ${convertedUpdate}`;\n    }\n  );\n\n  // Remove MySQL-incompatible syntax like ::jsonb (legacy PostgreSQL syntax)\n  mysqlSql = mysqlSql.replace(/::jsonb/g, '');\n  mysqlSql = mysqlSql.replace(/::json/g, '');\n\n  return mysqlSql;\n}\n\n/**\n * Initialize database\n */\nexport async function initializeDatabase(): Promise<void> {\n  const { ensureDatabase, initializeTables } = await import(\"./mysql\");\n  await ensureDatabase();\n  await initializeTables();\n}\n\n/**\n * Test database connection\n */\nexport async function testConnection(): Promise<boolean> {\n  try {\n    const { testConnection } = await import(\"./mysql\");\n    return await testConnection();\n  } catch (error) {\n    return false;\n  }\n}\n\n/**\n * Get database type\n */\nexport function getDatabaseType(): \"mysql\" | \"none\" {\n  return \"mysql\";\n}\n","/**\r\n * Image utility functions\r\n */\r\n\r\n/**\r\n * Get placeholder image URL\r\n * Uses external service for Next.js Image component compatibility\r\n * @param width - Image width in pixels (default: 600)\r\n * @param height - Image height in pixels (default: 600)\r\n * @returns Placeholder image URL\r\n */\r\nexport function getPlaceholderImage(width: number = 600, height: number = 600): string {\r\n  // Use placehold.co service for Next.js Image compatibility\r\n  const text = encodeURIComponent(`${width}x${height}`);\r\n  return `https://placehold.co/${width}x${height}/f3f4f6/9ca3af?text=${text}`;\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"qUAEO,IAAM,EAAS,CAAA,EAAA,AADtB,EAAA,CAAA,CAAA,OACsB,uBAAA,AAAuB,EACzC,WAAa,MAAM,AAAI,MAAM,0NAA4N,EACzP,6DACA,sDAHG,IAAM,EAAS,CAAA,EADtB,AACsB,EADtB,CAAA,CAAA,OACsB,uBAAA,AAAuB,EACzC,WAAa,MAAM,AAAI,MAAM,0NAA4N,EACzP,yCACA,iHCHG,IAAM,EAAS,CAAA,EAAA,AADtB,EAAA,CAAA,CAAA,OACsB,uBAAA,AAAuB,EACzC,WAAa,MAAM,AAAI,MAAM,0NAA4N,EACzP,6DACA,sDAHG,IAAM,EAAS,CAAA,EAAA,AADtB,EAAA,CAAA,CAAA,OACsB,uBAAA,AAAuB,EACzC,WAAa,MAAM,AAAI,MAAM,0NAA4N,EACzP,yCACA,iHCHG,IAAM,EAAgB,CAAA,EAD7B,AAC6B,EAD7B,CAAA,CAAA,OAC6B,uBAAA,AAAuB,EAChD,WAAa,MAAM,AAAI,MAAM,wOAA0O,EACvQ,sEACA,oEAHG,IAAM,EAAgB,CAAA,EAD7B,AAC6B,EAD7B,CAAA,CAAA,OAC6B,uBAAA,AAAuB,EAChD,WAAa,MAAM,AAAI,MAAM,wOAA0O,EACvQ,kDACA,+ICJJ,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OCMO,eAAe,EACpB,CAAW,CACX,EAAgB,EAAE,EAElB,GAAI,CACF,GAAM,UAAE,CAAQ,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,OAEf,EAAW,AA2DrB,SAAS,AAAkB,CAAW,EACpC,IAMI,EANA,EAAW,EAIT,EAAmB,WACnB,EAA2D,EAAE,CAEnE,KAAO,AAAyC,KAAM,GAA9C,EAAQ,EAAiB,IAAI,CAAC,EAAA,CAAI,EACxC,EAAa,IAAI,CAAC,CAChB,MAAO,SAAS,CAAK,CAAC,EAAE,CAAE,IAC1B,SAAU,EAAM,KAAK,AACvB,GAIF,GAAI,EAAa,MAAM,CAAG,EAKxB,CAL2B,GAKtB,IAAM,KAHX,EAAa,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,QAAQ,CAAG,EAAE,QAAQ,EAGzB,GACxB,EAAW,EAAS,MADkB,GACT,CAAC,EAAG,EAAY,QAAQ,EAC1C,IACA,EAAS,SAAS,CAAC,EAAY,QAAQ,CAAG,CAAC,CAAC,EAAE,EAAY,KAAK,CAAA,CAAE,CAAC,MAAM,EAsBvF,OAAO,AAFP,EAAW,CADX,EAAW,CAVX,EAAW,CAHX,EAAW,EAAS,OAAO,CAAC,aAAc,OAAA,EAGtB,OAAO,CACzB,qDACA,CAAC,EAAO,EAAiB,KAEvB,IAAM,EAAkB,EAAa,OAAO,CAAC,oBAAqB,cAClE,MAAO,CAAC,wBAAwB,EAAE,EAAA,CAAiB,AACrD,EAAA,EAIkB,OAAO,CAAC,WAAY,GAAA,EACpB,OAAO,CAAC,UAAW,GAGzC,EA1GuC,GACnC,OAAO,MAAM,EAAY,EAAU,EACrC,CAAE,MAAO,EAAY,CAOnB,MANA,QAAQ,KAAK,CAAC,4BAA6B,KACzC,SACA,EACA,MAAO,GAAO,QACd,KAAM,GAAO,IACf,GACM,CACR,CACF,CDnBA,IAAM,EAAU,QAAQ,GAAG,CAAC,eAAe,EAAI,mBAE/C,eAAe,EAAW,CAAU,EAClC,GAAI,CACF,IAAM,EAAU,MAAM,EACpB,yDACA,CAAC,EAAG,EAGN,GAAI,CAAC,EACH,OADY,AACL,KAiCT,MA7B+B,CAC7B,AA4BK,GA5BF,CAAO,CACV,OAAQ,MAAM,OAAO,CAAC,EAAQ,MAAM,EAChC,EAAQ,MAAM,CACa,UAA1B,OAAO,EAAQ,MAAM,CAAgB,KAAK,KAAK,CAAC,EAAQ,MAAM,EAAI,EAAE,CACzE,KAAM,MAAM,OAAO,CAAC,EAAQ,IAAI,EAC5B,EAAQ,IAAI,CACa,UAAxB,OAAO,EAAQ,IAAI,CAAgB,KAAK,KAAK,CAAC,EAAQ,IAAI,EAAI,EAAE,CACrE,eAAkD,UAAlC,OAAO,EAAQ,cAAc,EAA4C,OAA3B,EAAQ,cAAc,CAChF,EAAQ,cAAc,CACa,UAAlC,OAAO,EAAQ,cAAc,CAAgB,KAAK,KAAK,CAAC,EAAQ,cAAc,EAAI,CAAC,EACxF,MAAO,OAAO,EAAQ,KAAK,EAC3B,cAAe,EAAQ,aAAa,CAAG,OAAO,EAAQ,aAAa,OAAI,EACvE,WAAY,OAAO,EAAQ,UAAU,EACrC,SAAS,CAAQ,EAAQ,OAAO,CAChC,SAAS,CAAQ,EAAQ,OAAO,CAChC,YAAY,CAAQ,EAAQ,UAAU,CACtC,oBAAoB,CAAQ,EAAQ,kBAAkB,CACtD,oBAAoB,CAAQ,EAAQ,kBAAkB,CACtD,gBAA6C,OAA5B,EAAQ,eAAe,OAAyC,IAA5B,EAAQ,eAAe,CACxE,OAAO,EAAQ,eAAe,EAC9B,KACJ,gBAA6C,OAA5B,EAAQ,eAAe,OAAyC,IAA5B,EAAQ,eAAe,CACxE,OAAO,EAAQ,eAAe,EAC9B,KACJ,UAAW,EAAQ,SAAS,YAAY,KAAO,EAAQ,SAAS,CAAG,IAAI,KAAK,EAAQ,SAAS,EAC7F,UAAW,EAAQ,SAAS,YAAY,KAAO,EAAQ,SAAS,CAAG,IAAI,KAAK,EAAQ,SAAS,CAC/F,CAGF,CAAE,MAAO,EAAO,CAEd,OADA,QAAQ,KAAK,CAAC,uCAAwC,GAC/C,IACT,CACF,CAEO,eAAe,EAAiB,CACrC,QAAM,CAGP,EACC,GAAM,IAAE,CAAE,CAAE,CAAG,MAAM,EACf,EAAU,MAAM,EAAW,GAEjC,GAAI,CAAC,EACH,MAAO,CADK,AAEV,MAAO,uBACP,YAAa,6BACf,EAGF,IAAM,EAAe,EAAQ,MAAM,EAAE,CAAC,EAAE,EE9DnC,AF8DuC,SE9D9B,AAAoB,EAAgB,GAAG,CAAE,EAAiB,GAAG,EAE3E,IAAM,EAAO,mBAAmB,CAAA,EAAG,EAAM,CAAC,EAAE,EAAA,CAAQ,EACpD,MAAO,CAAC,qBAAqB,EAAE,EAAM,CAAC,EAAE,EAAO,oBAAoB,EAAE,EAAA,CAAM,AAC7E,EF0DkE,KAAM,KAChE,EAAa,CAAA,EAAG,EAAQ,UAAU,EAAE,EAAA,CAAI,CAChC,EAAQ,KAAK,CAC3B,EAD8B,EACxB,EAAc,EADgB,AACR,WAAW,EAAI,CAAA,EAAG,EAAQ,IAAI,CAAC,cAAc,EAAE,EAAQ,EADJ,GACS,CAAC,uBAAuB,CAAC,CAEjH,MAAO,CACL,MAAO,CAAA,EAAG,EAAQ,IAAI,CAAC,MAAM,CAAC,CAC9B,YAAa,EAAY,SAAS,CAAC,EAAG,KACtC,SAAU,CACR,EAAQ,IAAI,CACZ,EAAQ,KAAK,EAAI,GACjB,EAAQ,QAAQ,EAAI,GACpB,cACA,mBACI,EAAQ,IAAI,EAAI,EAAE,CACvB,CACD,WAAY,CACV,UAAW,CACb,EACA,UAAW,CACT,MAAO,EAAQ,IAAI,CACnB,YAAa,EAAY,SAAS,CAAC,EAAG,KACtC,IAAK,EACL,SAAU,4BACV,OAAQ,CACN,CACE,IAAK,EACL,MAAO,KACP,OAAQ,IACR,IAAK,EAAQ,IAAI,AACnB,EACD,CACD,OAAQ,QACR,KAAM,SACR,EACA,QAAS,CACP,KAAM,sBACN,MAAO,EAAQ,IAAI,CACnB,YAAa,EAAY,SAAS,CAAC,EAAG,KACtC,OAAQ,CAAC,EAAa,AACxB,EACA,OAAQ,CACN,OAAO,EACP,QAAQ,EACR,UAAW,CACT,MAAO,GACP,QAAQ,EACR,oBAAqB,CAAC,EACtB,oBAAqB,QACrB,cAAe,CAAC,CAClB,CACF,CACF,CACF,CAEe,eAAe,EAAkB,QAC9C,CAAM,CAGP,EACC,GAAM,IAAE,CAAE,CAAE,CAAG,MAAM,EAErB,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uCACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAA,GACP,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iDACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,CAAC,UAAW,MAE5B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAA,KAGb","ignoreList":[0,1,2]}
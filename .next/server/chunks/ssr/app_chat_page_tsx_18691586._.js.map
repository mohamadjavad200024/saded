{"version":3,"sources":["../../../../app/chat/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect, useCallback } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Send,\n  MessageCircle,\n  Phone,\n  Mail,\n  Image,\n  Paperclip,\n  MapPin,\n  FileText,\n  X,\n  Mic,\n  Square,\n  Pause,\n  Loader2,\n  Check,\n  CheckCheck,\n  Trash2,\n  ChevronDown,\n  ArrowRight,\n} from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { AudioPlayer } from \"@/components/chat/audio-player\";\nimport { useNotifications } from \"@/hooks/use-notifications\";\nimport { OnlineStatusBadge } from \"@/components/chat/online-status-badge\";\nimport { useAdminPresence } from \"@/hooks/use-admin-presence\";\nimport { TypingIndicator } from \"@/components/chat/typing-indicator\";\nimport { logger } from \"@/lib/logger-client\";\nimport { useAuthStore } from \"@/store/auth-store\";\nimport { ProtectedRoute } from \"@/components/auth/protected-route\";\n\ntype MessageStatus = \"sending\" | \"sent\" | \"delivered\" | \"read\";\n\ninterface Message {\n  id: string;\n  text: string;\n  sender: \"user\" | \"support\";\n  timestamp: Date;\n  attachments?: Attachment[];\n  status?: MessageStatus;\n}\n\ninterface Attachment {\n  id: string;\n  type: \"image\" | \"file\" | \"location\" | \"audio\";\n  url?: string;\n  name?: string;\n  size?: number;\n  duration?: number;\n}\n\nfunction ChatPageContent() {\n  const router = useRouter();\n  const { toast } = useToast();\n  const { showNotification, requestPermission } = useNotifications();\n  const { isOnline, lastSeen, checkStatus } = useAdminPresence({\n    enabled: true,\n    heartbeatInterval: 20000,\n  });\n  const { user, isAuthenticated } = useAuthStore();\n  const [messages, setMessages] = useState<Message[]>([\n    {\n      id: \"1\",\n      text: \"سلام! خوش آمدید. برای خرید سریع لطفاً اطلاعات زیر را وارد کنید:\",\n      sender: \"support\",\n      timestamp: new Date(),\n    },\n  ]);\n  const [message, setMessage] = useState(\"\");\n  const [replyingTo, setReplyingTo] = useState<Message | null>(null);\n  const [editingMessage, setEditingMessage] = useState<Message | null>(null);\n  const [step, setStep] = useState<\"info\" | \"chat\">(\"chat\");\n  \n  // Load customer info from auth store (chat is protected, so we expect an authenticated user)\n  const loadCustomerInfo = useCallback(() => {\n    if (typeof window === \"undefined\") return { name: \"\", phone: \"\", email: \"\" };\n    \n    // ProtectedRoute ensures user exists, so we can safely use it\n    if (user) {\n      return {\n        name: user.name || \"\",\n        phone: user.phone || \"\",\n        email: \"\",\n      };\n    }\n    return { name: \"\", phone: \"\", email: \"\" };\n  }, [user]);\n\n  const [customerInfo, setCustomerInfo] = useState(loadCustomerInfo);\n  \n  // Update customer info when auth state changes\n  useEffect(() => {\n    const updatedInfo = loadCustomerInfo();\n    setCustomerInfo(updatedInfo);\n  }, [user, loadCustomerInfo]);\n  const [attachments, setAttachments] = useState<Attachment[]>([]);\n  const [showAttachmentOptions, setShowAttachmentOptions] = useState(false);\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordingTime, setRecordingTime] = useState(0);\n  const [audioUrl, setAudioUrl] = useState<string | null>(null);\n  const [audioBlob, setAudioBlob] = useState<Blob | null>(null);\n  const [isSaving, setIsSaving] = useState(false);\n  const [isSupportTyping, setIsSupportTyping] = useState(false);\n  const [showScrollToBottom, setShowScrollToBottom] = useState(false);\n  const [showPermissionGuide, setShowPermissionGuide] = useState(false);\n  const [chatId, setChatId] = useState<string | null>(null);\n\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const imageInputRef = useRef<HTMLInputElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const recordingIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const hasScrolledOnOpenRef = useRef<boolean>(false);\n  const shouldAutoSendRef = useRef<boolean>(false);\n\n  // Initialize user's chat (server-side, session-based)\n  const initMyChat = useCallback(async (opts?: { silent?: boolean }) => {\n    // Authentication removed - chat is now open to everyone\n    try {\n      \n      // Wait a bit to ensure cookie is available (especially after login)\n      await new Promise(resolve => setTimeout(resolve, 200));\n      \n      // Retry mechanism for cookie availability\n      let res: Response | null = null;\n      let lastError: Error | null = null;\n      \n      for (let attempt = 0; attempt < 3; attempt++) {\n        try {\n          // Get user from store to send as header in development\n          const currentUser = useAuthStore.getState().user;\n          const headers: Record<string, string> = {\n            \"Cache-Control\": \"no-cache\",\n            \"Content-Type\": \"application/json\",\n          };\n          \n          // Add userId header in development as fallback\n          if (process.env.NODE_ENV === 'development' && currentUser?.id) {\n            headers['x-user-id'] = currentUser.id;\n          }\n          \n          res = await fetch(\"/api/chat/my\", { \n            method: \"GET\",\n            credentials: \"include\", // CRITICAL: Must include credentials to send cookies\n            cache: \"no-store\",\n            headers,\n          });\n          \n          // If successful, break out of retry loop\n          if (res.ok) {\n            break;\n          }\n          \n          // If 401, session might be invalid - check auth again\n          if (res.status === 401) {\n            // Re-check authentication\n            const recheck = await fetch(\"/api/auth/me\", {\n              credentials: \"include\",\n              cache: \"no-store\",\n            });\n            const recheckData = await recheck.json().catch(() => null);\n            \n            if (!recheck.ok || !recheckData?.success || !recheckData?.data?.authenticated) {\n              // Session is definitely invalid\n              if (!opts?.silent) {\n                router.push(\"/auth?redirect=\" + encodeURIComponent(window.location.pathname));\n              }\n              return null;\n            }\n            \n            // Session is valid but chat endpoint failed - retry\n            if (attempt < 2) {\n              await new Promise(resolve => setTimeout(resolve, 500));\n              continue;\n            }\n          }\n          \n          // For other errors, break\n          break;\n        } catch (error) {\n          lastError = error instanceof Error ? error : new Error(String(error));\n          if (attempt < 2) {\n            await new Promise(resolve => setTimeout(resolve, 500));\n          }\n        }\n      }\n      \n      if (!res) {\n        throw lastError || new Error(\"Failed to fetch chat\");\n      }\n      \n      const json = await res.json().catch(() => null);\n      if (!res.ok || !json?.success || !json?.data?.chatId) {\n        // Authentication removed - no redirect needed\n        const msg = json?.error || json?.message || \"خطا در دریافت چت\";\n        throw new Error(msg);\n      }\n      const id = String(json.data.chatId);\n      setChatId(id);\n      setStep(\"chat\");\n      return id;\n    } catch (e) {\n      if (!opts?.silent) {\n        toast({\n          title: \"خطا\",\n          description: e instanceof Error ? e.message : \"خطا در دریافت چت\",\n          variant: \"destructive\",\n        });\n      }\n      return null;\n    }\n  }, [toast]);\n\n  // Poll for new messages (optionally for a specific chatId)\n  const pollForNewMessages = useCallback(async (chatIdOverride?: string) => {\n    const id = chatIdOverride || chatId;\n    if (!id) return;\n\n    try {\n      const response = await fetch(`/api/chat?chatId=${id}`, { credentials: \"include\" });\n      if (!response.ok) {\n        // If 401, user is not authenticated - redirect to auth\n        if (response.status === 401) {\n          router.push(\"/auth?redirect=\" + encodeURIComponent(window.location.pathname));\n          return;\n        }\n        return;\n      }\n\n      const data = await response.json();\n      if (data.success && data.data?.messages) {\n        const formattedMessages: Message[] = data.data.messages.map((msg: any) => ({\n          id: msg.id,\n          text: msg.text || \"\",\n          sender: msg.sender as \"user\" | \"support\",\n          timestamp: new Date(msg.createdAt),\n          attachments: msg.attachments\n            ? (Array.isArray(msg.attachments) ? msg.attachments : JSON.parse(msg.attachments))\n            : [],\n          status: msg.status || (msg.sender === \"user\" ? \"sent\" : undefined),\n        }));\n\n        // Merge with existing messages and remove deleted ones\n        setMessages((prev) => {\n          const dbMessageIds = new Set(formattedMessages.map((m) => m.id));\n          const existingIds = new Set(prev.map((m) => m.id));\n          const uniqueNewMessages = formattedMessages.filter((msg) => !existingIds.has(msg.id));\n          \n          // Update status of existing messages from database\n          const updatedPrev = prev\n            .filter((existingMsg) => {\n              // Keep temp messages (those starting with \"temp-\") and messages that exist in DB\n              return existingMsg.id.startsWith(\"temp-\") || dbMessageIds.has(existingMsg.id);\n            })\n            .map((existingMsg) => {\n              const dbMsg = formattedMessages.find((m) => m.id === existingMsg.id);\n              if (dbMsg && existingMsg.sender === \"user\" && dbMsg.status && existingMsg.status !== dbMsg.status) {\n                return { ...existingMsg, status: dbMsg.status };\n              }\n              return existingMsg;\n            });\n          \n          // If we have new messages, add them. Otherwise just return updated prev (preserves tempId messages)\n          if (uniqueNewMessages.length > 0) {\n            return [...updatedPrev, ...uniqueNewMessages];\n          }\n          return updatedPrev;\n        });\n      }\n    } catch (error) {\n      logger.error(\"Error polling messages:\", error);\n    }\n  }, [chatId]);\n\n  // Auto-init chat once user is available\n  // ProtectedRoute ensures user exists, so we can safely use it\n  useEffect(() => {\n    if (!user) return; // ProtectedRoute should handle this\n    if (chatId) return;\n    \n    // Add delay to ensure cookie is available (especially after login redirect)\n    // This gives browser time to process the Set-Cookie header\n    const timeoutId = setTimeout(() => {\n      initMyChat({ silent: true }).catch(() => null);\n    }, 500);\n    \n    return () => clearTimeout(timeoutId);\n  }, [user, chatId, initMyChat]);\n\n  // Start polling when chatId is available\n  // ProtectedRoute ensures user exists, so we can safely use it\n  useEffect(() => {\n    if (!chatId || !user) return;\n    pollForNewMessages(chatId);\n    const t = setInterval(() => pollForNewMessages(chatId), 3000);\n    return () => clearInterval(t);\n  }, [chatId, pollForNewMessages, user]);\n\n  const createChat = useCallback(\n    async (info: { name: string; phone: string; email?: string }, opts?: { silent?: boolean }) => {\n      const name = info.name?.trim();\n      const phone = info.phone?.trim();\n      const email = info.email?.trim();\n\n      if (!name || !phone) {\n        if (!opts?.silent) {\n          toast({\n            title: \"خطا\",\n            description: \"لطفاً نام و شماره تماس را وارد کنید\",\n            variant: \"destructive\",\n          });\n        }\n        return null;\n      }\n\n      try {\n        const response = await fetch(\"/api/chat\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          credentials: \"include\",\n          body: JSON.stringify({\n            customerInfo: { name, phone, email: email || undefined },\n            messages: [],\n          }),\n        });\n\n        const data = await response.json().catch(() => null);\n        if (!response.ok || !data?.success) {\n          const msg =\n            data?.error ||\n            (response.status === 429 ? \"درخواست‌های شما زیاد است. لطفاً کمی بعد دوباره تلاش کنید.\" : null) ||\n            \"خطا در ایجاد چت\";\n          throw new Error(msg);\n        }\n\n        const newChatId = data.data?.id;\n        if (!newChatId) throw new Error(\"خطا در ایجاد چت\");\n\n        setChatId(newChatId);\n        setStep(\"chat\");\n        // Fetch messages for the chat (new chat will be empty)\n        pollForNewMessages(newChatId);\n\n        return newChatId as string;\n      } catch (error) {\n        logger.error(\"Error creating chat:\", error);\n        if (!opts?.silent) {\n          toast({\n            title: \"خطا\",\n            description: error instanceof Error ? error.message : \"خطا در ایجاد چت. لطفاً دوباره تلاش کنید.\",\n            variant: \"destructive\",\n          });\n        }\n        return null;\n      }\n    },\n    [toast, pollForNewMessages]\n  );\n\n  // Handle submit info (manual)\n  const handleSubmitInfo = useCallback(async () => {\n    // Chat is session-based; just ensure we have a chatId for the current user\n    await initMyChat({ silent: false });\n  }, [initMyChat]);\n\n  // Format time\n  const formatTime = useCallback((seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins.toString().padStart(2, \"0\")}:${secs.toString().padStart(2, \"0\")}`;\n  }, []);\n\n  // Check microphone permission\n  const checkMicrophonePermission = useCallback(async (): Promise<boolean> => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      stream.getTracks().forEach((track) => track.stop());\n      return true;\n    } catch (error) {\n      setShowPermissionGuide(true);\n      return false;\n    }\n  }, []);\n\n  // Start recording\n  const startRecording = useCallback(async () => {\n    try {\n      const hasPermission = await checkMicrophonePermission();\n      if (!hasPermission) return;\n\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      const mediaRecorder = new MediaRecorder(stream);\n      mediaRecorderRef.current = mediaRecorder;\n\n      const chunks: Blob[] = [];\n      mediaRecorder.ondataavailable = (e) => {\n        if (e.data.size > 0) chunks.push(e.data);\n      };\n\n      mediaRecorder.onstop = () => {\n        const blob = new Blob(chunks, { type: \"audio/webm\" });\n        setAudioBlob(blob);\n        const url = URL.createObjectURL(blob);\n        setAudioUrl(url);\n        stream.getTracks().forEach((track) => track.stop());\n      };\n\n      mediaRecorder.start();\n      setIsRecording(true);\n      setRecordingTime(0);\n\n      const interval = setInterval(() => {\n        setRecordingTime((prev) => prev + 1);\n      }, 1000);\n      recordingIntervalRef.current = interval;\n    } catch (error) {\n      logger.error(\"Error starting recording:\", error);\n      toast({\n        title: \"خطا\",\n        description: \"خطا در شروع ضبط صدا\",\n        variant: \"destructive\",\n      });\n    }\n  }, [checkMicrophonePermission, toast]);\n\n  // Stop recording\n  const stopRecording = useCallback(() => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n      if (recordingIntervalRef.current) {\n        clearInterval(recordingIntervalRef.current);\n        recordingIntervalRef.current = null;\n      }\n    }\n  }, [isRecording]);\n\n  // Cancel recording\n  const cancelRecording = useCallback(() => {\n    stopRecording();\n    setAudioUrl(null);\n    setAudioBlob(null);\n    setRecordingTime(0);\n  }, [stopRecording]);\n\n  // Save recording\n  const saveRecording = useCallback(async () => {\n    logger.info(\"saveRecording called\", { hasAudioBlob: !!audioBlob, hasAudioUrl: !!audioUrl });\n    console.log(\"[Voice] saveRecording called\", { hasAudioBlob: !!audioBlob, hasAudioUrl: !!audioUrl, audioBlobSize: audioBlob?.size, audioUrl });\n    \n    if (!audioBlob || !audioUrl) {\n      logger.warn(\"No audio blob or URL available\");\n      console.log(\"[Voice] No audio blob or URL available, returning\");\n      toast({\n        title: \"خطا\",\n        description: \"هیچ ضبط صوتی موجود نیست\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      setIsSaving(true);\n      console.log(\"[Voice] Starting upload...\");\n      const formData = new FormData();\n      formData.append(\"file\", audioBlob, \"recording.webm\");\n      formData.append(\"type\", \"audio\");\n\n      const response = await fetch(\"/api/chat/upload\", {\n        method: \"POST\",\n        credentials: \"include\",\n        body: formData,\n      });\n\n      if (!response.ok) throw new Error(\"خطا در آپلود فایل\");\n\n      const data = await response.json();\n      console.log(\"[Voice] Upload response:\", data);\n      if (data.success && data.data?.url) {\n        // Generate truly unique ID\n        const uniqueId = typeof crypto !== 'undefined' && crypto.randomUUID \n          ? crypto.randomUUID() \n          : `audio-${Date.now()}-${Math.random().toString(36).substr(2, 9)}-${performance.now()}`;\n        \n        const attachment: Attachment = {\n          id: uniqueId,\n          type: \"audio\",\n          url: data.data.url,\n          name: \"پیام صوتی\",\n          duration: recordingTime,\n        };\n        console.log(\"[Voice] Adding attachment:\", attachment);\n        setAttachments((prev) => {\n          // Check if attachment already exists to avoid duplicates\n          const exists = prev.some(att => att.id === attachment.id);\n          if (exists) {\n            console.log(\"[Voice] Attachment already exists, skipping\");\n            return prev; // Already exists, don't add again\n          }\n          const newAttachments = [...prev, attachment];\n          console.log(\"[Voice] New attachments:\", newAttachments);\n          return newAttachments;\n        });\n        setAudioUrl(null);\n        setAudioBlob(null);\n        setRecordingTime(0);\n        \n        // Set flag to auto-send message with audio attachment\n        shouldAutoSendRef.current = true;\n        console.log(\"[Voice] shouldAutoSendRef set to true\");\n      } else {\n        console.error(\"[Voice] Upload failed:\", data);\n      }\n    } catch (error) {\n      logger.error(\"Error saving recording:\", error);\n      toast({\n        title: \"خطا\",\n        description: \"خطا در ذخیره پیام صوتی\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSaving(false);\n    }\n  }, [audioBlob, audioUrl, recordingTime, toast]);\n\n  // Handle file select\n  const handleFileSelect = useCallback(\n    async (e: React.ChangeEvent<HTMLInputElement>, type: \"image\" | \"file\") => {\n      const files = e.target.files;\n      if (!files || files.length === 0) return;\n\n      try {\n        for (let i = 0; i < files.length; i++) {\n          const file = files[i];\n          const formData = new FormData();\n          formData.append(\"file\", file);\n          formData.append(\"type\", type);\n\n          // Add userId header if user is available (fallback for session issues)\n          const headers: Record<string, string> = {};\n          if (user?.id) {\n            headers['x-user-id'] = user.id;\n          }\n\n          const response = await fetch(\"/api/chat/upload\", {\n            method: \"POST\",\n            credentials: \"include\", // CRITICAL: Include cookies for session\n            headers,\n            body: formData,\n          });\n\n          if (!response.ok) {\n            const errorData = await response.json().catch(() => null);\n            const errorMessage = errorData?.error || errorData?.message || \"خطا در آپلود فایل\";\n            throw new Error(errorMessage);\n          }\n\n          const data = await response.json();\n          if (data.success && data.data?.url) {\n            const attachment: Attachment = {\n              id: `${type}-${Date.now()}-${i}-${Math.random().toString(36).substr(2, 9)}`,\n              type,\n              url: data.data.url,\n              name: file.name,\n              size: file.size,\n            };\n            setAttachments((prev) => [...prev, attachment]);\n          }\n        }\n      } catch (error) {\n        logger.error(\"Error uploading file:\", error);\n        toast({\n          title: \"خطا\",\n          description: \"خطا در آپلود فایل\",\n          variant: \"destructive\",\n        });\n      }\n\n      // Reset input\n      if (e.target) e.target.value = \"\";\n    },\n    [toast, router]\n  );\n\n  // Handle location share\n  const handleLocationShare = useCallback(() => {\n    logger.info(\"handleLocationShare called\");\n    console.log(\"[Location] handleLocationShare called\");\n    \n    if (!navigator.geolocation) {\n      logger.warn(\"Geolocation not supported\");\n      console.log(\"[Location] Geolocation not supported\");\n      toast({\n        title: \"خطا\",\n        description: \"مرورگر شما از موقعیت‌یابی پشتیبانی نمی‌کند\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check if we're on a secure origin (HTTPS or localhost)\n    const isSecure = window.location.protocol === 'https:' || window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n    console.log(\"[Location] Protocol:\", window.location.protocol, \"Hostname:\", window.location.hostname, \"IsSecure:\", isSecure);\n    if (!isSecure) {\n      logger.warn(\"Not on secure origin\");\n      console.log(\"[Location] Not on secure origin\");\n      toast({\n        title: \"خطا\",\n        description: \"برای استفاده از موقعیت‌یابی باید از HTTPS استفاده کنید. لطفاً از آدرس امن سایت استفاده کنید.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Show loading toast\n    toast({\n      title: \"در حال دریافت موقعیت...\",\n      description: \"لطفاً اجازه دسترسی به موقعیت را در مرورگر بدهید\",\n      duration: 3000,\n    });\n\n    logger.info(\"Requesting geolocation permission...\");\n    console.log(\"[Location] Requesting geolocation permission...\");\n    navigator.geolocation.getCurrentPosition(\n      (position) => {\n        logger.info(\"Location received:\", position.coords);\n        console.log(\"[Location] Position received:\", position.coords);\n        const { latitude, longitude } = position.coords;\n        const url = `https://www.google.com/maps?q=${latitude},${longitude}`;\n        const attachment: Attachment = {\n          id: `location-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n          type: \"location\",\n          url,\n          name: \"موقعیت من\",\n        };\n        console.log(\"[Location] Adding attachment:\", attachment);\n        setAttachments((prev) => {\n          const newAttachments = [...prev, attachment];\n          console.log(\"[Location] New attachments:\", newAttachments);\n          return newAttachments;\n        });\n        setShowAttachmentOptions(false);\n        \n        // Set flag to auto-send message with location attachment\n        shouldAutoSendRef.current = true;\n        console.log(\"[Location] shouldAutoSendRef set to true\");\n      },\n      (error) => {\n        logger.error(\"Error getting location:\", error);\n        let errorMessage = \"خطا در دریافت موقعیت\";\n        if (error.code === 1) {\n          errorMessage = \"دسترسی به موقعیت رد شد. لطفاً در تنظیمات مرورگر اجازه دسترسی به موقعیت را فعال کنید.\";\n        } else if (error.code === 2) {\n          errorMessage = \"موقعیت در دسترس نیست. لطفاً مطمئن شوید که GPS فعال است.\";\n        } else if (error.code === 3) {\n          errorMessage = \"دریافت موقعیت زمان‌بر شد. لطفاً دوباره تلاش کنید.\";\n        }\n        toast({\n          title: \"خطا\",\n          description: errorMessage,\n          variant: \"destructive\",\n        });\n      },\n      {\n        enableHighAccuracy: true,\n        timeout: 10000,\n        maximumAge: 0,\n      }\n    );\n  }, [toast]);\n\n  // Remove attachment\n  const handleRemoveAttachment = useCallback((id: string) => {\n    setAttachments((prev) => prev.filter((att) => att.id !== id));\n  }, []);\n\n  // Send typing status\n  const sendTypingStatus = useCallback(\n    async (isTyping: boolean) => {\n      if (!chatId) return;\n\n      try {\n        await fetch(\"/api/chat/typing\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          credentials: \"include\",\n          body: JSON.stringify({\n            chatId,\n            sender: \"user\",\n            isTyping,\n          }),\n        });\n      } catch (error) {\n        // Silent fail\n      }\n    },\n    [chatId]\n  );\n\n  // Update customer info when auth state changes\n  useEffect(() => {\n    // ProtectedRoute ensures user exists, so we can safely use it\n    if (!user) return;\n\n    const nextInfo = {\n      name: user.name || \"\",\n      phone: user.phone || \"\",\n      email: \"\",\n    };\n    setCustomerInfo(nextInfo);\n\n    // ChatId is initialized server-side via /api/chat/my\n  }, [user]);\n\n  // Check support typing\n  const checkSupportTyping = useCallback(async () => {\n    if (!chatId) return;\n\n    try {\n      const response = await fetch(`/api/chat/typing?chatId=${chatId}&sender=support`, { credentials: \"include\" });\n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          setIsSupportTyping(data.data?.isTyping || false);\n        }\n      }\n    } catch (error) {\n      // Silent fail\n    }\n  }, [chatId]);\n\n  // Handle send message\n  const handleSendMessage = useCallback(async () => {\n    // ProtectedRoute ensures user exists, so we can safely use it\n    // Server will verify session in API routes\n    if (!user) {\n      // This shouldn't happen if ProtectedRoute is working correctly\n      toast({\n        title: \"خطا\",\n        description: \"برای ارسال پیام باید وارد حساب کاربری خود شوید\",\n        variant: \"destructive\",\n      });\n      router.push(\"/auth?redirect=\" + encodeURIComponent(window.location.pathname));\n      return;\n    }\n    \n    let activeChatId = chatId;\n    if (!activeChatId) {\n      const created = await initMyChat({ silent: true });\n      if (!created) {\n        toast({\n          title: \"خطا\",\n          description: \"چت آماده نیست. لطفاً دوباره تلاش کنید\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      activeChatId = created;\n    }\n\n    // IMPORTANT: Read from textarea ref first (IME/composition can make React state lag behind)\n    const currentText = (textareaRef.current?.value ?? message) as string;\n    if (!currentText.trim() && attachments.length === 0) return;\n\n    // Use authenticated user info directly (no need for customerInfo step)\n    if (!user || !user.name || !user.phone) {\n      toast({\n        title: \"خطا\",\n        description: \"اطلاعات کاربری کامل نیست. لطفاً دوباره وارد شوید\",\n        variant: \"destructive\",\n      });\n      router.push(\"/auth?redirect=\" + encodeURIComponent(window.location.pathname));\n      return;\n    }\n\n    // If editing, update the message\n    if (editingMessage) {\n      try {\n        const response = await fetch(`/api/chat/message/${editingMessage.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          credentials: \"include\",\n          body: JSON.stringify({\n            text: currentText,\n            attachments: attachments,\n          }),\n        });\n\n        if (response.ok) {\n          setMessages((prev) =>\n            prev.map((msg) =>\n              msg.id === editingMessage.id\n                ? { ...msg, text: currentText, attachments: attachments }\n                : msg\n            )\n          );\n          setEditingMessage(null);\n          setMessage(\"\");\n          setAttachments([]);\n        }\n      } catch (error) {\n        logger.error(\"Error editing message:\", error);\n      }\n      return;\n    }\n\n    const tempId = `temp-${Date.now()}`;\n    const newMessage: Message = {\n      id: tempId,\n      text: message,\n      sender: \"user\",\n      timestamp: new Date(),\n      attachments: attachments,\n      status: \"sending\",\n    };\n\n    // Save message text before clearing\n    const messageText = currentText;\n    \n    // Optimistic update: Add message to UI immediately for better UX\n    setMessages((prev) => [...prev, newMessage]);\n    \n    // Clear input and attachments smoothly (no flash)\n    setMessage(\"\");\n    setAttachments([]);\n    setReplyingTo(null);\n\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n      typingTimeoutRef.current = null;\n    }\n    sendTypingStatus(false);\n\n    try {\n      // Prepare message for API - use saved messageText instead of cleared message\n      const messageToSave = {\n        id: tempId,\n        text: messageText,\n        sender: \"user\",\n        timestamp: newMessage.timestamp.toISOString(),\n        attachments: attachments.filter((att) => {\n          const url = att.url;\n          return url && \n                 !url.startsWith('blob:') && \n                 !url.startsWith('data:') &&\n                 (url.startsWith('http') || url.startsWith('/'));\n        }),\n        status: \"sent\",\n      };\n\n      // Use authenticated user info directly (guaranteed to exist from checks above)\n      const finalCustomerInfo = {\n        name: user.name || \"\",\n        phone: user.phone || \"\",\n        email: customerInfo.email || \"\",\n      };\n\n      const response = await fetch(\"/api/chat\", {\n        method: \"POST\",\n        headers: { \n          \"Content-Type\": \"application/json\",\n          ...(process.env.NODE_ENV === 'development' && user?.id ? { 'x-user-id': user.id } : {}),\n        },\n        credentials: \"include\", // CRITICAL: Include cookies for session\n        body: JSON.stringify({\n          chatId: activeChatId,\n          customerInfo: finalCustomerInfo,\n          messages: [messageToSave],\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({} as any));\n        \n        // If 401 (Unauthorized), session is invalid - redirect to login\n        // Server has verified that session is invalid, so we trust it\n        if (response.status === 401) {\n          toast({\n            title: \"خطا\",\n            description: \"جلسه شما منقضی شده است. لطفاً دوباره وارد شوید\",\n            variant: \"destructive\",\n          });\n          router.push(\"/auth?redirect=\" + encodeURIComponent(window.location.pathname));\n          return;\n        }\n        const serverMsg =\n          (typeof errorData?.error === \"string\" && errorData.error) ||\n          (typeof errorData?.error?.message === \"string\" && errorData.error.message) ||\n          (typeof errorData?.message === \"string\" && errorData.message) ||\n          (response.status === 429 ? \"درخواست‌های شما زیاد است. لطفاً کمی بعد دوباره تلاش کنید.\" : null) ||\n          `خطا در ارسال پیام (HTTP ${response.status})`;\n        throw new Error(serverMsg);\n      }\n\n      const data = await response.json();\n      if (data.success && data.data?.messages && data.data.messages.length > 0) {\n        const savedMessage = data.data.messages[0];\n        \n        // Update tempId message with real ID from server smoothly (no flash)\n        // Use requestAnimationFrame to ensure smooth UI updates\n        requestAnimationFrame(() => {\n          setMessages((prev) =>\n            prev.map((msg) =>\n              msg.id === tempId\n                ? {\n                    ...msg,\n                    id: savedMessage.id,\n                    text: savedMessage.text || msg.text, // Ensure text is preserved\n                    status: savedMessage.status || \"sent\",\n                    attachments: savedMessage.attachments || msg.attachments,\n                  }\n                : msg\n            )\n          );\n        });\n        \n        // Update chatId if server returned a new one (stale local state)\n        if (data.data.chatId && data.data.chatId !== activeChatId) {\n          setChatId(data.data.chatId);\n        }\n      }\n\n      // Poll for new messages in background (silent, no visible reload)\n      // Use a longer delay to avoid visible refresh\n      setTimeout(() => {\n        pollForNewMessages(activeChatId);\n      }, 1000);\n    } catch (error) {\n      logger.error(\"Error sending message:\", error);\n      setMessages((prev) => prev.filter((msg) => msg.id !== tempId));\n      toast({\n        title: \"خطا\",\n        description: error instanceof Error ? error.message : \"خطا در ارسال پیام\",\n        variant: \"destructive\",\n      });\n    }\n\n    setTimeout(() => {\n      scrollToBottom(false);\n    }, 100);\n  }, [chatId, attachments, replyingTo, editingMessage, sendTypingStatus, toast, setStep, initMyChat, pollForNewMessages, isAuthenticated, user, router]);\n\n  // Auto-send when attachments are added (for location and voice)\n  // Use a ref to track if we should auto-send (set by saveRecording/handleLocationShare)\n  useEffect(() => {\n    // Only auto-send if flag is set and we have attachments\n    if (shouldAutoSendRef.current && attachments.length > 0) {\n      shouldAutoSendRef.current = false; // Reset flag\n      const timer = setTimeout(() => {\n        handleSendMessage();\n      }, 200);\n      return () => clearTimeout(timer);\n    }\n  }, [attachments, handleSendMessage]);\n\n  // Handle reply\n  const handleReply = useCallback((msg: Message) => {\n    setReplyingTo(msg);\n    setEditingMessage(null);\n  }, []);\n\n  // Handle edit\n  const handleEdit = useCallback((msg: Message) => {\n    setEditingMessage(msg);\n    setReplyingTo(null);\n    setMessage(msg.text || \"\");\n  }, []);\n\n  // Handle delete\n  const handleDelete = useCallback(\n    async (messageId: string) => {\n      try {\n        const response = await fetch(`/api/chat/message/${messageId}`, {\n          method: \"DELETE\",\n          credentials: \"include\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n        });\n\n        const data = await response.json().catch(() => ({}));\n\n        if (response.ok) {\n          setMessages((prev) => prev.filter((msg) => msg.id !== messageId));\n          // Force immediate polling to sync with other clients\n          setTimeout(() => {\n            pollForNewMessages();\n          }, 500);\n          toast({\n            title: \"موفق\",\n            description: \"پیام با موفقیت حذف شد\",\n          });\n        } else {\n          const errorMessage = data.error || data.message || `خطا در حذف پیام (${response.status})`;\n          toast({\n            title: \"خطا\",\n            description: errorMessage,\n            variant: \"destructive\",\n          });\n        }\n      } catch (error) {\n        logger.error(\"Error deleting message:\", error);\n        toast({\n          title: \"خطا\",\n          description: \"خطا در حذف پیام\",\n          variant: \"destructive\",\n        });\n      }\n    },\n    [toast]\n  );\n\n  // Scroll to bottom\n  const scrollToBottom = useCallback((instant = false) => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({\n        behavior: instant ? \"auto\" : \"smooth\",\n        block: \"end\",\n      });\n    }\n  }, []);\n\n  // Check scroll position\n  const checkScrollPosition = useCallback(() => {\n    if (!messagesContainerRef.current) {\n      setShowScrollToBottom(false);\n      return;\n    }\n    const container = messagesContainerRef.current;\n    const threshold = 150;\n    const scrollBottom = container.scrollHeight - container.scrollTop - container.clientHeight;\n    setShowScrollToBottom(scrollBottom > threshold);\n  }, []);\n\n  // Poll for messages\n  useEffect(() => {\n    if (!chatId || step !== \"chat\") return;\n\n    pollForNewMessages();\n    const interval = setInterval(() => {\n      pollForNewMessages();\n      checkSupportTyping();\n    }, 3000);\n\n    return () => clearInterval(interval);\n  }, [chatId, step, pollForNewMessages, checkSupportTyping]);\n\n  // Scroll to bottom on messages change\n  useEffect(() => {\n    if (messages.length > 0 && step === \"chat\") {\n      setTimeout(() => {\n        scrollToBottom(true);\n        checkScrollPosition();\n      }, 100);\n    }\n  }, [messages.length, step, scrollToBottom, checkScrollPosition]);\n\n  // Track scroll\n  useEffect(() => {\n    const container = messagesContainerRef.current;\n    if (!container) return;\n\n    const handleScroll = () => {\n      checkScrollPosition();\n    };\n\n    container.addEventListener(\"scroll\", handleScroll, { passive: true });\n    return () => container.removeEventListener(\"scroll\", handleScroll);\n  }, [checkScrollPosition]);\n\n  // Request notification permission\n  useEffect(() => {\n    requestPermission();\n  }, [requestPermission]);\n\n  // Set body and html overflow for chat page\n  useEffect(() => {\n    const originalBodyOverflow = document.body.style.overflow;\n    const originalHtmlOverflow = document.documentElement.style.overflow;\n    \n    document.body.style.overflow = \"hidden\";\n    document.documentElement.style.overflow = \"hidden\";\n    \n    return () => {\n      document.body.style.overflow = originalBodyOverflow;\n      document.documentElement.style.overflow = originalHtmlOverflow;\n    };\n  }, []);\n\n  return (\n    <div className=\"flex flex-col overflow-hidden\" style={{ height: '100dvh' }}>\n      <div className=\"flex-1 flex justify-center w-full min-h-0\">\n        <main className=\"flex-1 flex flex-col min-h-0 overflow-hidden w-full md:max-w-2xl lg:max-w-3xl h-full\">\n        {/* Header - Sticky at top */}\n        <div className=\"flex-shrink-0 border-b border-border/40 px-4 sm:px-6 py-3 bg-background/95 backdrop-blur-sm\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => router.back()}\n              className=\"h-8 w-8 rounded-lg\"\n            >\n              <ArrowRight className=\"h-4 w-4\" />\n            </Button>\n            <div className=\"flex-1 min-w-0\">\n              <h1 className=\"text-base font-semibold text-foreground flex items-center gap-2\">\n                پشتیبانی و خرید سریع\n                {step === \"chat\" && (\n                  <OnlineStatusBadge isOnline={isOnline} lastSeen={lastSeen} showText={false} />\n                )}\n              </h1>\n            </div>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden\">\n          {step === \"info\" ? (\n            <div className=\"flex-1 overflow-y-auto p-6 sm:p-8 space-y-6 bg-gradient-to-b from-background via-background to-muted/10\">\n              {/* Welcome Message */}\n              <motion.div\n                initial={{ opacity: 0, y: -10 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"text-center pb-2\"\n              >\n                <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 mb-3 shadow-lg\">\n                  <MessageCircle className=\"h-8 w-8 text-primary\" />\n                </div>\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  لطفاً اطلاعات زیر را برای شروع خرید سریع وارد کنید\n                </p>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"space-y-5\"\n              >\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-semibold text-foreground flex items-center gap-2\">\n                    <svg\n                      className=\"h-4 w-4 text-primary\"\n                      viewBox=\"0 0 24 24\"\n                      fill=\"none\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <path\n                        d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"\n                        stroke=\"currentColor\"\n                        strokeWidth=\"2\"\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                      />\n                      <circle\n                        cx=\"12\"\n                        cy=\"7\"\n                        r=\"4\"\n                        stroke=\"currentColor\"\n                        strokeWidth=\"2\"\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                      />\n                    </svg>\n                    نام و نام خانوادگی\n                    <span className=\"text-destructive text-xs\">*</span>\n                  </label>\n                  <Input\n                    type=\"text\"\n                    placeholder=\"مثال: علی احمدی\"\n                    value={customerInfo.name}\n                    onChange={(e) =>\n                      setCustomerInfo({ ...customerInfo, name: e.target.value })\n                    }\n                    className=\"h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-semibold text-foreground flex items-center gap-2\">\n                    <Phone className=\"h-4 w-4 text-primary\" />\n                    شماره تماس\n                    <span className=\"text-destructive text-xs\">*</span>\n                  </label>\n                  <Input\n                    type=\"tel\"\n                    placeholder=\"09123456789\"\n                    value={customerInfo.phone}\n                    onChange={(e) =>\n                      setCustomerInfo({ ...customerInfo, phone: e.target.value })\n                    }\n                    className=\"h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-semibold text-foreground flex items-center gap-2\">\n                    <Mail className=\"h-4 w-4 text-primary\" />\n                    ایمیل\n                    <span className=\"text-xs text-muted-foreground font-normal\">(اختیاری)</span>\n                  </label>\n                  <Input\n                    type=\"email\"\n                    placeholder=\"example@email.com\"\n                    value={customerInfo.email}\n                    onChange={(e) =>\n                      setCustomerInfo({ ...customerInfo, email: e.target.value })\n                    }\n                    className=\"h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background\"\n                  />\n                </div>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.15 }}\n                className=\"pt-2\"\n              >\n                <Button\n                  onClick={handleSubmitInfo}\n                  disabled={!customerInfo.name || !customerInfo.phone}\n                  className=\"w-full h-13 text-base font-semibold bg-gradient-to-r from-primary via-primary to-primary/90 hover:from-primary/90 hover:via-primary/80 hover:to-primary/70 shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 transition-all duration-300 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed rounded-xl\"\n                >\n                  <span className=\"flex items-center justify-center gap-2\">\n                    ادامه\n                    <motion.div\n                      animate={{ x: [0, 4, 0] }}\n                      transition={{ repeat: Infinity, duration: 1.5, delay: 0.5 }}\n                    >\n                      →\n                    </motion.div>\n                  </span>\n                </Button>\n                <p className=\"text-xs text-muted-foreground text-center mt-3\">\n                  با ادامه، شما شرایط و قوانین ما را می‌پذیرید\n                </p>\n              </motion.div>\n            </div>\n          ) : (\n            <>\n              {/* Messages */}\n              <div\n                ref={messagesContainerRef}\n                className=\"flex-1 min-h-0 overflow-y-auto p-5 sm:p-6 md:p-8 space-y-5 sm:space-y-6 bg-gradient-to-b from-background via-background/95 to-muted/5 scroll-smooth\"\n              >\n                {messages.length === 0 && (\n                  <motion.div\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"flex flex-col items-center justify-center h-full min-h-[200px] text-center px-4\"\n                  >\n                    <div className=\"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mb-4 shadow-lg\">\n                      <MessageCircle className=\"h-10 w-10 text-primary/60\" />\n                    </div>\n                    <p className=\"text-muted-foreground text-base font-medium leading-relaxed\">\n                      هنوز پیامی ارسال نشده است\n                    </p>\n                    <p className=\"text-muted-foreground/70 text-sm mt-2 leading-relaxed\">\n                      پیام خود را بنویسید...\n                    </p>\n                  </motion.div>\n                )}\n                <div className=\"space-y-3\">\n                {messages.map((msg) => (\n                  <motion.div\n                    key={msg.id}\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className={`flex ${msg.sender === \"user\" ? \"justify-end\" : \"justify-start\"} items-end gap-2 group`}\n                  >\n                    <div\n                      className={`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${\n                        msg.sender === \"user\"\n                          ? \"bg-primary text-primary-foreground\"\n                          : \"bg-muted text-foreground border border-border/40\"\n                      }`}\n                    >\n                      {msg.text && (\n                        <p className=\"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5\">\n                          {msg.text}\n                        </p>\n                      )}\n                      {msg.attachments && msg.attachments.length > 0 && (\n                        <div className={`space-y-2 ${msg.text ? \"mt-2\" : \"\"}`}>\n                          {msg.attachments.map((attachment) => (\n                            <div key={attachment.id} className=\"rounded-xl overflow-hidden\">\n                              {attachment.type === \"image\" && attachment.url && (\n                                <img\n                                  src={attachment.url}\n                                  alt={attachment.name || \"تصویر\"}\n                                  className=\"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all\"\n                                  onClick={() => window.open(attachment.url, \"_blank\")}\n                                />\n                              )}\n                              {attachment.type === \"file\" && (\n                                <a\n                                  href={attachment.url}\n                                  target=\"_blank\"\n                                  rel=\"noopener noreferrer\"\n                                  download={attachment.name}\n                                  className=\"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs\"\n                                >\n                                  <FileText className=\"h-3.5 w-3.5\" />\n                                  <span className=\"font-medium truncate\">{attachment.name || \"فایل\"}</span>\n                                </a>\n                              )}\n                              {attachment.type === \"location\" && (\n                                <a\n                                  href={attachment.url}\n                                  target=\"_blank\"\n                                  rel=\"noopener noreferrer\"\n                                  className=\"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs\"\n                                >\n                                  <MapPin className=\"h-3.5 w-3.5\" />\n                                  <span className=\"font-medium\">{attachment.name || \"موقعیت\"}</span>\n                                </a>\n                              )}\n                              {attachment.type === \"audio\" && attachment.url && (\n                                <AudioPlayer url={attachment.url} duration={attachment.duration} />\n                              )}\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                      <div\n                        className={`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${\n                          msg.sender === \"user\"\n                            ? \"border-primary-foreground/20 justify-end\"\n                            : \"border-border/30 justify-start\"\n                        }`}\n                      >\n                        <span\n                          className={`text-[10px] sm:text-xs ${\n                            msg.sender === \"user\"\n                              ? \"text-primary-foreground/70\"\n                              : \"text-muted-foreground\"\n                          }`}\n                        >\n                          {new Date(msg.timestamp).toLocaleTimeString(\"fa-IR\", {\n                            hour: \"2-digit\",\n                            minute: \"2-digit\",\n                          })}\n                        </span>\n                        {msg.sender === \"user\" && (\n                          <>\n                            {msg.status === \"sending\" && (\n                              <Loader2 className=\"h-3 w-3 text-primary-foreground/50 animate-spin\" />\n                            )}\n                            {msg.status === \"sent\" && (\n                              <Check className=\"h-3 w-3 text-primary-foreground/40\" />\n                            )}\n                            {msg.status === \"delivered\" && (\n                              <CheckCheck className=\"h-3 w-3 text-primary-foreground/40\" />\n                            )}\n                            {msg.status === \"read\" && (\n                              <CheckCheck className=\"h-3 w-3 text-primary-foreground/70\" />\n                            )}\n                            {!msg.status && (\n                              <Check className=\"h-3 w-3 text-primary-foreground/40\" />\n                            )}\n                          </>\n                        )}\n                        {/* آیکون حذف مستقیم فقط برای پیام‌های ارسالی کاربر - همیشه قابل مشاهده */}\n                        {msg.sender === \"user\" && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-6 w-6 hover:bg-destructive/10 text-destructive hover:text-destructive opacity-70 hover:opacity-100 transition-opacity\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              if (confirm(\"آیا مطمئن هستید که می‌خواهید این پیام را حذف کنید؟\")) {\n                                handleDelete(msg.id);\n                              }\n                            }}\n                            title=\"حذف پیام\"\n                          >\n                            <Trash2 className=\"h-3.5 w-3.5\" />\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  </motion.div>\n                ))}\n                {isSupportTyping && (\n                  <motion.div\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"flex justify-start items-end gap-2.5\"\n                  >\n                    <TypingIndicator />\n                  </motion.div>\n                )}\n                <div ref={messagesEndRef} />\n                </div>\n              </div>\n\n              {/* Input Area - Fixed at bottom */}\n              <div className=\"flex-shrink-0 border-t border-border/40 bg-background/95 backdrop-blur-sm p-2 sm:p-3 space-y-2 relative\">\n                {/* Scroll to bottom button */}\n                <AnimatePresence>\n                  {showScrollToBottom && (\n                    <motion.div\n                      initial={{ opacity: 0, y: 10, scale: 0.9 }}\n                      animate={{ opacity: 1, y: 0, scale: 1 }}\n                      exit={{ opacity: 0, y: 10, scale: 0.9 }}\n                      className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-10\"\n                    >\n                      <Button\n                        onClick={() => scrollToBottom(false)}\n                        size=\"icon\"\n                        className=\"h-9 w-9 rounded-full shadow-lg hover:shadow-xl bg-primary text-primary-foreground hover:bg-primary/90 transition-all\"\n                        title=\"برو به آخرین پیام\"\n                      >\n                        <ChevronDown className=\"h-4 w-4\" />\n                      </Button>\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n\n                {/* Recording UI */}\n                {(isRecording || audioUrl) && (\n                  <motion.div\n                    initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                    animate={{ opacity: 1, y: 0, scale: 1 }}\n                    exit={{ opacity: 0, y: 10, scale: 0.95 }}\n                    className=\"flex items-center gap-2 p-2 bg-destructive/10 border border-destructive/30 rounded-lg\"\n                  >\n                    {isRecording ? (\n                      <>\n                        <motion.div\n                          animate={{ scale: [1, 1.1, 1] }}\n                          transition={{ repeat: Infinity, duration: 1 }}\n                          className=\"p-1.5 rounded-full bg-destructive/20\"\n                        >\n                          <Mic className=\"h-3.5 w-3.5 text-destructive\" />\n                        </motion.div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-xs font-medium text-destructive leading-tight\">در حال ضبط</p>\n                          <p className=\"text-xs text-muted-foreground font-mono\">{formatTime(recordingTime)}</p>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={stopRecording}\n                          className=\"h-7 w-7 text-destructive hover:bg-destructive/10 rounded-lg\"\n                        >\n                          <Square className=\"h-3 w-3 fill-current\" />\n                        </Button>\n                      </>\n                    ) : (\n                      <>\n                        <div className=\"p-1.5 rounded-full bg-primary/20\">\n                          <Mic className=\"h-3.5 w-3.5 text-primary\" />\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-xs font-medium leading-tight\">پیام صوتی آماده است</p>\n                          <p className=\"text-xs text-muted-foreground font-mono\">{formatTime(recordingTime)}</p>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={cancelRecording}\n                          className=\"h-7 w-7 text-muted-foreground hover:text-destructive rounded-lg\"\n                        >\n                          <X className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <Button \n                          onClick={(e) => {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            console.log(\"[Voice] Save button clicked!\");\n                            saveRecording();\n                          }} \n                          size=\"sm\" \n                          className=\"h-7 px-3 text-xs rounded-lg\"\n                          title=\"ذخیره و ارسال پیام صوتی\"\n                        >\n                          ذخیره\n                        </Button>\n                      </>\n                    )}\n                  </motion.div>\n                )}\n\n                {/* Attachment Options */}\n                {showAttachmentOptions && (\n                  <motion.div\n                    initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                    animate={{ opacity: 1, y: 0, scale: 1 }}\n                    exit={{ opacity: 0, y: 10, scale: 0.95 }}\n                    className=\"flex gap-2 p-2 bg-card rounded-lg border border-border/50 shadow-lg\"\n                    onClick={(e) => {\n                      console.log(\"[Attachment Options] Container clicked!\", e.target);\n                    }}\n                  >\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => {\n                        imageInputRef.current?.click();\n                        setShowAttachmentOptions(false);\n                      }}\n                      className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                    >\n                      <Image className=\"h-3.5 w-3.5\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => {\n                        fileInputRef.current?.click();\n                        setShowAttachmentOptions(false);\n                      }}\n                      className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                    >\n                      <FileText className=\"h-3.5 w-3.5\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        console.log(\"[Location] Button clicked!\");\n                        handleLocationShare();\n                        setShowAttachmentOptions(false);\n                      }}\n                      className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                      title=\"اشتراک‌گذاری موقعیت مکانی\"\n                    >\n                      <MapPin className=\"h-3.5 w-3.5\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={async (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        console.log(\"[Voice] Button clicked!\");\n                        setShowAttachmentOptions(false);\n                        if (isRecording) {\n                          stopRecording();\n                        } else {\n                          // Show loading toast\n                          toast({\n                            title: \"در حال درخواست دسترسی...\",\n                            description: \"لطفاً اجازه دسترسی به میکروفون را در مرورگر بدهید\",\n                            duration: 3000,\n                          });\n                          \n                          const hasPermission = await checkMicrophonePermission();\n                          if (!hasPermission) {\n                            toast({\n                              title: \"نیاز به دسترسی میکروفون\",\n                              description: \"برای ضبط صدا، لطفاً دسترسی میکروفون را در تنظیمات مرورگر فعال کنید.\",\n                              variant: \"destructive\",\n                              duration: 5000,\n                            });\n                            return;\n                          }\n                          startRecording();\n                        }\n                      }}\n                      title=\"ضبط پیام صوتی\"\n                      className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg\"\n                      disabled={isRecording}\n                    >\n                      {isRecording ? (\n                        <Pause className=\"h-3.5 w-3.5 text-destructive\" />\n                      ) : (\n                        <Mic className=\"h-3.5 w-3.5\" />\n                      )}\n                    </Button>\n                  </motion.div>\n                )}\n\n                {/* Hidden Inputs */}\n                <input\n                  ref={imageInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  multiple\n                  className=\"hidden\"\n                  onChange={(e) => handleFileSelect(e, \"image\")}\n                />\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  multiple\n                  className=\"hidden\"\n                  onChange={(e) => handleFileSelect(e, \"file\")}\n                />\n\n                {/* Input */}\n                <div className=\"flex items-end gap-2\">\n                  <div className=\"flex-1 relative\">\n                    {/* Attachments Preview */}\n                    {attachments.length > 0 && (\n                      <div className=\"absolute top-2 right-2 left-2 z-10 pointer-events-none overflow-hidden\">\n                        <div className=\"overflow-x-auto overflow-y-hidden scroll-smooth w-full [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]\">\n                          <div className=\"flex items-center gap-1.5 flex-nowrap\">\n                            {attachments.map((attachment) => (\n                              <div\n                                key={attachment.id}\n                                className=\"relative group pointer-events-auto flex-shrink-0 w-auto\"\n                              >\n                                <div className=\"bg-card/95 backdrop-blur-sm rounded-md p-1 border border-border/40 shadow-sm\">\n                                  {attachment.type === \"image\" && attachment.url && (\n                                    <img\n                                      src={attachment.url}\n                                      alt={attachment.name || \"تصویر\"}\n                                      className=\"w-10 h-10 object-cover rounded\"\n                                    />\n                                  )}\n                                  {attachment.type === \"file\" && (\n                                    <div className=\"flex items-center gap-1 px-1.5 py-1\">\n                                      <FileText className=\"h-3 w-3 flex-shrink-0 text-primary\" />\n                                      <p className=\"text-[10px] truncate max-w-[50px] font-medium leading-tight\">\n                                        {attachment.name}\n                                      </p>\n                                    </div>\n                                  )}\n                                  {attachment.type === \"location\" && (\n                                    <div className=\"flex items-center gap-1 px-1.5 py-1\">\n                                      <MapPin className=\"h-3 w-3 flex-shrink-0 text-primary\" />\n                                      <span className=\"text-[10px] font-medium whitespace-nowrap leading-tight\">\n                                        موقعیت\n                                      </span>\n                                    </div>\n                                  )}\n                                  {attachment.type === \"audio\" && (\n                                    <div className=\"flex items-center gap-1 px-1.5 py-1\">\n                                      <Mic className=\"h-3 w-3 flex-shrink-0 text-primary\" />\n                                      <span className=\"text-[10px] font-medium whitespace-nowrap leading-tight\">\n                                        {attachment.duration ? formatTime(attachment.duration) : \"صدا\"}\n                                      </span>\n                                    </div>\n                                  )}\n                                </div>\n                                <button\n                                  onClick={() => handleRemoveAttachment(attachment.id)}\n                                  className=\"absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-20 hover:scale-110\"\n                                >\n                                  <X className=\"h-2.5 w-2.5\" />\n                                </button>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      </div>\n                    )}\n\n                    <Textarea\n                      ref={textareaRef}\n                      value={message}\n                      onChange={(e) => {\n                        setMessage(e.target.value);\n                        if (typingTimeoutRef.current) {\n                          clearTimeout(typingTimeoutRef.current);\n                        }\n                        if (e.target.value.trim().length > 0) {\n                          sendTypingStatus(true);\n                          typingTimeoutRef.current = setTimeout(() => {\n                            sendTypingStatus(false);\n                          }, 2000);\n                        } else {\n                          sendTypingStatus(false);\n                        }\n                      }}\n                      onKeyDown={(e) => {\n                        if (e.key === \"Enter\" && !e.shiftKey) {\n                          e.preventDefault();\n                          if (typingTimeoutRef.current) {\n                            clearTimeout(typingTimeoutRef.current);\n                          }\n                          sendTypingStatus(false);\n                          handleSendMessage();\n                        }\n                      }}\n                      placeholder=\"پیام خود را بنویسید...\"\n                      className={`min-h-[44px] max-h-[100px] resize-none text-sm leading-relaxed rounded-lg border pr-20 pl-3 py-2 ${\n                        attachments.length > 0 ? \"pt-12\" : \"\"\n                      }`}\n                    />\n\n                    {/* Buttons */}\n                    <div className=\"absolute bottom-2 right-2 flex items-center gap-1\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={(e) => {\n                          e.preventDefault();\n                          e.stopPropagation();\n                          console.log(\"[Paperclip] Button clicked! showAttachmentOptions:\", !showAttachmentOptions);\n                          setShowAttachmentOptions(!showAttachmentOptions);\n                        }}\n                        className={`h-7 w-7 rounded-lg transition-all ${\n                          showAttachmentOptions\n                            ? \"bg-primary/10 text-primary\"\n                            : \"hover:bg-muted/60 text-muted-foreground hover:text-foreground\"\n                        }`}\n                      >\n                        <Paperclip className=\"h-4 w-4\" />\n                      </Button>\n                      {!isRecording && (\n                        <>\n                          {isSaving ? (\n                            <Loader2 className=\"h-4 w-4 text-primary animate-spin\" />\n                          ) : (\n                            <Button\n                              onClick={handleSendMessage}\n                              size=\"icon\"\n                              className=\"h-7 w-7 rounded-lg transition-all\"\n                            >\n                              <Send className=\"h-3.5 w-3.5\" />\n                            </Button>\n                          )}\n                        </>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </>\n          )}\n        </div>\n        </main>\n      </div>\n    </div>\n  );\n}\n\nexport default function ChatPage() {\n  // Chat requires authentication - only registered users can chat\n  return (\n    <ProtectedRoute requireAuth>\n      <ChatPageContent />\n    </ProtectedRoute>\n  );\n}\n\n"],"names":[],"mappings":"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"}
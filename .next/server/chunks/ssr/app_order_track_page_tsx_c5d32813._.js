module.exports=[12783,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(3130),f=a.i(40695),g=a.i(5522),h=a.i(17171),i=a.i(410),j=a.i(60421),k=a.i(87532),l=a.i(83497),m=a.i(24987),n=a.i(63519),o=a.i(92258),p=a.i(41675),q=a.i(10227),r=a.i(67453),s=a.i(41710),t=a.i(62722),u=a.i(38784);let v=(0,a.i(70106).default)("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);var w=a.i(16201),x=a.i(45222),y=a.i(52495),z=a.i(32336),A=a.i(54161);a.i(35112);var B=a.i(11011),C=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,d)=>{let e=(0,B.createSlot)(`Primitive.${d}`),f=c.forwardRef((a,c)=>{let{asChild:f,...g}=a;return(0,b.jsx)(f?e:d,{...g,ref:c})});return f.displayName=`Primitive.${d}`,{...a,[d]:f}},{}),D="Progress",[E,F]=function(a,d=[]){let e=[],f=()=>{let b=e.map(a=>c.createContext(a));return function(d){let e=d?.[a]||b;return c.useMemo(()=>({[`__scope${a}`]:{...d,[a]:e}}),[d,e])}};return f.scopeName=a,[function(d,f){let g=c.createContext(f);g.displayName=d+"Context";let h=e.length;e=[...e,f];let i=d=>{let{scope:e,children:f,...i}=d,j=e?.[a]?.[h]||g,k=c.useMemo(()=>i,Object.values(i));return(0,b.jsx)(j.Provider,{value:k,children:f})};return i.displayName=d+"Provider",[i,function(b,e){let i=e?.[a]?.[h]||g,j=c.useContext(i);if(j)return j;if(void 0!==f)return f;throw Error(`\`${b}\` must be used within \`${d}\``)}]},function(...a){let b=a[0];if(1===a.length)return b;let d=()=>{let d=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let e=d.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return c.useMemo(()=>({[`__scope${b.scopeName}`]:e}),[e])}};return d.scopeName=b.scopeName,d}(f,...d)]}(D),[G,H]=E(D),I=c.forwardRef((a,c)=>{var d,e;let{__scopeProgress:f,value:g=null,max:h,getValueLabel:i=L,...j}=a;(h||0===h)&&!O(h)&&console.error((d=`${h}`,`Invalid prop \`max\` of value \`${d}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let k=O(h)?h:100;null===g||P(g,k)||console.error((e=`${g}`,`Invalid prop \`value\` of value \`${e}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let l=P(g,k)?g:null,m=N(l)?i(l,k):void 0;return(0,b.jsx)(G,{scope:f,value:l,max:k,children:(0,b.jsx)(C.div,{"aria-valuemax":k,"aria-valuemin":0,"aria-valuenow":N(l)?l:void 0,"aria-valuetext":m,role:"progressbar","data-state":M(l,k),"data-value":l??void 0,"data-max":k,...j,ref:c})})});I.displayName=D;var J="ProgressIndicator",K=c.forwardRef((a,c)=>{let{__scopeProgress:d,...e}=a,f=H(J,d);return(0,b.jsx)(C.div,{"data-state":M(f.value,f.max),"data-value":f.value??void 0,"data-max":f.max,...e,ref:c})});function L(a,b){return`${Math.round(a/b*100)}%`}function M(a,b){return null==a?"indeterminate":a===b?"complete":"loading"}function N(a){return"number"==typeof a}function O(a){return N(a)&&!isNaN(a)&&a>0}function P(a,b){return N(a)&&!isNaN(a)&&a<=b&&a>=0}K.displayName=J;var Q=a.i(97895);let R=c.forwardRef(({className:a,value:c,...d},e)=>(0,b.jsx)(I,{ref:e,className:(0,Q.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...d,children:(0,b.jsx)(K,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(c||0)}%)`}})}));R.displayName=I.displayName;var S=a.i(53071),T=a.i(77687),U=a.i(80794),V=a.i(42964),W=a.i(99209),X=a.i(54917),Y=a.i(46271),Z=a.i(96221),$=a.i(33441),_=a.i(20610),aa=a.i(81560),ab=a.i(33508),ac=a.i(4720),ad=a.i(62478),ae=a.i(23708);function af({messages:a,messagesContainerRef:c,messagesEndRef:d,isSupportTyping:e,onDelete:g}){return(0,b.jsx)("div",{ref:c,className:"flex-1 min-h-0 overflow-y-auto p-5 sm:p-6 md:p-8 bg-gradient-to-b from-background via-background/95 to-muted/5 scroll-smooth",children:(0,b.jsxs)("div",{className:"space-y-3",children:[0===a.length&&(0,b.jsxs)(Y.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center h-full min-h-[200px] text-center px-4",children:[(0,b.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mb-4 shadow-lg",children:(0,b.jsxs)("svg",{className:"h-10 w-10 text-primary/60",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M8 10h.01M12 10h.01M16 10h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,b.jsx)("p",{className:"text-muted-foreground text-base font-medium leading-relaxed",children:"Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"}),(0,b.jsx)("p",{className:"text-muted-foreground/70 text-sm mt-2 leading-relaxed",children:"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."})]}),a.map((a,c)=>(0,b.jsx)(Y.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},className:`flex ${"user"===a.sender?"justify-end":"justify-start"} items-end gap-2 group`,children:(0,b.jsxs)("div",{className:`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${"user"===a.sender?"bg-primary text-primary-foreground":"bg-muted text-foreground border border-border/40"}`,children:[a.text&&(0,b.jsx)("p",{className:"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5",children:a.text}),a.attachments&&a.attachments.length>0&&(0,b.jsx)("div",{className:`space-y-2 ${a.text?"mt-2":""}`,children:a.attachments.map((a,d)=>(0,b.jsxs)(Y.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*d},className:"rounded-xl overflow-hidden",children:["image"===a.type&&a.url&&(0,b.jsx)("img",{src:a.url,alt:a.name||"ØªØµÙˆÛŒØ±",className:"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all",onClick:()=>window.open(a.url,"_blank"),onError:b=>{X.logger.error("Image load error:",a.url),b.target.style.display="none"}}),"file"===a.type&&(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",download:a.name,className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,b.jsx)(ac.FileText,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"font-medium truncate",children:a.name||"ÙØ§ÛŒÙ„"})]}),"location"===a.type&&(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,b.jsx)(m.MapPin,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"font-medium",children:a.name||"Ù…ÙˆÙ‚Ø¹ÛŒØª"})]}),"audio"===a.type&&a.url&&(0,b.jsx)(ae.AudioPlayer,{url:a.url,duration:a.duration})]},a.id||`att-${c}-${d}`))}),(0,b.jsxs)("div",{className:`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${"user"===a.sender?"border-primary-foreground/20 justify-end":"border-border/30 justify-start"}`,children:[(0,b.jsx)("span",{className:`text-[10px] sm:text-xs ${"user"===a.sender?"text-primary-foreground/70":"text-muted-foreground"}`,children:new Date(a.timestamp).toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}),"user"===a.sender&&(0,b.jsxs)(b.Fragment,{children:["sending"===a.status&&(0,b.jsx)(Z.Loader2,{className:"h-3 w-3 text-primary-foreground/50 animate-spin"}),"sent"===a.status&&(0,b.jsx)($.Check,{className:"h-3 w-3 text-primary-foreground/40"}),"delivered"===a.status&&(0,b.jsx)(_.CheckCheck,{className:"h-3 w-3 text-primary-foreground/40"}),"read"===a.status&&(0,b.jsx)(_.CheckCheck,{className:"h-3 w-3 text-primary-foreground/70"}),"failed"===a.status&&(0,b.jsx)(ab.X,{className:"h-3 w-3 text-destructive"}),!a.status&&(0,b.jsx)($.Check,{className:"h-3 w-3 text-primary-foreground/40"})]}),"user"===a.sender&&g&&(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-destructive/10 text-destructive hover:text-destructive opacity-70 hover:opacity-100 transition-opacity",onClick:b=>{b.stopPropagation(),confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ")&&g(a.id)},title:"Ø­Ø°Ù Ù¾ÛŒØ§Ù…",children:(0,b.jsx)(aa.Trash2,{className:"h-3.5 w-3.5"})})]})]})},a.id)),e&&(0,b.jsx)(Y.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"flex justify-start items-end gap-2.5",children:(0,b.jsx)(ad.TypingIndicator,{})}),(0,b.jsx)("div",{ref:d})]})})}var ag=a.i(52119),ah=a.i(9655);function ai({step:a,isOnline:c,lastSeen:d,customerInfo:e,onEditInfo:g}){return(0,b.jsx)(S.SheetHeader,{className:"px-4 sm:px-6 py-2 border-b border-border/40",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsxs)(S.SheetTitle,{className:"text-base font-semibold text-foreground flex items-center gap-2",children:["Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹","chat"===a&&(0,b.jsx)(ah.OnlineStatusBadge,{isOnline:c,lastSeen:d instanceof Date?d.toISOString():"string"==typeof d?d:null,showText:!1})]})}),"chat"===a&&e.name&&e.phone&&(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:g,className:"h-8 w-8 rounded-lg hover:bg-primary/10 transition-colors",title:"ØªØºÛŒÛŒØ± Ø§Ø·Ù„Ø§Ø¹Ø§Øª",children:(0,b.jsxs)("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})})}let aj=a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`};var ak=a.i(25173);function al({isOpen:a,onOpenChange:e,trigger:f}){let g=(0,d.useRouter)(),{toast:h}=(0,T.useToast)(),{showNotification:i,requestPermission:j}=(0,U.useNotifications)(),{showMessageNotification:k}=(0,W.usePersistentNotifications)(),{isOnline:l,lastSeen:m,checkStatus:n}=(0,V.useAdminPresence)({enabled:!0,heartbeatInterval:2e4}),{user:o,isAuthenticated:p}=(0,ak.useAuthStore)(),[q,r]=(0,c.useState)([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}]),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),y=(0,c.useCallback)(()=>p&&o?{name:o.name||"",phone:o.phone||"",email:""}:{name:"",phone:"",email:""},[p,o]),[z,A]=(0,c.useState)(y);(0,c.useEffect)(()=>{A(y())},[p,o,y]);let B="chat",[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(null),Q=(0,c.useRef)(null),R=(0,c.useRef)(null),Y=(0,c.useRef)(null);(0,c.useRef)({});let Z=(0,c.useRef)(null);(0,c.useRef)(new Set),(0,c.useRef)(new Map),(0,c.useRef)(new Map);let $=(0,c.useRef)(!1),_=(0,c.useRef)(null),aa=(0,c.useRef)(null),ab=(0,c.useRef)(null),ac=(0,c.useRef)(null),ad=(0,c.useRef)(!1),ae=(0,c.useRef)(null),[ah,al]=(0,c.useState)(!1),am=(0,c.useCallback)(()=>{if(!ab.current)return void al(!1);let a=ab.current;al(a.scrollHeight-a.scrollTop-a.clientHeight>150)},[B]),an=(0,c.useCallback)((a=!1)=>{aa.current&&(aa.current.scrollIntoView({behavior:a?"auto":"smooth",block:"end"}),setTimeout(()=>{al(!1)},300))},[]);(0,c.useEffect)(()=>{let a=ab.current;if(!a)return void al(!1);let b=()=>{am()};return a.addEventListener("scroll",b,{passive:!0}),am(),setTimeout(()=>{am()},100),()=>{a.removeEventListener("scroll",b)}},[B,am,q.length]),(0,c.useEffect)(()=>{if(q.length>0&&!ad.current){ad.current=!0;let a=setTimeout(()=>{an(!0),setTimeout(()=>{am()},500)},200);return()=>clearTimeout(a)}},[B,an,am]),(0,c.useEffect)(()=>{},[B]),(0,c.useEffect)(()=>{if(q.length>0){let a=q[q.length-1];if(a.id===ae.current&&"user"===a.sender){let a=setTimeout(()=>{an(!1),setTimeout(()=>{am()},500)},150);return()=>clearTimeout(a)}{let a=setTimeout(()=>{am()},200);return()=>clearTimeout(a)}}},[q,B,an,am]),(0,c.useEffect)(()=>{},[z]),(0,c.useEffect)(()=>{},[I]),(0,c.useEffect)(()=>{if(a){let a=y();a.name&&a.phone&&(A(a),ao(a,null))}else t(""),D([]),F(!1),P(null),Y.current&&(clearInterval(Y.current),Y.current=null),L(!1)},[a]);let ao=async(a,b)=>{try{let c="/api/chat?";if(b)c+=`chatId=${b}`;else{try{let a=await fetch("/api/chat/my",{credentials:"include"}),d=await a.json().catch(()=>null);a.ok&&d?.success&&d?.data?.chatId&&(b=String(d.data.chatId),c=`/api/chat?chatId=${b}`)}catch{}c+=`customerPhone=${encodeURIComponent(a.phone)}`,a.name&&(c+=`&customerName=${encodeURIComponent(a.name)}`)}let d=await fetch(c,{credentials:"include"});if(!d.ok)throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª");let e=await d.json();if(e.success&&e.data){let{chat:b,messages:c}=e.data;if(b&&c&&c.length>0){J(b.id);let a=c.map(a=>{let b=[];if(a.attachments){if(Array.isArray(a.attachments))b=a.attachments.map(a=>{let b=a.url||a.fileUrl||a.filePath,c=a.type;return!c&&b&&(b.includes("/image-")||b.includes("image-")?c="image":(b.includes("/audio-")||b.includes("audio-"))&&(c="audio")),{id:a.id||`att-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:c||a.type||"file",url:b,name:a.name||a.fileName,size:a.size||a.fileSize,duration:a.duration}});else if("string"==typeof a.attachments)try{let c=JSON.parse(a.attachments);Array.isArray(c)&&(b=c.map(a=>{let b=a.url||a.fileUrl||a.filePath,c=a.type;return!c&&b&&(b.includes("/image-")||b.includes("image-")?c="image":(b.includes("/audio-")||b.includes("audio-"))&&(c="audio")),{id:a.id||`att-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:c||a.type||"file",url:b,name:a.name||a.fileName,size:a.size||a.fileSize,duration:a.duration}}))}catch(a){X.logger.error("Error parsing attachments JSON:",a)}}let c=b.filter(a=>{let b=a.url;return b&&!b.startsWith("blob:")&&!b.startsWith("data:")&&(b.startsWith("http")||b.startsWith("/"))});return b.length>0&&X.logger.debug(`Loaded message ${a.id} has ${c.length} valid attachment(s) out of ${b.length} total:`,c.map(a=>({id:a.id,type:a.type,url:a.url,name:a.name,hasUrl:!!a.url}))),{id:a.id,text:a.text||"",sender:a.sender,timestamp:new Date(a.createdAt),attachments:c.length>0?c:void 0,status:"user"===a.sender?a.status||"sent":void 0}}),d=a.map(a=>"user"!==a.sender||a.status?a:{...a,status:"sent"});(r(d),a.length>0)?(Z.current=a[a.length-1].id,d.some(a=>"support"===a.sender&&"1"!==a.id)?$.current=!0:$.current=!1):$.current=!1}else r([{id:"1",text:`Ø³Ù„Ø§Ù… ${a.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),$.current=!1}else r([{id:"1",text:`Ø³Ù„Ø§Ù… ${a.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),$.current=!1}catch(b){X.logger.error("Error loading chat history:",b),r([{id:"1",text:`Ø³Ù„Ø§Ù… ${a.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),$.current=!1}},ap=async()=>{if(I)try{await fetch("/api/chat/status",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:I,sender:"user",action:"delivered"})})}catch(a){X.logger.error("Error marking messages as delivered:",a)}},aq=async()=>{if(I)try{await fetch("/api/chat/status",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:I,sender:"user",action:"read"})})}catch(a){X.logger.error("Error marking messages as read:",a)}},ar=async()=>{if(I&&a&&1)try{L(!0);let a=Z.current,b=`/api/chat?chatId=${I}`;a&&"1"!==a&&(b+=`&lastMessageId=${a}`);let c=await fetch(b,{credentials:"include"});if(!c.ok)throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯");let d=await c.json();if(d.success&&d.data?.messages&&Array.isArray(d.data.messages)){let a=d.data.messages;a.length>0&&(ap(),setTimeout(()=>{aq()},1e3));let b=a.map(a=>{let b=[];a.attachments&&Array.isArray(a.attachments)&&(b=a.attachments.map(a=>{let b=a.url||a.fileUrl||a.filePath,c=a.type;return!c&&b&&(b.includes("/image-")||b.includes("image-")?c="image":(b.includes("/audio-")||b.includes("audio-"))&&(c="audio")),{id:a.id||`att-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:c||a.type||"file",url:b,name:a.name||a.fileName,size:a.size||a.fileSize,duration:a.duration}}));let c=b.filter(a=>{let b=a.url;return b&&!b.startsWith("blob:")&&!b.startsWith("data:")&&(b.startsWith("http")||b.startsWith("/"))});return{id:a.id,text:a.text||"",sender:a.sender,timestamp:new Date(a.createdAt),attachments:c.length>0?c:void 0,status:"user"===a.sender?a.status||"sent":void 0}});r(a=>{let c=new Set(a.map(a=>a.id)),d=b.filter(a=>!c.has(a.id)),e=a.filter(a=>!a.id.startsWith("system-")).map(a=>{let c=b.find(b=>b.id===a.id);return c&&"user"===a.sender&&c.status&&a.status!==c.status?{...a,status:c.status}:a});if(d.length>0){let a=d.some(a=>"support"===a.sender),b=e;a&&_.current&&(b=e.filter(a=>a.id!==_.current),_.current=null,$.current=!0);let c=[...b,...d],f=c[c.length-1];return f&&(Z.current=f.id),c}return e})}}catch(a){X.logger.error("Error polling for new messages:",a)}finally{L(!1)}},as=async()=>{if(I)try{let a=await fetch(`/api/chat/typing?chatId=${I}&sender=support`,{credentials:"include"});if(a.ok){let b=await a.json();b.success&&N(b.data.isTyping||!1)}}catch(a){X.logger.error("Error checking typing status:",a)}},at=async a=>{if(I)try{await fetch("/api/chat/typing",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:I,sender:"user",isTyping:a})})}catch(a){X.logger.error("Error sending typing status:",a)}};(0,c.useEffect)(()=>{j()},[]),(0,c.useEffect)(()=>{let b=b=>{let{chatId:c,isAdmin:d}=b.detail;(!1===d||void 0===d)&&(a||e(!0))};return window.addEventListener("openChat",b),()=>{window.removeEventListener("openChat",b)}},[a,e,I,B,ar]),(0,c.useEffect)(()=>{if(a&&I){ap();let a=setTimeout(()=>{aq()},2e3);return as(),R.current=setInterval(()=>{as()},3e3),Y.current=setInterval(()=>{ar(),ap()},5e3),ar(),n(),()=>{Y.current&&(clearInterval(Y.current),Y.current=null),R.current&&(clearInterval(R.current),R.current=null),Q.current&&(clearTimeout(Q.current),Q.current=null),clearTimeout(a),at(!1)}}},[a,B,I,n]);let au=async a=>{try{if((await fetch(`/api/chat/message/${a}`,{method:"DELETE",credentials:"include"})).ok)r(b=>b.filter(b=>b.id!==a)),h({title:"Ù…ÙˆÙÙ‚",description:"Ù¾ÛŒØ§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯"});else throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…")}catch(a){X.logger.error("Error deleting message:",a),h({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…",variant:"destructive"})}},av=async()=>{if(!p||!o){h({title:"Ø®Ø·Ø§",description:"Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø´ÙˆÛŒØ¯",variant:"destructive"}),e(!1),g.push("/auth?redirect="+encodeURIComponent(window.location.pathname));return}let b=ac.current?.value??s;if(!b.trim()&&0===C.length)return;if(w){try{(await fetch(`/api/chat/message/${w.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({text:b,attachments:C})})).ok&&(r(a=>a.map(a=>a.id===w.id?{...a,text:b,attachments:C}:a)),x(null),t(""),D([]),h({title:"Ù…ÙˆÙÙ‚",description:"Ù¾ÛŒØ§Ù… ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯"}))}catch(a){X.logger.error("Error editing message:",a),h({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…",variant:"destructive"})}return}let c=C.filter(a=>{let b=a.url;return b&&!b.startsWith("blob:")&&!b.startsWith("data:")&&(b.startsWith("http")||b.startsWith("/"))});if(!b.trim()&&0===c.length)return void h({title:"Ø®Ø·Ø§",description:"Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù¾ÛŒØ§Ù… ÛŒØ§ ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯",variant:"destructive"});let d=b;u&&(d=`Ø¯Ø± Ù¾Ø§Ø³Ø® Ø¨Ù‡: ${u.text}

${b}`);let f={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,text:d,sender:"user",timestamp:new Date,attachments:c.length>0?c:void 0,status:"sending"};r(a=>{let b=[...a,f];return Z.current=f.id,ae.current=f.id,b}),setTimeout(()=>{an(!1)},150);let i=[...C];t(""),D([]),F(!1),v(null);try{H(!0);let b={id:f.id,text:f.text,sender:f.sender,timestamp:f.timestamp.toISOString(),status:"sent",attachments:(i||[]).filter(a=>{let b=a.url;return b&&!b.startsWith("blob:")&&!b.startsWith("data:")&&(b.startsWith("http")||b.startsWith("/"))})};f.attachments&&f.attachments.length>0&&X.logger.debug(`ğŸ“¤ Sending new message with ${f.attachments.length} attachment(s):`,f.attachments.map(a=>({id:a.id,type:a.type,url:a.url,name:a.name})));let c=p&&o?{name:o.name||z.name||"",phone:o.phone||z.phone||"",email:z.email||""}:z;if(!c.name||!c.phone){h({title:"Ø®Ø·Ø§",description:"Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú©Ø§Ù…Ù„ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯",variant:"destructive"}),e(!1),g.push("/auth?redirect="+encodeURIComponent(window.location.pathname));return}let d=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:I||void 0,customerInfo:c,messages:[b]})});if(!d.ok){let a=await d.json().catch(()=>({})),c=a.error||a.message||`Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù… (Ú©Ø¯: ${d.status})`;if(401===d.status){let{checkAuth:a}=ak.useAuthStore.getState();await a();let{isAuthenticated:c,user:d}=ak.useAuthStore.getState();if(c&&d){let a={name:d.name||z.name||"",phone:d.phone||z.phone||"",email:z.email||""},c=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:I||void 0,customerInfo:a,messages:[b]})});if(c.ok){let a=await c.json();a.data?.chatId&&J(a.data.chatId);let b=a.data?.messages?.find(a=>a.id===f.id),d=b?.status||"sent";r(a=>a.map(a=>a.id===f.id?{...a,status:d}:a));return}}h({title:"Ø®Ø·Ø§",description:"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø´ÙˆÛŒØ¯",variant:"destructive"}),e(!1),g.push("/auth?redirect="+encodeURIComponent(window.location.pathname));return}throw X.logger.error("âŒ Message send failed:",{status:d.status,error:c,errorData:a}),Error(c)}let j=await d.json();j.data?.chatId&&J(j.data.chatId);let l=j.data?.messages?.find(a=>a.id===f.id),m=l?.status||"sent";r(a=>a.map(a=>a.id===f.id?{...a,status:m}:a));try{let b=await fetch("/api/admin/presence");if(b.ok){let c=await b.json();c.success&&c.data?.admins&&(Array.isArray(c.data.admins)&&c.data.admins.length>0||k("Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ","Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¢Ù†Ù„Ø§ÛŒÙ† Ù†ÛŒØ³Øª. Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡ Ùˆ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",{onOpen:()=>{a||e(!0)},chatId:I||void 0,metadata:{isAdminOffline:!0,isAdmin:!1}}))}}catch(a){X.logger.error("Error checking admin status:",a)}}catch(a){X.logger.error("âŒ Error saving message:",{error:a.message,errorStack:a.stack,messageId:f.id,chatId:I||void 0,messageText:f.text?.substring(0,50)+"..."}),r(a=>a.map(a=>a.id===f.id?{...a,status:"failed"}:a)),t(d),D(i),h({title:"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…",description:a.message||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",variant:"destructive",duration:5e3})}finally{H(!1)}$.current||setTimeout(async()=>{let a=`system-${Date.now()}`;_.current=a,$.current=!0;let b={id:a,text:"Ù…ØªØ´Ú©Ø±Ù…! Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯. Ù‡Ù…Ú©Ø§Ø±Ø§Ù† Ù…Ø§ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¨Ø§ Ø´Ù…Ø§ ØªÙ…Ø§Ø³ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ú¯Ø±ÙØª.",sender:"support",timestamp:new Date};r(a=>[...a,b])},1e3)},aw=async(a,b,c=0)=>{try{let c=new FormData;c.append("file",a),c.append("type",b);let d=await fetch("/api/chat/upload",{method:"POST",body:c,credentials:"include"});if(!d.ok){let a=await d.json().catch(()=>({error:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„"}));throw Error(a.error||"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„")}return(await d.json()).data.url}catch(d){if(X.logger.error("Error uploading file:",d),c<3&&(d.message?.includes("fetch")||d.message?.includes("network")||d.message?.includes("timeout")||"NETWORK_ERROR"===d.code||"TypeError"===d.name)){let d=2e3*Math.pow(2,c);return X.logger.debug(`Retrying file upload in ${d}ms (attempt ${c+1}/3)`),0===c&&h({title:"Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...",description:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„. Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...",duration:2e3}),await new Promise(a=>setTimeout(a,d)),aw(a,b,c+1)}throw h({title:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„",description:d.message||"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯",variant:"destructive"}),d}},ax=function(a,b,d){let{toast:e}=(0,T.useToast)(),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(0),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(!1),r=(0,c.useRef)(null),s=(0,c.useRef)([]),t=(0,c.useRef)(null),u=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void e({title:"Ø®Ø·Ø§",description:"Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ø¶Ø¨Ø· ØµØ¯Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯",variant:"destructive"});let a=await navigator.mediaDevices.getUserMedia({audio:!0});o(!0),q(!1);let b=new MediaRecorder(a);r.current=b,s.current=[],b.ondataavailable=a=>{a.data.size>0&&s.current.push(a.data)},b.onstop=()=>{let c=new Blob(s.current,{type:b.mimeType||"audio/webm"});k(c);let d=URL.createObjectURL(c);m(d),a.getTracks().forEach(a=>a.stop())},b.onerror=a=>{X.logger.error("MediaRecorder error:",a),e({title:"Ø®Ø·Ø§ Ø¯Ø± Ø¶Ø¨Ø· ØµØ¯Ø§",description:"Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¶Ø¨Ø· ØµØ¯Ø§ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",variant:"destructive"}),v()},b.start(),g(!0),i(0),t.current=setInterval(()=>{i(a=>a+1)},1e3),e({title:"Ø¶Ø¨Ø· ØµØ¯Ø§ Ø´Ø±ÙˆØ¹ Ø´Ø¯",description:"Ø¯Ø± Ø­Ø§Ù„ Ø¶Ø¨Ø· Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ..."})}catch(c){X.logger.error("Error starting recording:",c),o(!1);let a="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª.",b="";"NotAllowedError"===c.name||"PermissionDeniedError"===c.name?(a="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø¯ Ø´Ø¯",b="Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø®ÙˆØ¯ØŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯."):"NotFoundError"===c.name||"DevicesNotFoundError"===c.name?(a="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ÛŒØ§ÙØª Ù†Ø´Ø¯",b="Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¨Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø´Ù…Ø§ Ù…ØªØµÙ„ Ø§Ø³Øª."):"NotReadableError"===c.name||"TrackStartError"===c.name?(a="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª",b="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ØªÙˆØ³Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ Ø¨Ø¨Ù†Ø¯ÛŒØ¯."):"OverconstrainedError"===c.name||"ConstraintNotSatisfiedError"===c.name?(a="ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯",b="Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯."):b="Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯ ÛŒØ§ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.",e({title:a,description:b,variant:"destructive",duration:5e3}),("NotAllowedError"===c.name||"PermissionDeniedError"===c.name)&&q(!0)}},v=()=>{if(r.current&&"inactive"!==r.current.state)try{r.current.stop(),g(!1),t.current&&clearInterval(t.current),e({title:"Ø¶Ø¨Ø· ØµØ¯Ø§ Ù…ØªÙˆÙ‚Ù Ø´Ø¯",description:"Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ Ø´Ù…Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§ Ù„ØºÙˆ Ú©Ù†ÛŒØ¯."})}catch(a){X.logger.error("Error stopping recording:",a),e({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± ØªÙˆÙ‚Ù Ø¶Ø¨Ø· Ø±Ø® Ø¯Ø§Ø¯.",variant:"destructive"})}},w=async()=>{if(X.logger.info("saveRecording called",{hasAudioBlob:!!j,hasAudioUrl:!!l}),console.log("[Voice Widget] saveRecording called",{hasAudioBlob:!!j,hasAudioUrl:!!l,audioBlobSize:j?.size,audioUrl:l}),!j||!l){X.logger.warn("No audio blob or URL available"),console.log("[Voice Widget] No audio blob or URL available, returning"),alert("Ù‡ÛŒÚ† Ø¶Ø¨Ø· ØµÙˆØªÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª");return}try{console.log("[Voice Widget] Starting upload...");let c="webm",e=j.type||"audio/webm";e.includes("mp4")||e.includes("m4a")?c="m4a":e.includes("ogg")?c="ogg":e.includes("wav")?c="wav":e.includes("webm")&&(c="webm");let f=new File([j],`audio-${Date.now()}.${c}`,{type:e});console.log("[Voice Widget] Uploading audio file...");let g=await a(f,"audio");console.log("[Voice Widget] Upload successful, URL:",g);let n={id:"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():`audio-${Date.now()}-${Math.random().toString(36).substr(2,9)}-${performance.now()}`,type:"audio",url:g,name:`Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ ${aj(h)}`,size:j.size,duration:h};console.log("[Voice Widget] Adding attachment:",n),b(a=>{let b=[...a,n];return console.log("[Voice Widget] New attachments:",b),b}),k(null),l&&URL.revokeObjectURL(l),m(null),i(0),console.log("[Voice Widget] Auto-sending message..."),setTimeout(()=>{d()},100)}catch(a){}};return{isRecording:f,recordingTime:h,audioUrl:l,showPermissionGuide:p,setShowPermissionGuide:q,checkMicrophonePermission:async()=>{try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(a=>a.stop()),!0}catch(a){return!1}},startRecording:u,stopRecording:v,cancelRecording:()=>{v(),k(null),l&&(URL.revokeObjectURL(l),m(null)),i(0)},saveRecording:w}}(aw,D,av),ay=function(a,b,d,e){let{toast:f}=(0,T.useToast)(),g=(0,c.useRef)(null),h=(0,c.useRef)(null);return{imageInputRef:g,fileInputRef:h,handleFileSelect:async(c,d)=>{let e=c.target.files;if(e&&0!==e.length){for(let c of Array.from(e))try{let e=await a(c,d),f={id:`${d}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:d,name:c.name,size:c.size,url:e};b(a=>[...a,f])}catch(a){}c.target.value=""}},handleRemoveAttachment:a=>{b(b=>{let c=b.find(b=>b.id===a);return c?.url&&URL.revokeObjectURL(c.url),b.filter(b=>b.id!==a)})},handleLocationShare:()=>{if(X.logger.info("handleLocationShare called"),console.log("[Location Widget] handleLocationShare called"),!navigator.geolocation){X.logger.warn("Geolocation not supported"),console.log("[Location Widget] Geolocation not supported"),f({title:"Ø®Ø·Ø§",description:"Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯",variant:"destructive"});return}let a="https:"===window.location.protocol||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;if(console.log("[Location Widget] Protocol:",window.location.protocol,"Hostname:",window.location.hostname,"IsSecure:",a),!a){X.logger.warn("Not on secure origin"),console.log("[Location Widget] Not on secure origin"),f({title:"Ø®Ø·Ø§",description:"Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø¨Ø§ÛŒØ¯ Ø§Ø² HTTPS Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ø¢Ø¯Ø±Ø³ Ø§Ù…Ù† Ø³Ø§ÛŒØª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",variant:"destructive"});return}f({title:"Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª...",description:"Ù„Ø·ÙØ§Ù‹ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø¯Ù‡ÛŒØ¯",duration:3e3}),X.logger.info("Requesting geolocation permission..."),console.log("[Location Widget] Requesting geolocation permission..."),navigator.geolocation.getCurrentPosition(a=>{X.logger.info("Location received:",a.coords),console.log("[Location Widget] Position received:",a.coords);let c={id:`location-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"location",url:`https://www.google.com/maps?q=${a.coords.latitude},${a.coords.longitude}`,name:"Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ"};console.log("[Location Widget] Adding attachment:",c),b(a=>{let b=[...a,c];return console.log("[Location Widget] New attachments:",b),b}),d(!1),console.log("[Location Widget] Auto-sending message..."),setTimeout(()=>{e()},100)},a=>{X.logger.error("Error getting location:",a);let b="Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ";1===a.code?b="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø¯ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.":2===a.code?b="Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ GPS ÙØ¹Ø§Ù„ Ø§Ø³Øª.":3===a.code&&(b="Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø²Ù…Ø§Ù†â€ŒØ¨Ø± Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯."),f({title:"Ø®Ø·Ø§",description:b,variant:"destructive"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}}}(aw,D,F,av),{isRecording:az,recordingTime:aA,audioUrl:aB,showPermissionGuide:aC,setShowPermissionGuide:aD,checkMicrophonePermission:aE,startRecording:aF,stopRecording:aG,cancelRecording:aH,saveRecording:aI}=ax,{imageInputRef:aJ,fileInputRef:aK,handleFileSelect:aL,handleRemoveAttachment:aM,handleLocationShare:aN}=ay;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{"data-chat-open":a&&1?"true":"false",style:{display:"none"}}),(0,b.jsxs)(S.Sheet,{open:a,onOpenChange:e,children:[f&&(0,b.jsx)(S.SheetTrigger,{asChild:!0,children:f}),(0,b.jsxs)(S.SheetContent,{side:"left",className:"w-full sm:w-[420px] md:w-[480px] p-0 flex flex-col border-l-2 border-border/40 bg-background shadow-2xl",children:[(0,b.jsx)(ai,{step:B,isOnline:l,lastSeen:m,customerInfo:z,onEditInfo:()=>{window.location.href="/auth"}}),(0,b.jsx)(af,{messages:q,messagesContainerRef:ab,messagesEndRef:aa,isSupportTyping:M,onReply:a=>{v(a),x(null)},onEdit:a=>{x(a),v(null),t(a.text||"")},onDelete:au}),(0,b.jsx)(ag.ChatInput,{message:s,setMessage:t,attachments:C,setAttachments:D,showAttachmentOptions:E,setShowAttachmentOptions:F,isRecording:az,recordingTime:aA,audioUrl:aB,isSaving:G,showScrollToBottom:ah,showPermissionGuide:aC,setShowPermissionGuide:aD,textareaRef:ac,imageInputRef:aJ,fileInputRef:aK,typingTimeoutRef:Q,handleSendMessage:av,handleFileSelect:aL,handleRemoveAttachment:aM,handleLocationShare:aN,startRecording:aF,stopRecording:aG,saveRecording:aI,cancelRecording:aH,sendTypingStatus:at,scrollToBottom:an,formatTime:aj,toast:h})]})]})]})}let am={pending:{label:"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±",color:"bg-yellow-100 text-yellow-800",icon:s.Clock},processing:{label:"Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´",color:"bg-blue-100 text-blue-800",icon:l.Package},shipped:{label:"Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡",color:"bg-purple-100 text-purple-800",icon:q.Truck},delivered:{label:"ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡",color:"bg-green-100 text-green-800",icon:r.CheckCircle2},cancelled:{label:"Ù„ØºÙˆ Ø´Ø¯Ù‡",color:"bg-red-100 text-red-800",icon:t.XCircle}},an={pending:{label:"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª",color:"bg-yellow-100 text-yellow-800"},paid:{label:"Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡",color:"bg-green-100 text-green-800"},failed:{label:"Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚",color:"bg-red-100 text-red-800"},refunded:{label:"Ø¨Ø§Ø²Ú¯Ø´Øª ÙˆØ¬Ù‡",color:"bg-gray-100 text-gray-800"}};function ao(){let a,B,C,D,E,F,G,H,I,J,K=(0,d.useSearchParams)().get("orderNumber")||"",[L,M]=(0,c.useState)(K),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(!1),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(!1),{orders:W,updateOrder:X}=(0,i.useOrderStore)(),{getProduct:Y,loadProductsFromDB:Z}=(0,j.useProductStore)(),$=()=>{(Q(!1),O(null),T(!0),L.trim())?_(L):T(!1)},_=async a=>{try{let b=W.find(b=>b.orderNumber.toLowerCase()===a.toLowerCase().trim()||b.id===a.trim());if(b){O(b),Q(!1);return}console.log("[Track Order] Fetching order from API:",a);let c=await fetch(`/api/orders?orderNumber=${encodeURIComponent(a)}`,{credentials:"include"});if(console.log("[Track Order] API response status:",c.status),c.ok){let a=await c.json();if(console.log("[Track Order] API result:",{success:a.success,dataLength:a.data?.length||0,hasData:!!a.data}),a.success&&a.data&&a.data.length>0){let b=a.data[0];console.log("[Track Order] Order found:",b.orderNumber),O(b),Q(!1),X(b.id,b)}else console.log("[Track Order] Order not found in API response"),Q(!0)}else{let a=await c.text().catch(()=>"Unknown error");console.error("[Track Order] API error:",c.status,a),Q(!0)}}catch(a){console.error("Error fetching order:",a),Q(!0)}};return(0,c.useEffect)(()=>{Z(!0).catch(a=>{console.error("Error loading products for order tracking:",a)})},[Z]),(0,c.useEffect)(()=>{K&&K.trim()&&(T(!0),_(K))},[K]),(0,c.useEffect)(()=>{if(!N?.id)return;let a=setInterval(async()=>{try{let a=await fetch(`/api/orders/${N.id}`);if(a.ok){let b=await a.json();b.success&&b.data&&(O(b.data),X(b.data.id,b.data))}}catch(a){console.error("Error polling order status:",a)}},1e4);return()=>clearInterval(a)},[N?.id,X]),N&&am[N.status]?.icon||s.Clock,(0,b.jsxs)("div",{className:"container mx-auto px-4 py-6 sm:py-8 md:py-12",children:[(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6 sm:mb-8",children:[(0,b.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´"}),(0,b.jsxs)(f.Button,{onClick:()=>V(!0),variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,b.jsx)(x.MessageCircle,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Ú†Øª Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ†"}),(0,b.jsx)("span",{className:"sm:hidden",children:"Ú†Øª"})]})]}),(0,b.jsxs)(e.Card,{className:"mb-4 sm:mb-6",children:[(0,b.jsx)(e.CardHeader,{className:"pb-3 sm:pb-6",children:(0,b.jsx)(e.CardTitle,{className:"text-base sm:text-lg",children:"Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³ÙØ§Ø±Ø´"})}),(0,b.jsx)(e.CardContent,{className:"pt-0 sm:pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(h.Label,{htmlFor:"orderNumber",className:"text-sm sm:text-base",children:"Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´"}),(0,b.jsx)(g.Input,{id:"orderNumber",placeholder:"ORD-1234567890-001",value:L,onChange:a=>M(a.target.value),onKeyDown:a=>{"Enter"===a.key&&$()},className:"mt-1 text-sm sm:text-base"})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsxs)(f.Button,{onClick:$,size:"lg",className:"w-full sm:w-auto",children:[(0,b.jsx)(k.Search,{className:"ml-2 h-4 w-4"}),"Ø¬Ø³ØªØ¬Ùˆ"]})})]})})]}),P&&S&&(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,b.jsx)(t.XCircle,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,b.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Ø³ÙØ§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯"}),(0,b.jsx)("p",{className:"text-muted-foreground text-center mb-6",children:"Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."})]})})}),N&&(0,b.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:["cancelled"===N.status&&(0,b.jsx)(e.Card,{className:"border-2 border-red-500 bg-red-50 dark:bg-red-950/30",children:(0,b.jsxs)(e.CardContent,{className:"pt-4 sm:pt-6",children:[(0,b.jsxs)("div",{className:"flex sm:hidden items-center gap-2",children:[(0,b.jsx)(t.XCircle,{className:"h-5 w-5 text-red-700 dark:text-red-400 flex-shrink-0"}),(0,b.jsx)(A.Badge,{variant:"destructive",className:"bg-red-600 text-white text-xs",children:am.cancelled.label}),(0,b.jsx)("span",{className:"text-sm font-semibold text-red-900 dark:text-red-50 flex-1",children:"Ø³ÙØ§Ø±Ø´ Ù„ØºÙˆ Ø´Ø¯Ù‡"})]}),(0,b.jsxs)("div",{className:"hidden sm:flex items-center gap-3",children:[(0,b.jsx)(t.XCircle,{className:"h-6 w-6 text-red-700 dark:text-red-400 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg text-red-900 dark:text-red-50 mb-1",children:"Ø³ÙØ§Ø±Ø´ Ù„ØºÙˆ Ø´Ø¯Ù‡ Ø§Ø³Øª"}),(0,b.jsxs)("p",{className:"text-sm text-red-800 dark:text-red-100",children:["Ø§ÛŒÙ† Ø³ÙØ§Ø±Ø´ ØªÙˆØ³Ø· Ù…Ø¯ÛŒØ±ÛŒØª Ù„ØºÙˆ Ø´Ø¯Ù‡ Ø§Ø³Øª.",N.updatedAt&&(0,b.jsxs)("span",{className:"block mt-1 text-red-900 dark:text-red-50",children:["ØªØ§Ø±ÛŒØ® Ù„ØºÙˆ: ",new Date(N.updatedAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),(0,b.jsx)(A.Badge,{variant:"destructive",className:"bg-red-600 text-white",children:am.cancelled.label})]})]})}),(0,b.jsxs)(e.Card,{className:"border-2",children:[(0,b.jsx)(e.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,b.jsxs)(e.CardTitle,{className:"flex items-center gap-2 text-base sm:text-lg",children:[(0,b.jsx)(l.Package,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´"}),(0,b.jsx)("span",{className:"sm:hidden",children:"ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´"})]})}),(0,b.jsxs)(e.CardContent,{className:"pt-4 sm:pt-6",children:[(0,b.jsxs)("div",{className:"sm:hidden space-y-3",children:[[{status:"pending",label:"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±",icon:u.ShoppingCart},{status:"processing",label:"Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´",icon:v},{status:"shipped",label:"Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡",icon:q.Truck},{status:"delivered",label:"ØªØ­ÙˆÛŒÙ„ Ø´Ø¯Ù‡",icon:r.CheckCircle2}].map(a=>{let c=["pending","processing","shipped","delivered"],d=c.indexOf(N.status),e=c.indexOf(a.status),f=d>=e&&"cancelled"!==N.status,g=d===e&&"cancelled"!==N.status,h=a.icon;return(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${f?"bg-primary text-primary-foreground":g?"bg-primary/20 text-primary border border-primary":"bg-muted text-muted-foreground"}`,children:f?(0,b.jsx)(w.CheckCircle,{className:"h-4 w-4"}):(0,b.jsx)(h,{className:"h-4 w-4"})}),(0,b.jsx)("span",{className:`text-sm flex-1 ${f||g?"font-semibold":"text-muted-foreground"}`,children:a.label}),g&&(0,b.jsx)(A.Badge,{variant:"default",className:"text-xs animate-pulse",children:"ÙØ¹Ù„ÛŒ"})]},a.status)}),(0,b.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1.5",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Ù¾ÛŒØ´Ø±ÙØª"}),(0,b.jsx)("span",{className:"text-xs font-medium",children:-1===(B=(a=["pending","processing","shipped","delivered"]).indexOf(N.status))?"0%":`${Math.round((B+1)/a.length*100)}%`})]}),(0,b.jsx)(R,{value:-1===(D=(C=["pending","processing","shipped","delivered"]).indexOf(N.status))?0:(D+1)/C.length*100,className:"h-2"})]})]}),(0,b.jsxs)("div",{className:"hidden sm:block",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute right-8 top-0 bottom-0 w-0.5 bg-border",children:(0,b.jsx)("div",{className:"absolute top-0 right-0 w-full bg-primary transition-all duration-500 ease-in-out",style:{height:`${-1===(F=(E=["pending","processing","shipped","delivered"]).indexOf(N.status))?0:(F+1)/E.length*100}%`}})}),(0,b.jsx)("div",{className:"space-y-8 relative z-10",children:[{status:"pending",label:"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±",icon:u.ShoppingCart,description:"Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯"},{status:"processing",label:"Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´",icon:v,description:"Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ"},{status:"shipped",label:"Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡",icon:q.Truck,description:"Ø¯Ø± Ù…Ø³ÛŒØ± ØªØ­ÙˆÛŒÙ„"},{status:"delivered",label:"ØªØ­ÙˆÛŒÙ„ Ø´Ø¯Ù‡",icon:r.CheckCircle2,description:"ØªØ­ÙˆÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯"}].map((a,c)=>{let d=["pending","processing","shipped","delivered"],e=d.indexOf(N.status),f=d.indexOf(a.status),g=e>=f&&"cancelled"!==N.status,h=e===f&&"cancelled"!==N.status,i=a.icon;return(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:"relative z-10",children:(0,b.jsx)("div",{className:`w-16 h-16 rounded-full flex items-center justify-center transition-all duration-300 ${g?"bg-primary text-primary-foreground shadow-lg shadow-primary/50":h?"bg-primary/20 text-primary border-2 border-primary":"bg-muted text-muted-foreground"}`,children:g?(0,b.jsx)(w.CheckCircle,{className:"h-8 w-8"}):(0,b.jsx)(i,{className:"h-8 w-8"})})}),(0,b.jsxs)("div",{className:"flex-1 pt-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsx)("h3",{className:`font-semibold text-lg ${g||h?"text-foreground":"text-muted-foreground"}`,children:a.label}),h&&(0,b.jsx)(A.Badge,{variant:"default",className:"animate-pulse",children:"Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…"}),g&&!h&&(0,b.jsxs)(A.Badge,{variant:"success",className:"gap-1",children:[(0,b.jsx)(w.CheckCircle,{className:"h-3 w-3"}),"ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯"]})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.description}),h&&N.updatedAt&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:"," ",new Date(N.updatedAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]},a.status)})})]}),(0,b.jsxs)("div",{className:"mt-8 pt-6 border-t",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Ù¾ÛŒØ´Ø±ÙØª Ú©Ù„ÛŒ"}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:-1===(H=(G=["pending","processing","shipped","delivered"]).indexOf(N.status))?"0%":`${Math.round((H+1)/G.length*100)}%`})]}),(0,b.jsx)(R,{value:-1===(J=(I=["pending","processing","shipped","delivered"]).indexOf(N.status))?0:(J+1)/I.length*100,className:"h-3"})]}),(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,b.jsx)(l.Package,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´"}),(0,b.jsx)("p",{className:"font-semibold font-mono",children:N.orderNumber})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,b.jsx)(p.Calendar,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª"}),(0,b.jsx)("p",{className:"font-semibold",children:new Date(N.createdAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3 sm:pb-6",children:(0,b.jsx)(e.CardTitle,{className:"text-base sm:text-lg",children:"Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³ÙØ§Ø±Ø´"})}),(0,b.jsx)(e.CardContent,{className:"pt-0 sm:pt-6",children:(0,b.jsx)("div",{className:"space-y-3 sm:space-y-4",children:Array.isArray(N.items)?N.items.map(a=>{let c=Y(a.productId||a.id),d=a.image&&""!==a.image.trim()?a.image:"";!d&&c&&c.images&&c.images.length>0&&(d=c.images[0]);let e=d&&(a=>{if(!a||"string"!=typeof a||""===a.trim())return!1;if(a.startsWith("blob:")||a.startsWith("data:"))return!0;try{return new URL(a),!0}catch{return!1}})(d);return(0,b.jsxs)("div",{className:"flex gap-2 sm:gap-4 pb-3 sm:pb-4 border-b last:border-0",children:[(0,b.jsx)("div",{className:"relative w-16 h-16 sm:w-20 sm:h-20 bg-muted rounded-lg overflow-hidden flex-shrink-0 border",children:(0,b.jsx)(z.SafeImage,{src:e?d:null,alt:a.name||"Product image",fill:!0,className:"w-full h-full"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"font-semibold mb-1 text-sm sm:text-base truncate",children:a.name}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-1 sm:gap-0",children:[(0,b.jsxs)("span",{className:"text-xs sm:text-sm text-muted-foreground",children:["ØªØ¹Ø¯Ø§Ø¯: ",a.quantity]}),(0,b.jsxs)("span",{className:"font-semibold text-sm sm:text-base text-foreground",children:[(a.price*a.quantity).toLocaleString("fa-IR")," ØªÙˆÙ…Ø§Ù†"]})]})]})]},a.id)}):(0,b.jsxs)("div",{className:"text-center py-6 sm:py-8 text-muted-foreground",children:[(0,b.jsx)(l.Package,{className:"h-10 w-10 sm:h-12 sm:w-12 mx-auto mb-3 sm:mb-4 opacity-50"}),(0,b.jsx)("p",{className:"text-sm sm:text-base",children:"Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³ÙØ§Ø±Ø´ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª"})]})})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3 sm:pb-6",children:(0,b.jsx)(e.CardTitle,{className:"text-base sm:text-lg",children:"Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§"})}),(0,b.jsxs)(e.CardContent,{className:"space-y-2 sm:space-y-3 pt-0 sm:pt-6",children:[(0,b.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3",children:[(0,b.jsx)("div",{className:"p-1.5 sm:p-2 bg-muted rounded-lg flex-shrink-0",children:(0,b.jsx)(l.Package,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Ù†Ø§Ù…"}),(0,b.jsx)("p",{className:"font-semibold text-sm sm:text-base truncate",children:N.customerName})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3",children:[(0,b.jsx)("div",{className:"p-1.5 sm:p-2 bg-muted rounded-lg flex-shrink-0",children:(0,b.jsx)(n.Phone,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³"}),(0,b.jsx)("p",{className:"font-semibold text-sm sm:text-base",children:N.customerPhone})]})]}),N.customerEmail&&(0,b.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3",children:[(0,b.jsx)("div",{className:"p-1.5 sm:p-2 bg-muted rounded-lg flex-shrink-0",children:(0,b.jsx)(o.Mail,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Ø§ÛŒÙ…ÛŒÙ„"}),(0,b.jsx)("p",{className:"font-semibold text-sm sm:text-base truncate",children:N.customerEmail})]})]})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3 sm:pb-6",children:(0,b.jsx)(e.CardTitle,{className:"text-base sm:text-lg",children:"Ø¢Ø¯Ø±Ø³ Ø§Ø±Ø³Ø§Ù„"})}),(0,b.jsxs)(e.CardContent,{className:"space-y-2 sm:space-y-3 pt-0 sm:pt-6",children:[(0,b.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3",children:[(0,b.jsx)("div",{className:"p-1.5 sm:p-2 bg-muted rounded-lg flex-shrink-0",children:(0,b.jsx)(m.MapPin,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Ø¢Ø¯Ø±Ø³"}),(()=>{let a=N.shippingAddress.location,c=a&&a.includes(",")&&/^-?\d+\.?\d*,-?\d+\.?\d*$/.test(a.trim());if(("location"===N.shippingAddress.addressType||c)&&a){let[c,d]=a.split(",").map(a=>a.trim()),e=`https://www.google.com/maps?q=${c},${d}`;return(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("p",{className:"font-semibold text-sm sm:text-base break-words font-mono",children:[c,", ",d]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Ù…Ø®ØªØµØ§Øª Ø¯Ù‚ÛŒÙ‚ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø´Ù…Ø§"}),(0,b.jsxs)(f.Button,{type:"button",variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>window.open(e,"_blank"),children:[(0,b.jsx)(m.MapPin,{className:"h-3 w-3 ml-1"}),"Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ù†Ù‚Ø´Ù‡",(0,b.jsx)(y.ExternalLink,{className:"h-3 w-3 mr-1"})]})]})}return"postalCode"===N.shippingAddress.addressType&&N.shippingAddress.postalCode?(0,b.jsxs)("p",{className:"font-semibold text-sm sm:text-base break-words",children:["Ú©Ø¯ Ù¾Ø³ØªÛŒ: ",N.shippingAddress.postalCode]}):(0,b.jsxs)(b.Fragment,{children:[N.shippingAddress.city&&(0,b.jsxs)("p",{className:"font-semibold text-sm sm:text-base break-words",children:[N.shippingAddress.city,N.shippingAddress.address?`ØŒ ${N.shippingAddress.address}`:""]}),N.shippingAddress.postalCode&&(0,b.jsxs)("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:["Ú©Ø¯ Ù¾Ø³ØªÛŒ: ",N.shippingAddress.postalCode]})]})})()]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3",children:[(0,b.jsx)("div",{className:"p-1.5 sm:p-2 bg-muted rounded-lg flex-shrink-0",children:(0,b.jsx)(q.Truck,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Ø±ÙˆØ´ Ø§Ø±Ø³Ø§Ù„"}),(0,b.jsx)("p",{className:"font-semibold text-sm sm:text-base",children:"air"===N.shippingMethod?"Ù‡ÙˆØ§ÛŒÛŒ":"Ø¯Ø±ÛŒØ§ÛŒÛŒ"})]})]})]})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3 sm:pb-6",children:(0,b.jsx)(e.CardTitle,{className:"text-base sm:text-lg",children:"Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ§Ø±Ø´"})}),(0,b.jsx)(e.CardContent,{className:"pt-0 sm:pt-6",children:(0,b.jsxs)("div",{className:"space-y-2.5 sm:space-y-3",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm sm:text-base",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Ø¬Ù…Ø¹ Ú©Ù„:"}),(0,b.jsxs)("span",{className:"font-semibold",children:[N.total.toLocaleString("fa-IR")," ØªÙˆÙ…Ø§Ù†"]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm sm:text-base",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„:"}),(0,b.jsx)("span",{className:"font-semibold",children:0===N.shippingCost?(0,b.jsx)("span",{className:"text-green-600",children:"Ø±Ø§ÛŒÚ¯Ø§Ù†"}):`${N.shippingCost.toLocaleString("fa-IR")} ØªÙˆÙ…Ø§Ù†`})]}),(0,b.jsxs)("div",{className:"flex justify-between pt-2.5 sm:pt-3 border-t text-base sm:text-lg",children:[(0,b.jsx)("span",{className:"font-bold",children:"Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ:"}),(0,b.jsxs)("span",{className:"font-bold text-primary",children:[(N.total+N.shippingCost).toLocaleString("fa-IR")," ØªÙˆÙ…Ø§Ù†"]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center pt-2.5 sm:pt-3 border-t text-sm sm:text-base",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª:"}),(0,b.jsx)(A.Badge,{className:`text-xs sm:text-sm ${an[N.paymentStatus]?.color}`,children:an[N.paymentStatus]?.label})]})]})})]})]})]}),(0,b.jsx)(al,{isOpen:U,onOpenChange:V})]})}function ap(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"container mx-auto px-4 py-6",children:"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ..."}),children:(0,b.jsx)(ao,{})})}a.s(["default",()=>ap],12783)}];

//# sourceMappingURL=app_order_track_page_tsx_c5d32813._.js.map
{"version":3,"sources":["../../../lib/validations/auth.ts"],"sourcesContent":["import * as z from \"zod\";\r\n\r\n/**\r\n * اعتبارسنجی شماره تماس ایرانی\r\n * فرمت‌های معتبر: 09123456789, 9123456789, +989123456789\r\n */\r\nexport function validateIranianPhone(phone: string): boolean {\r\n  if (!phone || typeof phone !== \"string\") {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    // حذف فاصله‌ها و کاراکترهای غیر عددی (به جز +)\r\n    const cleaned = phone.replace(/\\s+/g, \"\").replace(/[^\\d+]/g, \"\");\r\n    \r\n    if (!cleaned || cleaned.length === 0) {\r\n      return false;\r\n    }\r\n    \r\n    // حذف +98 و 0098 از ابتدا\r\n    let normalized = cleaned.replace(/^(\\+98|0098)/, \"\");\r\n    \r\n    // اگر با 0 شروع می‌شود، 0 را حذف کن\r\n    if (normalized.startsWith(\"0\")) {\r\n      normalized = normalized.substring(1);\r\n    }\r\n    \r\n    // باید 10 رقم باشد و با 9 شروع شود\r\n    return /^9\\d{9}$/.test(normalized);\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * اعتبارسنجی رمز عبور\r\n * فقط طول را بررسی می‌کند - حداقل 6 کاراکتر\r\n */\r\nexport function validateStrongPassword(password: string): {\r\n  valid: boolean;\r\n  errors: string[];\r\n} {\r\n  const errors: string[] = [];\r\n  \r\n  if (password.length < 6) {\r\n    errors.push(\"رمز عبور باید حداقل 6 کاراکتر باشد\");\r\n    return { valid: false, errors };\r\n  }\r\n  \r\n  if (password.length > 128) {\r\n    errors.push(\"رمز عبور نمی‌تواند بیشتر از 128 کاراکتر باشد\");\r\n    return { valid: false, errors };\r\n  }\r\n  \r\n  // هیچ محدودیتی روی نوع کاراکترها نیست - فقط طول مهم است\r\n  \r\n  return {\r\n    valid: true,\r\n    errors: [],\r\n  };\r\n}\r\n\r\n/**\r\n * Schema اعتبارسنجی ثبت‌نام\r\n */\r\nexport const registerSchema = z.object({\r\n  name: z\r\n    .string()\r\n    .min(2, \"نام باید حداقل 2 کاراکتر باشد\")\r\n    .max(100, \"نام نمی‌تواند بیشتر از 100 کاراکتر باشد\")\r\n    .regex(/^[\\u0600-\\u06FFa-zA-Z\\s]+$/, \"نام باید فقط شامل حروف فارسی یا انگلیسی باشد\"),\r\n  phone: z\r\n    .string()\r\n    .min(1, \"شماره تماس الزامی است\")\r\n    .refine((val) => {\r\n      try {\r\n        return validateIranianPhone(val);\r\n      } catch {\r\n        return false;\r\n      }\r\n    }, {\r\n      message: \"شماره تماس معتبر نیست. فرمت صحیح: 09123456789\",\r\n    }),\r\n  password: z\r\n    .string()\r\n    .min(6, \"رمز عبور باید حداقل 6 کاراکتر باشد\")\r\n    .max(128, \"رمز عبور نمی‌تواند بیشتر از 128 کاراکتر باشد\"),\r\n});\r\n\r\n/**\r\n * Schema اعتبارسنجی ورود\r\n */\r\nexport const loginSchema = z.object({\r\n  phone: z\r\n    .string()\r\n    .min(1, \"شماره تماس الزامی است\")\r\n    .refine((val) => {\r\n      try {\r\n        return validateIranianPhone(val);\r\n      } catch {\r\n        return false;\r\n      }\r\n    }, {\r\n      message: \"شماره تماس معتبر نیست. فرمت صحیح: 09123456789\",\r\n    }),\r\n  password: z\r\n    .string()\r\n    .min(1, \"رمز عبور الزامی است\")\r\n    .max(128, \"رمز عبور نمی‌تواند بیشتر از 128 کاراکتر باشد\"),\r\n});\r\n\r\n/**\r\n * نرمال‌سازی شماره تماس به فرمت استاندارد (09123456789)\r\n */\r\nexport function normalizePhone(phone: string): string {\r\n  if (!phone || typeof phone !== \"string\") {\r\n    throw new Error(\"شماره تماس معتبر نیست\");\r\n  }\r\n\r\n  // حذف فاصله‌ها و کاراکترهای غیر عددی (به جز +)\r\n  let cleaned = phone.trim().replace(/\\s+/g, \"\").replace(/[^\\d+]/g, \"\");\r\n  \r\n  if (!cleaned || cleaned.length === 0) {\r\n    throw new Error(\"شماره تماس معتبر نیست\");\r\n  }\r\n  \r\n  // حذف +98 و 0098 از ابتدا\r\n  cleaned = cleaned.replace(/^(\\+98|0098)/, \"\");\r\n  \r\n  // اگر با 0 شروع نمی‌شود، 0 اضافه کن\r\n  if (!cleaned.startsWith(\"0\")) {\r\n    cleaned = \"0\" + cleaned;\r\n  }\r\n  \r\n  // بررسی نهایی - باید دقیقاً 11 رقم باشد\r\n  if (cleaned.length !== 11) {\r\n    throw new Error(`شماره تماس باید دقیقاً 11 رقم باشد (${cleaned.length} رقم وارد شده: ${cleaned})`);\r\n  }\r\n  \r\n  // بررسی اینکه با 09 شروع می‌شود\r\n  if (!cleaned.startsWith(\"09\")) {\r\n    throw new Error(`شماره تماس باید با 09 شروع شود (شروع شده با: ${cleaned.substring(0, 2)})`);\r\n  }\r\n  \r\n  // بررسی اینکه فقط عدد باشد\r\n  if (!/^\\d+$/.test(cleaned)) {\r\n    throw new Error(\"شماره تماس باید فقط شامل اعداد باشد\");\r\n  }\r\n  \r\n  return cleaned;\r\n}\r\n\r\nexport type RegisterData = z.infer<typeof registerSchema>;\r\nexport type LoginData = z.infer<typeof loginSchema>;\r\n\r\n"],"names":[],"mappings":"uCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAMO,SAAS,EAAqB,CAAa,EAChD,GAAI,CAAC,GAA0B,UAAjB,AAA2B,OAApB,EACnB,OAAO,EAGT,GAAI,CAEF,IAAM,EAAU,EAAM,OAAO,CAAC,OAAQ,IAAI,OAAO,CAAC,UAAW,IAE7D,GAAI,CAAC,GAA8B,GAAG,CAAtB,EAAQ,MAAM,CAC5B,OAAO,EAIT,IAAI,EAAa,EAAQ,OAAO,CAAC,eAAgB,IAQjD,OALI,EAAW,UAAU,CAAC,MAAM,CAC9B,EAAa,EAAW,SAAS,CAAC,EAAA,EAI7B,WAAW,IAAI,CAAC,EACzB,CAAE,KAAM,CACN,OAAO,CACT,CACF,CAMO,SAAS,EAAuB,CAAgB,EAIrD,IAAM,EAAmB,EAAE,QAEvB,AAAJ,EAAa,MAAM,CAAG,GAAG,AACvB,EAAO,IAAI,CAAC,sCACL,CAAE,OAAO,SAAO,CAAO,GAG5B,EAAS,MAAM,CAAG,KAAK,AACzB,EAAO,IAAI,CAAC,gDACL,CAAE,OAAO,SAAO,CAAO,GAKzB,CACL,MAAO,GACP,OAAQ,EAAE,AACZ,CACF,CAKO,IAAM,EAAiB,EAAA,MAAQ,CAAC,CACrC,KAAM,EAAA,MACG,GACN,GAAG,CAAC,EAAG,iCACP,GAAG,CAAC,IAAK,2CACT,KAAK,CAAC,6BAA8B,gDACvC,MAAO,EAAA,MACE,GACN,GAAG,CAAC,EAAG,yBACP,MAAM,CAAE,AAAD,IACN,GAAI,CACF,OAAO,EAAqB,EAC9B,CAAE,KAAM,CACN,OAAO,CACT,CACF,EAAG,CACD,QAAS,+CACX,GACF,SAAU,EAAA,MACD,GACN,GAAG,CAAC,EAAG,sCACP,GAAG,CAAC,IAAK,+CACd,GAKa,EAAc,EAAA,MAAQ,CAAC,CAClC,MAAO,EAAA,MACE,GACN,GAAG,CAAC,EAAG,yBACP,MAAM,CAAC,AAAC,IACP,GAAI,CACF,OAAO,EAAqB,EAC9B,CAAE,KAAM,CACN,OAAO,CACT,CACF,EAAG,CACD,QAAS,+CACX,GACF,SAAU,EAAA,MACD,GACN,GAAG,CAAC,EAAG,uBACP,GAAG,CAAC,IAAK,+CACd,GAKO,SAAS,EAAe,CAAa,EAC1C,GAAI,CAAC,GAAS,AAAiB,UAAU,OAApB,EACnB,MAAU,AAAJ,MAAU,yBAIlB,IAAI,EAAU,EAAM,IAAI,GAAG,OAAO,CAAC,OAAQ,IAAI,OAAO,CAAC,UAAW,IAElE,GAAI,CAAC,GAA8B,GAAG,CAAtB,EAAQ,MAAM,CAC5B,MAAM,AAAI,MAAM,yBAYlB,GALI,AAAC,CAHL,EAAU,EAAQ,OAAO,CAAC,eAAgB,GAAA,EAG7B,UAAU,CAAC,MAAM,CAC5B,EAAU,IAAM,CAAA,EAIK,IAAI,CAAvB,EAAQ,MAAM,CAChB,MAAM,AAAI,MAAM,CAAC,oCAAoC,EAAE,EAAQ,MAAM,CAAC,eAAe,EAAE,EAAQ,CAAC,CAAC,EAInG,GAAI,CAAC,EAAQ,UAAU,CAAC,MACtB,CAD6B,KACvB,AAAI,MAAM,CAAC,6CAA6C,EAAE,EAAQ,SAAS,CAAC,EAAG,GAAG,CAAC,CAAC,EAI5F,GAAI,CAAC,QAAQ,IAAI,CAAC,GAChB,MAAM,AAAI,CADgB,KACV,uCAGlB,OAAO,CACT"}
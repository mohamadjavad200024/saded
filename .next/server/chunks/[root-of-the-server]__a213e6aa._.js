module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},40911,e=>{"use strict";let t=new class{isDevelopment=!1;isProduction=!0;shouldLog(e){return"error"===e||"warn"===e||this.isDevelopment}log(...e){this.shouldLog("log")&&console.log(...e)}error(...e){console.error(...e)}warn(...e){console.warn(...e)}info(...e){this.shouldLog("info")&&console.info(...e)}debug(...e){this.shouldLog("debug")&&console.debug(...e)}dbQuery(e,t){this.isDevelopment&&console.log("[DB Query]",e.substring(0,100),t?`[${t.length} params]`:"")}apiRequest(e,t,r){this.isDevelopment&&console.log(`[API] ${e} ${t}${r?` ${r}`:""}`)}};e.s(["logger",0,t])},17939,39142,e=>{"use strict";var t,r=e.i(94028),a=e.i(40911);class s extends Error{status;code;details;constructor(e,t,r,a){super(e),this.name="AppError",this.status=t,this.code=r,this.details=a,Object.setPrototypeOf(this,s.prototype)}}(t={}).TIMEOUT="TIMEOUT",t.NETWORK="NETWORK",t.ABORTED="ABORTED",t.UNKNOWN="UNKNOWN";class o extends Error{type;originalError;constructor(e,t="UNKNOWN",r){super(e),this.name="NetworkError",this.type=t,this.originalError=r,Object.setPrototypeOf(this,o.prototype)}}function n(e,t){let r=e instanceof s?{message:e.message,status:e.status,code:e.code,details:e.details}:e instanceof o?{message:e.message,code:e.type,details:e.originalError}:e instanceof Error?{message:e.message}:"string"==typeof e?{message:e}:{message:"خطای نامشخص رخ داد"},n=t?`[${t}] `:"";a.logger.error(`${n}${r.message}`,{status:r.status,code:r.code,details:r.details})}function i(e,t=500){let a,s="خطای سرور",o=t;return e instanceof Error?(s=e.message,"status"in e&&"number"==typeof e.status&&(o=e.status),"code"in e&&"string"==typeof e.code&&(a=e.code),"details"in e&&e.details):"string"==typeof e?s=e:e&&"object"==typeof e&&"message"in e&&(s=String(e.message),"status"in e&&"number"==typeof e.status&&(o=e.status)),n(e,"API Route"),r.NextResponse.json({success:!1,error:s,...a?{code:a}:{}},{status:o})}function l(e,t=200,a){return r.NextResponse.json({success:!0,data:e,...a&&{pagination:a}},{status:t})}e.s(["AppError",()=>s,"logError",()=>n],39142),e.s(["createErrorResponse",()=>i,"createSuccessResponse",()=>l],17939)},24868,(e,t,r)=>{t.exports=e.x("fs/promises",()=>require("fs/promises"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},12071,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),s=e.i(59756),o=e.i(61916),n=e.i(14444),i=e.i(10680),l=e.i(69741),u=e.i(16795),p=e.i(87718),d=e.i(95169),c=e.i(47587),g=e.i(66012),h=e.i(70101),m=e.i(26937),f=e.i(10372),x=e.i(93695);e.i(52474);var w=e.i(220),E=e.i(24868),R=e.i(14747),v=e.i(22734),y=e.i(17939),A=e.i(39142);let b=(0,R.join)(process.cwd(),"public","uploads","chat");async function N(){(0,v.existsSync)(b)||await (0,E.mkdir)(b,{recursive:!0})}async function O(e){try{await N();let t=await e.formData(),r=t.get("file"),a=t.get("type");if(!r)throw new A.AppError("فایل ارسال نشده است",400,"MISSING_FILE");if(r.size>0xa00000)throw new A.AppError(`حجم فایل باید کمتر از 10 مگابایت باشد`,400,"FILE_TOO_LARGE");let s=["image/jpeg","image/jpg","image/png","image/webm","image/gif"],o=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"];if("image"===a){if(!s.includes(r.type)&&!r.type.startsWith("image/"))throw new A.AppError(`نوع فایل تصویری مجاز نیست. نوع مجاز: ${s.join(", ")}`,400,"INVALID_FILE_TYPE")}else if("file"===a){if(!o.includes(r.type))throw new A.AppError(`نوع فایل مجاز نیست. نوع مجاز: ${o.join(", ")}`,400,"INVALID_FILE_TYPE")}else if("audio"===a){let e=r.name.toLowerCase(),t=[".webm",".ogg",".mp3",".wav",".m4a",".aac",".flac",".mp4"].some(t=>e.endsWith(t));if(!(r.type.startsWith("audio/")||["audio/webm","audio/webm;codecs=opus","audio/ogg","audio/ogg;codecs=opus","audio/mpeg","audio/mp3","audio/wav","audio/wave","audio/x-wav","audio/mp4","audio/aac","audio/flac"].includes(r.type))&&!t)throw new A.AppError(`نوع فایل صوتی مجاز نیست. لطفاً فایل صوتی معتبری ارسال کنید.`,400,"INVALID_FILE_TYPE")}let n=Date.now(),i=Math.random().toString(36).substring(2,9),l=r.name.split(".").pop()||"",u=`${a}-${n}-${i}.${l}`,p=(0,R.join)(b,u),d=await r.arrayBuffer(),c=Buffer.from(d);await (0,E.writeFile)(p,c);let g=`/uploads/chat/${u}`;return(0,y.createSuccessResponse)({url:g,fileName:r.name,fileSize:r.size,type:a})}catch(e){return(0,y.createErrorResponse)(e)}}e.s(["POST",()=>O],38024);var T=e.i(38024);let C=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/chat/upload/route",pathname:"/api/chat/upload",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/chat/upload/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:I,workUnitAsyncStorage:P,serverHooks:S}=C;function _(){return(0,a.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:P})}async function j(e,t,a){C.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let E="/api/chat/upload/route";E=E.replace(/\/index$/,"")||"/";let R=await C.prepare(e,t,{srcPage:E,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:y,nextConfig:A,parsedUrl:b,isDraftMode:N,prerenderManifest:O,routerServerContext:T,isOnDemandRevalidate:I,revalidateOnlyGenerated:P,resolvedPathname:S,clientReferenceManifest:_,serverActionsManifest:j}=R,D=(0,l.normalizeAppPath)(E),q=!!(O.dynamicRoutes[D]||O.routes[S]),$=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,b,!1):t.end("This page could not be found"),null);if(q&&!N){let e=!!O.routes[S],t=O.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await $();throw new x.NoFallbackError}}let k=null;!q||C.isDev||N||(k="/index"===(k=S)?"/":k);let U=!0===C.isDev||!q,M=q&&!U;j&&_&&(0,n.setReferenceManifestsSingleton)({page:E,clientReferenceManifest:_,serverActionsManifest:j,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:j})});let L=e.method||"GET",H=(0,o.getTracer)(),F=H.getActiveScopeSpan(),K={params:y,prerenderManifest:O,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>C.onRequestError(e,t,a,T)},sharedContext:{buildId:v}},B=new u.NodeNextRequest(e),W=new u.NodeNextResponse(t),V=p.NextRequestAdapter.fromNodeNextRequest(B,(0,p.signalFromNodeResponse)(t));try{let n=async e=>C.handle(V,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${L} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${E}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var o,l;let u=async({previousCacheEntry:r})=>{try{if(!i&&I&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(s);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=K.renderOpts.collectedTags;if(!q)return await (0,g.sendResponse)(B,W,o,K.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:I})},T),t}},p=await C.handleResponse({req:e,nextConfig:A,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:O,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:P,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:i});if(!q)return null;if((null==p||null==(o=p.value)?void 0:o.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",I?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,h.fromNodeOutgoingHttpHeaders)(p.value.headers);return i&&q||d.delete(f.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,m.getCacheControlHeader)(p.cacheControl)),await (0,g.sendResponse)(B,W,new Response(p.value.body,{headers:d,status:p.value.status||200})),null};F?await l(F):await H.withPropagatedContext(e.headers,()=>H.trace(d.BaseServerSpan.handleRequest,{spanName:`${L} ${E}`,kind:o.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof x.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:I})}),q)throw t;return await (0,g.sendResponse)(B,W,new Response(null,{status:500})),null}}e.s(["handler",()=>j,"patchFetch",()=>_,"routeModule",()=>C,"serverHooks",()=>S,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>P],12071)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a213e6aa._.js.map
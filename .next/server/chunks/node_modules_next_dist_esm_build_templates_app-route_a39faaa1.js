module.exports=[33108,e=>{"use strict";var t=e.i(47909),s=e.i(74017),o=e.i(96250),i=e.i(59756),r=e.i(61916),n=e.i(14444),a=e.i(10680),l=e.i(69741),c=e.i(16795),d=e.i(87718),u=e.i(95169),p=e.i(47587),g=e.i(66012),E=e.i(70101),h=e.i(26937),T=e.i(10372),R=e.i(93695);e.i(52474);var A=e.i(220),m=e.i(17939),f=e.i(39142),N=e.i(12e3),U=e.i(40911);async function w(e){let t=Date.now();console.log("=== [GET /api/site-settings] ROUTE HANDLER CALLED ==="),console.log("Request URL:",e.url),console.log("Request method:",e.method),console.log("Request headers:",Object.fromEntries(e.headers.entries()));try{let e;U.logger.info("[GET /api/site-settings] Starting request"),console.log("[GET /api/site-settings] Starting request - DEBUG"),console.log("[GET /api/site-settings] Creating table if not exists - DEBUG");try{await (0,N.runQuery)(`
        CREATE TABLE IF NOT EXISTS settings (
          id VARCHAR(255) PRIMARY KEY DEFAULT 'site_settings',
          \`siteName\` VARCHAR(255) NOT NULL DEFAULT 'ساد',
          \`siteDescription\` TEXT,
          \`logoUrl\` LONGTEXT,
          \`contactPhone\` VARCHAR(255),
          \`contactEmail\` VARCHAR(255),
          \`address\` TEXT,
          \`maintenanceMode\` BOOLEAN DEFAULT FALSE,
          \`allowRegistration\` BOOLEAN DEFAULT TRUE,
          \`emailNotifications\` BOOLEAN DEFAULT TRUE,
          \`lowStockThreshold\` INTEGER DEFAULT 10,
          \`itemsPerPage\` INTEGER DEFAULT 10,
          \`showNotifications\` BOOLEAN DEFAULT TRUE,
          \`theme\` VARCHAR(50) DEFAULT 'system',
          \`createdAt\` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
          \`updatedAt\` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
      `),console.log("[GET /api/site-settings] Table created/verified successfully")}catch(e){throw console.error("[GET /api/site-settings] Database error creating table:",e),U.logger.error("[GET /api/site-settings] Database error creating table:",e),new f.AppError(`خطا در اتصال به دیتابیس: ${e.message||"خطای ناشناخته"}`,500,"DATABASE_ERROR")}console.log("[GET /api/site-settings] Fetching settings from database");try{e=await (0,N.getRow)("SELECT * FROM settings WHERE id = 'site_settings' LIMIT 1"),console.log("[GET /api/site-settings] Settings fetched:",e?"found":"not found")}catch(e){throw console.error("[GET /api/site-settings] Database error fetching settings:",e),U.logger.error("[GET /api/site-settings] Database error fetching settings:",e),new f.AppError(`خطا در خواندن تنظیمات: ${e.message||"خطای ناشناخته"}`,500,"DATABASE_ERROR")}if(!e){console.log("[GET /api/site-settings] Settings not found, creating default settings");try{await (0,N.runQuery)(`
          INSERT INTO settings (id, \`siteName\`, \`siteDescription\`, \`lowStockThreshold\`, \`itemsPerPage\`)
          VALUES ('site_settings', 'ساد', 'فروشگاه آنلاین قطعات خودرو وارداتی', 10, 10)
        `),console.log("[GET /api/site-settings] Default settings created"),e=await (0,N.getRow)("SELECT * FROM settings WHERE id = 'site_settings' LIMIT 1")}catch(e){throw console.error("[GET /api/site-settings] Database error creating default settings:",e),U.logger.error("[GET /api/site-settings] Database error creating default settings:",e),new f.AppError(`خطا در ایجاد تنظیمات پیش‌فرض: ${e.message||"خطای ناشناخته"}`,500,"DATABASE_ERROR")}}if(!e)throw console.error("[GET /api/site-settings] Settings still not found after creation attempt"),new f.AppError("خطا در بارگذاری تنظیمات",500,"SETTINGS_NOT_FOUND");let s=(0,m.createSuccessResponse)({siteName:e.siteName||"ساد",siteDescription:e.siteDescription||"",logoUrl:e.logoUrl||"",maintenanceMode:e.maintenanceMode||!1,allowRegistration:void 0===e.allowRegistration||e.allowRegistration,emailNotifications:void 0===e.emailNotifications||e.emailNotifications,lowStockThreshold:e.lowStockThreshold||10,itemsPerPage:e.itemsPerPage||10,showNotifications:void 0===e.showNotifications||e.showNotifications,theme:e.theme||"system"}),o=Date.now()-t;return console.log(`[GET /api/site-settings] Request completed successfully in ${o}ms`),s}catch(s){let e=Date.now()-t;if(console.error(`[GET /api/site-settings] Error after ${e}ms:`,s),U.logger.error("[GET /api/site-settings] Error getting settings:",s),s instanceof f.AppError)return(0,m.createErrorResponse)(s);return(0,m.createErrorResponse)(new f.AppError(`خطای سرور: ${s?.message||"خطای ناشناخته"}`,500,"INTERNAL_ERROR"))}}async function b(t){let s=Date.now();fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:175",message:"PUT handler called",data:{url:t.url,method:t.method,hasCookieHeader:!!t.headers.get("cookie")},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),console.log("=== [PUT /api/site-settings] ROUTE HANDLER CALLED ==="),console.log("Request URL:",t.url),console.log("Request method:",t.method);let o=t.headers.get("cookie"),i=Object.fromEntries(t.headers.entries());fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:182",message:"Request headers received",data:{cookieHeader:o?.substring(0,200)||"null",hasCookie:!!o,headerKeys:Object.keys(i)},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),console.log("Request headers:",i);try{let o,i;U.logger.info("[PUT /api/site-settings] Starting request"),console.log("[PUT /api/site-settings] Starting request - DEBUG"),console.log("[PUT /api/site-settings] Checking authentication");try{let{getSessionUserFromRequest:s}=await e.A(23636);o=await s(t),fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:195",message:"Session validation result",data:{hasSession:!!o,userId:o?.id||null,role:o?.role||null,enabled:o?.enabled||null},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch(()=>{}),console.log("[PUT /api/site-settings] Session user:",o?{id:o.id,role:o.role,enabled:o.enabled}:"null")}catch(e){throw fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:200",message:"Auth error occurred",data:{error:e?.message||"unknown",stack:e?.stack?.substring(0,300)||"none"},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"D"})}).catch(()=>{}),console.error("[PUT /api/site-settings] Auth error:",e),U.logger.error("[PUT /api/site-settings] Auth error:",e),new f.AppError(`خطا در بررسی احراز هویت: ${e.message||"خطای ناشناخته"}`,500,"AUTH_ERROR")}if(!o){let e=t.headers.get("x-user-id");if(e){console.log("[PUT /api/site-settings] Using userId from header (fallback):",e),fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:215",message:"Using userId header fallback",data:{userIdHeader:e},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"M"})}).catch(()=>{});let t=await (0,N.getRow)("SELECT id, name, phone, role, enabled, createdAt FROM users WHERE id = ?",[e]);t&&t.enabled&&(o={id:t.id,name:t.name,phone:t.phone,role:t.role||"user",enabled:!!t.enabled,createdAt:t.createdAt||new Date().toISOString()},console.log("[PUT /api/site-settings] Fallback user found:",o.id),fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:230",message:"Fallback user validated",data:{userId:o.id,role:o.role,isAdmin:"admin"===o.role},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"N"})}).catch(()=>{}))}}if(!o||"admin"!==o.role)throw fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:238",message:"Unauthorized - throwing 403",data:{hasSession:!!o,role:o?.role||null,isAdmin:o?.role==="admin"},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(()=>{}),console.warn("[PUT /api/site-settings] Unauthorized access attempt:",{hasSession:!!o,role:o?.role}),new f.AppError("دسترسی غیرمجاز - فقط ادمین می‌تواند تنظیمات را تغییر دهد",403,"UNAUTHORIZED");console.log("[PUT /api/site-settings] Parsing request body");try{i=await t.json(),console.log("[PUT /api/site-settings] Request body parsed:",Object.keys(i))}catch(e){throw console.error("[PUT /api/site-settings] JSON parse error:",e),new f.AppError("Invalid JSON in request body",400,"INVALID_JSON")}console.log("[PUT /api/site-settings] Ensuring settings table exists");try{await (0,N.runQuery)(`
        CREATE TABLE IF NOT EXISTS settings (
          id VARCHAR(255) PRIMARY KEY DEFAULT 'site_settings',
          \`siteName\` VARCHAR(255) NOT NULL DEFAULT 'ساد',
          \`siteDescription\` TEXT,
          \`logoUrl\` LONGTEXT,
          \`contactPhone\` VARCHAR(255),
          \`contactEmail\` VARCHAR(255),
          \`address\` TEXT,
          \`maintenanceMode\` BOOLEAN DEFAULT FALSE,
          \`allowRegistration\` BOOLEAN DEFAULT TRUE,
          \`emailNotifications\` BOOLEAN DEFAULT TRUE,
          \`lowStockThreshold\` INTEGER DEFAULT 10,
          \`itemsPerPage\` INTEGER DEFAULT 10,
          \`showNotifications\` BOOLEAN DEFAULT TRUE,
          \`theme\` VARCHAR(50) DEFAULT 'system',
          \`createdAt\` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
          \`updatedAt\` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
      `),console.log("[PUT /api/site-settings] Table created/verified successfully")}catch(e){throw console.error("[PUT /api/site-settings] Database error creating table:",e),U.logger.error("[PUT /api/site-settings] Database error creating table:",e),new f.AppError(`خطا در اتصال به دیتابیس: ${e.message||"خطای ناشناخته"}`,500,"DATABASE_ERROR")}console.log("[PUT /api/site-settings] Updating settings");try{let e=[],t=[];if(void 0!==i.siteName&&(e.push("`siteName` = ?"),t.push(i.siteName||"ساد")),void 0!==i.siteDescription&&(e.push("`siteDescription` = ?"),t.push(i.siteDescription||null)),void 0!==i.logoUrl&&(e.push("`logoUrl` = ?"),t.push(i.logoUrl||null)),void 0!==i.maintenanceMode&&(e.push("`maintenanceMode` = ?"),t.push(i.maintenanceMode||!1)),void 0!==i.allowRegistration&&(e.push("`allowRegistration` = ?"),t.push(i.allowRegistration)),void 0!==i.emailNotifications&&(e.push("`emailNotifications` = ?"),t.push(i.emailNotifications)),void 0!==i.lowStockThreshold&&(e.push("`lowStockThreshold` = ?"),t.push(i.lowStockThreshold||10)),void 0!==i.itemsPerPage&&(e.push("`itemsPerPage` = ?"),t.push(i.itemsPerPage||10)),void 0!==i.showNotifications&&(e.push("`showNotifications` = ?"),t.push(i.showNotifications)),void 0!==i.theme&&(e.push("`theme` = ?"),t.push(i.theme||"system")),0===e.length)throw new f.AppError("هیچ فیلدی برای به‌روزرسانی ارسال نشده است",400,"NO_FIELDS_TO_UPDATE");e.push("`updatedAt` = CURRENT_TIMESTAMP"),await (0,N.runQuery)(`
        UPDATE settings 
        SET ${e.join(", ")}
        WHERE id = 'site_settings'
      `,t),console.log("[PUT /api/site-settings] Settings updated successfully")}catch(e){throw console.error("[PUT /api/site-settings] Database error updating settings:",e),U.logger.error("[PUT /api/site-settings] Database error updating settings:",e),new f.AppError(`خطا در ذخیره تنظیمات: ${e.message||"خطای ناشناخته"}`,500,"DATABASE_ERROR")}let r=Date.now()-s;return console.log(`[PUT /api/site-settings] Request completed successfully in ${r}ms`),(0,m.createSuccessResponse)({message:"تنظیمات با موفقیت ذخیره شد"})}catch(t){let e=Date.now()-s;if(console.error(`[PUT /api/site-settings] Error after ${e}ms:`,t),U.logger.error("[PUT /api/site-settings] Error updating settings:",t),t instanceof f.AppError)return(0,m.createErrorResponse)(t);return(0,m.createErrorResponse)(new f.AppError(`خطای سرور: ${t?.message||"خطای ناشناخته"}`,500,"INTERNAL_ERROR"))}}e.s(["GET",()=>w,"PUT",()=>b],98399);var S=e.i(98399);let D=new t.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/site-settings/route",pathname:"/api/site-settings",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/site-settings/route.ts",nextConfigOutput:"",userland:S}),{workAsyncStorage:O,workUnitAsyncStorage:P,serverHooks:y}=D;function I(){return(0,o.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:P})}async function L(e,t,o){D.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let m="/api/site-settings/route";m=m.replace(/\/index$/,"")||"/";let f=await D.prepare(e,t,{srcPage:m,multiZoneDraftMode:!1});if(!f)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:N,params:U,nextConfig:w,parsedUrl:b,isDraftMode:S,prerenderManifest:O,routerServerContext:P,isOnDemandRevalidate:y,revalidateOnlyGenerated:I,resolvedPathname:L,clientReferenceManifest:C,serverActionsManifest:v}=f,M=(0,l.normalizeAppPath)(m),_=!!(O.dynamicRoutes[M]||O.routes[L]),F=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,b,!1):t.end("This page could not be found"),null);if(_&&!S){let e=!!O.routes[L],t=O.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await F();throw new R.NoFallbackError}}let H=null;!_||D.isDev||S||(H="/index"===(H=L)?"/":H);let k=!0===D.isDev||!_,G=_&&!k;v&&C&&(0,n.setReferenceManifestsSingleton)({page:m,clientReferenceManifest:C,serverActionsManifest:v,serverModuleMap:(0,a.createServerModuleMap)({serverActionsManifest:v})});let x=e.method||"GET",q=(0,r.getTracer)(),B=q.getActiveScopeSpan(),$={params:U,prerenderManifest:O,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,s,o)=>D.onRequestError(e,t,o,P)},sharedContext:{buildId:N}},j=new c.NodeNextRequest(e),V=new c.NodeNextResponse(t),K=d.NextRequestAdapter.fromNodeNextRequest(j,(0,d.signalFromNodeResponse)(t));try{let n=async e=>D.handle(K,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let s=q.getRootSpanAttributes();if(!s)return;if(s.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${s.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=s.get("next.route");if(o){let t=`${x} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${x} ${m}`)}),a=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var r,l;let c=async({previousCacheEntry:s})=>{try{if(!a&&y&&I&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await n(i);e.fetchMetrics=$.renderOpts.fetchMetrics;let l=$.renderOpts.pendingWaitUntil;l&&o.waitUntil&&(o.waitUntil(l),l=void 0);let c=$.renderOpts.collectedTags;if(!_)return await (0,g.sendResponse)(j,V,r,$.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,E.toNodeOutgoingHttpHeaders)(r.headers);c&&(t[T.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let s=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=T.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,o=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=T.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:A.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:s,expire:o}}}}catch(t){throw(null==s?void 0:s.isStale)&&await D.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:y})},P),t}},d=await D.handleResponse({req:e,nextConfig:w,cacheKey:H,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:O,isRoutePPREnabled:!1,isOnDemandRevalidate:y,revalidateOnlyGenerated:I,responseGenerator:c,waitUntil:o.waitUntil,isMinimalMode:a});if(!_)return null;if((null==d||null==(r=d.value)?void 0:r.kind)!==A.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",y?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,E.fromNodeOutgoingHttpHeaders)(d.value.headers);return a&&_||u.delete(T.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,g.sendResponse)(j,V,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};B?await l(B):await q.withPropagatedContext(e.headers,()=>q.trace(u.BaseServerSpan.handleRequest,{spanName:`${x} ${m}`,kind:r.SpanKind.SERVER,attributes:{"http.method":x,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await D.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:y})}),_)throw t;return await (0,g.sendResponse)(j,V,new Response(null,{status:500})),null}}e.s(["handler",()=>L,"patchFetch",()=>I,"routeModule",()=>D,"serverHooks",()=>y,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>P],33108)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_a39faaa1.js.map
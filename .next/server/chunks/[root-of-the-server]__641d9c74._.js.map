{"version":3,"sources":["../../../lib/auth/session.ts","../../../lib/db/index.ts","../../../lib/logger.ts","../../../lib/api-route-helpers.ts","../../../lib/api-error-handler.ts","../../../node_modules/next/dist/esm/build/templates/app-route.js","../../../app/api/chat/status/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport crypto from \"crypto\";\r\nimport { getRow, getRows, runQuery } from \"@/lib/db/index\";\r\nimport { AppError } from \"@/lib/api-error-handler\";\r\n\r\nexport const SESSION_COOKIE_NAME = \"saded_session\";\r\n\r\nconst SESSION_DAYS = 30;\r\n\r\nfunction nowIso(): string {\r\n  // MySQL friendly datetime (YYYY-MM-DD HH:mm:ss)\r\n  return new Date().toISOString().slice(0, 19).replace(\"T\", \" \");\r\n}\r\n\r\nfunction addDays(date: Date, days: number): Date {\r\n  const d = new Date(date);\r\n  d.setDate(d.getDate() + days);\r\n  return d;\r\n}\r\n\r\nexport function sha256Hex(input: string): string {\r\n  return crypto.createHash(\"sha256\").update(input).digest(\"hex\");\r\n}\r\n\r\nexport function isHttpsRequest(request: NextRequest): boolean {\r\n  const proto = request.headers.get(\"x-forwarded-proto\") || request.nextUrl.protocol.replace(\":\", \"\");\r\n  return proto === \"https\";\r\n}\r\n\r\nexport function getSessionCookieOptions(request: NextRequest) {\r\n  // Important: if your site is served over http (Not secure), Secure cookies won't set.\r\n  const secure = process.env.NODE_ENV === \"production\" ? isHttpsRequest(request) : false;\r\n  return {\r\n    httpOnly: true,\r\n    secure,\r\n    sameSite: \"lax\" as const,\r\n    path: \"/\",\r\n    maxAge: SESSION_DAYS * 24 * 60 * 60,\r\n  };\r\n}\r\n\r\nexport async function ensureAuthTables(): Promise<void> {\r\n  // Users table\r\n  await runQuery(`\r\n    CREATE TABLE IF NOT EXISTS users (\r\n      id VARCHAR(255) PRIMARY KEY,\r\n      name VARCHAR(255) NOT NULL,\r\n      phone VARCHAR(32) NOT NULL,\r\n      password VARCHAR(255) NOT NULL,\r\n      role VARCHAR(50) NOT NULL DEFAULT 'user',\r\n      enabled BOOLEAN DEFAULT TRUE,\r\n      createdAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\r\n      updatedAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\r\n      UNIQUE KEY uniq_users_phone (phone)\r\n    )\r\n  `);\r\n\r\n  // If table already existed with different schema/indexes, normalize it:\r\n  // - Only `phone` should be unique (besides PRIMARY id)\r\n  // - Remove other UNIQUE indexes that can block registration (e.g. old email unique)\r\n  // - Ensure phone is NOT NULL\r\n  try {\r\n    // Remove invalid rows (NULL/empty phone) to avoid ALTER failures\r\n    await runQuery(`DELETE FROM users WHERE phone IS NULL OR TRIM(phone) = ''`);\r\n\r\n    // Ensure phone column is NOT NULL (keep type small)\r\n    await runQuery(`ALTER TABLE users MODIFY phone VARCHAR(32) NOT NULL`);\r\n\r\n    // Read indexes\r\n    const indexRows = await getRows<any>(`SHOW INDEX FROM users`);\r\n    const uniqueIndexToColumns = new Map<string, string[]>();\r\n\r\n    for (const r of indexRows) {\r\n      const keyName = String(r.Key_name ?? r.key_name ?? r.KEY_NAME ?? \"\");\r\n      const nonUnique = Number(r.Non_unique ?? r.non_unique ?? r.NON_UNIQUE ?? 1);\r\n      const colName = String(r.Column_name ?? r.column_name ?? r.COLUMN_NAME ?? \"\");\r\n      if (!keyName || !colName) continue;\r\n      if (nonUnique !== 0) continue;\r\n      const cols = uniqueIndexToColumns.get(keyName) || [];\r\n      cols.push(colName);\r\n      uniqueIndexToColumns.set(keyName, cols);\r\n    }\r\n\r\n    // Find which unique index (if any) is exactly on phone\r\n    let phoneUniqueIndexName: string | null = null;\r\n    for (const [key, cols] of uniqueIndexToColumns.entries()) {\r\n      if (key === \"PRIMARY\") continue;\r\n      const normalizedCols = cols.map((c) => c.toLowerCase()).sort();\r\n      if (normalizedCols.length === 1 && normalizedCols[0] === \"phone\") {\r\n        phoneUniqueIndexName = key;\r\n        break;\r\n      }\r\n    }\r\n\r\n    // Ensure we have a unique index on phone with our preferred name\r\n    if (!phoneUniqueIndexName) {\r\n      await runQuery(`ALTER TABLE users ADD UNIQUE KEY uniq_users_phone (phone)`);\r\n      phoneUniqueIndexName = \"uniq_users_phone\";\r\n    }\r\n\r\n    // Drop any other UNIQUE indexes (only PRIMARY + phone unique should remain)\r\n    for (const key of uniqueIndexToColumns.keys()) {\r\n      if (key === \"PRIMARY\") continue;\r\n      if (key === phoneUniqueIndexName) continue;\r\n      // Drop (might fail if permissions; ignore)\r\n      try {\r\n        await runQuery(`ALTER TABLE users DROP INDEX \\`${key}\\``);\r\n      } catch {\r\n        // ignore\r\n      }\r\n    }\r\n  } catch {\r\n    // Best-effort; do not block auth if ALTER is not permitted\r\n  }\r\n\r\n  // Sessions table\r\n  await runQuery(`\r\n    CREATE TABLE IF NOT EXISTS sessions (\r\n      id VARCHAR(255) PRIMARY KEY,\r\n      userId VARCHAR(255) NOT NULL,\r\n      tokenHash CHAR(64) NOT NULL,\r\n      expiresAt TIMESTAMP NOT NULL,\r\n      createdAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\r\n      lastSeenAt TIMESTAMP NULL DEFAULT NULL,\r\n      userAgent VARCHAR(255) NULL DEFAULT NULL,\r\n      ip VARCHAR(64) NULL DEFAULT NULL,\r\n      UNIQUE KEY uniq_sessions_tokenHash (tokenHash),\r\n      KEY idx_sessions_userId (userId),\r\n      KEY idx_sessions_expiresAt (expiresAt)\r\n    )\r\n  `);\r\n}\r\n\r\nexport type SessionUser = {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  role: string;\r\n  enabled: boolean;\r\n  createdAt: string;\r\n};\r\n\r\nexport async function createSession(userId: string, request: NextRequest): Promise<string> {\r\n  await ensureAuthTables();\r\n\r\n  const token = crypto.randomBytes(32).toString(\"base64url\");\r\n  const tokenHash = sha256Hex(token);\r\n  const sessionId = `sess_${Date.now()}_${crypto.randomBytes(6).toString(\"hex\")}`;\r\n  const expiresAt = addDays(new Date(), SESSION_DAYS);\r\n\r\n  const ua = request.headers.get(\"user-agent\");\r\n  const ip = request.headers.get(\"x-forwarded-for\")?.split(\",\")[0]?.trim() || null;\r\n\r\n  await runQuery(\r\n    `INSERT INTO sessions (id, userId, tokenHash, expiresAt, createdAt, lastSeenAt, userAgent, ip)\r\n     VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,\r\n    [\r\n      sessionId,\r\n      userId,\r\n      tokenHash,\r\n      expiresAt.toISOString().slice(0, 19).replace(\"T\", \" \"),\r\n      nowIso(),\r\n      nowIso(),\r\n      ua || null,\r\n      ip,\r\n    ]\r\n  );\r\n\r\n  return token;\r\n}\r\n\r\nexport async function getSessionUserFromRequest(request: NextRequest): Promise<SessionUser | null> {\r\n  await ensureAuthTables();\r\n\r\n  const token = request.cookies.get(SESSION_COOKIE_NAME)?.value;\r\n  if (!token) return null;\r\n\r\n  const tokenHash = sha256Hex(token);\r\n  const row = await getRow<{\r\n    sessionId: string;\r\n    userId: string;\r\n    expiresAt: string;\r\n    enabled: any;\r\n    role: string;\r\n    name: string;\r\n    phone: string;\r\n    createdAt: string;\r\n  }>(\r\n    `SELECT s.id as sessionId, s.userId, s.expiresAt, u.enabled, u.role, u.name, u.phone, u.createdAt\r\n     FROM sessions s\r\n     JOIN users u ON u.id = s.userId\r\n     WHERE s.tokenHash = ?\r\n     LIMIT 1`,\r\n    [tokenHash]\r\n  );\r\n\r\n  if (!row) return null;\r\n\r\n  const expires = new Date(row.expiresAt);\r\n  if (Number.isNaN(expires.getTime()) || expires.getTime() < Date.now()) {\r\n    // Expired: delete it\r\n    await runQuery(`DELETE FROM sessions WHERE tokenHash = ?`, [tokenHash]);\r\n    return null;\r\n  }\r\n\r\n  // Touch session\r\n  await runQuery(`UPDATE sessions SET lastSeenAt = ? WHERE id = ?`, [nowIso(), row.sessionId]);\r\n\r\n  return {\r\n    id: row.userId,\r\n    name: row.name,\r\n    phone: row.phone,\r\n    role: row.role || \"user\",\r\n    enabled: Boolean(row.enabled),\r\n    createdAt: row.createdAt,\r\n  };\r\n}\r\n\r\nexport async function clearSession(request: NextRequest): Promise<void> {\r\n  const token = request.cookies.get(SESSION_COOKIE_NAME)?.value;\r\n  if (!token) return;\r\n  const tokenHash = sha256Hex(token);\r\n  await runQuery(`DELETE FROM sessions WHERE tokenHash = ?`, [tokenHash]);\r\n}\r\n\r\nexport function setSessionCookie(response: NextResponse, token: string, request: NextRequest) {\r\n  response.cookies.set(SESSION_COOKIE_NAME, token, getSessionCookieOptions(request));\r\n}\r\n\r\nexport function clearSessionCookie(response: NextResponse, request: NextRequest) {\r\n  response.cookies.set(SESSION_COOKIE_NAME, \"\", {\r\n    ...getSessionCookieOptions(request),\r\n    maxAge: 0,\r\n  });\r\n}\r\n\r\n\r\n","/**\n * Database Wrapper\n * \n * این فایل یک interface یکپارچه برای استفاده از MySQL فراهم می‌کند\n */\n\n/**\n * Get single row from database\n */\nexport async function getRow<T extends Record<string, any> = any>(\n  sql: string,\n  params: any[] = []\n): Promise<T | null> {\n  try {\n    const { queryOne } = await import(\"./mysql\");\n    // Convert double-quoted column names to backticks for MySQL\n    const mysqlSql = convertToMySQLSQL(sql);\n    return await queryOne<T>(mysqlSql, params);\n  } catch (error: any) {\n    console.error(\"Database error in getRow:\", {\n      sql,\n      params,\n      error: error?.message,\n      code: error?.code,\n    });\n    throw error;\n  }\n}\n\n/**\n * Get multiple rows from database\n */\nexport async function getRows<T extends Record<string, any> = any>(\n  sql: string,\n  params: any[] = []\n): Promise<T[]> {\n  try {\n    const { queryAll } = await import(\"./mysql\");\n    // Convert double-quoted column names to backticks for MySQL\n    const mysqlSql = convertToMySQLSQL(sql);\n    return await queryAll<T>(mysqlSql, params);\n  } catch (error: any) {\n    console.error(\"Database error in getRows:\", {\n      sql,\n      params,\n      error: error?.message,\n      code: error?.code,\n    });\n    throw error;\n  }\n}\n\n/**\n * Run a query (INSERT, UPDATE, DELETE)\n */\nexport async function runQuery(\n  sql: string,\n  params: any[] = []\n): Promise<{ changes: number; lastInsertRowid?: number }> {\n  const { query } = await import(\"./mysql\");\n  const mysqlSql = convertToMySQLSQL(sql);\n  const result = await query(mysqlSql, params);\n  return {\n    changes: result.affectedRows || result.rowCount || 0,\n    lastInsertRowid: result.insertId || undefined,\n  };\n}\n\n/**\n * Convert SQL to MySQL SQL\n * - Converts double-quoted column names to backticks\n * - Converts PostgreSQL $1, $2, etc. placeholders to MySQL ? placeholders\n * - Converts ON CONFLICT to ON DUPLICATE KEY UPDATE\n * - MySQL uses ? placeholders (already correct)\n */\nfunction convertToMySQLSQL(sql: string): string {\n  let mysqlSql = sql;\n\n  // Convert PostgreSQL $1, $2, etc. placeholders to MySQL ? placeholders\n  // First, extract all $N placeholders and their positions\n  const placeholderRegex = /\\$(\\d+)/g;\n  const placeholders: Array<{ index: number; position: number }> = [];\n  let match;\n  while ((match = placeholderRegex.exec(sql)) !== null) {\n    placeholders.push({\n      index: parseInt(match[1], 10),\n      position: match.index,\n    });\n  }\n\n  // Replace placeholders in reverse order to maintain positions\n  if (placeholders.length > 0) {\n    // Sort by position in reverse order\n    placeholders.sort((a, b) => b.position - a.position);\n    \n    // Replace each $N with ?\n    for (const placeholder of placeholders) {\n      mysqlSql = mysqlSql.substring(0, placeholder.position) + \n                 '?' + \n                 mysqlSql.substring(placeholder.position + `$${placeholder.index}`.length);\n    }\n  }\n\n  // Convert double-quoted column names to backticks for MySQL\n  // Match \"columnName\" and replace with `columnName`\n  mysqlSql = mysqlSql.replace(/\"([^\"]+)\"/g, '`$1`');\n\n  // Convert PostgreSQL ON CONFLICT to MySQL ON DUPLICATE KEY UPDATE\n  mysqlSql = mysqlSql.replace(\n    /ON CONFLICT\\s*\\(([^)]+)\\)\\s*DO UPDATE SET\\s*(.+)/gi,\n    (match, conflictColumns, updateClause) => {\n      // Convert EXCLUDED.columnName to VALUES(columnName)\n      const convertedUpdate = updateClause.replace(/EXCLUDED\\.(\\w+)/gi, 'VALUES($1)');\n      return `ON DUPLICATE KEY UPDATE ${convertedUpdate}`;\n    }\n  );\n\n  // Remove MySQL-incompatible syntax like ::jsonb (legacy PostgreSQL syntax)\n  mysqlSql = mysqlSql.replace(/::jsonb/g, '');\n  mysqlSql = mysqlSql.replace(/::json/g, '');\n\n  return mysqlSql;\n}\n\n/**\n * Initialize database\n */\nexport async function initializeDatabase(): Promise<void> {\n  const { ensureDatabase, initializeTables } = await import(\"./mysql\");\n  await ensureDatabase();\n  await initializeTables();\n}\n\n/**\n * Test database connection\n */\nexport async function testConnection(): Promise<boolean> {\n  try {\n    const { testConnection } = await import(\"./mysql\");\n    return await testConnection();\n  } catch (error) {\n    return false;\n  }\n}\n\n/**\n * Get database type\n */\nexport function getDatabaseType(): \"mysql\" | \"none\" {\n  return \"mysql\";\n}\n","/**\r\n * Centralized logging utility\r\n * Disables console.log in production for better performance\r\n */\r\n\r\ntype LogLevel = 'log' | 'error' | 'warn' | 'info' | 'debug';\r\n\r\nclass Logger {\r\n  private isDevelopment = process.env.NODE_ENV === 'development';\r\n  private isProduction = process.env.NODE_ENV === 'production';\r\n\r\n  private shouldLog(level: LogLevel): boolean {\r\n    // Always log errors and warnings\r\n    if (level === 'error' || level === 'warn') {\r\n      return true;\r\n    }\r\n    // Only log other levels in development\r\n    return this.isDevelopment;\r\n  }\r\n\r\n  log(...args: any[]): void {\r\n    if (this.shouldLog('log')) {\r\n      console.log(...args);\r\n    }\r\n  }\r\n\r\n  error(...args: any[]): void {\r\n    console.error(...args);\r\n  }\r\n\r\n  warn(...args: any[]): void {\r\n    console.warn(...args);\r\n  }\r\n\r\n  info(...args: any[]): void {\r\n    if (this.shouldLog('info')) {\r\n      console.info(...args);\r\n    }\r\n  }\r\n\r\n  debug(...args: any[]): void {\r\n    if (this.shouldLog('debug')) {\r\n      console.debug(...args);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log database query (only in development)\r\n   */\r\n  dbQuery(query: string, params?: any[]): void {\r\n    if (this.isDevelopment) {\r\n      console.log('[DB Query]', query.substring(0, 100), params ? `[${params.length} params]` : '');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log API request (only in development)\r\n   */\r\n  apiRequest(method: string, path: string, statusCode?: number): void {\r\n    if (this.isDevelopment) {\r\n      console.log(`[API] ${method} ${path}${statusCode ? ` ${statusCode}` : ''}`);\r\n    }\r\n  }\r\n}\r\n\r\nexport const logger = new Logger();\r\n\r\n","/**\r\n * API Route Helpers\r\n * Provides standardized error handling and response formatting for API routes\r\n */\r\n\r\nimport { NextResponse } from \"next/server\";\r\nimport { logError, AppError } from \"./api-error-handler\";\r\n\r\nexport interface ApiRouteError {\r\n  message: string;\r\n  status?: number;\r\n  code?: string;\r\n  details?: unknown;\r\n}\r\n\r\n/**\r\n * Create standardized error response\r\n */\r\nexport function createErrorResponse(\r\n  error: unknown,\r\n  defaultStatus: number = 500\r\n): NextResponse {\r\n  let message = \"خطای سرور\";\r\n  let status = defaultStatus;\r\n  let code: string | undefined;\r\n  let details: unknown;\r\n\r\n  // Handle AppError specifically (most common case)\r\n  if (error instanceof AppError) {\r\n    message = error.message;\r\n    status = error.status || defaultStatus;\r\n    code = error.code;\r\n    details = error.details;\r\n  } else if (error instanceof Error) {\r\n    message = error.message;\r\n    if (\"status\" in error && typeof error.status === \"number\") {\r\n      status = error.status;\r\n    }\r\n    if (\"code\" in error && typeof error.code === \"string\") {\r\n      code = error.code;\r\n    }\r\n    if (\"details\" in error) {\r\n      details = error.details;\r\n    }\r\n  } else if (typeof error === \"string\") {\r\n    message = error;\r\n  } else if (error && typeof error === \"object\" && \"message\" in error) {\r\n    message = String(error.message);\r\n    if (\"status\" in error && typeof error.status === \"number\") {\r\n      status = error.status;\r\n    }\r\n    if (\"code\" in error && typeof error.code === \"string\") {\r\n      code = error.code as string;\r\n    }\r\n  }\r\n\r\n  // Log error in development\r\n  logError(error, \"API Route\");\r\n\r\n  return NextResponse.json(\r\n    {\r\n      success: false,\r\n      error: message,\r\n      ...(code ? { code } : {}),\r\n      ...(process.env.NODE_ENV === \"development\" && details ? { details } : {}),\r\n    },\r\n    { status }\r\n  );\r\n}\r\n\r\n/**\r\n * Create standardized success response\r\n */\r\nexport function createSuccessResponse<T>(\r\n  data: T,\r\n  status: number = 200,\r\n  pagination?: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  }\r\n): NextResponse {\r\n  return NextResponse.json(\r\n    {\r\n      success: true,\r\n      data,\r\n      ...(pagination && { pagination }),\r\n    },\r\n    { status }\r\n  );\r\n}\r\n\r\n/**\r\n * Wrap route handler with error handling\r\n */\r\nexport function withErrorHandling(\r\n  handler: (request: Request, context?: any) => Promise<NextResponse>\r\n) {\r\n  return async (request: Request, context?: any): Promise<NextResponse> => {\r\n    try {\r\n      return await handler(request, context);\r\n    } catch (error) {\r\n      return createErrorResponse(error);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Validate request body\r\n */\r\nexport function validateRequestBody<T>(\r\n  body: unknown,\r\n  validator?: (data: unknown) => data is T\r\n): T {\r\n  if (!body) {\r\n    throw new Error(\"Request body is required\");\r\n  }\r\n\r\n  if (validator && !validator(body)) {\r\n    throw new Error(\"Invalid request body\");\r\n  }\r\n\r\n  return body as T;\r\n}\r\n\r\n","/**\r\n * Centralized Error Handler\r\n * Provides consistent error handling and logging across the application\r\n */\r\n\r\nexport interface ApiError {\r\n  message: string;\r\n  status?: number;\r\n  code?: string;\r\n  details?: unknown;\r\n}\r\n\r\nexport class AppError extends Error {\r\n  status?: number;\r\n  code?: string;\r\n  details?: unknown;\r\n\r\n  constructor(message: string, status?: number, code?: string, details?: unknown) {\r\n    super(message);\r\n    this.name = \"AppError\";\r\n    this.status = status;\r\n    this.code = code;\r\n    this.details = details;\r\n    Object.setPrototypeOf(this, AppError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Network error types\r\n */\r\nexport enum NetworkErrorType {\r\n  TIMEOUT = \"TIMEOUT\",\r\n  NETWORK = \"NETWORK\",\r\n  ABORTED = \"ABORTED\",\r\n  UNKNOWN = \"UNKNOWN\",\r\n}\r\n\r\nexport class NetworkError extends Error {\r\n  type: NetworkErrorType;\r\n  originalError?: Error;\r\n\r\n  constructor(\r\n    message: string,\r\n    type: NetworkErrorType = NetworkErrorType.UNKNOWN,\r\n    originalError?: Error\r\n  ) {\r\n    super(message);\r\n    this.name = \"NetworkError\";\r\n    this.type = type;\r\n    this.originalError = originalError;\r\n    Object.setPrototypeOf(this, NetworkError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Import centralized logger\r\n */\r\nimport { logger } from \"@/lib/logger\";\r\n\r\n/**\r\n * Parse error from various sources\r\n */\r\nexport function parseError(error: unknown): ApiError {\r\n  if (error instanceof AppError) {\r\n    return {\r\n      message: error.message,\r\n      status: error.status,\r\n      code: error.code,\r\n      details: error.details,\r\n    };\r\n  }\r\n\r\n  if (error instanceof NetworkError) {\r\n    return {\r\n      message: error.message,\r\n      code: error.type,\r\n      details: error.originalError,\r\n    };\r\n  }\r\n\r\n  if (error instanceof Error) {\r\n    return {\r\n      message: error.message,\r\n    };\r\n  }\r\n\r\n  if (typeof error === \"string\") {\r\n    return {\r\n      message: error,\r\n    };\r\n  }\r\n\r\n  return {\r\n    message: \"خطای نامشخص رخ داد\",\r\n  };\r\n}\r\n\r\n/**\r\n * Get user-friendly error message\r\n */\r\nexport function getUserFriendlyMessage(error: unknown): string {\r\n  const parsed = parseError(error);\r\n\r\n  // Network errors\r\n  if (parsed.code === NetworkErrorType.TIMEOUT) {\r\n    return \"درخواست شما به دلیل طولانی شدن زمان پاسخ لغو شد. لطفاً دوباره تلاش کنید.\";\r\n  }\r\n\r\n  if (parsed.code === NetworkErrorType.NETWORK) {\r\n    return \"خطا در ارتباط با سرور. لطفاً اتصال اینترنت خود را بررسی کنید.\";\r\n  }\r\n\r\n  if (parsed.code === NetworkErrorType.ABORTED) {\r\n    return \"درخواست لغو شد.\";\r\n  }\r\n\r\n  // HTTP status codes\r\n  if (parsed.status) {\r\n    switch (parsed.status) {\r\n      case 400:\r\n        return parsed.message || \"درخواست نامعتبر است.\";\r\n      case 401:\r\n        return \"لطفاً دوباره وارد شوید.\";\r\n      case 403:\r\n        return \"شما دسترسی به این منبع ندارید.\";\r\n      case 404:\r\n        return \"منبع مورد نظر یافت نشد.\";\r\n      case 429:\r\n        return \"تعداد درخواست‌های شما بیش از حد مجاز است. لطفاً کمی صبر کنید.\";\r\n      case 500:\r\n        return \"خطای سرور. لطفاً بعداً تلاش کنید.\";\r\n      case 502:\r\n      case 503:\r\n      case 504:\r\n        return \"سرور در دسترس نیست. لطفاً بعداً تلاش کنید.\";\r\n      default:\r\n        return parsed.message || \"خطایی رخ داد.\";\r\n    }\r\n  }\r\n\r\n  return parsed.message || \"خطای نامشخص رخ داد.\";\r\n}\r\n\r\n/**\r\n * Log error (only in development)\r\n */\r\nexport function logError(error: unknown, context?: string): void {\r\n  const parsed = parseError(error);\r\n  const contextMsg = context ? `[${context}] ` : \"\";\r\n  \r\n  logger.error(`${contextMsg}${parsed.message}`, {\r\n    status: parsed.status,\r\n    code: parsed.code,\r\n    details: parsed.details,\r\n  });\r\n}\r\n","import { AppRouteRouteModule } from \"next/dist/esm/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/esm/server/lib/patch-fetch\";\nimport { addRequestMeta, getRequestMeta } from \"next/dist/esm/server/request-meta\";\nimport { getTracer, SpanKind } from \"next/dist/esm/server/lib/trace/tracer\";\nimport { setReferenceManifestsSingleton } from \"next/dist/esm/server/app-render/encryption-utils\";\nimport { createServerModuleMap } from \"next/dist/esm/server/app-render/action-utils\";\nimport { normalizeAppPath } from \"next/dist/esm/shared/lib/router/utils/app-paths\";\nimport { NodeNextRequest, NodeNextResponse } from \"next/dist/esm/server/base-http/node\";\nimport { NextRequestAdapter, signalFromNodeResponse } from \"next/dist/esm/server/web/spec-extension/adapters/next-request\";\nimport { BaseServerSpan } from \"next/dist/esm/server/lib/trace/constants\";\nimport { getRevalidateReason } from \"next/dist/esm/server/instrumentation/utils\";\nimport { sendResponse } from \"next/dist/esm/server/send-response\";\nimport { fromNodeOutgoingHttpHeaders, toNodeOutgoingHttpHeaders } from \"next/dist/esm/server/web/utils\";\nimport { getCacheControlHeader } from \"next/dist/esm/server/lib/cache-control\";\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from \"next/dist/esm/lib/constants\";\nimport { NoFallbackError } from \"next/dist/esm/shared/lib/no-fallback-error.external\";\nimport { CachedRouteKind } from \"next/dist/esm/server/response-cache\";\nimport * as userland from \"INNER_APP_ROUTE\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/chat/status/route\",\n        pathname: \"/api/chat/status\",\n        filename: \"route\",\n        bundlePath: \"\"\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    resolvedPagePath: \"[project]/app/api/chat/status/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\nexport async function handler(req, res, ctx) {\n    if (routeModule.isDev) {\n        addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint());\n    }\n    let srcPage = \"/api/chat/status/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    } else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = process.env.__NEXT_MULTI_ZONE_DRAFT_MODE;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, parsedUrl, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname, clientReferenceManifest, serverActionsManifest } = prepareResult;\n    const normalizedSrcPage = normalizeAppPath(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    const render404 = async ()=>{\n        // TODO: should route-module itself handle rendering the 404\n        if (routerServerContext == null ? void 0 : routerServerContext.render404) {\n            await routerServerContext.render404(req, res, parsedUrl, false);\n        } else {\n            res.end('This page could not be found');\n        }\n        return null;\n    };\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                if (nextConfig.experimental.adapterPath) {\n                    return await render404();\n                }\n                throw new NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isStaticGeneration = isIsr && !supportsDynamicResponse;\n    // Before rendering (which initializes component tree modules), we have to\n    // set the reference manifests to our global store so Server Action's\n    // encryption util can access to them at the top level of the page module.\n    if (serverActionsManifest && clientReferenceManifest) {\n        setReferenceManifestsSingleton({\n            page: srcPage,\n            clientReferenceManifest,\n            serverActionsManifest,\n            serverModuleMap: createServerModuleMap({\n                serverActionsManifest\n            })\n        });\n    }\n    const method = req.method || 'GET';\n    const tracer = getTracer();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            cacheComponents: Boolean(nextConfig.cacheComponents),\n            supportsDynamicResponse,\n            incrementalCache: getRequestMeta(req, 'incrementalCache'),\n            cacheLifeProfiles: nextConfig.cacheLife,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new NodeNextRequest(req);\n    const nodeNextRes = new NodeNextResponse(res);\n    const nextReq = NextRequestAdapter.fromNodeNextRequest(nodeNextReq, signalFromNodeResponse(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${srcPage}`);\n                }\n            });\n        };\n        const isMinimalMode = Boolean(process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode'));\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!isMinimalMode && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = toNodeOutgoingHttpHeaders(response.headers);\n                        if (cacheTags) {\n                            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await sendResponse(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: getRevalidateReason({\n                                isStaticGeneration,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil,\n                isMinimalMode\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!isMinimalMode) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers);\n            if (!(isMinimalMode && isIsr)) {\n                headers.delete(NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', getCacheControlHeader(cacheEntry.cacheControl));\n            }\n            await sendResponse(nodeNextReq, nodeNextRes, // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n            new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${srcPage}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                    isStaticGeneration,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await sendResponse(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n","import { NextRequest } from \"next/server\";\nimport { getRow, runQuery } from \"@/lib/db/index\";\nimport { createErrorResponse, createSuccessResponse } from \"@/lib/api-route-helpers\";\nimport { AppError } from \"@/lib/api-error-handler\";\nimport { getSessionUserFromRequest } from \"@/lib/auth/session\";\n\n/**\n * PATCH /api/chat/status - Update message status\n */\nexport async function PATCH(request: NextRequest) {\n  try {\n    const sessionUser = await getSessionUserFromRequest(request);\n    if (!sessionUser || !sessionUser.enabled) {\n      throw new AppError(\"برای استفاده از چت باید وارد حساب کاربری شوید\", 401, \"UNAUTHORIZED\");\n    }\n    const isAdmin = sessionUser.role === \"admin\";\n\n    const body = await request.json().catch(() => {\n      throw new AppError(\"Invalid JSON in request body\", 400, \"INVALID_JSON\");\n    });\n\n    const { messageId, status } = body;\n\n    if (!messageId || !status) {\n      throw new AppError(\"messageId and status are required\", 400, \"MISSING_PARAMS\");\n    }\n\n    if (![\"sending\", \"sent\", \"delivered\", \"read\"].includes(status)) {\n      throw new AppError(\"Invalid status\", 400, \"INVALID_STATUS\");\n    }\n\n    // Access control: message must belong to user's chat (or admin)\n    const msg = await getRow<any>(\n      `SELECT m.id, c.userId as chatUserId\n       FROM chat_messages m\n       JOIN quick_buy_chats c ON c.id = m.chatId\n       WHERE m.id = ?\n       LIMIT 1`,\n      [messageId]\n    );\n    if (!msg) {\n      throw new AppError(\"پیام یافت نشد\", 404, \"MESSAGE_NOT_FOUND\");\n    }\n    if (!isAdmin) {\n      const chatUserId = msg.chatUserId ? String(msg.chatUserId) : \"\";\n      if (!chatUserId || chatUserId !== sessionUser.id) {\n        throw new AppError(\"شما به این پیام دسترسی ندارید\", 403, \"FORBIDDEN\");\n      }\n    }\n\n    await runQuery(\n      `UPDATE chat_messages \n       SET status = ? \n       WHERE id = ?`,\n      [status, messageId]\n    );\n\n    return createSuccessResponse({ messageId, status });\n  } catch (error) {\n    return createErrorResponse(error);\n  }\n}\n\n/**\n * POST /api/chat/status - Mark messages as delivered or read\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const sessionUser = await getSessionUserFromRequest(request);\n    if (!sessionUser || !sessionUser.enabled) {\n      throw new AppError(\"برای استفاده از چت باید وارد حساب کاربری شوید\", 401, \"UNAUTHORIZED\");\n    }\n    const isAdmin = sessionUser.role === \"admin\";\n\n    const body = await request.json().catch(() => {\n      throw new AppError(\"Invalid JSON in request body\", 400, \"INVALID_JSON\");\n    });\n\n    const { chatId, sender, action = \"read\" } = body;\n\n    if (!chatId || !sender) {\n      throw new AppError(\"chatId and sender are required\", 400, \"MISSING_PARAMS\");\n    }\n\n    const chat = await getRow<any>(`SELECT id, userId, customerPhone FROM quick_buy_chats WHERE id = ?`, [chatId]);\n    if (!chat) {\n      throw new AppError(\"چت یافت نشد\", 404, \"CHAT_NOT_FOUND\");\n    }\n    if (!isAdmin) {\n      const chatUserId = chat.userId ? String(chat.userId) : \"\";\n      if (!chatUserId || chatUserId !== sessionUser.id) {\n        throw new AppError(\"شما به این چت دسترسی ندارید\", 403, \"FORBIDDEN\");\n      }\n    }\n\n    // Mark all messages from the opposite sender\n    const oppositeSender = sender === \"user\" ? \"support\" : \"user\";\n    \n    if (action === \"delivered\") {\n      // Mark as delivered if not already read or delivered\n      await runQuery(\n        `UPDATE chat_messages \n         SET status = 'delivered' \n         WHERE chatId = ? AND sender = ? AND status NOT IN ('read', 'delivered')`,\n        [chatId, oppositeSender]\n      );\n    } else {\n      // Mark as read\n      await runQuery(\n        `UPDATE chat_messages \n         SET status = 'read' \n         WHERE chatId = ? AND sender = ? AND status != 'read'`,\n        [chatId, oppositeSender]\n      );\n    }\n\n    return createSuccessResponse({ chatId, action, marked: true });\n  } catch (error) {\n    return createErrorResponse(error);\n  }\n}\n\n"],"names":[],"mappings":"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","ignoreList":[5]}
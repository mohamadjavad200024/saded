module.exports=[11518,e=>{"use strict";var t=e.i(47909),i=e.i(74017),a=e.i(96250),n=e.i(59756),s=e.i(61916),r=e.i(14444),o=e.i(10680),p=e.i(69741),d=e.i(16795),l=e.i(87718),c=e.i(95169),u=e.i(47587),h=e.i(66012),g=e.i(70101),S=e.i(26937),E=e.i(10372),b=e.i(93695);e.i(52474);var m=e.i(220),y=e.i(12e3),C=e.i(17939),f=e.i(39142),R=e.i(8776);async function v(e,{params:t}){try{let{id:e}=await t,i=await (0,y.getRow)("SELECT * FROM products WHERE id = ?",[e]);if(!i)throw new f.AppError("محصول یافت نشد",404,"PRODUCT_NOT_FOUND");let a={...i,images:(0,R.normalizeImages)(i.images),tags:(0,R.normalizeTags)(i.tags),specifications:(0,R.normalizeSpecifications)(i.specifications),price:Number(i.price),originalPrice:i.originalPrice?Number(i.originalPrice):void 0,stockCount:Number(i.stockCount),inStock:!!i.inStock,enabled:!!i.enabled,vinEnabled:!!i.vinEnabled,airShippingEnabled:!!i.airShippingEnabled,seaShippingEnabled:!!i.seaShippingEnabled,airShippingCost:null!==i.airShippingCost&&void 0!==i.airShippingCost?Number(i.airShippingCost):null,seaShippingCost:null!==i.seaShippingCost&&void 0!==i.seaShippingCost?Number(i.seaShippingCost):null,createdAt:i.createdAt instanceof Date?i.createdAt:new Date(i.createdAt),updatedAt:i.updatedAt instanceof Date?i.updatedAt:new Date(i.updatedAt)};return fetch(logEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:47",message:"GET product parsed",data:{productId:a.id,airShippingEnabledRaw:i.airShippingEnabled,airShippingEnabledType:typeof i.airShippingEnabled,airShippingEnabledParsed:a.airShippingEnabled,airShippingEnabledParsedType:typeof a.airShippingEnabled,seaShippingEnabledRaw:i.seaShippingEnabled,seaShippingEnabledType:typeof i.seaShippingEnabled,seaShippingEnabledParsed:a.seaShippingEnabled,seaShippingEnabledParsedType:typeof a.seaShippingEnabled},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"C"})}).catch(()=>{}),(0,C.createSuccessResponse)(a)}catch(e){return(0,C.createErrorResponse)(e)}}async function w(e,{params:t}){let i="http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615";fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:55",message:"PUT handler entry",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{});try{let{id:a}=await t;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:60",message:"Params extracted",data:{id:a},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{});let n=await e.json().catch(()=>{throw new f.AppError("Invalid JSON in request body",400,"INVALID_JSON")});if(fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:65",message:"Request body parsed",data:{bodyKeys:Object.keys(n),airShippingCost:n.airShippingCost,seaShippingCost:n.seaShippingCost,airShippingCostType:typeof n.airShippingCost,seaShippingCostType:typeof n.seaShippingCost,specsType:typeof n.specifications,tagsType:typeof n.tags},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"})}).catch(()=>{}),!await (0,y.getRow)("SELECT * FROM products WHERE id = ?",[a]))throw new f.AppError("محصول یافت نشد",404,"PRODUCT_NOT_FOUND");let s={updatedAt:new Date().toISOString()};for(let e of["name","description","price","originalPrice","brand","category","vehicle","model","vin","vinEnabled","airShippingEnabled","seaShippingEnabled","airShippingCost","seaShippingCost","stockCount","inStock","enabled","images","tags","specifications"])void 0!==n[e]&&(s[e]=n[e]);void 0!==s.images&&(s.images=JSON.stringify(s.images)),void 0!==s.tags&&(s.tags=JSON.stringify(s.tags)),void 0!==s.specifications&&(s.specifications=JSON.stringify(s.specifications)),void 0!==s.airShippingEnabled&&(s.airShippingEnabled="boolean"==typeof s.airShippingEnabled?s.airShippingEnabled:!0===s.airShippingEnabled||"true"===s.airShippingEnabled||1===s.airShippingEnabled),void 0!==s.seaShippingEnabled&&(s.seaShippingEnabled="boolean"==typeof s.seaShippingEnabled?s.seaShippingEnabled:!0===s.seaShippingEnabled||"true"===s.seaShippingEnabled||1===s.seaShippingEnabled),void 0!==s.airShippingCost&&(s.airShippingCost=null!==s.airShippingCost&&void 0!==s.airShippingCost?Math.max(0,Math.round(Number(s.airShippingCost))):null),void 0!==s.seaShippingCost&&(s.seaShippingCost=null!==s.seaShippingCost&&void 0!==s.seaShippingCost?Math.max(0,Math.round(Number(s.seaShippingCost))):null);let r=Object.keys(s).map(e=>`${e} = ?`).join(", "),o=Object.values(s);o.push(a),fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:130",message:"Before database update",data:{setClause:r,valuesCount:o.length,filteredUpdatesKeys:Object.keys(s),airShippingCost:s.airShippingCost,seaShippingCost:s.seaShippingCost},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(()=>{}),await (0,y.runQuery)(`UPDATE products SET ${r} WHERE id = ?`,o),fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:133",message:"Database update completed",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(()=>{});let p=await (0,y.getRow)("SELECT * FROM products WHERE id = ?",[a]),d={...p,images:(0,R.normalizeImages)(p.images),tags:(0,R.normalizeTags)(p.tags),specifications:(0,R.normalizeSpecifications)(p.specifications),price:Number(p.price),originalPrice:p.originalPrice?Number(p.originalPrice):void 0,stockCount:Number(p.stockCount),inStock:!!p.inStock,enabled:!!p.enabled,vinEnabled:!!p.vinEnabled,airShippingEnabled:!!p.airShippingEnabled,seaShippingEnabled:!!p.seaShippingEnabled,airShippingCost:null!==p.airShippingCost&&void 0!==p.airShippingCost?Number(p.airShippingCost):null,seaShippingCost:null!==p.seaShippingCost&&void 0!==p.seaShippingCost?Number(p.seaShippingCost):null,createdAt:p.createdAt instanceof Date?p.createdAt:new Date(p.createdAt),updatedAt:p.updatedAt instanceof Date?p.updatedAt:new Date(p.updatedAt)};return fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:175",message:"PUT handler success",data:{productId:d.id},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),(0,C.createSuccessResponse)(d)}catch(e){return fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"route.ts:177",message:"PUT handler error",data:{errorMessage:e instanceof Error?e.message:String(e),errorType:e?.constructor?.name},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),(0,C.createErrorResponse)(e)}}async function T(e,{params:t}){try{let{id:e}=await t;if(!await (0,y.getRow)("SELECT * FROM products WHERE id = ?",[e]))throw new f.AppError("محصول یافت نشد",404,"PRODUCT_NOT_FOUND");return await (0,y.runQuery)("DELETE FROM products WHERE id = ?",[e]),(0,C.createSuccessResponse)({message:"محصول با موفقیت حذف شد"})}catch(e){return(0,C.createErrorResponse)(e)}}e.s(["DELETE",()=>T,"GET",()=>v,"PUT",()=>w],52203);var O=e.i(52203);let N=new t.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/products/[id]/route.ts",nextConfigOutput:"",userland:O}),{workAsyncStorage:A,workUnitAsyncStorage:P,serverHooks:I}=N;function D(){return(0,a.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:P})}async function x(e,t,a){N.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/products/[id]/route";y=y.replace(/\/index$/,"")||"/";let C=await N.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!C)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:f,params:R,nextConfig:v,parsedUrl:w,isDraftMode:T,prerenderManifest:O,routerServerContext:A,isOnDemandRevalidate:P,revalidateOnlyGenerated:I,resolvedPathname:D,clientReferenceManifest:x,serverActionsManifest:U}=C,_=(0,p.normalizeAppPath)(y),k=!!(O.dynamicRoutes[_]||O.routes[D]),M=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,w,!1):t.end("This page could not be found"),null);if(k&&!T){let e=!!O.routes[D],t=O.dynamicRoutes[_];if(t&&!1===t.fallback&&!e){if(v.experimental.adapterPath)return await M();throw new b.NoFallbackError}}let H=null;!k||N.isDev||T||(H="/index"===(H=D)?"/":H);let j=!0===N.isDev||!k,q=k&&!j;U&&x&&(0,r.setReferenceManifestsSingleton)({page:y,clientReferenceManifest:x,serverActionsManifest:U,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:U})});let F=e.method||"GET",J=(0,s.getTracer)(),L=J.getActiveScopeSpan(),$={params:R,prerenderManifest:O,renderOpts:{experimental:{authInterrupts:!!v.experimental.authInterrupts},cacheComponents:!!v.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:v.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,i,a)=>N.onRequestError(e,t,a,A)},sharedContext:{buildId:f}},B=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),W=l.NextRequestAdapter.fromNodeNextRequest(B,(0,l.signalFromNodeResponse)(t));try{let r=async e=>N.handle(W,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let i=J.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=i.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${y}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),p=async n=>{var s,p;let d=async({previousCacheEntry:i})=>{try{if(!o&&P&&I&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await r(n);e.fetchMetrics=$.renderOpts.fetchMetrics;let p=$.renderOpts.pendingWaitUntil;p&&a.waitUntil&&(a.waitUntil(p),p=void 0);let d=$.renderOpts.collectedTags;if(!k)return await (0,h.sendResponse)(B,K,s,$.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(s.headers);d&&(t[E.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let i=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=E.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,a=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=E.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:i,expire:a}}}}catch(t){throw(null==i?void 0:i.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:P})},A),t}},l=await N.handleResponse({req:e,nextConfig:v,cacheKey:H,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:O,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:I,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!k)return null;if((null==l||null==(s=l.value)?void 0:s.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(p=l.value)?void 0:p.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",P?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,g.fromNodeOutgoingHttpHeaders)(l.value.headers);return o&&k||c.delete(E.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,S.getCacheControlHeader)(l.cacheControl)),await (0,h.sendResponse)(B,K,new Response(l.value.body,{headers:c,status:l.value.status||200})),null};L?await p(L):await J.withPropagatedContext(e.headers,()=>J.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${y}`,kind:s.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},p))}catch(t){if(t instanceof b.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:P})}),k)throw t;return await (0,h.sendResponse)(B,K,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>D,"routeModule",()=>N,"serverHooks",()=>I,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>P],11518)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_74b1edd8.js.map
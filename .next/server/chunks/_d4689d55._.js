module.exports=[32628,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),s=e.i(59756),n=e.i(61916),i=e.i(14444),o=e.i(10680),d=e.i(69741),l=e.i(16795),p=e.i(87718),u=e.i(95169),c=e.i(47587),h=e.i(66012),R=e.i(70101),E=e.i(26937),A=e.i(10372),g=e.i(93695);e.i(52474);var w=e.i(220),f=e.i(12e3),m=e.i(17939),v=e.i(39142),y=e.i(25686);async function O(e,{params:t}){try{let{id:r}=await t,a=await (0,y.getSessionUserFromRequest)(e);a?.role;let s=await (0,f.getRow)("SELECT * FROM orders WHERE id = ?",[r]);if(!s)throw new v.AppError("سفارش یافت نشد",404,"ORDER_NOT_FOUND");let n={...s,items:Array.isArray(s.items)?s.items:"string"==typeof s.items?JSON.parse(s.items):[],shippingAddress:"object"==typeof s.shippingAddress&&null!==s.shippingAddress?s.shippingAddress:"string"==typeof s.shippingAddress?JSON.parse(s.shippingAddress):{},total:Number(s.total),shippingCost:Number(s.shippingCost),createdAt:s.createdAt instanceof Date?s.createdAt:new Date(s.createdAt),updatedAt:s.updatedAt instanceof Date?s.updatedAt:new Date(s.updatedAt)};return(0,m.createSuccessResponse)(n)}catch(e){return(0,m.createErrorResponse)(e)}}async function N(e,{params:t}){try{let{id:r}=await t,a=await (0,y.getSessionUserFromRequest)(e);if(a?.role!=="admin")throw new v.AppError("فقط ادمین می‌تواند سفارش را ویرایش کند",403,"FORBIDDEN");let s=await e.json().catch(()=>{throw new v.AppError("Invalid JSON in request body",400,"INVALID_JSON")});if(!await (0,f.getRow)("SELECT * FROM orders WHERE id = ?",[r]))throw new v.AppError("سفارش یافت نشد",404,"ORDER_NOT_FOUND");let n={...s,updatedAt:new Date().toISOString()};n.items&&(n.items=JSON.stringify(n.items)),n.shippingAddress&&(n.shippingAddress=JSON.stringify(n.shippingAddress));let i=Object.keys(n).map(e=>`${e} = ?`).join(", "),o=Object.values(n);o.push(r),await (0,f.runQuery)(`UPDATE orders SET ${i} WHERE id = ?`,o);let d=await (0,f.getRow)("SELECT * FROM orders WHERE id = ?",[r]),l={...d,items:Array.isArray(d.items)?d.items:"string"==typeof d.items?JSON.parse(d.items):[],shippingAddress:"object"==typeof d.shippingAddress&&null!==d.shippingAddress?d.shippingAddress:"string"==typeof d.shippingAddress?JSON.parse(d.shippingAddress):{},total:Number(d.total),shippingCost:Number(d.shippingCost),createdAt:d.createdAt instanceof Date?d.createdAt:new Date(d.createdAt),updatedAt:d.updatedAt instanceof Date?d.updatedAt:new Date(d.updatedAt)};return(0,m.createSuccessResponse)(l)}catch(e){return(0,m.createErrorResponse)(e)}}async function C(e,{params:t}){try{let{id:r}=await t,a=await (0,y.getSessionUserFromRequest)(e);if(a?.role!=="admin")throw new v.AppError("فقط ادمین می‌تواند سفارش را ویرایش کند",403,"FORBIDDEN");if(!await (0,f.getRow)("SELECT * FROM orders WHERE id = ?",[r]))throw new v.AppError("سفارش یافت نشد",404,"ORDER_NOT_FOUND");return await (0,f.runQuery)("DELETE FROM orders WHERE id = ?",[r]),(0,m.createSuccessResponse)({message:"سفارش با موفقیت حذف شد"})}catch(e){return(0,m.createErrorResponse)(e)}}e.s(["DELETE",()=>C,"GET",()=>O,"PUT",()=>N],15845);var S=e.i(15845);let T=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/orders/[id]/route",pathname:"/api/orders/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/orders/[id]/route.ts",nextConfigOutput:"",userland:S}),{workAsyncStorage:D,workUnitAsyncStorage:_,serverHooks:b}=T;function x(){return(0,a.patchFetch)({workAsyncStorage:D,workUnitAsyncStorage:_})}async function P(e,t,a){T.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/orders/[id]/route";f=f.replace(/\/index$/,"")||"/";let m=await T.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!m)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:y,nextConfig:O,parsedUrl:N,isDraftMode:C,prerenderManifest:S,routerServerContext:D,isOnDemandRevalidate:_,revalidateOnlyGenerated:b,resolvedPathname:x,clientReferenceManifest:P,serverActionsManifest:U}=m,H=(0,d.normalizeAppPath)(f),F=!!(S.dynamicRoutes[H]||S.routes[x]),I=async()=>((null==D?void 0:D.render404)?await D.render404(e,t,N,!1):t.end("This page could not be found"),null);if(F&&!C){let e=!!S.routes[x],t=S.dynamicRoutes[H];if(t&&!1===t.fallback&&!e){if(O.experimental.adapterPath)return await I();throw new g.NoFallbackError}}let M=null;!F||T.isDev||C||(M="/index"===(M=x)?"/":M);let q=!0===T.isDev||!F,k=F&&!q;U&&P&&(0,i.setReferenceManifestsSingleton)({page:f,clientReferenceManifest:P,serverActionsManifest:U,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:U})});let j=e.method||"GET",L=(0,n.getTracer)(),$=L.getActiveScopeSpan(),J={params:y,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!O.experimental.authInterrupts},cacheComponents:!!O.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:O.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>T.onRequestError(e,t,a,D)},sharedContext:{buildId:v}},K=new l.NodeNextRequest(e),W=new l.NodeNextResponse(t),B=p.NextRequestAdapter.fromNodeNextRequest(K,(0,p.signalFromNodeResponse)(t));try{let i=async e=>T.handle(B,J).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${j} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${f}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var n,d;let l=async({previousCacheEntry:r})=>{try{if(!o&&_&&b&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=J.renderOpts.fetchMetrics;let d=J.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let l=J.renderOpts.collectedTags;if(!F)return await (0,h.sendResponse)(K,W,n,J.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[A.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==J.renderOpts.collectedRevalidate&&!(J.renderOpts.collectedRevalidate>=A.INFINITE_CACHE)&&J.renderOpts.collectedRevalidate,a=void 0===J.renderOpts.collectedExpire||J.renderOpts.collectedExpire>=A.INFINITE_CACHE?void 0:J.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:_})},D),t}},p=await T.handleResponse({req:e,nextConfig:O,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:_,revalidateOnlyGenerated:b,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:o});if(!F)return null;if((null==p||null==(n=p.value)?void 0:n.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(d=p.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",_?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,R.fromNodeOutgoingHttpHeaders)(p.value.headers);return o&&F||u.delete(A.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,E.getCacheControlHeader)(p.cacheControl)),await (0,h.sendResponse)(K,W,new Response(p.value.body,{headers:u,status:p.value.status||200})),null};$?await d($):await L.withPropagatedContext(e.headers,()=>L.trace(u.BaseServerSpan.handleRequest,{spanName:`${j} ${f}`,kind:n.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},d))}catch(t){if(t instanceof g.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:H,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:_})}),F)throw t;return await (0,h.sendResponse)(K,W,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>x,"routeModule",()=>T,"serverHooks",()=>b,"workAsyncStorage",()=>D,"workUnitAsyncStorage",()=>_],32628)},6149,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_util_be9989c7._.js","server/chunks/_19ab7056._.js","server/chunks/[root-of-the-server]__473dce0e._.js"].map(t=>e.l(t))).then(()=>t(85238)))}];

//# sourceMappingURL=_d4689d55._.js.map
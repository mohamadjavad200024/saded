module.exports=[29395,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),i=e.i(61916),s=e.i(14444),o=e.i(10680),l=e.i(69741),d=e.i(16795),u=e.i(87718),c=e.i(95169),p=e.i(47587),E=e.i(66012),R=e.i(70101),T=e.i(26937),A=e.i(10372),h=e.i(93695);e.i(52474);var w=e.i(220),m=e.i(17939),N=e.i(39142),v=e.i(25686),g=e.i(12e3),_=e.i(40911);let U="12345678910";async function S(e){try{let t=await (0,v.getSessionUserFromRequest)(e);if(!t||"admin"!==t.role)throw new N.AppError("دسترسی غیرمجاز",403,"UNAUTHORIZED");try{await (0,g.runQuery)(`
        CREATE TABLE IF NOT EXISTS admin_settings (
          id VARCHAR(255) PRIMARY KEY DEFAULT 'admin_password',
          \`key\` VARCHAR(255) UNIQUE NOT NULL,
          \`value\` TEXT NOT NULL,
          \`createdAt\` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
          \`updatedAt\` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
      `)}catch(e){_.logger.warn("Error ensuring admin_settings table:",e?.message)}let r=await (0,g.getRow)("SELECT `key`, `value` FROM admin_settings WHERE `key` = 'admin_password' LIMIT 1");return r||(await (0,g.runQuery)(`INSERT INTO admin_settings (\`key\`, \`value\`) VALUES ('admin_password', ?)
         ON DUPLICATE KEY UPDATE \`value\` = ?`,[U,U]),r={key:"admin_password",value:U}),(0,m.createSuccessResponse)({password:r.value})}catch(e){return(0,m.createErrorResponse)(e)}}async function f(e){try{let t=await (0,v.getSessionUserFromRequest)(e);if(!t||"admin"!==t.role)throw new N.AppError("دسترسی غیرمجاز",403,"UNAUTHORIZED");let{password:r,currentPassword:a}=await e.json().catch(()=>{throw new N.AppError("Invalid JSON in request body",400,"INVALID_JSON")});if(!r||"string"!=typeof r||""===r.trim())throw new N.AppError("رمز عبور جدید الزامی است",400,"MISSING_PASSWORD");if(r.length<6)throw new N.AppError("رمز عبور باید حداقل 6 کاراکتر باشد",400,"PASSWORD_TOO_SHORT");try{await (0,g.runQuery)(`
        CREATE TABLE IF NOT EXISTS admin_settings (
          id VARCHAR(255) PRIMARY KEY DEFAULT 'admin_password',
          \`key\` VARCHAR(255) UNIQUE NOT NULL,
          \`value\` TEXT NOT NULL,
          \`createdAt\` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
          \`updatedAt\` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
      `)}catch(e){_.logger.warn("Error ensuring admin_settings table:",e?.message)}if(a){let e=await (0,g.getRow)("SELECT `key`, `value` FROM admin_settings WHERE `key` = 'admin_password' LIMIT 1"),t=e?.value||U;if(a!==t)throw new N.AppError("رمز عبور فعلی اشتباه است",401,"INVALID_CURRENT_PASSWORD")}return await (0,g.runQuery)(`INSERT INTO admin_settings (\`key\`, \`value\`) VALUES ('admin_password', ?)
       ON DUPLICATE KEY UPDATE \`value\` = ?, \`updatedAt\` = CURRENT_TIMESTAMP`,[r.trim(),r.trim()]),_.logger.info("Admin password updated successfully"),(0,m.createSuccessResponse)({message:"رمز عبور با موفقیت تغییر کرد"})}catch(e){return(0,m.createErrorResponse)(e)}}e.s(["GET",()=>S,"PUT",()=>f],4663);var C=e.i(4663);let I=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/admin/password/route",pathname:"/api/admin/password",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/admin/password/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:O,workUnitAsyncStorage:y,serverHooks:P}=I;function L(){return(0,a.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:y})}async function M(e,t,a){I.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let m="/api/admin/password/route";m=m.replace(/\/index$/,"")||"/";let N=await I.prepare(e,t,{srcPage:m,multiZoneDraftMode:!1});if(!N)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:g,nextConfig:_,parsedUrl:U,isDraftMode:S,prerenderManifest:f,routerServerContext:C,isOnDemandRevalidate:O,revalidateOnlyGenerated:y,resolvedPathname:P,clientReferenceManifest:L,serverActionsManifest:M}=N,D=(0,l.normalizeAppPath)(m),x=!!(f.dynamicRoutes[D]||f.routes[P]),b=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,U,!1):t.end("This page could not be found"),null);if(x&&!S){let e=!!f.routes[P],t=f.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(_.experimental.adapterPath)return await b();throw new h.NoFallbackError}}let H=null;!x||I.isDev||S||(H="/index"===(H=P)?"/":H);let k=!0===I.isDev||!x,F=x&&!k;M&&L&&(0,s.setReferenceManifestsSingleton)({page:m,clientReferenceManifest:L,serverActionsManifest:M,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:M})});let q=e.method||"GET",K=(0,i.getTracer)(),j=K.getActiveScopeSpan(),V={params:g,prerenderManifest:f,renderOpts:{experimental:{authInterrupts:!!_.experimental.authInterrupts},cacheComponents:!!_.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:_.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>I.onRequestError(e,t,a,C)},sharedContext:{buildId:v}},B=new d.NodeNextRequest(e),$=new d.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let s=async e=>I.handle(G,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=K.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${q} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${m}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var i,l;let d=async({previousCacheEntry:r})=>{try{if(!o&&O&&y&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=V.renderOpts.fetchMetrics;let l=V.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=V.renderOpts.collectedTags;if(!x)return await (0,E.sendResponse)(B,$,i,V.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[A.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=A.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,a=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=A.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:O})},C),t}},u=await I.handleResponse({req:e,nextConfig:_,cacheKey:H,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:f,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:y,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!x)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",O?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,R.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&x||c.delete(A.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,T.getCacheControlHeader)(u.cacheControl)),await (0,E.sendResponse)(B,$,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};j?await l(j):await K.withPropagatedContext(e.headers,()=>K.trace(c.BaseServerSpan.handleRequest,{spanName:`${q} ${m}`,kind:i.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:O})}),x)throw t;return await (0,E.sendResponse)(B,$,new Response(null,{status:500})),null}}e.s(["handler",()=>M,"patchFetch",()=>L,"routeModule",()=>I,"serverHooks",()=>P,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>y],29395)},6149,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_util_be9989c7._.js","server/chunks/_19ab7056._.js","server/chunks/[root-of-the-server]__473dce0e._.js"].map(t=>e.l(t))).then(()=>t(85238)))}];

//# sourceMappingURL=_00c27ef9._.js.map
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67881,20783,91918,e=>{"use strict";var t=e.i(43476),r=e.i(71645);function n(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function o(...e){return t=>{let r=!1,o=e.map(e=>{let o=n(e,t);return r||"function"!=typeof o||(r=!0),o});if(r)return()=>{for(let t=0;t<o.length;t++){let r=o[t];"function"==typeof r?r():n(e[t],null)}}}}function a(...e){return r.useCallback(o(...e),e)}e.s(["composeRefs",()=>o,"useComposedRefs",()=>a],20783);var i=Symbol.for("react.lazy"),s=r[" use ".trim().toString()];function l(e){var t;return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===i&&"_payload"in e&&"object"==typeof(t=e._payload)&&null!==t&&"then"in t}function u(e){var n;let a,i=(n=e,(a=r.forwardRef((e,t)=>{let{children:n,...a}=e;if(l(n)&&"function"==typeof s&&(n=s(n._payload)),r.isValidElement(n)){var i;let e,s,l=(i=n,(s=(e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?i.ref:(s=(e=Object.getOwnPropertyDescriptor(i,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?i.props.ref:i.props.ref||i.ref),u=function(e,t){let r={...t};for(let n in t){let o=e[n],a=t[n];/^on[A-Z]/.test(n)?o&&a?r[n]=(...e)=>{let t=a(...e);return o(...e),t}:o&&(r[n]=o):"style"===n?r[n]={...o,...a}:"className"===n&&(r[n]=[o,a].filter(Boolean).join(" "))}return{...e,...r}}(a,n.props);return n.type!==r.Fragment&&(u.ref=t?o(t,l):l),r.cloneElement(n,u)}return r.Children.count(n)>1?r.Children.only(null):null})).displayName=`${n}.SlotClone`,a),u=r.forwardRef((e,n)=>{let{children:o,...a}=e;l(o)&&"function"==typeof s&&(o=s(o._payload));let u=r.Children.toArray(o),c=u.find(f);if(c){let e=c.props.children,o=u.map(t=>t!==c?t:r.Children.count(e)>1?r.Children.only(null):r.isValidElement(e)?e.props.children:null);return(0,t.jsx)(i,{...a,ref:n,children:r.isValidElement(e)?r.cloneElement(e,void 0,o):null})}return(0,t.jsx)(i,{...a,ref:n,children:o})});return u.displayName=`${e}.Slot`,u}var c=u("Slot"),d=Symbol("radix.slottable");function f(e){return r.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===d}e.s(["Slot",()=>c,"createSlot",()=>u],91918);var g=e.i(25913),p=e.i(47163);let m=(0,g.cva)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 border-[0.25px] border-primary/30",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-[0.25px] border-foreground/30 bg-background text-foreground hover:bg-foreground hover:text-background",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 border-[0.25px] border-secondary/30",ghost:"hover:bg-foreground/10 text-foreground",link:"text-foreground underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),h=r.forwardRef(({className:e,variant:r,size:n,asChild:o=!1,...a},i)=>(0,t.jsx)(o?c:"button",{className:(0,p.cn)(m({variant:r,size:n,className:e})),ref:i,...a}));h.displayName="Button",e.s(["Button",()=>h],67881)},73493,e=>{"use strict";class t{isDevelopment="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;shouldLog(e){return"error"===e||"warn"===e||this.isDevelopment}log(...e){this.shouldLog("log")&&console.log(...e)}error(...e){console.error(...e)}warn(...e){console.warn(...e)}info(...e){this.shouldLog("info")&&console.info(...e)}debug(...e){this.shouldLog("debug")&&console.debug(...e)}}let r=new t;e.s(["logger",0,r])},18566,(e,t,r)=>{t.exports=e.r(76562)},33525,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return n}});let n=e=>{}},18581,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"useMergedRef",{enumerable:!0,get:function(){return o}});let n=e.r(71645);function o(e,t){let r=(0,n.useRef)(null),o=(0,n.useRef)(null);return(0,n.useCallback)(n=>{if(null===n){let e=r.current;e&&(r.current=null,e());let t=o.current;t&&(o.current=null,t())}else e&&(r.current=a(e,n)),t&&(o.current=a(t,n))},[e,t])}function a(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},98183,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={assign:function(){return l},searchParamsToUrlQuery:function(){return a},urlQueryToSearchParams:function(){return s}};for(var o in n)Object.defineProperty(r,o,{enumerable:!0,get:n[o]});function a(e){let t={};for(let[r,n]of e.entries()){let e=t[r];void 0===e?t[r]=n:Array.isArray(e)?e.push(n):t[r]=[e,n]}return t}function i(e){return"string"==typeof e?e:("number"!=typeof e||isNaN(e))&&"boolean"!=typeof e?"":String(e)}function s(e){let t=new URLSearchParams;for(let[r,n]of Object.entries(e))if(Array.isArray(n))for(let e of n)t.append(r,i(e));else t.set(r,i(n));return t}function l(e,...t){for(let r of t){for(let t of r.keys())e.delete(t);for(let[t,n]of r.entries())e.append(t,n)}return e}},95057,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={formatUrl:function(){return s},formatWithValidation:function(){return u},urlObjectKeys:function(){return l}};for(var o in n)Object.defineProperty(r,o,{enumerable:!0,get:n[o]});let a=e.r(90809)._(e.r(98183)),i=/https?|ftp|gopher|file/;function s(e){let{auth:t,hostname:r}=e,n=e.protocol||"",o=e.pathname||"",s=e.hash||"",l=e.query||"",u=!1;t=t?encodeURIComponent(t).replace(/%3A/i,":")+"@":"",e.host?u=t+e.host:r&&(u=t+(~r.indexOf(":")?`[${r}]`:r),e.port&&(u+=":"+e.port)),l&&"object"==typeof l&&(l=String(a.urlQueryToSearchParams(l)));let c=e.search||l&&`?${l}`||"";return n&&!n.endsWith(":")&&(n+=":"),e.slashes||(!n||i.test(n))&&!1!==u?(u="//"+(u||""),o&&"/"!==o[0]&&(o="/"+o)):u||(u=""),s&&"#"!==s[0]&&(s="#"+s),c&&"?"!==c[0]&&(c="?"+c),o=o.replace(/[?#]/g,encodeURIComponent),c=c.replace("#","%23"),`${n}${u}${o}${c}${s}`}let l=["auth","hash","host","hostname","href","path","pathname","port","protocol","query","search","slashes"];function u(e){return s(e)}},18967,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={DecodeError:function(){return y},MiddlewareNotFoundError:function(){return E},MissingStaticPage:function(){return S},NormalizeError:function(){return v},PageNotFoundError:function(){return b},SP:function(){return m},ST:function(){return h},WEB_VITALS:function(){return a},execOnce:function(){return i},getDisplayName:function(){return d},getLocationOrigin:function(){return u},getURL:function(){return c},isAbsoluteUrl:function(){return l},isResSent:function(){return f},loadGetInitialProps:function(){return p},normalizeRepeatedSlashes:function(){return g},stringifyError:function(){return w}};for(var o in n)Object.defineProperty(r,o,{enumerable:!0,get:n[o]});let a=["CLS","FCP","FID","INP","LCP","TTFB"];function i(e){let t,r=!1;return(...n)=>(r||(r=!0,t=e(...n)),t)}let s=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,l=e=>s.test(e);function u(){let{protocol:e,hostname:t,port:r}=window.location;return`${e}//${t}${r?":"+r:""}`}function c(){let{href:e}=window.location,t=u();return e.substring(t.length)}function d(e){return"string"==typeof e?e:e.displayName||e.name||"Unknown"}function f(e){return e.finished||e.headersSent}function g(e){let t=e.split("?");return t[0].replace(/\\/g,"/").replace(/\/\/+/g,"/")+(t[1]?`?${t.slice(1).join("?")}`:"")}async function p(e,t){let r=t.res||t.ctx&&t.ctx.res;if(!e.getInitialProps)return t.ctx&&t.Component?{pageProps:await p(t.Component,t.ctx)}:{};let n=await e.getInitialProps(t);if(r&&f(r))return n;if(!n)throw Object.defineProperty(Error(`"${d(e)}.getInitialProps()" should resolve to an object. But found "${n}" instead.`),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return n}let m="undefined"!=typeof performance,h=m&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class y extends Error{}class v extends Error{}class b extends Error{constructor(e){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message=`Cannot find module for page: ${e}`}}class S extends Error{constructor(e,t){super(),this.message=`Failed to load static file for page: ${e} ${t}`}}class E extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}}function w(e){return JSON.stringify({message:e.message,stack:e.stack})}},73668,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isLocalURL",{enumerable:!0,get:function(){return a}});let n=e.r(18967),o=e.r(52817);function a(e){if(!(0,n.isAbsoluteUrl)(e))return!0;try{let t=(0,n.getLocationOrigin)(),r=new URL(e,t);return r.origin===t&&(0,o.hasBasePath)(r.pathname)}catch(e){return!1}}},84508,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"errorOnce",{enumerable:!0,get:function(){return n}});let n=e=>{}},22016,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={default:function(){return y},useLinkStatus:function(){return b}};for(var o in n)Object.defineProperty(r,o,{enumerable:!0,get:n[o]});let a=e.r(90809),i=e.r(43476),s=a._(e.r(71645)),l=e.r(95057),u=e.r(8372),c=e.r(18581),d=e.r(18967),f=e.r(5550);e.r(33525);let g=e.r(91949),p=e.r(73668),m=e.r(9396);function h(e){return"string"==typeof e?e:(0,l.formatUrl)(e)}function y(t){var r;let n,o,a,[l,y]=(0,s.useOptimistic)(g.IDLE_LINK_STATUS),b=(0,s.useRef)(null),{href:S,as:E,children:w,prefetch:O=null,passHref:P,replace:I,shallow:T,scroll:x,onClick:_,onMouseEnter:j,onTouchStart:C,legacyBehavior:N=!1,onNavigate:R,ref:$,unstable_dynamicOnHover:M,...D}=t;n=w,N&&("string"==typeof n||"number"==typeof n)&&(n=(0,i.jsx)("a",{children:n}));let z=s.default.useContext(u.AppRouterContext),k=!1!==O,L=!1!==O?null===(r=O)||"auto"===r?m.FetchStrategy.PPR:m.FetchStrategy.Full:m.FetchStrategy.PPR,{href:A,as:U}=s.default.useMemo(()=>{let e=h(S);return{href:e,as:E?h(E):e}},[S,E]);if(N){if(n?.$$typeof===Symbol.for("react.lazy"))throw Object.defineProperty(Error("`<Link legacyBehavior>` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's `<a>` tag."),"__NEXT_ERROR_CODE",{value:"E863",enumerable:!1,configurable:!0});o=s.default.Children.only(n)}let F=N?o&&"object"==typeof o&&o.ref:$,B=s.default.useCallback(e=>(null!==z&&(b.current=(0,g.mountLinkInstance)(e,A,z,L,k,y)),()=>{b.current&&((0,g.unmountLinkForCurrentNavigation)(b.current),b.current=null),(0,g.unmountPrefetchableInstance)(e)}),[k,A,z,L,y]),q={ref:(0,c.useMergedRef)(B,F),onClick(t){N||"function"!=typeof _||_(t),N&&o.props&&"function"==typeof o.props.onClick&&o.props.onClick(t),!z||t.defaultPrevented||function(t,r,n,o,a,i,l){if("undefined"!=typeof window){let u,{nodeName:c}=t.currentTarget;if("A"===c.toUpperCase()&&((u=t.currentTarget.getAttribute("target"))&&"_self"!==u||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||t.nativeEvent&&2===t.nativeEvent.which)||t.currentTarget.hasAttribute("download"))return;if(!(0,p.isLocalURL)(r)){a&&(t.preventDefault(),location.replace(r));return}if(t.preventDefault(),l){let e=!1;if(l({preventDefault:()=>{e=!0}}),e)return}let{dispatchNavigateAction:d}=e.r(99781);s.default.startTransition(()=>{d(n||r,a?"replace":"push",i??!0,o.current)})}}(t,A,U,b,I,x,R)},onMouseEnter(e){N||"function"!=typeof j||j(e),N&&o.props&&"function"==typeof o.props.onMouseEnter&&o.props.onMouseEnter(e),z&&k&&(0,g.onNavigationIntent)(e.currentTarget,!0===M)},onTouchStart:function(e){N||"function"!=typeof C||C(e),N&&o.props&&"function"==typeof o.props.onTouchStart&&o.props.onTouchStart(e),z&&k&&(0,g.onNavigationIntent)(e.currentTarget,!0===M)}};return(0,d.isAbsoluteUrl)(U)?q.href=U:N&&!P&&("a"!==o.type||"href"in o.props)||(q.href=(0,f.addBasePath)(U)),a=N?s.default.cloneElement(o,q):(0,i.jsx)("a",{...D,...q,children:n}),(0,i.jsx)(v.Provider,{value:l,children:a})}e.r(84508);let v=(0,s.createContext)(g.IDLE_LINK_STATUS),b=()=>(0,s.useContext)(v);("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},79473,e=>{"use strict";let t={get url(){return`file://${e.P("node_modules/zustand/esm/middleware.mjs")}`}};function r(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var n;let o=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),a=null!=(n=r.getItem(e))?n:null;return a instanceof Promise?a.then(o):o(a)},setItem:(e,n)=>r.setItem(e,JSON.stringify(n,null==t?void 0:t.replacer)),removeItem:e=>r.removeItem(e)}}let n=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>n(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>n(t)(e)}}},o=(e,o)=>{if("getStorage"in o||"serialize"in o||"deserialize"in o)return(t.env?t.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),(t,r,a)=>{let i,s,l={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...o},u=!1,c=new Set,d=new Set;try{i=l.getStorage()}catch(e){}if(!i)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),t(...e)},r,a);let f=n(l.serialize),g=()=>{let e,t=f({state:l.partialize({...r()}),version:l.version}).then(e=>i.setItem(l.name,e)).catch(t=>{e=t});if(e)throw e;return t},p=a.setState;a.setState=(e,t)=>{p(e,t),g()};let m=e((...e)=>{t(...e),g()},r,a),h=()=>{var e;if(!i)return;u=!1,c.forEach(e=>e(r()));let o=(null==(e=l.onRehydrateStorage)?void 0:e.call(l,r()))||void 0;return n(i.getItem.bind(i))(l.name).then(e=>{if(e)return l.deserialize(e)}).then(e=>{if(e)if("number"!=typeof e.version||e.version===l.version)return e.state;else{if(l.migrate)return l.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}}).then(e=>{var n;return t(s=l.merge(e,null!=(n=r())?n:m),!0),g()}).then(()=>{null==o||o(s,void 0),u=!0,d.forEach(e=>e(s))}).catch(e=>{null==o||o(void 0,e)})};return a.persist={setOptions:e=>{l={...l,...e},e.getStorage&&(i=e.getStorage())},clearStorage:()=>{null==i||i.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>h(),hasHydrated:()=>u,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(d.add(e),()=>{d.delete(e)})},h(),s||m};return(t,a,i)=>{let s,l={storage:r(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...o},u=!1,c=new Set,d=new Set,f=l.storage;if(!f)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),t(...e)},a,i);let g=()=>{let e=l.partialize({...a()});return f.setItem(l.name,{state:e,version:l.version})},p=i.setState;i.setState=(e,t)=>{p(e,t),g()};let m=e((...e)=>{t(...e),g()},a,i);i.getInitialState=()=>m;let h=()=>{var e,r;if(!f)return;u=!1,c.forEach(e=>{var t;return e(null!=(t=a())?t:m)});let o=(null==(r=l.onRehydrateStorage)?void 0:r.call(l,null!=(e=a())?e:m))||void 0;return n(f.getItem.bind(f))(l.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===l.version)return[!1,e.state];else{if(l.migrate)return[!0,l.migrate(e.state,e.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var r;let[n,o]=e;if(t(s=l.merge(o,null!=(r=a())?r:m),!0),n)return g()}).then(()=>{null==o||o(s,void 0),s=a(),u=!0,d.forEach(e=>e(s))}).catch(e=>{null==o||o(void 0,e)})};return i.persist={setOptions:e=>{l={...l,...e},e.storage&&(f=e.storage)},clearStorage:()=>{null==f||f.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>h(),hasHydrated:()=>u,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(d.add(e),()=>{d.delete(e)})},l.skipHydration||h(),s||m}};e.s(["createJSONStorage",()=>r,"persist",()=>o])},61180,e=>{"use strict";var t=e.i(6344),r=e.i(79473),n=e.i(73493);let o=(0,r.createJSONStorage)(()=>({getItem:e=>{if("undefined"==typeof localStorage)return null;try{return localStorage.getItem(e)}catch(e){return n.logger.error("Error reading from localStorage:",e),null}},setItem:(e,t)=>{if("undefined"!=typeof localStorage)try{if(new Blob([t]).size>4194304){n.logger.warn("Cart data too large, clearing old items");try{let r=JSON.parse(t);if(r.state?.items&&Array.isArray(r.state.items)){r.state.items=r.state.items.slice(-50);let t=JSON.stringify(r);if(new Blob([t]).size<4194304)return void localStorage.setItem(e,t)}}catch(e){}throw localStorage.removeItem(e),Error("QUOTA_EXCEEDED")}localStorage.setItem(e,t)}catch(t){if(t?.name==="QuotaExceededError"||t?.message==="QUOTA_EXCEEDED"){n.logger.error("localStorage quota exceeded. Clearing cart data.");try{localStorage.removeItem(e);let t=JSON.stringify({state:{items:[],shippingMethod:null},version:0});localStorage.setItem(e,t)}catch(e){n.logger.error("Failed to clear localStorage:",e)}throw t}n.logger.error("Error writing to localStorage:",t)}},removeItem:e=>{if("undefined"!=typeof localStorage)try{localStorage.removeItem(e)}catch(e){n.logger.error("Error removing from localStorage:",e)}}}));function a(){let e=localStorage.getItem("cart-session-id");return e||(e=`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("cart-session-id",e)),e}let i=(0,t.create)()((0,r.persist)((e,t)=>({items:[],shippingMethod:null,sessionId:null,initializeSession:()=>{e({sessionId:a()})},syncToDatabase:async()=>{try{let e=t(),r=e.sessionId||a();if(!r)return void n.logger.warn("No session ID, skipping database sync");let o=e.items.map(e=>(n.logger.debug("Syncing item to DB:",{id:e.id,name:e.name,hasImage:!!e.image,imageLength:e.image?.length||0,imageType:e.image?.startsWith("data:")?"base64":"url"}),{...e})),i=await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:o,shippingMethod:e.shippingMethod,sessionId:r})});if(i.ok)try{let e=await i.json();e&&e.success}catch(e){}else{let e=`HTTP ${i.status}: ${i.statusText}`;try{let t=await i.json();t&&"object"==typeof t&&(e=t.error||t.message||e)}catch(r){let t=await i.text().catch(()=>"");t&&(e=`${e} - ${t.substring(0,100)}`)}i.status>=400&&n.logger.error("Failed to sync cart to database:",{status:i.status,statusText:i.statusText,error:e,sessionId:r,itemCount:o.length})}}catch(e){e instanceof Error?e.message.includes("fetch")||e.message.includes("network")||n.logger.error("Error syncing cart to database:",{message:e.message,name:e.name,sessionId:t().sessionId||a()}):n.logger.error("Error syncing cart to database:",e)}},loadFromDatabase:async()=>{try{let t=a();if(!t)return;let r=await fetch("/api/cart",{headers:{"x-cart-session-id":t}});if(r.ok){let o=await r.json();if(o.success&&o.data){n.logger.debug("Cart loaded from database:",{itemCount:o.data.items?.length||0,sessionId:t});let r=(o.data.items||[]).map(e=>(e.image&&e.image.trim(),e));e({items:r,shippingMethod:o.data.shippingMethod||null,sessionId:t})}else n.logger.debug("No cart data in response or empty cart")}else{let e=`HTTP ${r.status}`;try{let t=await r.json();t&&"object"==typeof t&&(e=t.error||t.message||e)}catch(n){let t=await r.text().catch(()=>"");t&&(e=`${e} - ${t.substring(0,100)}`)}r.status>=400&&n.logger.error("Failed to load cart from database:",{status:r.status,error:e,sessionId:t})}}catch(e){e instanceof Error?e.message.includes("fetch")||e.message.includes("network")||n.logger.error("Error loading cart from database:",{message:e.message,name:e.name,sessionId:a()}):n.logger.error("Error loading cart from database:",e)}},addItem:r=>{try{e(e=>{if(e.items.length>=100)return n.logger.warn("Cart limit reached (100 items). Please remove some items."),e;if(e.items.find(e=>e.id===r.id))return{items:e.items.map(e=>e.id===r.id?{...e,quantity:e.quantity+(r.quantity||1)}:e)};let o={items:[...e.items,{...r,image:r.image||"",quantity:r.quantity||1}]};return setTimeout(()=>{t().syncToDatabase()},100),o})}catch(e){throw e?.name==="QuotaExceededError"&&n.logger.error("Storage quota exceeded. Please clear your cart."),e}},updateQuantity:(r,o)=>{try{e(e=>{if(o<=0)return{items:e.items.filter(e=>e.id!==r)};let n={items:e.items.map(e=>e.id===r?{...e,quantity:o}:e)};return setTimeout(()=>{t().syncToDatabase()},100),n})}catch(e){throw e?.name==="QuotaExceededError"&&n.logger.error("Storage quota exceeded. Please clear your cart."),e}},removeItem:r=>{e(e=>{let n={items:e.items.filter(e=>e.id!==r)};return setTimeout(()=>{t().syncToDatabase()},100),n})},clearCart:()=>{e({items:[],shippingMethod:null}),setTimeout(()=>{t().syncToDatabase()},100)},getTotal:()=>t().items.reduce((e,t)=>e+t.price*t.quantity,0),getItemCount:()=>t().items.reduce((e,t)=>e+t.quantity,0),setShippingMethod:r=>{e({shippingMethod:r}),setTimeout(()=>{t().syncToDatabase()},100)}}),{name:"cart-storage",storage:o,partialize:e=>({items:e.items.slice(0,100).map(e=>{var t;return{...e,image:(t=e.image)&&"string"==typeof t?t.startsWith("data:image")?t.length<5e4?t:"":t.length>2e3?(n.logger.warn("Very long image URL detected, truncating:",t.substring(0,100)),t.substring(0,2e3)):t:""}}),shippingMethod:e.shippingMethod,sessionId:e.sessionId})}));e.s(["useCartStore",0,i])}]);
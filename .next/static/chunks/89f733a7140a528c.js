(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,94983,e=>{"use strict";let t=(0,e.i(75254).default)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);e.s(["MessageCircle",()=>t],94983)},88653,e=>{"use strict";e.i(47167);var t=e.i(43476),r=e.i(71645),i=e.i(31178),a=e.i(47414),n=e.i(21476),s=r,o=e.i(37806);class l extends s.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d({children:e,isPresent:r}){let i=(0,s.useId)(),a=(0,s.useRef)(null),n=(0,s.useRef)({width:0,height:0,top:0,left:0}),{nonce:d}=(0,s.useContext)(o.MotionConfigContext);return(0,s.useInsertionEffect)(()=>{let{width:e,height:t,top:s,left:o}=n.current;if(r||!a.current||!e||!t)return;a.current.dataset.motionPopId=i;let l=document.createElement("style");return d&&(l.nonce=d),document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${t}px !important;
            top: ${s}px !important;
            left: ${o}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[r]),(0,t.jsx)(l,{isPresent:r,childRef:a,sizeRef:n,children:s.cloneElement(e,{ref:a})})}let c=({children:e,initial:i,isPresent:s,onExitComplete:o,custom:l,presenceAffectsLayout:c,mode:m})=>{let g=(0,a.useConstant)(u),f=(0,r.useId)(),h=(0,r.useCallback)(e=>{for(let t of(g.set(e,!0),g.values()))if(!t)return;o&&o()},[g,o]),p=(0,r.useMemo)(()=>({id:f,initial:i,isPresent:s,custom:l,onExitComplete:h,register:e=>(g.set(e,!1),()=>g.delete(e))}),c?[Math.random(),h]:[s,h]);return(0,r.useMemo)(()=>{g.forEach((e,t)=>g.set(t,!1))},[s]),r.useEffect(()=>{s||g.size||!o||o()},[s]),"popLayout"===m&&(e=(0,t.jsx)(d,{isPresent:s,children:e})),(0,t.jsx)(n.PresenceContext.Provider,{value:p,children:e})};function u(){return new Map}var m=e.i(64978);let g=e=>e.key||"";function f(e){let t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}var h=e.i(74008);let p=({children:e,custom:n,initial:s=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:d="sync",propagate:u=!1})=>{let[p,w]=(0,m.usePresence)(u),x=(0,r.useMemo)(()=>f(e),[e]),y=u&&!p?[]:x.map(g),b=(0,r.useRef)(!0),v=(0,r.useRef)(x),N=(0,a.useConstant)(()=>new Map),[A,C]=(0,r.useState)(x),[k,T]=(0,r.useState)(x);(0,h.useIsomorphicLayoutEffect)(()=>{b.current=!1,v.current=x;for(let e=0;e<k.length;e++){let t=g(k[e]);y.includes(t)?N.delete(t):!0!==N.get(t)&&N.set(t,!1)}},[k,y.length,y.join("-")]);let E=[];if(x!==A){let e=[...x];for(let t=0;t<k.length;t++){let r=k[t],i=g(r);y.includes(i)||(e.splice(t,0,r),E.push(r))}"wait"===d&&E.length&&(e=E),T(f(e)),C(x);return}let{forceRender:j}=(0,r.useContext)(i.LayoutGroupContext);return(0,t.jsx)(t.Fragment,{children:k.map(e=>{let r=g(e),i=(!u||!!p)&&(x===k||y.includes(r));return(0,t.jsx)(c,{isPresent:i,initial:(!b.current||!!s)&&void 0,custom:i?void 0:n,presenceAffectsLayout:l,mode:d,onExitComplete:i?void 0:()=>{if(!N.has(r))return;N.set(r,!0);let e=!0;N.forEach(t=>{t||(e=!1)}),e&&(null==j||j(),T(v.current),u&&(null==w||w()),o&&o())},children:e},r)})})};e.s(["AnimatePresence",()=>p],88653)},52571,e=>{"use strict";let t=(0,e.i(75254).default)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);e.s(["Info",()=>t],52571)},73860,44073,e=>{"use strict";e.i(47167);var t=e.i(71645),r=e.i(73493);function i(){let[e,i]=(0,t.useState)("default"),a=(0,t.useRef)(null);(0,t.useEffect)(()=>{"Notification"in window&&(i(Notification.permission),"default"===Notification.permission&&Notification.requestPermission().then(e=>{i(e)}))},[]);let n=async()=>{if(!("Notification"in window))return!1;if("granted"===Notification.permission)return!0;let e=await Notification.requestPermission();return i(e),"granted"===e},s=async(e,t=!0)=>{if("Notification"in window){if(("granted"===Notification.permission||await n())&&(!t||a.current!==e.tag)){!1!==e.sound&&(()=>{try{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),r=e.createGain();t.connect(r),r.connect(e.destination),t.frequency.setValueAtTime(800,e.currentTime),t.frequency.setValueAtTime(600,e.currentTime+.1),t.frequency.setValueAtTime(800,e.currentTime+.2),r.gain.setValueAtTime(.3,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)}catch(e){r.logger.error("Error playing notification sound:",e)}})();try{let t=new Notification(e.title,{body:e.body,icon:e.icon||"/favicon.ico",badge:e.badge||"/favicon.ico",tag:e.tag,requireInteraction:e.requireInteraction||!1,dir:"rtl",lang:"fa"});return e.tag&&(a.current=e.tag),setTimeout(()=>{t.close()},5e3),t.onclick=()=>{window.focus(),t.close()},t}catch(e){r.logger.error("Error showing notification:",e)}}}};return{permission:e,requestPermission:n,showNotification:s,isSupported:"Notification"in window}}var a=e.i(6344),n=e.i(79473);let s=(0,a.create)()((0,n.persist)((e,t)=>({notifications:[],addNotification:i=>{let a=i.metadata?.notificationId||`notif-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n=t().notifications.find(e=>e.id===a);if(n&&!n.dismissed)return r.logger.debug(`[Notification Store] Updating existing notification ${a}`),e(e=>({notifications:e.notifications.map(e=>e.id===a?{...e,...i,timestamp:Date.now(),read:!1,dismissed:!1}:e)})),a;let s={...i,id:a,timestamp:Date.now(),read:!1,dismissed:!1};return r.logger.debug(`[Notification Store] Adding new notification ${a}`,{type:s.type,title:s.title,chatId:s.metadata?.chatId,isAdmin:s.metadata?.isAdmin}),e(e=>({notifications:[s,...e.notifications.filter(e=>e.id!==a)].slice(0,50)})),a},removeNotification:t=>{e(e=>({notifications:e.notifications.filter(e=>e.id!==t)}))},markAsRead:t=>{e(e=>({notifications:e.notifications.map(e=>e.id===t?{...e,read:!0}:e)}))},markAllAsRead:()=>{e(e=>({notifications:e.notifications.map(e=>({...e,read:!0}))}))},dismissNotification:r=>{let i=t().notifications.find(e=>e.id===r);i?.onDismiss&&i.onDismiss(),e(e=>({notifications:e.notifications.filter(e=>e.id!==r)}))},dismissAll:()=>{e(e=>({notifications:e.notifications.filter(e=>e.persistent)}))},getUnreadCount:()=>t().notifications.filter(e=>!e.read&&!e.dismissed).length,getUnreadCountExcludingChat:e=>e?t().notifications.filter(t=>!t.read&&!t.dismissed&&!(t.metadata?.chatId===e&&t.metadata?.isAdmin)).length:t().getUnreadCount(),getNotificationsExcludingChat:e=>e?t().notifications.filter(t=>!(t.metadata?.chatId===e&&t.metadata?.isAdmin)):t().notifications,clearAll:()=>{e({notifications:[]})}}),{name:"notification-storage",partialize:e=>({notifications:e.notifications.filter(e=>e.read).slice(0,20)})}));function o(){let{notifications:e,addNotification:a,removeNotification:n,markAsRead:o,markAllAsRead:l,dismissNotification:d,getUnreadCount:c}=s(),{showNotification:u}=i(),m=(0,t.useCallback)((e,t)=>{try{let e=new(window.AudioContext||window.webkitAudioContext),r=e.createOscillator(),i=e.createGain();r.connect(i),i.connect(e.destination),"urgent"===t||"high"===t?(r.frequency.setValueAtTime(1e3,e.currentTime),r.frequency.setValueAtTime(800,e.currentTime+.1),r.frequency.setValueAtTime(1e3,e.currentTime+.2),r.frequency.setValueAtTime(800,e.currentTime+.3),r.frequency.setValueAtTime(1e3,e.currentTime+.4),i.gain.setValueAtTime(.3,e.currentTime),i.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),r.start(e.currentTime),r.stop(e.currentTime+.5)):(r.frequency.setValueAtTime(800,e.currentTime),r.frequency.setValueAtTime(600,e.currentTime+.1),r.frequency.setValueAtTime(800,e.currentTime+.2),i.gain.setValueAtTime(.3,e.currentTime),i.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),r.start(e.currentTime),r.stop(e.currentTime+.3))}catch(e){r.logger.error("Error playing notification sound:",e)}},[]),g=(0,t.useCallback)(e=>{if("vibrate"in navigator)try{navigator.vibrate(e)}catch(e){r.logger.error("Error vibrating device:",e)}},[]),f=(0,t.useCallback)(e=>{let{type:t="message",priority:r="medium",title:i,message:n,sender:s,avatar:o,actions:l,onConfirm:d,onDismiss:c,metadata:f,persistent:h=!0,sound:p=!0,vibration:w=!1}=e;return p&&m(t,r),w&&"urgent"===r&&g([200,100,200]),u({title:i,body:n,tag:`persistent-${Date.now()}`,requireInteraction:h,sound:!1}).catch(()=>{}),a({type:t,priority:r,title:i,message:n,sender:s,avatar:o,actions:l,onConfirm:d,onDismiss:c,metadata:f,persistent:h,sound:p,vibration:w})},[a,m,g,u]),h=(0,t.useCallback)((e,t,r)=>{let{avatar:i,onOpen:a,chatId:n,metadata:s}=r||{},l=n?`msg-${n}`:void 0;return f({type:"message",priority:"high",title:`پیام جدید از ${e}`,message:t,sender:e,avatar:i,persistent:!0,sound:!0,actions:n?[{label:"مشاهده",action:()=>{let e=new CustomEvent("openChat",{detail:{chatId:n,isAdmin:s?.isAdmin!==!1}});window.dispatchEvent(e),a&&a(),l&&(o(l),d(l))},variant:"default"}]:a?[{label:"مشاهده",action:()=>{a&&a()},variant:"default"}]:void 0,onConfirm:a,metadata:{chatId:n,notificationId:l,...s}})},[f,o,d]);return{notifications:e.filter(e=>!e.dismissed),showNotification:f,showMessageNotification:h,removeNotification:n,markAsRead:o,markAllAsRead:l,dismissNotification:d,unreadCount:c()}}function l({isUser:e=!1,chatId:a,onNewMessage:n}){let{showNotification:s}=i(),{showMessageNotification:l}=o(),d=(0,t.useRef)({isOnline:!1,lastChecked:0}),c=(0,t.useRef)(null),u=(0,t.useRef)(null),m=(0,t.useRef)(0),g=(0,t.useRef)(new Set),f=(0,t.useRef)(new Map),h=(0,t.useRef)(new Map);(0,t.useEffect)(()=>{if(e&&1&&localStorage.getItem("quickBuyChat_chatId")&&!a){let e=localStorage.getItem("quickBuyChat_lastMessageId");e&&(u.current=e)}},[e,a]);let p=(0,t.useCallback)(async()=>{try{let e=Date.now();if(e-d.current.lastChecked<5e3)return d.current.isOnline;let t=await fetch("/api/admin/presence");if(!t.ok)return!1;let r=await t.json();if(r.success&&r.data?.admins&&Array.isArray(r.data.admins)){let t=r.data.admins.length>0;return d.current={isOnline:t,lastChecked:e},t}return!1}catch(e){return r.logger.error("Error checking admin status:",e),!1}},[]),w=(0,t.useCallback)(async()=>{try{let t,i,o="",d=a;if(e){if(!(d=d||localStorage.getItem("quickBuyChat_chatId")))return;o=`/api/chat?chatId=${d}`,u.current&&"1"!==u.current&&(o+=`&lastMessageId=${u.current}`)}else o="/api/chat";try{let e=new AbortController,r=setTimeout(()=>e.abort(),1e4);t=await fetch(o,{signal:e.signal}),clearTimeout(r)}catch(e){e instanceof Error&&"AbortError"!==e.name&&r.logger.warn("[Chat Polling] Network error (will retry):",e.message);return}if(!t.ok){if(429===t.status){let e=t.headers.get("Retry-After");e&&parseInt(e,10);return}t.status;return}try{i=await t.json()}catch(e){r.logger.error("Error parsing chat response:",e);return}if(e){let e=null!==document.querySelector('[data-chat-open="true"]');if(i.success&&i.data?.messages&&Array.isArray(i.data.messages)){let t=i.data.messages,a=t.filter(e=>"support"===e.sender&&!g.current.has(e.id));if(a.length>0){let o=a[a.length-1],c=o.text||"پیام جدید دریافت شد",m=c.length>50?c.substring(0,50)+"...":c;a.forEach(e=>{g.current.add(e.id)});let w=t.map(e=>e.id);w.length>0&&(u.current=w[w.length-1],u.current&&localStorage.setItem("quickBuyChat_lastMessageId",u.current));let x=await p();if(e)r.logger.debug("New support message detected but chat is open, skipping notification");else{let e=`user-${d}-${o.id}`,t=Date.now(),a=h.current.get(e)||0;if(t-a<5e3){r.logger.debug(`[User Notification] ⏭️ Skipping duplicate notification for ${d}`),n&&n(o,i.data.chat);return}let c=f.current.get(e);c&&clearTimeout(c);let u=setTimeout(()=>{r.logger.debug("New support message detected, showing notification:",m),h.current.set(e,Date.now()),s({title:"پیام جدید از پشتیبانی",body:m,tag:`support-${o.id}`,requireInteraction:!1,sound:!0}).catch(e=>{r.logger.error("[User Notification] Error showing browser notification:",e)}),l("پشتیبانی",m,{onOpen:()=>{n&&n(o)},chatId:d||void 0,metadata:{messageId:o.id,chatId:d,isAdminOffline:!x,isAdmin:!1}}),f.current.delete(e)},300);f.current.set(e,u)}n&&n(o,i.data.chat)}else if(t.length>0){let e=t[t.length-1].id;e!==u.current&&(u.current=e,localStorage.setItem("quickBuyChat_lastMessageId",e))}}}else if(i.success&&i.data?.chats&&Array.isArray(i.data.chats)){let e=i.data.chats;for(let t of(r.logger.debug(`[Admin Polling] ✅ Polling active - Checking ${e.length} chats for new messages`),e))try{let e,i=m.current>0?m.current:Date.now()-6e4,a=new Date(i).toISOString();try{let r=new AbortController,i=setTimeout(()=>r.abort(),5e3);e=await fetch(`/api/chat?chatId=${t.id}&since=${a}`,{signal:r.signal}),clearTimeout(i)}catch(e){continue}if(!e.ok){e.status;continue}let s=await e.json();if(s.success&&s.data?.messages&&Array.isArray(s.data.messages)){let e=s.data.messages;r.logger.debug(`[Admin Polling] Chat ${t.id} (${t.customerName}): Found ${e.length} total messages`);let a=e.filter(e=>{let t="user"===e.sender,a=!g.current.has(e.id),n=new Date(e.createdAt).getTime()>i;return n&&!t&&r.logger.debug(`[Admin Polling] Skipping message from ${e.sender} (only user messages trigger notifications)`),t&&a&&n});if(r.logger.debug(`[Admin Polling] Chat ${t.id}: Found ${a.length} new user messages (received from user)`),e.filter(e=>"support"===e.sender&&new Date(e.createdAt).getTime()>i).length,a.length>0){let e=a[a.length-1];if("user"!==e.sender){r.logger.warn(`[Admin Notification] ⚠️ Skipping notification - message sender is "${e.sender}", expected "user"`),g.current.add(e.id);continue}if(g.current.has(e.id)){r.logger.debug(`[Admin Notification] Message ${e.id} already processed, skipping`);continue}let i=!1;{let e=localStorage.getItem("admin_selected_chat_id");if(e&&(i=e===t.id),!i){let e=document.querySelector('[data-admin-chat-open="true"]');if(e){let r=e.getAttribute("data-selected-chat-id");r&&""!==r&&r===t.id&&(i=!0)}}}r.logger.debug(`[Admin Notification] Chat ${t.id} (${t.customerName}): isOpen=${i}, messageId=${e.id}`);let s=`admin-${t.id}-${e.id}`,o=Date.now(),l=h.current.get(s)||0;if(o-l<5e3){r.logger.debug(`[Admin Notification] ⏭️ Skipping duplicate notification for chat ${t.id} (shown ${Math.round((o-l)/1e3)}s ago)`),g.current.add(e.id),n&&n(e,t);continue}g.current.add(e.id),n&&n(e,t)}}else r.logger.warn(`[Admin Polling] Chat ${t.id}: Invalid response format`,s)}catch(e){r.logger.error(`[Admin Polling] Error polling chat ${t.id}:`,e)}m.current=Date.now(),r.logger.debug(`[Admin Polling] ✅ Polling completed, next poll in 3 seconds`)}else r.logger.warn("[Admin Polling] Invalid response format or no chats found",i)}catch(e){}},[e,a,s,l,n,p]);return(0,t.useEffect)(()=>{if(e){let e=a||localStorage.getItem("quickBuyChat_chatId");if(!e)return void r.logger.debug("Global polling: No chatId found, skipping polling");r.logger.debug("Global polling: Starting polling for chatId:",e)}else r.logger.debug("Global polling: Starting admin polling");return r.logger.debug("[Admin Polling] Starting initial poll..."),w(),c.current=setInterval(()=>{w()},5e3),()=>{c.current&&(clearInterval(c.current),c.current=null),f.current.forEach(e=>clearTimeout(e)),f.current.clear()}},[w,e,a]),{stopPolling:()=>{c.current&&(clearInterval(c.current),c.current=null),f.current.forEach(e=>clearTimeout(e)),f.current.clear()}}}e.s(["usePersistentNotifications",()=>o],44073),e.s(["useGlobalChatPolling",()=>l],73860)},45423,e=>{"use strict";let t=(0,e.i(75254).default)("Bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);e.s(["Bell",()=>t],45423)},12012,73306,e=>{"use strict";var t=e.i(43476),r=e.i(71645),i=e.i(46932),a=e.i(94983),n=e.i(37727),s=e.i(63209),o=e.i(52571),l=e.i(45423),d=e.i(84614),c=e.i(1928),u=e.i(3116),m=e.i(67881),g=e.i(94179),f=e.i(47163);function h({notification:e,onConfirm:h,onDismiss:p,onMarkAsRead:w}){var x;let y,b,v,N=(e=>{switch(e){case"message":return a.MessageCircle;case"order":return c.ShoppingCart;case"alert":return s.AlertCircle;case"system":return o.Info;default:return l.Bell}})(e.type),[A,C]=r.useState(!1);return(0,t.jsx)(i.motion.div,{initial:{opacity:0,y:-50,scale:.95,x:20},animate:{opacity:1,y:0,scale:1,x:0},exit:{opacity:0,y:-20,scale:.95,x:20,transition:{duration:.2}},whileHover:{scale:1.02,y:-2},transition:{type:"spring",stiffness:300,damping:25},className:(0,f.cn)("relative w-full max-w-lg sm:max-w-xl pointer-events-auto",!e.read&&"ring-2 ring-primary/40 shadow-lg"),onAnimationComplete:()=>{"urgent"!==e.priority&&"message"!==e.type||A||C(!0)},children:(0,t.jsxs)(i.motion.div,{className:(0,f.cn)("group relative w-full rounded-lg sm:rounded-xl py-2 px-2.5 sm:py-3 sm:px-4 shadow-sm sm:shadow-lg backdrop-blur-sm sm:backdrop-blur-md transition-all duration-300 cursor-pointer border","urgent"===e.priority?"bg-gradient-to-br from-red-50/95 via-background to-red-50/60 dark:from-red-950/30 dark:via-background dark:to-red-950/15 border-red-200/50 dark:border-red-800/30 hover:border-red-300 dark:hover:border-red-700":"high"===e.priority?"bg-gradient-to-br from-orange-50/60 via-background to-orange-50/40 dark:from-orange-950/15 dark:via-background dark:to-orange-950/8 border-orange-200/40 dark:border-orange-800/20 hover:border-orange-300 dark:hover:border-orange-700":"bg-gradient-to-br from-background via-background to-primary/8 border-border/50 hover:border-primary/30",!e.read&&"shadow-md hover:shadow-lg"),onClick:()=>{h&&h(),e.onConfirm&&e.onConfirm(),w&&w()},whileHover:{boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},children:[(0,t.jsx)("div",{className:(0,f.cn)("absolute top-0 right-0 left-0 h-0.5 sm:h-1 rounded-t-lg sm:rounded-t-xl",(e=>{switch(e){case"urgent":return"bg-red-500";case"high":return"bg-orange-500";case"medium":default:return"bg-blue-500";case"low":return"bg-gray-500"}})(e.priority))}),!e.read&&(0,t.jsx)(i.motion.div,{className:"absolute top-1.5 left-1.5 sm:top-2 sm:left-2 w-2 h-2 sm:w-2.5 sm:h-2.5 rounded-full bg-primary shadow-lg",animate:{scale:[1,1.3,1],opacity:[1,.7,1]},transition:{repeat:1/0,duration:2},children:(0,t.jsx)(i.motion.div,{className:"absolute inset-0 rounded-full bg-primary/50",animate:{scale:[1,2,2],opacity:[.5,0,0]},transition:{repeat:1/0,duration:2}})}),(0,t.jsxs)("div",{className:"flex items-start gap-1.5 sm:gap-3",children:[(0,t.jsxs)(i.motion.div,{className:"relative flex-shrink-0",initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15,delay:.1},children:[e.avatar?(0,t.jsxs)(i.motion.div,{className:"relative w-7 h-7 sm:w-10 sm:h-10 rounded-full overflow-hidden ring-2 ring-primary/30 shadow-md",whileHover:{scale:1.1},transition:{type:"spring",stiffness:400,damping:17},children:[(0,t.jsx)("img",{src:e.avatar,alt:e.sender||e.title,className:"w-full h-full object-cover"}),!e.read&&(0,t.jsx)(i.motion.div,{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 sm:w-3.5 sm:h-3.5 bg-green-500 rounded-full border-2 border-background",initial:{scale:0},animate:{scale:1},transition:{delay:.2}})]}):(0,t.jsx)(i.motion.div,{className:(0,f.cn)("w-7 h-7 sm:w-10 sm:h-10 rounded-full flex items-center justify-center shadow-md ring-2 ring-primary/20","message"===e.type?"bg-gradient-to-br from-primary/25 via-primary/20 to-accent/25":"order"===e.type?"bg-gradient-to-br from-green-500/25 via-green-500/20 to-green-400/25":"bg-gradient-to-br from-blue-500/25 via-blue-500/20 to-blue-400/25"),whileHover:{scale:1.1,rotate:5},transition:{type:"spring",stiffness:400,damping:17},children:(0,t.jsx)(N,{className:"h-3.5 w-3.5 sm:h-5 sm:w-5 text-primary"})}),"urgent"===e.priority&&(0,t.jsx)(i.motion.div,{className:"absolute -top-0.5 -right-0.5 sm:-top-1 sm:-right-1 w-4 h-4 sm:w-5 sm:h-5 bg-red-500 rounded-full border border-background sm:border-2 shadow-md sm:shadow-lg flex items-center justify-center",animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1},children:(0,t.jsx)(l.Bell,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-white"})})]}),(0,t.jsx)("div",{className:"flex-1 min-w-0 space-y-1 sm:space-y-2",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-1 sm:gap-2",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 sm:gap-1.5 mb-0.5 sm:mb-1 flex-wrap",children:[(0,t.jsx)("h4",{className:"text-xs sm:text-sm font-semibold text-foreground truncate",children:e.title}),(0,t.jsx)(g.Badge,{variant:(e=>{switch(e){case"urgent":return"destructive";case"high":return"secondary";default:return"default"}})(e.priority),className:"text-[9px] sm:text-[10px] px-1 sm:px-1.5 py-0 h-4 sm:h-5",children:"urgent"===e.priority?"فوری":"high"===e.priority?"مهم":"medium"===e.priority?"متوسط":"کم"})]}),e.sender&&(0,t.jsxs)("p",{className:"text-[9px] sm:text-[10px] text-muted-foreground mb-0.5 sm:mb-1 flex items-center gap-0.5 sm:gap-1",children:[(0,t.jsx)(d.User,{className:"h-2 w-2 sm:h-2.5 sm:w-2.5"}),e.sender]}),(0,t.jsx)(i.motion.p,{className:(0,f.cn)("text-[10px] sm:text-xs text-muted-foreground leading-tight sm:leading-relaxed transition-all duration-300",A?"line-clamp-none":"line-clamp-2"),initial:{opacity:.8},animate:{opacity:1},transition:{delay:.1},children:e.message}),(0,t.jsxs)("div",{className:"flex items-center gap-1 sm:gap-1.5 mt-0.5 sm:mt-1 text-[9px] sm:text-[10px] text-muted-foreground",children:[(0,t.jsx)(u.Clock,{className:"h-2 w-2 sm:h-2.5 sm:w-2.5"}),(0,t.jsx)("span",{children:(x=e.timestamp,v=Math.floor((b=Math.floor((y=Math.floor((Date.now()-x)/1e3))/60))/60),y<60?"همین الان":b<60?`${b} دقیقه پیش`:v<24?`${v} ساعت پیش`:new Date(x).toLocaleDateString("fa-IR",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]}),(0,t.jsx)(i.motion.div,{whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,t.jsx)(m.Button,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),p&&p(),e.onDismiss&&e.onDismiss()},className:"h-5 w-5 sm:h-7 sm:w-7 rounded-full hover:bg-destructive/10 hover:text-destructive flex-shrink-0 transition-colors",children:(0,t.jsx)(n.X,{className:"h-2.5 w-2.5 sm:h-3.5 sm:w-3.5"})})})]})})]}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/3 sm:from-primary/5 via-transparent to-accent/3 sm:to-accent/5 pointer-events-none rounded-lg sm:rounded-xl"}),"urgent"===e.priority&&(0,t.jsx)(i.motion.div,{className:"absolute inset-0 rounded-lg sm:rounded-xl border border-red-500/20 sm:border-2 sm:border-red-500/30",animate:{opacity:[.5,1,.5],scale:[1,1.02,1]},transition:{repeat:1/0,duration:2}})]})})}e.i(47167);var p=e.i(88653),w=e.i(44073);function x({position:e="top-right",maxNotifications:a=5,className:n}){let s,{notifications:o,markAsRead:d,markAllAsRead:c,dismissNotification:u,unreadCount:m}=(0,w.usePersistentNotifications)(),[x,y]=r.useState(null);r.useEffect(()=>{let e=()=>{y(localStorage.getItem("admin_selected_chat_id"))};e();let t=t=>{"admin_selected_chat_id"===t.key&&e()},r=e=>{e.detail?.chatId&&y(e.detail.chatId)},i=()=>{y(null)};window.addEventListener("storage",t),window.addEventListener("openChat",r),window.addEventListener("chatOpened",e=>{e.detail?.chatId&&y(e.detail.chatId)}),window.addEventListener("closeChat",i),window.addEventListener("chatClosed",i);let a=setInterval(e,500);return()=>{window.removeEventListener("storage",t),window.removeEventListener("openChat",r),window.removeEventListener("closeChat",i),clearInterval(a)}},[]);let b=o.filter(e=>!!e.persistent&&!e.dismissed&&(!(e.metadata?.isAdmin&&e.metadata?.chatId)||!x||e.metadata.chatId!==x)).sort((e,t)=>{if(e.read!==t.read)return e.read?1:-1;let r={urgent:4,high:3,medium:2,low:1},i=(r[t.priority]||0)-(r[e.priority]||0);return 0!==i?i:t.timestamp-e.timestamp}).slice(0,a);return 0===b.length?null:(0,t.jsxs)("div",{className:(0,f.cn)("fixed z-[9999] pointer-events-none flex flex-col gap-2 sm:gap-3",{"top-right":"top-4 right-4","top-left":"top-4 left-4","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4"}[e],n),children:[(0,t.jsx)(p.AnimatePresence,{mode:"popLayout",children:b.map((r,a)=>(0,t.jsx)(i.motion.div,{layout:!0,initial:{opacity:0,scale:.8,y:-20,x:e.includes("right")?20:-20},animate:{opacity:1,scale:1,y:0,x:0},exit:{opacity:0,scale:.8,y:-20,x:e.includes("right")?20:-20,transition:{duration:.2}},transition:{type:"spring",stiffness:300,damping:25,delay:.05*a},className:"pointer-events-auto",children:(0,t.jsx)(h,{notification:r,onConfirm:()=>{if(r.metadata?.chatId){let e=new CustomEvent("openChat",{detail:{chatId:r.metadata.chatId,isAdmin:!1!==r.metadata.isAdmin}});window.dispatchEvent(e)}r.onConfirm&&r.onConfirm(),d(r.id),u(r.id)},onDismiss:()=>{u(r.id)},onMarkAsRead:()=>{d(r.id)}})},r.id))}),(s=b.filter(e=>!e.read).length)>0?(0,t.jsx)(i.motion.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:180},transition:{type:"spring",stiffness:300,damping:20},className:(0,f.cn)("fixed pointer-events-none z-[10000]","top-right"===e?"top-2 right-2":"top-left"===e?"top-2 left-2":"bottom-right"===e?"bottom-2 right-2":"bottom-2 left-2"),children:(0,t.jsxs)(g.Badge,{variant:"destructive",className:"h-6 px-2 text-xs font-bold shadow-lg flex items-center gap-1.5 animate-pulse",children:[(0,t.jsx)(l.Bell,{className:"h-3 w-3"}),s]})}):null]})}e.s(["NotificationCenter",()=>x],73306),e.s([],12012)},38808,81947,e=>{"use strict";e.i(47167);var t,r=e.i(43476),i=e.i(71645),a=e.i(63209),n=e.i(25913),s=e.i(47163);let o=(0,n.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pr-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:right-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive bg-destructive/10",warning:"border-yellow-500/50 text-yellow-700 dark:text-yellow-400 dark:border-yellow-400 [&>svg]:text-yellow-600 dark:[&>svg]:text-yellow-400 bg-yellow-50 dark:bg-yellow-950/20"}},defaultVariants:{variant:"default"}}),l=i.forwardRef(({className:e,variant:t,...i},a)=>(0,r.jsx)("div",{ref:a,role:"alert",className:(0,s.cn)(o({variant:t}),e),...i}));l.displayName="Alert";let d=i.forwardRef(({className:e,...t},i)=>(0,r.jsx)("h5",{ref:i,className:(0,s.cn)("mb-1 font-medium leading-none tracking-tight",e),...t}));d.displayName="AlertTitle";let c=i.forwardRef(({className:e,...t},i)=>(0,r.jsx)("div",{ref:i,className:(0,s.cn)("text-sm [&_p]:leading-relaxed",e),...t}));c.displayName="AlertDescription",e.s(["Alert",()=>l,"AlertDescription",()=>c,"AlertTitle",()=>d],81947);var u=e.i(67881);let m=new class{isDevelopment=!1;isProduction=!0;shouldLog(e){return"error"===e||"warn"===e||this.isDevelopment}log(...e){this.shouldLog("log")&&console.log(...e)}error(...e){console.error(...e)}warn(...e){console.warn(...e)}info(...e){this.shouldLog("info")&&console.info(...e)}debug(...e){this.shouldLog("debug")&&console.debug(...e)}dbQuery(e,t){this.isDevelopment&&console.log("[DB Query]",e.substring(0,100),t?`[${t.length} params]`:"")}apiRequest(e,t,r){this.isDevelopment&&console.log(`[API] ${e} ${t}${r?` ${r}`:""}`)}};class g extends Error{status;code;details;constructor(e,t,r,i){super(e),this.name="AppError",this.status=t,this.code=r,this.details=i,Object.setPrototypeOf(this,g.prototype)}}(t={}).TIMEOUT="TIMEOUT",t.NETWORK="NETWORK",t.ABORTED="ABORTED",t.UNKNOWN="UNKNOWN";class f extends Error{type;originalError;constructor(e,t="UNKNOWN",r){super(e),this.name="NetworkError",this.type=t,this.originalError=r,Object.setPrototypeOf(this,f.prototype)}}class h extends i.default.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){let r,i;r=e instanceof g?{message:e.message,status:e.status,code:e.code,details:e.details}:e instanceof f?{message:e.message,code:e.type,details:e.originalError}:e instanceof Error?{message:e.message}:"string"==typeof e?{message:e}:{message:"خطای نامشخص رخ داد"},i="[ErrorBoundary] ",m.error(`${i}${r.message}`,{status:r.status,code:r.code,details:r.details})}handleReset=()=>{this.setState({hasError:!1,error:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,r.jsxs)(l,{variant:"destructive",className:"max-w-md",children:[(0,r.jsx)(a.AlertCircle,{className:"h-4 w-4"}),(0,r.jsx)(d,{children:"خطایی رخ داد"}),(0,r.jsxs)(c,{className:"mt-2",children:[(0,r.jsx)("p",{className:"mb-4",children:"متأسفانه خطایی در سیستم رخ داده است. لطفاً صفحه را رفرش کنید."}),!1,(0,r.jsx)(u.Button,{onClick:this.handleReset,className:"mt-4",variant:"outline",children:"تلاش مجدد"})]})]})}):this.props.children}}e.s(["ErrorBoundary",()=>h],38808)}]);
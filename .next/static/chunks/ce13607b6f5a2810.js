(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71876,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),s=e.i(70065),i=e.i(67881),n=e.i(23750),l=e.i(10708),o=e.i(60366),d=e.i(36361),c=e.i(55436),m=e.i(88844),u=e.i(46897),h=e.i(43432),p=e.i(63488),x=e.i(87316),g=e.i(15788),f=e.i(95468),j=e.i(3116),v=e.i(73884),y=e.i(1928),b=e.i(72664),N=e.i(69638),w=e.i(94983),k=e.i(57688),C=e.i(94179);e.i(74080);var S=e.i(91918),I=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,a)=>{let s=(0,S.createSlot)(`Primitive.${a}`),i=r.forwardRef((e,r)=>{let{asChild:i,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(i?s:a,{...n,ref:r})});return i.displayName=`Primitive.${a}`,{...e,[a]:i}},{}),T="Progress",[E,$]=function(e,a=[]){let s=[],i=()=>{let t=s.map(e=>r.createContext(e));return function(a){let s=a?.[e]||t;return r.useMemo(()=>({[`__scope${e}`]:{...a,[e]:s}}),[a,s])}};return i.scopeName=e,[function(a,i){let n=r.createContext(i);n.displayName=a+"Context";let l=s.length;s=[...s,i];let o=a=>{let{scope:s,children:i,...o}=a,d=s?.[e]?.[l]||n,c=r.useMemo(()=>o,Object.values(o));return(0,t.jsx)(d.Provider,{value:c,children:i})};return o.displayName=a+"Provider",[o,function(t,s){let o=s?.[e]?.[l]||n,d=r.useContext(o);if(d)return d;if(void 0!==i)return i;throw Error(`\`${t}\` must be used within \`${a}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let a=()=>{let a=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let s=a.reduce((t,{useScope:r,scopeName:a})=>{let s=r(e)[`__scope${a}`];return{...t,...s}},{});return r.useMemo(()=>({[`__scope${t.scopeName}`]:s}),[s])}};return a.scopeName=t.scopeName,a}(i,...a)]}(T),[M,R]=E(T),D=r.forwardRef((e,r)=>{var a,s;let{__scopeProgress:i,value:n=null,max:l,getValueLabel:o=O,...d}=e;(l||0===l)&&!_(l)&&console.error((a=`${l}`,`Invalid prop \`max\` of value \`${a}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let c=_(l)?l:100;null===n||W(n,c)||console.error((s=`${n}`,`Invalid prop \`value\` of value \`${s}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let m=W(n,c)?n:null,u=z(m)?o(m,c):void 0;return(0,t.jsx)(M,{scope:i,value:m,max:c,children:(0,t.jsx)(I.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":z(m)?m:void 0,"aria-valuetext":u,role:"progressbar","data-state":L(m,c),"data-value":m??void 0,"data-max":c,...d,ref:r})})});D.displayName=T;var P="ProgressIndicator",B=r.forwardRef((e,r)=>{let{__scopeProgress:a,...s}=e,i=R(P,a);return(0,t.jsx)(I.div,{"data-state":L(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...s,ref:r})});function O(e,t){return`${Math.round(e/t*100)}%`}function L(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function z(e){return"number"==typeof e}function _(e){return z(e)&&!isNaN(e)&&e>0}function W(e,t){return z(e)&&!isNaN(e)&&e<=t&&e>=0}B.displayName=P;var A=e.i(47163);let q=r.forwardRef(({className:e,value:r,...a},s)=>(0,t.jsx)(D,{ref:s,className:(0,A.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...a,children:(0,t.jsx)(B,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));q.displayName=D.displayName;var U=e.i(52917),F=e.i(84762),H=e.i(63415),J=e.i(14764),K=e.i(73708),X=e.i(82735),V=e.i(78583),G=e.i(37727),Q=e.i(87951),Y=e.i(52044),Z=e.i(95242),ee=e.i(31278),et=e.i(43531),er=e.i(94771),ea=e.i(29006),es=e.i(92930),ei=e.i(27612),en=e.i(23585),el=e.i(64659),eo=e.i(46932),ed=e.i(88653),ec=e.i(20682),em=e.i(16637),eu=e.i(73042),eh=e.i(27651),ep=e.i(44073),ex=e.i(26428),eg=e.i(73493);function ef({isOpen:e,onOpenChange:a,trigger:s}){let{toast:l}=(0,ec.useToast)(),{showNotification:o,requestPermission:d}=(0,em.useNotifications)(),{showMessageNotification:c}=(0,ep.usePersistentNotifications)(),{isOnline:m,lastSeen:x,checkStatus:g}=(0,eh.useAdminPresence)({enabled:!0,heartbeatInterval:2e4}),[f,j]=(0,r.useState)([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}]),[v,y]=(0,r.useState)(""),[b,N]=(0,r.useState)(null),[w,k]=(0,r.useState)(null),C=()=>{{let e=localStorage.getItem("quickBuyChat_customerInfo"),t=localStorage.getItem("quickBuyChat_customerInfo_timestamp");if(e)try{let r=JSON.parse(e);if(t){let e=parseInt(t,10);if((Date.now()-e)/864e5>30)return localStorage.removeItem("quickBuyChat_customerInfo"),localStorage.removeItem("quickBuyChat_customerInfo_timestamp"),localStorage.removeItem("quickBuyChat_chatId"),{name:"",phone:"",email:""}}return r}catch{localStorage.removeItem("quickBuyChat_customerInfo"),localStorage.removeItem("quickBuyChat_customerInfo_timestamp")}}return{name:"",phone:"",email:""}},[S,I]=(0,r.useState)(C),[T,E]=(0,r.useState)("info"),[$,M]=(0,r.useState)([]),[R,D]=(0,r.useState)(!1),[P,B]=(0,r.useState)(!1),[O,L]=(0,r.useState)(0),[z,_]=(0,r.useState)(null),[W,A]=(0,r.useState)(null),[q,ef]=(0,r.useState)(null),[ej,ev]=(0,r.useState)(null),[ey,eb]=(0,r.useState)(!1),[eN,ew]=(0,r.useState)(!1),[ek,eC]=(0,r.useState)(localStorage.getItem("quickBuyChat_chatId")),[eS,eI]=(0,r.useState)(!1),[eT,eE]=(0,r.useState)(!1),e$=(0,r.useRef)(null),eM=(0,r.useRef)(null),eR=(0,r.useRef)(null),eD=(0,r.useRef)(null),eP=(0,r.useRef)([]),eB=(0,r.useRef)(null);(0,r.useRef)({});let eO=(0,r.useRef)(null);(0,r.useRef)(new Set),(0,r.useRef)(new Map),(0,r.useRef)(new Map);let eL=(0,r.useRef)(!1),ez=(0,r.useRef)(null),e_=(0,r.useRef)(null),eW=(0,r.useRef)(null),eA=(0,r.useRef)(null),eq=(0,r.useRef)(null),eU=(0,r.useRef)(null),eF=(0,r.useRef)(!1),eH=(0,r.useRef)(null),[eJ,eK]=(0,r.useState)(!1),eX=(0,r.useCallback)(()=>{if(!eW.current||"chat"!==T)return void eK(!1);let e=eW.current;eK(e.scrollHeight-e.scrollTop-e.clientHeight>150)},[T]),eV=(0,r.useCallback)((e=!1)=>{e_.current&&(e_.current.scrollIntoView({behavior:e?"auto":"smooth",block:"end"}),setTimeout(()=>{eK(!1)},300))},[]);(0,r.useEffect)(()=>{let e=eW.current;if(!e||"chat"!==T)return void eK(!1);let t=()=>{eX()};return e.addEventListener("scroll",t,{passive:!0}),eX(),setTimeout(()=>{eX()},100),()=>{e.removeEventListener("scroll",t)}},[T,eX,f.length]),(0,r.useEffect)(()=>{if("chat"===T&&f.length>0&&!eF.current){eF.current=!0;let e=setTimeout(()=>{eV(!0),setTimeout(()=>{eX()},500)},200);return()=>clearTimeout(e)}},[T,eV,eX]),(0,r.useEffect)(()=>{"chat"!==T&&(eF.current=!1)},[T]),(0,r.useEffect)(()=>{if(f.length>0&&"chat"===T){let e=f[f.length-1];if(e.id===eH.current&&"user"===e.sender){let e=setTimeout(()=>{eV(!1),setTimeout(()=>{eX()},500)},150);return()=>clearTimeout(e)}{let e=setTimeout(()=>{eX()},200);return()=>clearTimeout(e)}}},[f,T,eV,eX]),(0,r.useEffect)(()=>{S.name&&S.phone&&(localStorage.setItem("quickBuyChat_customerInfo",JSON.stringify(S)),localStorage.setItem("quickBuyChat_customerInfo_timestamp",Date.now().toString()))},[S]),(0,r.useEffect)(()=>{ek&&localStorage.setItem("quickBuyChat_chatId",ek)},[ek]),(0,r.useEffect)(()=>{if(e){let e=C(),t=localStorage.getItem("quickBuyChat_chatId");e.name&&e.phone?(I(e),E("chat"),e1(e,t)):(E("info"),j([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}]))}else E("info"),y(""),M([]),D(!1),B(!1),L(0),_(null),A(null),ef(null),eB.current&&clearInterval(eB.current),eR.current&&"inactive"!==eR.current.state&&eR.current.stop(),eD.current&&(clearInterval(eD.current),eD.current=null),eI(!1)},[e]);let eG=async()=>{try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop()),!0}catch(e){return!1}},eQ=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void l({title:"Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯",description:"Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ø¶Ø¨Ø· ØµØ¯Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…Ø±ÙˆØ±Ú¯Ø± Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",variant:"destructive"});let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});ev(!0);let t=new MediaRecorder(e,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":"audio/webm"});eR.current=t,eP.current=[],t.ondataavailable=e=>{e.data.size>0&&eP.current.push(e.data)},t.onstop=()=>{let r=new Blob(eP.current,{type:t.mimeType||"audio/webm"});_(r);let a=URL.createObjectURL(r);A(a),e.getTracks().forEach(e=>e.stop())},t.onerror=e=>{eg.logger.error("MediaRecorder error:",e),l({title:"Ø®Ø·Ø§ Ø¯Ø± Ø¶Ø¨Ø· ØµØ¯Ø§",description:"Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¶Ø¨Ø· ØµØ¯Ø§ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",variant:"destructive"}),eY()},t.start(),B(!0),L(0),eB.current=setInterval(()=>{L(e=>e+1)},1e3),l({title:"Ø¶Ø¨Ø· ØµØ¯Ø§ Ø´Ø±ÙˆØ¹ Ø´Ø¯",description:"Ø¯Ø± Ø­Ø§Ù„ Ø¶Ø¨Ø· Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ..."})}catch(r){eg.logger.error("Error starting recording:",r),ev(!1);let e="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª.",t="";"NotAllowedError"===r.name||"PermissionDeniedError"===r.name?(e="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø¯ Ø´Ø¯",t="Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø®ÙˆØ¯ØŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯."):"NotFoundError"===r.name||"DevicesNotFoundError"===r.name?(e="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ÛŒØ§ÙØª Ù†Ø´Ø¯",t="Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¨Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø´Ù…Ø§ Ù…ØªØµÙ„ Ø§Ø³Øª."):"NotReadableError"===r.name||"TrackStartError"===r.name?(e="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª",t="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ØªÙˆØ³Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ Ø¨Ø¨Ù†Ø¯ÛŒØ¯."):"OverconstrainedError"===r.name||"ConstraintNotSatisfiedError"===r.name?(e="ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯",t="Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯."):t="Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯ ÛŒØ§ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.",l({title:e,description:t,variant:"destructive",duration:5e3}),("NotAllowedError"===r.name||"PermissionDeniedError"===r.name)&&eb(!0)}},eY=()=>{if(eR.current&&"inactive"!==eR.current.state)try{eR.current.stop(),B(!1),eB.current&&clearInterval(eB.current),l({title:"Ø¶Ø¨Ø· ØµØ¯Ø§ Ù…ØªÙˆÙ‚Ù Ø´Ø¯",description:"Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ Ø´Ù…Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§ Ù„ØºÙˆ Ú©Ù†ÛŒØ¯."})}catch(e){eg.logger.error("Error stopping recording:",e),l({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± ØªÙˆÙ‚Ù Ø¶Ø¨Ø· Ø±Ø® Ø¯Ø§Ø¯.",variant:"destructive"})}},eZ=async()=>{if(z&&W)try{let e="webm",t=z.type||"audio/webm";t.includes("mp4")||t.includes("m4a")?e="m4a":t.includes("ogg")?e="ogg":t.includes("wav")?e="wav":t.includes("webm")&&(e="webm");let r=new File([z],`audio-${Date.now()}.${e}`,{type:t}),a=await te(r,"audio"),s={id:Date.now().toString(),type:"audio",url:a,name:`Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ ${e0(O)}`,size:z.size,duration:O};M(e=>[...e,s]),_(null),W&&URL.revokeObjectURL(W),A(null),L(0)}catch(e){}},e0=e=>{let t=Math.floor(e/60);return`${t}:${(e%60).toString().padStart(2,"0")}`},e1=async(e,t)=>{try{let r="/api/chat?";t?r+=`chatId=${t}`:(r+=`customerPhone=${encodeURIComponent(e.phone)}`,e.name&&(r+=`&customerName=${encodeURIComponent(e.name)}`));let a=await fetch(r);if(!a.ok)throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª");let s=await a.json();if(s.success&&s.data){let{chat:t,messages:r}=s.data;if(t&&r&&r.length>0){eC(t.id),localStorage.setItem("quickBuyChat_chatId",t.id);let e=r.map(e=>{let t=[];if(e.attachments){if(Array.isArray(e.attachments))t=e.attachments.map(e=>{let t=e.url||e.fileUrl||e.filePath,r=e.type;return!r&&t&&(t.includes("/image-")||t.includes("image-")?r="image":(t.includes("/audio-")||t.includes("audio-"))&&(r="audio")),{id:e.id||`att-${Date.now()}-${Math.random()}`,type:r||e.type||"file",url:t,name:e.name||e.fileName,size:e.size||e.fileSize,duration:e.duration}});else if("string"==typeof e.attachments)try{let r=JSON.parse(e.attachments);Array.isArray(r)&&(t=r.map(e=>{let t=e.url||e.fileUrl||e.filePath,r=e.type;return!r&&t&&(t.includes("/image-")||t.includes("image-")?r="image":(t.includes("/audio-")||t.includes("audio-"))&&(r="audio")),{id:e.id||`att-${Date.now()}-${Math.random()}`,type:r||e.type||"file",url:t,name:e.name||e.fileName,size:e.size||e.fileSize,duration:e.duration}}))}catch(e){eg.logger.error("Error parsing attachments JSON:",e)}}let r=t.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))});return t.length>0&&eg.logger.debug(`Loaded message ${e.id} has ${r.length} valid attachment(s) out of ${t.length} total:`,r.map(e=>({id:e.id,type:e.type,url:e.url,name:e.name,hasUrl:!!e.url}))),{id:e.id,text:e.text||"",sender:e.sender,timestamp:new Date(e.createdAt),attachments:r.length>0?r:void 0,status:"user"===e.sender?e.status||"sent":void 0}}),a=e.map(e=>"user"!==e.sender||e.status?e:{...e,status:"sent"});if(j(a),e.length>0){let t=e[e.length-1].id;eO.current=t,localStorage.setItem("quickBuyChat_lastMessageId",t),a.some(e=>"support"===e.sender&&"1"!==e.id)?eL.current=!0:eL.current=!1}else eL.current=!1;E("chat")}else E("chat"),j([{id:"1",text:`Ø³Ù„Ø§Ù… ${e.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),eL.current=!1}else E("chat"),j([{id:"1",text:`Ø³Ù„Ø§Ù… ${e.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),eL.current=!1}catch(t){eg.logger.error("Error loading chat history:",t),E("chat"),j([{id:"1",text:`Ø³Ù„Ø§Ù… ${e.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),eL.current=!1}},e2=async()=>{if(ek)try{await fetch("/api/chat/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ek,sender:"user",action:"delivered"})})}catch(e){eg.logger.error("Error marking messages as delivered:",e)}},e4=async()=>{if(ek)try{await fetch("/api/chat/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ek,sender:"user",action:"read"})})}catch(e){eg.logger.error("Error marking messages as read:",e)}},e3=async()=>{if(ek&&e&&"chat"===T)try{eI(!0);let e=eO.current,t=`/api/chat?chatId=${ek}`;e&&"1"!==e&&(t+=`&lastMessageId=${e}`);let r=await fetch(t);if(!r.ok)throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯");let a=await r.json();if(a.success&&a.data?.messages&&Array.isArray(a.data.messages)){let e=a.data.messages;e.length>0&&(e2(),setTimeout(()=>{e4()},1e3));let t=e.map(e=>{let t=[];e.attachments&&Array.isArray(e.attachments)&&(t=e.attachments.map(e=>{let t=e.url||e.fileUrl||e.filePath,r=e.type;return!r&&t&&(t.includes("/image-")||t.includes("image-")?r="image":(t.includes("/audio-")||t.includes("audio-"))&&(r="audio")),{id:e.id||`att-${Date.now()}-${Math.random()}`,type:r||e.type||"file",url:t,name:e.name||e.fileName,size:e.size||e.fileSize,duration:e.duration}}));let r=t.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))});return{id:e.id,text:e.text||"",sender:e.sender,timestamp:new Date(e.createdAt),attachments:r.length>0?r:void 0,status:"user"===e.sender?e.status||"sent":void 0}});j(e=>{let r=new Set(e.map(e=>e.id)),a=t.filter(e=>!r.has(e.id)),s=e.filter(e=>!e.id.startsWith("system-")).map(e=>{let r=t.find(t=>t.id===e.id);return r&&"user"===e.sender&&r.status&&e.status!==r.status?{...e,status:r.status}:e});if(a.length>0){let e=a.some(e=>"support"===e.sender),t=s;e&&ez.current&&(t=s.filter(e=>e.id!==ez.current),ez.current=null,eL.current=!0);let r=[...t,...a],i=r[r.length-1];return i&&(eO.current=i.id,localStorage.setItem("quickBuyChat_lastMessageId",i.id)),r}return s})}}catch(e){eg.logger.error("Error polling for new messages:",e)}finally{eI(!1)}},e5=async()=>{if(ek)try{let e=await fetch(`/api/chat/typing?chatId=${ek}&sender=support`);if(e.ok){let t=await e.json();t.success&&eE(t.data.isTyping||!1)}}catch(e){eg.logger.error("Error checking typing status:",e)}},e8=async e=>{if(ek)try{await fetch("/api/chat/typing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ek,sender:"user",isTyping:e})})}catch(e){eg.logger.error("Error sending typing status:",e)}};(0,r.useEffect)(()=>{d()},[]),(0,r.useEffect)(()=>{let t=t=>{let{chatId:r,isAdmin:s}=t.detail;(!1===s||void 0===s)&&(e||a(!0),"chat"!==T&&E("chat"),r&&1&&localStorage.getItem("quickBuyChat_chatId")!==r&&(localStorage.setItem("quickBuyChat_chatId",r),setTimeout(()=>{e&&"chat"===T&&e3()},500)))};return window.addEventListener("openChat",t),()=>{window.removeEventListener("openChat",t)}},[e,a,ek,T,e3]),(0,r.useEffect)(()=>{if(e&&"chat"===T&&ek){e2();let e=setTimeout(()=>{e4()},2e3);return e5(),eM.current=setInterval(()=>{e5()},3e3),eD.current=setInterval(()=>{e3(),e2()},5e3),e3(),g(),()=>{eD.current&&(clearInterval(eD.current),eD.current=null),eM.current&&(clearInterval(eM.current),eM.current=null),e$.current&&(clearTimeout(e$.current),e$.current=null),clearTimeout(e),e8(!1)}}},[e,T,ek,g]);let e6=async(e=!0,t=0)=>{if(0!==f.length)try{ew(!0);let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ek||void 0,customerInfo:S,messages:f.map(e=>({id:e.id,text:e.text,sender:e.sender,timestamp:e.timestamp.toISOString(),attachments:e.attachments?e.attachments.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))}):[]}))})});if(!t.ok){let e=await t.json().catch(()=>({error:"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ú†Øª"}));throw Error(e.error||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ú†Øª")}let r=await t.json();r.data.chatId&&(eC(r.data.chatId),localStorage.setItem("quickBuyChat_chatId",r.data.chatId)),e&&l({title:"Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",description:"Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯"})}catch(r){if(eg.logger.error("Error saving chat:",r),t<3&&(r.message?.includes("fetch")||r.message?.includes("network")||r.message?.includes("timeout")||"NETWORK_ERROR"===r.code)){let r=1e3*Math.pow(2,t);eg.logger.debug(`Retrying save in ${r}ms (attempt ${t+1}/3)`),setTimeout(()=>{e6(e,t+1)},r);return}e&&l({title:"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡",description:r.message||"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯",variant:"destructive"})}finally{0===t&&ew(!1)}},e7=async e=>{try{if((await fetch(`/api/chat/message/${e}`,{method:"DELETE"})).ok)j(t=>t.filter(t=>t.id!==e)),l({title:"Ù…ÙˆÙÙ‚",description:"Ù¾ÛŒØ§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯"});else throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…")}catch(e){eg.logger.error("Error deleting message:",e),l({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…",variant:"destructive"})}},e9=async()=>{if(!v.trim()&&0===$.length)return;if(w){try{(await fetch(`/api/chat/message/${w.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:v,attachments:$})})).ok&&(j(e=>e.map(e=>e.id===w.id?{...e,text:v,attachments:$}:e)),k(null),y(""),M([]),l({title:"Ù…ÙˆÙÙ‚",description:"Ù¾ÛŒØ§Ù… ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯"}))}catch(e){eg.logger.error("Error editing message:",e),l({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…",variant:"destructive"})}return}let t=$.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))});if(!v.trim()&&0===t.length)return void l({title:"Ø®Ø·Ø§",description:"Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù¾ÛŒØ§Ù… ÛŒØ§ ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯",variant:"destructive"});let r=v;b&&(r=`Ø¯Ø± Ù¾Ø§Ø³Ø® Ø¨Ù‡: ${b.text}

${v}`);let s={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,text:r,sender:"user",timestamp:new Date,attachments:t.length>0?t:void 0,status:"sending"};j(e=>{let t=[...e,s];return eO.current=s.id,eH.current=s.id,localStorage.setItem("quickBuyChat_lastMessageId",s.id),t}),setTimeout(()=>{eV(!1)},150);let i=[...$];y(""),M([]),D(!1),N(null);try{ew(!0);let t=[...f,s].map(e=>({id:e.id,text:e.text,sender:e.sender,timestamp:e.timestamp.toISOString(),status:e.id===s.id?"sent":e.status||("user"===e.sender?"sent":void 0),attachments:e.attachments?e.attachments.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))}):[]}));s.attachments&&s.attachments.length>0&&eg.logger.debug(`ğŸ“¤ Sending new message with ${s.attachments.length} attachment(s):`,s.attachments.map(e=>({id:e.id,type:e.type,url:e.url,name:e.name})));let r=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ek||void 0,customerInfo:S,messages:t})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.message||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…")}let i=await r.json();i.data?.chatId&&(eC(i.data.chatId),localStorage.setItem("quickBuyChat_chatId",i.data.chatId));let n=i.data?.messages?.find(e=>e.id===s.id),l=n?.status||"sent";j(e=>e.map(e=>e.id===s.id?{...e,status:l}:e));try{let t=await fetch("/api/admin/presence");if(t.ok){let r=await t.json();r.success&&r.data?.admins&&(Array.isArray(r.data.admins)&&r.data.admins.length>0||c("Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ","Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¢Ù†Ù„Ø§ÛŒÙ† Ù†ÛŒØ³Øª. Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡ Ùˆ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",{onOpen:()=>{e||a(!0)},chatId:ek||void 0,metadata:{isAdminOffline:!0,isAdmin:!1}}))}}catch(e){eg.logger.error("Error checking admin status:",e)}}catch(e){eg.logger.error("Error saving message:",e),j(e=>e.map(e=>e.id===s.id?{...e,status:"sent"}:e)),y(r),M(i),l({title:"Ø®Ø·Ø§",description:e.message||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",variant:"destructive"})}finally{ew(!1)}eL.current||setTimeout(async()=>{let e=`system-${Date.now()}`;ez.current=e,eL.current=!0;let t={id:e,text:"Ù…ØªØ´Ú©Ø±Ù…! Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯. Ù‡Ù…Ú©Ø§Ø±Ø§Ù† Ù…Ø§ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¨Ø§ Ø´Ù…Ø§ ØªÙ…Ø§Ø³ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ú¯Ø±ÙØª.",sender:"support",timestamp:new Date};j(e=>[...e,t])},1e3)},te=async(e,t,r=0)=>{try{let r=new FormData;r.append("file",e),r.append("type",t);let a=await fetch("/api/chat/upload",{method:"POST",body:r});if(!a.ok){let e=await a.json().catch(()=>({error:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„"}));throw Error(e.error||"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„")}return(await a.json()).data.url}catch(a){if(eg.logger.error("Error uploading file:",a),r<3&&(a.message?.includes("fetch")||a.message?.includes("network")||a.message?.includes("timeout")||"NETWORK_ERROR"===a.code||"TypeError"===a.name)){let a=2e3*Math.pow(2,r);return eg.logger.debug(`Retrying file upload in ${a}ms (attempt ${r+1}/3)`),0===r&&l({title:"Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...",description:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„. Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...",duration:2e3}),await new Promise(e=>setTimeout(e,a)),te(e,t,r+1)}throw l({title:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„",description:a.message||"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯",variant:"destructive"}),a}},tt=async(e,t)=>{let r=e.target.files;if(r&&0!==r.length){for(let e of Array.from(r))try{let r=await te(e,t),a={id:Date.now().toString()+Math.random(),type:t,name:e.name,size:e.size,url:r};M(e=>[...e,a])}catch(e){}e.target.value=""}},tr=async()=>{if(!S.name||!S.phone)return;localStorage.setItem("quickBuyChat_customerInfo",JSON.stringify(S)),eL.current=!1,ez.current=null,E("chat");let e={id:Date.now().toString(),text:`Ø³Ù„Ø§Ù… ${S.name}! Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date};j(t=>[...t,e]),await e6(!1)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{"data-chat-open":e&&"chat"===T?"true":"false",style:{display:"none"}}),(0,t.jsxs)(U.Sheet,{open:e,onOpenChange:a,children:[s&&(0,t.jsx)(U.SheetTrigger,{asChild:!0,children:s}),(0,t.jsx)(U.SheetContent,{side:"left",className:"w-full sm:w-[420px] md:w-[480px] p-0 flex flex-col border-l-2 border-border/40 bg-background shadow-2xl",children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.SheetHeader,{className:"px-4 sm:px-6 py-2 border-b border-border/40",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsxs)(U.SheetTitle,{className:"text-base font-semibold text-foreground flex items-center gap-2",children:["Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹","chat"===T&&(0,t.jsx)(eu.OnlineStatusBadge,{isOnline:m,lastSeen:x,showText:!1})]})}),"chat"===T&&S.name&&S.phone&&(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>{E("info"),j([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}])},className:"h-8 w-8 rounded-lg hover:bg-primary/10 transition-colors",title:"ØªØºÛŒÛŒØ± Ø§Ø·Ù„Ø§Ø¹Ø§Øª",children:(0,t.jsxs)("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})}),"info"===T?(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 sm:p-8 space-y-6 bg-gradient-to-b from-background via-background to-muted/10",children:[(0,t.jsxs)(eo.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-center pb-2",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 mb-3 shadow-lg",children:(0,t.jsxs)("svg",{className:"h-8 w-8 text-primary",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("path",{d:"M8 10h.01M12 10h.01M16 10h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"})]}),(0,t.jsxs)(eo.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-5",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,t.jsxs)("svg",{className:"h-4 w-4 text-primary",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ",(0,t.jsx)("span",{className:"text-destructive text-xs",children:"*"})]}),(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(n.Input,{type:"text",placeholder:"Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ",value:S.name,onChange:e=>I({...S,name:e.target.value}),className:"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"}),(0,t.jsx)("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,t.jsxs)("svg",{className:"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,t.jsx)(h.Phone,{className:"h-4 w-4 text-primary"}),"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³",(0,t.jsx)("span",{className:"text-destructive text-xs",children:"*"})]}),(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(n.Input,{type:"tel",placeholder:"09123456789",value:S.phone,onChange:e=>I({...S,phone:e.target.value}),className:"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"}),(0,t.jsx)("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,t.jsx)(h.Phone,{className:"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,t.jsx)(p.Mail,{className:"h-4 w-4 text-primary"}),"Ø§ÛŒÙ…ÛŒÙ„",(0,t.jsx)("span",{className:"text-xs text-muted-foreground font-normal",children:"(Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"})]}),(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(n.Input,{type:"email",placeholder:"example@email.com",value:S.email,onChange:e=>I({...S,email:e.target.value}),className:"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"}),(0,t.jsx)("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,t.jsx)(p.Mail,{className:"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors"})})]})]})]}),(0,t.jsxs)(eo.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"pt-2",children:[(0,t.jsx)(i.Button,{onClick:tr,disabled:!S.name||!S.phone,className:"w-full h-13 text-base font-semibold bg-gradient-to-r from-primary via-primary to-primary/90 hover:from-primary/90 hover:via-primary/80 hover:to-primary/70 shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 transition-all duration-300 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed rounded-xl",children:(0,t.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["Ø§Ø¯Ø§Ù…Ù‡",(0,t.jsx)(eo.motion.div,{animate:{x:[0,4,0]},transition:{repeat:1/0,duration:1.5,delay:.5},children:"â†’"})]})}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center mt-3",children:"Ø¨Ø§ Ø§Ø¯Ø§Ù…Ù‡ØŒ Ø´Ù…Ø§ Ø´Ø±Ø§ÛŒØ· Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ù…Ø§ Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒØ¯"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{ref:eW,className:"flex-1 min-h-0 overflow-y-auto p-5 sm:p-6 md:p-8 space-y-5 sm:space-y-6 bg-gradient-to-b from-background via-background/95 to-muted/5 scroll-smooth",children:[0===f.length&&(0,t.jsxs)(eo.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center h-full min-h-[200px] text-center px-4",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mb-4 shadow-lg",children:(0,t.jsxs)("svg",{className:"h-10 w-10 text-primary/60",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("path",{d:"M8 10h.01M12 10h.01M16 10h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,t.jsx)("p",{className:"text-muted-foreground text-base font-medium leading-relaxed",children:"Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"}),(0,t.jsx)("p",{className:"text-muted-foreground/70 text-sm mt-2 leading-relaxed",children:"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."})]}),f.map((e,r)=>(0,t.jsx)(eo.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},className:`flex ${"user"===e.sender?"justify-end":"justify-start"} items-end gap-2 group`,children:(0,t.jsxs)("div",{className:`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${"user"===e.sender?"bg-primary text-primary-foreground":"bg-muted text-foreground border border-border/40"}`,children:[e.text&&(0,t.jsx)("p",{className:"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5",children:e.text}),e.attachments&&e.attachments.length>0&&(0,t.jsx)("div",{className:`space-y-2 ${e.text?"mt-2":""}`,children:e.attachments.map((e,a)=>(0,t.jsxs)(eo.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*a},className:"rounded-xl overflow-hidden",children:["image"===e.type&&e.url&&(0,t.jsx)("img",{src:e.url,alt:e.name||"ØªØµÙˆÛŒØ±",className:"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all",onClick:()=>window.open(e.url,"_blank"),onError:t=>{eg.logger.error("Image load error:",e.url),t.target.style.display="none"}}),"file"===e.type&&(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",download:e.name,className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,t.jsx)(V.FileText,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"font-medium truncate",children:e.name||"ÙØ§ÛŒÙ„"})]}),"location"===e.type&&(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,t.jsx)(u.MapPin,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"font-medium",children:e.name||"Ù…ÙˆÙ‚Ø¹ÛŒØª"})]}),"audio"===e.type&&e.url&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-background/50 rounded",children:[(0,t.jsx)(Q.Mic,{className:"h-3.5 w-3.5"}),(0,t.jsx)("audio",{controls:!0,className:"flex-1 h-7 text-xs",children:(0,t.jsx)("source",{src:e.url})})]})]},e.id||`att-${r}-${a}`))}),(0,t.jsxs)("div",{className:`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${"user"===e.sender?"border-primary-foreground/20 justify-end":"border-border/30 justify-start"}`,children:[(0,t.jsx)("span",{className:`text-[10px] sm:text-xs ${"user"===e.sender?"text-primary-foreground/70":"text-muted-foreground"}`,children:new Date(e.timestamp).toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}),"user"===e.sender&&(0,t.jsxs)(t.Fragment,{children:["sending"===e.status&&(0,t.jsx)(ee.Loader2,{className:"h-3 w-3 text-primary-foreground/50 animate-spin"}),"sent"===e.status&&(0,t.jsx)(et.Check,{className:"h-3 w-3 text-primary-foreground/40"}),"delivered"===e.status&&(0,t.jsx)(er.CheckCheck,{className:"h-3 w-3 text-primary-foreground/40"}),"read"===e.status&&(0,t.jsx)(er.CheckCheck,{className:"h-3 w-3 text-primary-foreground/70"}),!e.status&&(0,t.jsx)(et.Check,{className:"h-3 w-3 text-primary-foreground/40"})]}),(0,t.jsx)("div",{className:"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsxs)(H.DropdownMenu,{children:[(0,t.jsx)(H.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-background/20",onClick:e=>{e.stopPropagation()},title:"Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±",children:(0,t.jsx)(en.MoreVertical,{className:"h-3.5 w-3.5"})})}),(0,t.jsxs)(H.DropdownMenuContent,{align:"user"===e.sender?"end":"start",className:"min-w-[140px]",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)(H.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),N(e),k(null)},className:"cursor-pointer",children:[(0,t.jsx)(ea.Reply,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"Ù¾Ø§Ø³Ø®"})]}),"user"===e.sender&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(H.DropdownMenuSeparator,{}),(0,t.jsxs)(H.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),k(e),N(null),y(e.text||"")},className:"cursor-pointer",children:[(0,t.jsx)(es.Edit2,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"ÙˆÛŒØ±Ø§ÛŒØ´"})]})]}),(0,t.jsx)(H.DropdownMenuSeparator,{}),(0,t.jsxs)(H.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ")&&e7(e.id)},className:"cursor-pointer text-destructive focus:text-destructive focus:bg-destructive/10",children:[(0,t.jsx)(ei.Trash2,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"Ø­Ø°Ù"})]})]})]})})]})]})},e.id)),eT&&(0,t.jsx)(eo.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"flex justify-start items-end gap-2.5",children:(0,t.jsx)(ex.TypingIndicator,{})}),(0,t.jsx)("div",{ref:e_})]}),(0,t.jsxs)("div",{className:"border-t border-border/40 bg-background p-2 sm:p-3 space-y-2 relative flex-shrink-0",children:[(0,t.jsx)(ed.AnimatePresence,{children:eJ&&(0,t.jsx)(eo.motion.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-10",children:(0,t.jsx)(i.Button,{onClick:()=>eV(!1),size:"icon",className:"h-9 w-9 rounded-full shadow-lg hover:shadow-xl bg-primary text-primary-foreground hover:bg-primary/90 transition-all",title:"Ø¨Ø±Ùˆ Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…",children:(0,t.jsx)(el.ChevronDown,{className:"h-4 w-4"})})})}),ey&&(0,t.jsx)(eo.motion.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},className:"p-3 bg-destructive/5 border-2 border-destructive/20 rounded-xl shadow-sm",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(Q.Mic,{className:"h-3.5 w-3.5 text-destructive mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-destructive mb-1.5 leading-tight",children:"Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù†ÛŒØ§Ø² Ø§Ø³Øª"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯"})]}),(0,t.jsx)("button",{onClick:()=>eb(!1),className:"p-0.5 rounded hover:bg-destructive/10 transition-colors flex-shrink-0",children:(0,t.jsx)(G.X,{className:"h-3 w-3 text-destructive"})})]})}),(P||W)&&(0,t.jsx)(eo.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"flex items-center gap-2 p-2 bg-destructive/10 border border-destructive/30 rounded-lg",children:P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eo.motion.div,{animate:{scale:[1,1.1,1]},transition:{repeat:1/0,duration:1},className:"p-1.5 rounded-full bg-destructive/20",children:(0,t.jsx)(Q.Mic,{className:"h-3.5 w-3.5 text-destructive"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-destructive leading-tight",children:"Ø¯Ø± Ø­Ø§Ù„ Ø¶Ø¨Ø·"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:e0(O)})]}),(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:eY,className:"h-7 w-7 text-destructive hover:bg-destructive/10 rounded-lg",children:(0,t.jsx)(Y.Square,{className:"h-3 w-3 fill-current"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"p-1.5 rounded-full bg-primary/20",children:(0,t.jsx)(Q.Mic,{className:"h-3.5 w-3.5 text-primary"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-xs font-medium leading-tight",children:"Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:e0(O)})]}),(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>{eY(),_(null),W&&(URL.revokeObjectURL(W),A(null)),L(0)},className:"h-7 w-7 text-muted-foreground hover:text-destructive rounded-lg",children:(0,t.jsx)(G.X,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(i.Button,{onClick:eZ,size:"sm",className:"h-7 px-3 text-xs rounded-lg",children:"Ø°Ø®ÛŒØ±Ù‡"})]})}),R&&(0,t.jsxs)(eo.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"flex gap-2 p-2 bg-card rounded-lg border border-border/50 shadow-lg",children:[(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>{eU.current?.click(),D(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,t.jsx)(K.Image,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>{eq.current?.click(),D(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,t.jsx)(V.FileText,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let t={id:Date.now().toString(),type:"location",url:`https://www.google.com/maps?q=${e.coords.latitude},${e.coords.longitude}`,name:"Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ"};M(e=>[...e,t]),D(!1)},e=>{eg.logger.error("Error getting location:",e),alert("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ")}):alert("Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯"),D(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,t.jsx)(u.MapPin,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:async()=>{D(!1),P?eY():(await eG()||l({title:"Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†",description:"Ø¨Ø±Ø§ÛŒ Ø¶Ø¨Ø· ØµØ¯Ø§ØŒ Ù„Ø·ÙØ§Ù‹ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.",variant:"destructive",duration:5e3}),eQ())},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",disabled:P,children:P?(0,t.jsx)(Z.Pause,{className:"h-3.5 w-3.5 text-destructive"}):(0,t.jsx)(Q.Mic,{className:"h-3.5 w-3.5"})})]}),(0,t.jsx)("input",{ref:eU,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:e=>tt(e,"image")}),(0,t.jsx)("input",{ref:eq,type:"file",multiple:!0,className:"hidden",onChange:e=>tt(e,"file")}),(0,t.jsx)("div",{className:"flex items-end gap-2",children:(0,t.jsxs)("div",{className:"flex-1 relative",children:[$.length>0&&(0,t.jsx)("div",{className:"absolute top-2 right-2 left-2 z-10 pointer-events-none overflow-hidden",children:(0,t.jsx)("div",{className:"overflow-x-auto overflow-y-hidden scroll-smooth w-full [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:(0,t.jsx)("div",{className:"flex items-center gap-1.5 flex-nowrap",children:$.map(e=>(0,t.jsxs)("div",{className:"relative group pointer-events-auto flex-shrink-0 w-auto",children:[(0,t.jsxs)("div",{className:"bg-card/95 backdrop-blur-sm rounded-md p-1 border border-border/40 shadow-sm",children:["image"===e.type&&e.url&&(0,t.jsx)("img",{src:e.url,alt:e.name||"ØªØµÙˆÛŒØ±",className:"w-10 h-10 object-cover rounded"}),"file"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,t.jsx)(V.FileText,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,t.jsx)("p",{className:"text-[10px] truncate max-w-[50px] font-medium leading-tight",children:e.name})]}),"location"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,t.jsx)(u.MapPin,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,t.jsx)("span",{className:"text-[10px] font-medium whitespace-nowrap leading-tight",children:"Ù…ÙˆÙ‚Ø¹ÛŒØª"})]}),"audio"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,t.jsx)(Q.Mic,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,t.jsx)("span",{className:"text-[10px] font-medium whitespace-nowrap leading-tight",children:e.duration?e0(e.duration):"ØµØ¯Ø§"})]})]}),(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void M(e=>{let r=e.find(e=>e.id===t);return r?.url&&URL.revokeObjectURL(r.url),e.filter(e=>e.id!==t)})},className:"absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-20 hover:scale-110",children:(0,t.jsx)(G.X,{className:"h-2.5 w-2.5"})})]},e.id))})})}),(0,t.jsx)(F.Textarea,{ref:eA,value:v,onChange:e=>{y(e.target.value),e$.current&&clearTimeout(e$.current),e.target.value.trim().length>0?(e8(!0),e$.current=setTimeout(()=>{e8(!1)},2e3)):e8(!1)},onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),e$.current&&clearTimeout(e$.current),e8(!1),(v.trim()||$.length>0)&&e9())},placeholder:"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...",className:`min-h-[44px] max-h-[100px] resize-none text-sm leading-relaxed rounded-lg border pr-20 pl-3 py-2 ${$.length>0?"pt-12":""}`}),(0,t.jsxs)("div",{className:"absolute bottom-2 right-2 flex items-center gap-1",children:[(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>D(!R),className:`h-7 w-7 rounded-lg transition-all ${R?"bg-primary/10 text-primary":"hover:bg-muted/60 text-muted-foreground hover:text-foreground"}`,children:(0,t.jsx)(X.Paperclip,{className:"h-4 w-4"})}),(v.trim()||$.length>0)&&!P&&(0,t.jsx)(t.Fragment,{children:eN?(0,t.jsx)(ee.Loader2,{className:"h-4 w-4 text-primary animate-spin"}):(0,t.jsx)(i.Button,{onClick:e9,size:"icon",className:"h-7 w-7 rounded-lg transition-all",children:(0,t.jsx)(J.Send,{className:"h-3.5 w-3.5"})})})]})]})})]})]})]})})]})]})}let ej={pending:{label:"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±",color:"bg-yellow-100 text-yellow-800",icon:j.Clock},processing:{label:"Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´",color:"bg-blue-100 text-blue-800",icon:m.Package},shipped:{label:"Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡",color:"bg-purple-100 text-purple-800",icon:g.Truck},delivered:{label:"ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡",color:"bg-green-100 text-green-800",icon:f.CheckCircle2},cancelled:{label:"Ù„ØºÙˆ Ø´Ø¯Ù‡",color:"bg-red-100 text-red-800",icon:v.XCircle}},ev={pending:{label:"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª",color:"bg-yellow-100 text-yellow-800"},paid:{label:"Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡",color:"bg-green-100 text-green-800"},failed:{label:"Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚",color:"bg-red-100 text-red-800"},refunded:{label:"Ø¨Ø§Ø²Ú¯Ø´Øª ÙˆØ¬Ù‡",color:"bg-gray-100 text-gray-800"}};function ey(){let e,S,I,T,E,$,M=(0,a.useSearchParams)().get("orderNumber")||"",[R,D]=(0,r.useState)(M),[P,B]=(0,r.useState)(null),[O,L]=(0,r.useState)(!1),[z,_]=(0,r.useState)(!1),[W,A]=(0,r.useState)(!1),{orders:U,updateOrder:F}=(0,o.useOrderStore)(),{getProduct:H,loadProductsFromDB:J}=(0,d.useProductStore)(),K=()=>{(L(!1),B(null),_(!0),R.trim())?X(R):_(!1)},X=async e=>{try{let t=U.find(t=>t.orderNumber.toLowerCase()===e.toLowerCase().trim()||t.id===e.trim());if(t){B(t),L(!1);return}let r=await fetch(`/api/orders?orderNumber=${encodeURIComponent(e)}`);if(r.ok){let e=await r.json();if(e.success&&e.data&&e.data.length>0){let t=e.data[0];B(t),L(!1),F(t.id,t)}else L(!0)}else L(!0)}catch(e){console.error("Error fetching order:",e),L(!0)}};return(0,r.useEffect)(()=>{J(!0).catch(e=>{console.error("Error loading products for order tracking:",e)})},[J]),(0,r.useEffect)(()=>{M&&M.trim()&&(_(!0),X(M))},[M]),(0,r.useEffect)(()=>{if(!P?.id)return;let e=setInterval(async()=>{try{let e=await fetch(`/api/orders/${P.id}`);if(e.ok){let t=await e.json();t.success&&t.data&&(B(t.data),F(t.data.id,t.data))}}catch(e){console.error("Error polling order status:",e)}},1e4);return()=>clearInterval(e)},[P?.id,F]),P&&ej[P.status]?.icon||j.Clock,(0,t.jsxs)("div",{className:"container mx-auto px-4 py-6 sm:py-8 md:py-12",children:[(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6 sm:mb-8",children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´"}),(0,t.jsxs)(i.Button,{onClick:()=>A(!0),variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,t.jsx)(w.MessageCircle,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Ú†Øª Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ†"}),(0,t.jsx)("span",{className:"sm:hidden",children:"Ú†Øª"})]})]}),(0,t.jsxs)(s.Card,{className:"mb-6",children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³ÙØ§Ø±Ø´"})}),(0,t.jsx)(s.CardContent,{children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(l.Label,{htmlFor:"orderNumber",children:"Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´"}),(0,t.jsx)(n.Input,{id:"orderNumber",placeholder:"Ù…Ø«Ø§Ù„: ORD-1234567890-001",value:R,onChange:e=>D(e.target.value),onKeyDown:e=>{"Enter"===e.key&&K()}})]}),(0,t.jsx)("div",{className:"flex items-end",children:(0,t.jsxs)(i.Button,{onClick:K,size:"lg",children:[(0,t.jsx)(c.Search,{className:"ml-2 h-4 w-4"}),"Ø¬Ø³ØªØ¬Ùˆ"]})})]})})]}),O&&z&&(0,t.jsx)(s.Card,{children:(0,t.jsx)(s.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,t.jsx)(v.XCircle,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Ø³ÙØ§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯"}),(0,t.jsx)("p",{className:"text-muted-foreground text-center mb-6",children:"Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."})]})})}),P&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(s.Card,{className:"border-2",children:[(0,t.jsx)(s.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,t.jsxs)(s.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Package,{className:"h-5 w-5 text-primary"}),"Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´"]})}),(0,t.jsxs)(s.CardContent,{className:"pt-6",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute right-8 top-0 bottom-0 w-0.5 bg-border",children:(0,t.jsx)("div",{className:"absolute top-0 right-0 w-full bg-primary transition-all duration-500 ease-in-out",style:{height:`${-1===(S=(e=["pending","processing","shipped","delivered"]).indexOf(P.status))?0:(S+1)/e.length*100}%`}})}),(0,t.jsx)("div",{className:"space-y-8 relative z-10",children:[{status:"pending",label:"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±",icon:y.ShoppingCart,description:"Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯"},{status:"processing",label:"Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´",icon:b.Box,description:"Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ"},{status:"shipped",label:"Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡",icon:g.Truck,description:"Ø¯Ø± Ù…Ø³ÛŒØ± ØªØ­ÙˆÛŒÙ„"},{status:"delivered",label:"ØªØ­ÙˆÛŒÙ„ Ø´Ø¯Ù‡",icon:f.CheckCircle2,description:"ØªØ­ÙˆÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯"}].map((e,r)=>{let a=["pending","processing","shipped","delivered"],s=a.indexOf(P.status),i=a.indexOf(e.status),n=s>=i&&"cancelled"!==P.status,l=s===i&&"cancelled"!==P.status,o=e.icon;return(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"relative z-10",children:(0,t.jsx)("div",{className:`w-16 h-16 rounded-full flex items-center justify-center transition-all duration-300 ${n?"bg-primary text-primary-foreground shadow-lg shadow-primary/50":l?"bg-primary/20 text-primary border-2 border-primary":"bg-muted text-muted-foreground"}`,children:n?(0,t.jsx)(N.CheckCircle,{className:"h-8 w-8"}):(0,t.jsx)(o,{className:"h-8 w-8"})})}),(0,t.jsxs)("div",{className:"flex-1 pt-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsx)("h3",{className:`font-semibold text-lg ${n||l?"text-foreground":"text-muted-foreground"}`,children:e.label}),l&&(0,t.jsx)(C.Badge,{variant:"default",className:"animate-pulse",children:"Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…"}),n&&!l&&(0,t.jsxs)(C.Badge,{variant:"success",className:"gap-1",children:[(0,t.jsx)(N.CheckCircle,{className:"h-3 w-3"}),"ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯"]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),l&&P.updatedAt&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:"," ",new Date(P.updatedAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]},e.status)})})]}),(0,t.jsxs)("div",{className:"mt-8 pt-6 border-t",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Ù¾ÛŒØ´Ø±ÙØª Ú©Ù„ÛŒ"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:-1===(T=(I=["pending","processing","shipped","delivered"]).indexOf(P.status))?"0%":`${Math.round((T+1)/I.length*100)}%`})]}),(0,t.jsx)(q,{value:-1===($=(E=["pending","processing","shipped","delivered"]).indexOf(P.status))?0:($+1)/E.length*100,className:"h-3"})]}),(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(m.Package,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´"}),(0,t.jsx)("p",{className:"font-semibold font-mono",children:P.orderNumber})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(x.Calendar,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª"}),(0,t.jsx)("p",{className:"font-semibold",children:new Date(P.createdAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³ÙØ§Ø±Ø´"})}),(0,t.jsx)(s.CardContent,{children:(0,t.jsx)("div",{className:"space-y-4",children:P.items.map(e=>{let r=H(e.productId||e.id),a=e.image&&""!==e.image.trim()?e.image:"";!a&&r&&r.images&&r.images.length>0&&(a=r.images[0]);let s=a&&""!==a.trim();return(0,t.jsxs)("div",{className:"flex gap-4 pb-4 border-b last:border-0",children:[s?(0,t.jsx)("div",{className:"relative w-20 h-20 bg-muted rounded-lg overflow-hidden flex-shrink-0 border",children:(0,t.jsx)(k.default,{src:a,alt:e.name,fill:!0,className:"object-cover",unoptimized:a.startsWith("blob:")||a.startsWith("data:")})}):(0,t.jsx)("div",{className:"w-20 h-20 bg-muted rounded-lg flex items-center justify-center flex-shrink-0 border",children:(0,t.jsx)(m.Package,{className:"h-8 w-8 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold mb-1",children:e.name}),(0,t.jsxs)("div",{className:"flex justify-between text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{children:["ØªØ¹Ø¯Ø§Ø¯: ",e.quantity]}),(0,t.jsxs)("span",{className:"font-semibold text-foreground",children:[(e.price*e.quantity).toLocaleString("fa-IR")," ØªÙˆÙ…Ø§Ù†"]})]})]})]},e.id)})})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ"})}),(0,t.jsxs)(s.CardContent,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(m.Package,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ù†Ø§Ù…"}),(0,t.jsx)("p",{className:"font-semibold",children:P.customerName})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(h.Phone,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³"}),(0,t.jsx)("p",{className:"font-semibold",children:P.customerPhone})]})]}),P.customerEmail&&(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(p.Mail,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø§ÛŒÙ…ÛŒÙ„"}),(0,t.jsx)("p",{className:"font-semibold",children:P.customerEmail})]})]})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Ø¢Ø¯Ø±Ø³ Ø§Ø±Ø³Ø§Ù„"})}),(0,t.jsxs)(s.CardContent,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(u.MapPin,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø¢Ø¯Ø±Ø³"}),(0,t.jsxs)("p",{className:"font-semibold",children:[P.shippingAddress.city,"ØŒ ",P.shippingAddress.address]}),P.shippingAddress.postalCode&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Ú©Ø¯ Ù¾Ø³ØªÛŒ: ",P.shippingAddress.postalCode]})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(g.Truck,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø±ÙˆØ´ Ø§Ø±Ø³Ø§Ù„"}),(0,t.jsx)("p",{className:"font-semibold",children:"air"===P.shippingMethod?"Ù‡ÙˆØ§ÛŒÛŒ":"Ø¯Ø±ÛŒØ§ÛŒÛŒ"})]})]})]})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ§Ø±Ø´"})}),(0,t.jsx)(s.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Ø¬Ù…Ø¹ Ú©Ù„:"}),(0,t.jsxs)("span",{className:"font-semibold",children:[P.total.toLocaleString("fa-IR")," ØªÙˆÙ…Ø§Ù†"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„:"}),(0,t.jsx)("span",{className:"font-semibold",children:0===P.shippingCost?(0,t.jsx)("span",{className:"text-green-600",children:"Ø±Ø§ÛŒÚ¯Ø§Ù†"}):`${P.shippingCost.toLocaleString("fa-IR")} ØªÙˆÙ…Ø§Ù†`})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-3 border-t",children:[(0,t.jsx)("span",{className:"font-bold",children:"Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ:"}),(0,t.jsxs)("span",{className:"font-bold text-lg text-primary",children:[(P.total+P.shippingCost).toLocaleString("fa-IR")," ØªÙˆÙ…Ø§Ù†"]})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-3 border-t",children:[(0,t.jsx)("span",{children:"ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª:"}),(0,t.jsx)(C.Badge,{className:ev[P.paymentStatus]?.color,children:ev[P.paymentStatus]?.label})]})]})})]})]})]}),(0,t.jsx)(ef,{isOpen:W,onOpenChange:A})]})}function eb(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ..."}),children:(0,t.jsx)(ey,{})})}e.s(["default",()=>eb],71876)}]);
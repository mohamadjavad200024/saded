(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,48106,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(4967),r=e.i(88844),l=e.i(36361);function i({src:e,alt:i,fill:d=!1,width:n,height:c,className:m="",priority:o=!1,loading:u="eager",sizes:x,onError:h,placeholder:p="empty",blurDataURL:g,productId:f}){let j=(0,l.useProductStore)(),N=(0,t.useMemo)(()=>(0,a.getPlaceholderImage)(n||600,c||600),[n,c]),b=(0,t.useCallback)(()=>{if(e&&"string"==typeof e&&""!==e.trim()){let s=(0,a.normalizeImageUrl)(e.trim());if(s&&(0,a.validateImageUrl)(s))return s}if(f){let e=j.getProduct(f);if(e?.images&&Array.isArray(e.images)&&e.images.length>0){for(let s of e.images)if(s&&"string"==typeof s&&""!==s.trim()){let e=(0,a.normalizeImageUrl)(s.trim());if(e&&(0,a.validateImageUrl)(e))return e}}}return N},[e,f,N,j]),v=(0,t.useMemo)(()=>b(),[b]),[y,w]=(0,t.useState)(v),[C,S]=(0,t.useState)(!0),[T,k]=(0,t.useState)(!1),[I,M]=(0,t.useState)(!u||"eager"===u),P=(0,t.useRef)(null),A=(0,t.useRef)(0),R=(0,t.useRef)(null),E=(0,t.useRef)(null);(0,t.useEffect)(()=>{if("lazy"===u&&"IntersectionObserver"in window){let e=new IntersectionObserver(s=>{s.forEach(s=>{s.isIntersecting&&(M(!0),e.disconnect())})},{rootMargin:"50px",threshold:.01});return P.current&&(e.observe(P.current),E.current=e),()=>{E.current&&E.current.disconnect()}}M(!0)},[u]),(0,t.useEffect)(()=>{o&&v&&v!==N&&I&&(0,a.preloadImage)(v).catch(()=>{})},[o,v,N,I]),(0,t.useEffect)(()=>{v!==y&&(w(v),S(!0),k(!1),A.current=0,R.current&&clearTimeout(R.current))},[v,y]),(0,t.useEffect)(()=>{if(C&&y&&y!==N&&I)return R.current=setTimeout(()=>{C&&$()},3e4),()=>{R.current&&clearTimeout(R.current)}},[C,y,N,I]);let H=(0,t.useCallback)(()=>{R.current&&clearTimeout(R.current),S(!1),k(!1),A.current=0},[]),$=(0,t.useCallback)(()=>{R.current&&clearTimeout(R.current);let e=y||v;if(e===N){S(!1),k(!0),h?.();return}if(A.current<3){A.current+=1;let s=1e3*Math.pow(2,A.current-1),t=e;if((0,a.needsCacheBusting)(e))t=(0,a.addCacheBusting)(e);else{let s=e.includes("?")?"&":"?";t=`${e.split("&_t=")[0].split("?_t=")[0]}${s}_retry=${A.current}&_t=${Date.now()}`}R.current=setTimeout(()=>{P.current&&(P.current.src="",setTimeout(()=>{P.current&&(P.current.src=t)},100))},s)}else{if(S(!1),k(!0),f){let s=j.getProduct(f);if(s?.images&&Array.isArray(s.images)&&s.images.length>0){let t=s.images.find(s=>{if(!s||"string"!=typeof s||""===s.trim())return!1;let t=(0,a.normalizeImageUrl)(s.trim());return t&&(0,a.validateImageUrl)(t)&&t!==e&&t!==y});if(t){let e=(0,a.normalizeImageUrl)(t.trim());if(e&&(0,a.validateImageUrl)(e)){A.current=0,w(e),S(!0),k(!1);return}}}}w(N),h?.()}},[y,v,N,f,j,h]);(0,t.useEffect)(()=>()=>{R.current&&clearTimeout(R.current),E.current&&E.current.disconnect()},[]);let z=(0,t.useMemo)(()=>y&&""!==y.trim()?y:N,[y,N]),L={src:(0,t.useMemo)(()=>(0,a.validateImageUrl)(z),[z])?z:N,alt:i,onLoad:H,onError:$,loading:I?u:"lazy",className:"object-cover w-full h-full",style:{objectFit:"cover"},fetchPriority:o?"high":"auto",decoding:"async",crossOrigin:z.startsWith("http")&&!z.includes(window.location.origin)?"anonymous":void 0};return d?(0,s.jsxs)("div",{className:`relative ${m}`,style:{width:"100%",height:"100%"},children:[(0,s.jsx)("img",{...L,ref:P}),C&&!T&&(0,s.jsx)("div",{className:"absolute inset-0 bg-muted animate-pulse flex items-center justify-center z-10",children:(0,s.jsx)(r.Package,{className:"h-8 w-8 text-muted-foreground"})})]}):(0,s.jsxs)("div",{className:`relative ${m}`,style:{width:n,height:c},children:[(0,s.jsx)("img",{...L,ref:P}),C&&!T&&(0,s.jsx)("div",{className:"absolute inset-0 bg-muted animate-pulse flex items-center justify-center z-10",children:(0,s.jsx)(r.Package,{className:"h-8 w-8 text-muted-foreground"})})]})}e.s(["SafeImage",()=>i])},87316,e=>{"use strict";let s=(0,e.i(75254).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>s],87316)},16715,e=>{"use strict";let s=(0,e.i(75254).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>s],16715)},47627,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(47163);let r=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:r,className:(0,a.cn)("w-full caption-bottom text-sm",e),...t})}));r.displayName="Table";let l=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("thead",{ref:r,className:(0,a.cn)("[&_tr]:border-b border-border/30",e),...t}));l.displayName="TableHeader";let i=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("tbody",{ref:r,className:(0,a.cn)("[&_tr:last-child]:border-0",e),...t}));i.displayName="TableBody",t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("tfoot",{ref:r,className:(0,a.cn)("border-t border-border/30 bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let d=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("tr",{ref:r,className:(0,a.cn)("border-b border-border/30 transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));d.displayName="TableRow";let n=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("th",{ref:r,className:(0,a.cn)("h-12 px-4 text-right align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));n.displayName="TableHead";let c=t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("td",{ref:r,className:(0,a.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));c.displayName="TableCell",t.forwardRef(({className:e,...t},r)=>(0,s.jsx)("caption",{ref:r,className:(0,a.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption",e.s(["Table",()=>r,"TableBody",()=>i,"TableCell",()=>c,"TableHead",()=>n,"TableHeader",()=>l,"TableRow",()=>d])},41071,e=>{"use strict";let s=(0,e.i(75254).default)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>s],41071)},97548,e=>{"use strict";let s=(0,e.i(75254).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["Filter",()=>s],97548)},40160,e=>{"use strict";let s=(0,e.i(75254).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>s],40160)},78917,e=>{"use strict";let s=(0,e.i(75254).default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.s(["ExternalLink",()=>s],78917)},76664,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(47627),r=e.i(67881),l=e.i(62870),i=e.i(41071),d=e.i(88844),n=e.i(15788),c=e.i(84614),m=e.i(43432),o=e.i(63488),u=e.i(46897),x=e.i(87316),h=e.i(78583),p=e.i(94983),g=e.i(78917),f=e.i(60366),j=e.i(36361),N=e.i(20682),b=e.i(48106),v=e.i(30374),y=e.i(45919),w=e.i(29865),C=e.i(82429);let S={pending:"در انتظار",processing:"در حال پردازش",shipped:"ارسال شده",delivered:"تحویل داده شده",cancelled:"لغو شده"},T={pending:"در انتظار پرداخت",paid:"پرداخت شده",failed:"پرداخت ناموفق",refunded:"بازگشت وجه"};function k({orders:e,onRefresh:k}){let{updateOrderStatus:I,updatePaymentStatus:M,updateOrder:P}=(0,f.useOrderStore)(),{getProduct:A}=(0,j.useProductStore)(),{toast:R}=(0,N.useToast)(),[E,H]=(0,t.useState)(!1),[$,z]=(0,t.useState)(null),[L,O]=(0,t.useState)(!1),U=async(e,s)=>{try{let t=await fetch(`/api/orders/${e}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"خطا در به‌روزرسانی وضعیت")}let a=await t.json();a.success&&a.data&&(I(e,s),$&&$.id===e&&z({...$,status:s}),R({title:"موفق",description:"وضعیت سفارش به‌روزرسانی شد"}),k?.())}catch(e){R({title:"خطا",description:e instanceof Error?e.message:"خطا در به‌روزرسانی وضعیت",variant:"destructive"})}},B=async(e,s)=>{try{let t=await fetch(`/api/orders/${e}/payment-status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentStatus:s})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"خطا در به‌روزرسانی وضعیت پرداخت")}let a=await t.json();a.success&&a.data&&(M(e,s),$&&$.id===e&&z({...$,paymentStatus:s}),R({title:"موفق",description:"وضعیت پرداخت به‌روزرسانی شد"}),k?.())}catch(e){R({title:"خطا",description:e instanceof Error?e.message:"خطا در به‌روزرسانی وضعیت پرداخت",variant:"destructive"})}},D=e=>new Intl.NumberFormat("fa-IR").format(e);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"border-b",children:(0,s.jsxs)(a.Table,{children:[(0,s.jsx)(a.TableHeader,{children:(0,s.jsxs)(a.TableRow,{className:"border-b hover:bg-transparent",children:[(0,s.jsx)(a.TableHead,{className:"h-10 text-xs font-medium text-muted-foreground",children:"شماره سفارش"}),(0,s.jsx)(a.TableHead,{className:"h-10 text-xs font-medium text-muted-foreground",children:"مشتری"}),(0,s.jsx)(a.TableHead,{className:"h-10 text-xs font-medium text-muted-foreground",children:"مبلغ"}),(0,s.jsx)(a.TableHead,{className:"h-10 text-xs font-medium text-muted-foreground",children:"وضعیت"}),(0,s.jsx)(a.TableHead,{className:"h-10 text-xs font-medium text-muted-foreground",children:"پرداخت"}),(0,s.jsx)(a.TableHead,{className:"h-10 text-xs font-medium text-muted-foreground",children:"تاریخ"}),(0,s.jsx)(a.TableHead,{className:"h-10 w-10"})]})}),(0,s.jsx)(a.TableBody,{children:0===e.length?(0,s.jsx)(a.TableRow,{children:(0,s.jsx)(a.TableCell,{colSpan:7,className:"text-center py-12 text-sm text-muted-foreground",children:"سفارشی یافت نشد"})}):e.map(e=>(0,s.jsxs)(a.TableRow,{className:"border-b hover:bg-muted/30",children:[(0,s.jsx)(a.TableCell,{className:"py-3",children:(0,s.jsx)("span",{className:"text-xs font-mono text-muted-foreground",children:e.orderNumber})}),(0,s.jsxs)(a.TableCell,{className:"py-3",children:[(0,s.jsx)("div",{className:"text-sm",children:e.customerName}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground mt-0.5",children:e.customerPhone})]}),(0,s.jsxs)(a.TableCell,{className:"py-3 text-sm",children:[D(e.total+e.shippingCost)," ",(0,s.jsx)("span",{className:"text-muted-foreground",children:"تومان"})]}),(0,s.jsx)(a.TableCell,{className:"py-3",children:(0,s.jsx)("span",{className:`text-xs px-2 py-0.5 rounded ${"delivered"===e.status?"bg-green-50 text-green-700":"pending"===e.status?"bg-gray-100 text-gray-700":"processing"===e.status?"bg-blue-50 text-blue-700":"shipped"===e.status?"bg-purple-50 text-purple-700":"bg-red-50 text-red-700"}`,children:S[e.status]})}),(0,s.jsx)(a.TableCell,{className:"py-3",children:(0,s.jsx)("span",{className:`text-xs px-2 py-0.5 rounded ${"paid"===e.paymentStatus?"bg-green-50 text-green-700":"pending"===e.paymentStatus?"bg-yellow-50 text-yellow-700":"failed"===e.paymentStatus?"bg-red-50 text-red-700":"bg-gray-50 text-gray-700"}`,children:T[e.paymentStatus]})}),(0,s.jsx)(a.TableCell,{className:"py-3 text-xs text-muted-foreground",children:(0,y.format)(new Date(e.createdAt),"yyyy/MM/dd",{locale:w.faIR})}),(0,s.jsx)(a.TableCell,{className:"py-3",children:(0,s.jsx)(r.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{z(e),H(!0)},children:(0,s.jsx)(i.MoreHorizontal,{className:"h-3.5 w-3.5"})})})]},e.id))})]})}),(0,s.jsx)(v.Dialog,{open:E,onOpenChange:H,children:(0,s.jsxs)(v.DialogContent,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(v.DialogHeader,{className:"pb-4 border-b",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(v.DialogTitle,{className:"text-lg font-semibold",children:["جزئیات سفارش ",$?.orderNumber]}),$&&(0,s.jsxs)(r.Button,{onClick:()=>O(!0),variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,s.jsx)(p.MessageCircle,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"چت با مشتری"}),(0,s.jsx)("span",{className:"sm:hidden",children:"چت"})]})]})}),$&&(0,s.jsxs)("div",{className:"space-y-6 pt-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-4 bg-muted/30 rounded-lg border",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"وضعیت سفارش"}),(0,s.jsxs)(l.Select,{value:$.status,onValueChange:e=>U($.id,e),children:[(0,s.jsx)(l.SelectTrigger,{className:"h-9",children:(0,s.jsx)(l.SelectValue,{})}),(0,s.jsx)(l.SelectContent,{children:Object.entries(S).map(([e,t])=>(0,s.jsx)(l.SelectItem,{value:e,children:t},e))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"وضعیت پرداخت"}),(0,s.jsxs)(l.Select,{value:$.paymentStatus,onValueChange:e=>B($.id,e),children:[(0,s.jsx)(l.SelectTrigger,{className:"h-9",children:(0,s.jsx)(l.SelectValue,{})}),(0,s.jsx)(l.SelectContent,{children:Object.entries(T).map(([e,t])=>(0,s.jsx)(l.SelectItem,{value:e,children:t},e))})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-4 bg-muted/30 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(x.Calendar,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"تاریخ ثبت"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:(0,y.format)(new Date($.createdAt),"yyyy/MM/dd - HH:mm",{locale:w.faIR})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.Truck,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"روش ارسال"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:"air"===$.shippingMethod?"هوایی":"دریایی"})]})]})]}),(0,s.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[(0,s.jsx)(c.User,{className:"h-4 w-4"}),"اطلاعات مشتری"]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(c.User,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"نام و نام خانوادگی"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:$.customerName})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(m.Phone,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"شماره تماس"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:$.customerPhone})]})]}),$.customerEmail&&(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(o.Mail,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"ایمیل"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:$.customerEmail})]})]})]}),(0,s.jsx)("div",{className:"space-y-3",children:(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(u.MapPin,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"آدرس ارسال"}),"location"===$.shippingAddress.addressType&&$.shippingAddress.location?(0,s.jsxs)("div",{className:"space-y-2 mt-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium break-words",children:(()=>{let e=$.shippingAddress.location;if(e.includes(",")&&/^-?\d+\.?\d*,-?\d+\.?\d*$/.test(e.trim())){let[s,t]=e.split(",").map(e=>e.trim());return`${s}, ${t}`}return e})()}),(()=>{let e=$.shippingAddress.location;if(e.includes(",")&&/^-?\d+\.?\d*,-?\d+\.?\d*$/.test(e.trim())){let[t,a]=e.split(",").map(e=>e.trim()),l=`https://www.google.com/maps?q=${t},${a}`;return(0,s.jsxs)(r.Button,{type:"button",variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>window.open(l,"_blank"),children:[(0,s.jsx)(u.MapPin,{className:"h-3 w-3 ml-1"}),"مشاهده در نقشه",(0,s.jsx)(g.ExternalLink,{className:"h-3 w-3 mr-1"})]})}return null})()]}):"postalCode"===$.shippingAddress.addressType&&$.shippingAddress.postalCode?(0,s.jsxs)("p",{className:"text-sm font-medium",children:["کد پستی: ",$.shippingAddress.postalCode]}):(0,s.jsxs)(s.Fragment,{children:[($.shippingAddress.province||$.shippingAddress.city)&&(0,s.jsxs)("p",{className:"text-sm font-medium",children:[$.shippingAddress.province&&`${$.shippingAddress.province}، `,$.shippingAddress.city]}),$.shippingAddress.address&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:$.shippingAddress.address}),$.shippingAddress.postalCode&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["کد پستی: ",$.shippingAddress.postalCode]})]})]})]})})]})]}),(0,s.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[(0,s.jsx)(d.Package,{className:"h-4 w-4"}),"محصولات سفارش (",$.items.length," آیتم)"]}),(0,s.jsx)("div",{className:"space-y-3",children:$.items.map((e,t)=>{let a=A(e.productId||e.id),r=e.image&&""!==e.image.trim()?e.image:"";!r&&a&&a.images&&a.images.length>0&&(r=a.images[0]);let l=r&&(e=>{if(!e||"string"!=typeof e||""===e.trim())return!1;if(e.startsWith("blob:")||e.startsWith("data:"))return!0;try{return new URL(e),!0}catch{return!1}})(r);return(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-muted/30 rounded-lg",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground w-6",children:t+1}),l?(0,s.jsx)("div",{className:"relative w-20 h-20 rounded-lg overflow-hidden bg-background flex-shrink-0 border shadow-sm",children:(0,s.jsx)(b.SafeImage,{src:r,alt:e.name||"Product image",fill:!0,className:"object-cover",productId:e.productId||e.id,priority:t<3,loading:"eager"})}):(0,s.jsx)("div",{className:"w-20 h-20 rounded-lg bg-muted flex items-center justify-center flex-shrink-0 border",children:(0,s.jsx)(d.Package,{className:"h-8 w-8 text-muted-foreground"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.name}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["تعداد: ",(0,s.jsx)("span",{className:"font-medium text-foreground",children:e.quantity})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["قیمت واحد: ",(0,s.jsxs)("span",{className:"font-medium text-foreground",children:[D(e.price)," تومان"]})]})]})]}),(0,s.jsx)("div",{className:"text-left",children:(0,s.jsxs)("p",{className:"text-sm font-semibold",children:[D(e.price*e.quantity)," تومان"]})})]},e.id)})})]}),$.notes&&(0,s.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[(0,s.jsx)(h.FileText,{className:"h-4 w-4"}),"یادداشت سفارش"]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:$.notes})]}),(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-muted/30",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold mb-3",children:"خلاصه مالی"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"جمع کل محصولات"}),(0,s.jsxs)("span",{className:"font-medium",children:[D($.total)," تومان"]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"هزینه ارسال"}),(0,s.jsx)("span",{className:"font-medium",children:0===$.shippingCost?(0,s.jsx)("span",{className:"text-green-600",children:"رایگان"}):`${D($.shippingCost)} تومان`})]}),(0,s.jsx)("div",{className:"border-t pt-2 mt-2",children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-base font-semibold",children:"مبلغ نهایی"}),(0,s.jsxs)("span",{className:"text-base font-bold text-primary",children:[D($.total+$.shippingCost)," تومان"]})]})})]})]})]})]})}),(0,s.jsx)(C.AdminChat,{isOpen:L,onOpenChange:O,initialCustomerPhone:$?.customerPhone})]})}var I=e.i(23750),M=e.i(70065),P=e.i(55436),A=e.i(40160),R=e.i(97548),E=e.i(31278),H=e.i(16715),$=e.i(18566);function z(){let{orders:e,setFilters:a,clearFilters:i,filters:n,loadOrdersFromDB:c,isLoading:m}=(0,f.useOrderStore)(),{loadProductsFromDB:o}=(0,j.useProductStore)(),[u,x]=(0,t.useState)(n.search||""),[h,p]=(0,t.useState)("all"),[g,N]=(0,t.useState)("all"),[b,v]=(0,t.useState)(!1),y=(0,$.usePathname)();(0,t.useEffect)(()=>((async()=>{try{await Promise.all([c(),o(!0)])}catch(e){console.error("Error loading data:",e)}})(),()=>{}),[y]),(0,t.useEffect)(()=>{let e=()=>{"visible"===document.visibilityState&&c()};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[c]);let w=(0,t.useMemo)(()=>{let s=e;if(u){let e=u.toLowerCase();s=s.filter(s=>s.orderNumber.toLowerCase().includes(e)||s.customerName.toLowerCase().includes(e)||s.customerPhone.includes(e)||s.customerEmail?.toLowerCase().includes(e))}return"all"!==h&&(s=s.filter(e=>e.status===h)),"all"!==g&&(s=s.filter(e=>e.paymentStatus===g)),s},[e,u,h,g]);return(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)(M.Card,{className:"shadow-sm",children:[(0,s.jsxs)(M.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(M.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(d.Package,{className:"h-5 w-5 text-primary"}),"سفارشات (",w.length,")"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(r.Button,{variant:"outline",onClick:async()=>{await c()},size:"sm",disabled:m,children:[m?(0,s.jsx)(E.Loader2,{className:"ml-2 h-4 w-4 animate-spin"}):(0,s.jsx)(H.RefreshCw,{className:"ml-2 h-4 w-4"}),"به‌روزرسانی"]}),(0,s.jsxs)(r.Button,{variant:b?"default":"outline",onClick:()=>v(!b),size:"sm",children:[(0,s.jsx)(R.Filter,{className:"ml-2 h-4 w-4"}),"فیلتر"]}),(0,s.jsxs)(r.Button,{variant:"outline",onClick:()=>{let e=new Blob([[["شماره سفارش","مشتری","تلفن","مبلغ کل","وضعیت","وضعیت پرداخت","تاریخ"],...w.map(e=>[e.orderNumber,e.customerName,e.customerPhone,(e.total+e.shippingCost).toString(),e.status,e.paymentStatus,e.createdAt.toISOString()])].map(e=>e.join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(e),s.download=`orders-${new Date().toISOString()}.csv`,s.click()},size:"sm",disabled:0===w.length,children:[(0,s.jsx)(A.Download,{className:"ml-2 h-4 w-4"}),"خروجی CSV"]})]})]}),b&&(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-border/20",children:[(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"جستجو"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(P.Search,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(I.Input,{placeholder:"جستجو در سفارشات...",value:u,onChange:e=>{var s;x(s=e.target.value),s?a({search:s}):i()},className:"pr-10"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"وضعیت سفارش"}),(0,s.jsxs)(l.Select,{value:h,onValueChange:e=>p(e),children:[(0,s.jsx)(l.SelectTrigger,{children:(0,s.jsx)(l.SelectValue,{placeholder:"همه وضعیت‌ها"})}),(0,s.jsxs)(l.SelectContent,{children:[(0,s.jsx)(l.SelectItem,{value:"all",children:"همه وضعیت‌ها"}),(0,s.jsx)(l.SelectItem,{value:"pending",children:"در انتظار"}),(0,s.jsx)(l.SelectItem,{value:"processing",children:"در حال پردازش"}),(0,s.jsx)(l.SelectItem,{value:"shipped",children:"ارسال شده"}),(0,s.jsx)(l.SelectItem,{value:"delivered",children:"تحویل داده شده"}),(0,s.jsx)(l.SelectItem,{value:"cancelled",children:"لغو شده"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"وضعیت پرداخت"}),(0,s.jsxs)(l.Select,{value:g,onValueChange:e=>N(e),children:[(0,s.jsx)(l.SelectTrigger,{children:(0,s.jsx)(l.SelectValue,{placeholder:"همه وضعیت‌ها"})}),(0,s.jsxs)(l.SelectContent,{children:[(0,s.jsx)(l.SelectItem,{value:"all",children:"همه وضعیت‌ها"}),(0,s.jsx)(l.SelectItem,{value:"pending",children:"در انتظار پرداخت"}),(0,s.jsx)(l.SelectItem,{value:"paid",children:"پرداخت شده"}),(0,s.jsx)(l.SelectItem,{value:"failed",children:"پرداخت ناموفق"}),(0,s.jsx)(l.SelectItem,{value:"refunded",children:"بازگشت وجه"})]})]})]})]}),(u||"all"!==h||"all"!==g)&&(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>{x(""),p("all"),N("all"),i()},children:[(0,s.jsx)(R.Filter,{className:"ml-2 h-4 w-4"}),"پاک کردن فیلترها"]})})]})]}),(0,s.jsx)(M.CardContent,{children:m?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)(E.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"در حال بارگذاری سفارش‌ها..."})]}):0===w.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)(d.Package,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"هیچ سفارشی یافت نشد"})]}):(0,s.jsx)(k,{orders:w})})]})})}e.s(["default",()=>z],76664)}]);
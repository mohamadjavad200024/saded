(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,93226,e=>{"use strict";var t=e.i(6344),r=e.i(79473);let s=(0,t.create)()((0,r.persist)((e,t)=>({user:null,isAuthenticated:!1,register:async(t,r,s)=>{let a=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,phone:r,password:s})}),d=await a.json();if(!d.success){let e=d.error||d.message||"خطا در ثبت‌نام";throw console.error("Register API error:",{status:a.status,statusText:a.statusText,result:d,body:{name:t,phone:"***",password:"***"}}),Error(e)}let i={id:d.data.user.id,name:d.data.user.name,phone:d.data.user.phone,role:d.data.user.role||"user",createdAt:d.data.user.createdAt};e({user:i,isAuthenticated:!0}),localStorage.setItem("saded_user_id",i.id),localStorage.setItem("saded_user_role",i.role||"user")},login:async(t,r)=>{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:t,password:r})}),a=await s.json();if(!a.success)return console.error("Login error:",a.error||a.message),!1;let d={id:a.data.user.id,name:a.data.user.name,phone:a.data.user.phone,role:a.data.user.role||"user",createdAt:a.data.user.createdAt};return e({user:d,isAuthenticated:!0}),localStorage.setItem("saded_user_id",d.id),localStorage.setItem("saded_user_role",d.role||"user"),!0},logout:()=>{e({user:null,isAuthenticated:!1}),localStorage.removeItem("saded_user_id"),localStorage.removeItem("saded_user_role")},updateUser:r=>{let{user:s}=t();s&&e({user:{...s,...r}})},loadUser:async t=>{try{let r=await fetch(`/api/auth/me?userId=${t}`),s=await r.json();if(s.success&&s.data.user){let t={id:s.data.user.id,name:s.data.user.name,phone:s.data.user.phone,role:s.data.user.role||"user",createdAt:s.data.user.createdAt};e({user:t,isAuthenticated:!0}),localStorage.setItem("saded_user_id",t.id),localStorage.setItem("saded_user_role",t.role||"user")}}catch(e){console.error("Error loading user:",e)}}}),{name:"saded_auth",storage:(0,r.createJSONStorage)(()=>localStorage),partialize:e=>({user:e.user,isAuthenticated:e.isAuthenticated})}));e.s(["useAuthStore",0,s])},70065,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(47163);let a=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("rounded-lg border-[0.25px] border-border/3 bg-card text-card-foreground shadow-sm",e),...r}));a.displayName="Card";let d=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...r}));d.displayName="CardHeader";let i=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("h3",{ref:a,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r}));i.displayName="CardTitle";let l=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("p",{ref:a,className:(0,s.cn)("text-sm text-muted-foreground",e),...r}));l.displayName="CardDescription";let n=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("p-6 pt-0",e),...r}));n.displayName="CardContent",r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("flex items-center p-6 pt-0",e),...r})).displayName="CardFooter",e.s(["Card",()=>a,"CardContent",()=>n,"CardDescription",()=>l,"CardHeader",()=>d,"CardTitle",()=>i])},20682,e=>{"use strict";var t=e.i(71645);let r=0,s=new Map,a=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),l({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},d=[],i={toasts:[]};function l(e){i=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?a(r):e.toasts.forEach(e=>{a(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(i,e),d.forEach(e=>{e(i)})}function n({...e}){let t=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>l({type:"DISMISS_TOAST",toastId:t});return l({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>l({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function o(){let[e,r]=t.useState(i);return t.useEffect(()=>(d.push(r),()=>{let e=d.indexOf(r);e>-1&&d.splice(e,1)}),[e]),{...e,toast:n,dismiss:e=>l({type:"DISMISS_TOAST",toastId:e})}}e.s(["useToast",()=>o])},31278,e=>{"use strict";let t=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},60366,e=>{"use strict";var t=e.i(6344),r=e.i(73493);let s={},a=(0,t.create)((t,a)=>({orders:[],filters:s,isLoading:!1,setOrders:e=>t({orders:e}),addOrder:e=>t(t=>{let r=t.orders.findIndex(t=>t.id===e.id);if(r>=0){let s=[...t.orders];return s[r]=e,{orders:s}}return{orders:[...t.orders,e]}}),updateOrder:(e,r)=>t(t=>{let s=t.orders.findIndex(t=>t.id===e);if(s>=0){let e=[...t.orders];return e[s]={...e[s],...r},{orders:e}}return t}),updateOrderStatus:(e,r)=>t(t=>({orders:t.orders.map(t=>t.id===e?{...t,status:r,updatedAt:new Date}:t)})),updatePaymentStatus:(e,r)=>t(t=>({orders:t.orders.map(t=>t.id===e?{...t,paymentStatus:r,updatedAt:new Date}:t)})),deleteOrder:e=>t(t=>({orders:t.orders.filter(t=>t.id!==e)})),getOrder:e=>a().orders.find(t=>t.id===e),setFilters:e=>t(t=>({filters:{...t.filters,...e}})),clearFilters:()=>t({filters:s}),loadOrdersFromDB:async()=>{t({isLoading:!0});try{let s=new AbortController,a=setTimeout(()=>s.abort(),15e3),{fetchWithAuth:d}=await e.A(91079),i=await d("/api/orders",{signal:s.signal});if(clearTimeout(a),i.ok){let e;try{e=await i.json()}catch(e){r.logger.error("Error parsing orders response:",e),t({orders:[],isLoading:!1});return}if(e.success&&e.data)try{let s=e.data.map(e=>{let t=[],s={};try{t=Array.isArray(e.items)?e.items:"string"==typeof e.items?JSON.parse(e.items):[]}catch(s){r.logger.warn("Error parsing items for order:",e.id,s),t=[]}try{s="object"==typeof e.shippingAddress&&null!==e.shippingAddress?e.shippingAddress:"string"==typeof e.shippingAddress?JSON.parse(e.shippingAddress):{}}catch(t){r.logger.warn("Error parsing shippingAddress for order:",e.id,t),s={}}return{...e,items:t,shippingAddress:s,total:Number(e.total)||0,shippingCost:Number(e.shippingCost)||0,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)}});t({orders:s,isLoading:!1})}catch(e){r.logger.error("Error parsing orders data:",e),t({orders:[],isLoading:!1})}else t({orders:[],isLoading:!1})}else r.logger.error("Failed to load orders:",i.status),t({orders:[],isLoading:!1})}catch(e){e instanceof Error&&"AbortError"!==e.name&&r.logger.error("Error loading orders from DB:",e),t({orders:[],isLoading:!1})}}}));e.s(["useOrderStore",0,a])},71689,e=>{"use strict";let t=(0,e.i(75254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},95468,e=>{"use strict";let t=(0,e.i(75254).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},73884,e=>{"use strict";let t=(0,e.i(75254).default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],73884)},61659,e=>{"use strict";let t=(0,e.i(75254).default)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);e.s(["CreditCard",()=>t],61659)},37496,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(18566),a=e.i(93226),d=e.i(31278);function i({children:e,requireAuth:i=!0,requireAdmin:l=!1}){let n=(0,s.useRouter)(),{isAuthenticated:o,user:c}=(0,a.useAuthStore)();return((0,r.useEffect)(()=>{i&&!o?n.push("/auth?redirect="+encodeURIComponent(window.location.pathname)):l&&(!o||c?.role!=="admin")&&n.push("/")},[o,c,i,l,n]),i&&!o)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)(d.Loader2,{className:"h-8 w-8 animate-spin text-primary"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"در حال بررسی دسترسی..."})]})}):l&&(!o||c?.role!=="admin")?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"flex flex-col items-center gap-4",children:(0,t.jsx)("p",{className:"text-destructive",children:"شما دسترسی به این بخش را ندارید"})})}):(0,t.jsx)(t.Fragment,{children:e})}e.s(["ProtectedRoute",()=>i])},27426,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(60366),a=e.i(70065),d=e.i(67881),i=e.i(94179),l=e.i(88844),n=e.i(3116),o=e.i(95468),c=e.i(73884),m=e.i(71689),u=e.i(61659),h=e.i(22016),p=e.i(18566),x=e.i(20682),f=e.i(37496);function g(){let{orders:e}=(0,s.useOrderStore)(),f=(0,p.useRouter)(),{toast:g}=(0,x.useToast)(),j=(0,r.useMemo)(()=>{let t=e.filter(e=>"pending"===e.paymentStatus);return{pending:t,paid:e.filter(e=>"paid"===e.paymentStatus),failed:e.filter(e=>"failed"===e.paymentStatus)}},[e]),N=async e=>{try{let t=localStorage.getItem("checkoutData"),r=localStorage.getItem("pendingOrder");if(!t&&!r)return void g({title:"خطا",description:"اطلاعات سفارش یافت نشد. لطفاً سفارش جدیدی ثبت کنید.",variant:"destructive"});if(r){let t=JSON.parse(r),s=t.total,a=await fetch("/api/payment/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:s,description:`سفارش ${e.items.length} محصول - ${e.orderNumber}`,callbackUrl:`${window.location.origin}/payment/verify`,mobile:e.customerPhone,email:e.customerEmail})}),d=await a.json();if(d.success&&d.paymentUrl){let e={...t,authority:d.authority};localStorage.setItem("pendingOrder",JSON.stringify(e)),window.location.href=d.paymentUrl}else g({title:"خطا",description:d.error||"خطا در اتصال به درگاه پرداخت",variant:"destructive"})}else f.push("/checkout")}catch(e){console.error("Continue payment error:",e),g({title:"خطا",description:"خطایی در پردازش درخواست رخ داد",variant:"destructive"})}};return(0,t.jsx)("div",{className:"container mx-auto px-4 py-6 sm:py-8 md:py-12",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,t.jsx)(h.default,{href:"/",children:(0,t.jsx)(d.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(m.ArrowLeft,{className:"h-5 w-5"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold",children:"سفارش‌های من"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"مدیریت و پیگیری سفارش‌های خود"})]})]}),j.pending.length>0&&(0,t.jsxs)(a.Card,{className:"mb-6 border-yellow-200 dark:border-yellow-800",children:[(0,t.jsx)(a.CardHeader,{className:"bg-yellow-50 dark:bg-yellow-950/20",children:(0,t.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Clock,{className:"h-5 w-5 text-yellow-600"}),"سفارش‌های در انتظار پرداخت (",j.pending.length,")"]})}),(0,t.jsx)(a.CardContent,{className:"pt-6",children:(0,t.jsx)("div",{className:"space-y-4",children:j.pending.map(e=>(0,t.jsx)(a.Card,{className:"border-l-4 border-l-yellow-500",children:(0,t.jsx)(a.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(l.Package,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-semibold",children:["شماره سفارش: ",e.orderNumber]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"مبلغ کل:"}),(0,t.jsxs)("span",{className:"font-bold mr-2",children:[(e.total+e.shippingCost).toLocaleString("fa-IR")," تومان"]})]}),(0,t.jsx)(i.Badge,{variant:"outline",className:"bg-yellow-100 text-yellow-800 border-yellow-300",children:"در انتظار پرداخت"})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(d.Button,{onClick:()=>N(e),className:"flex-1 sm:flex-none",children:[(0,t.jsx)(u.CreditCard,{className:"ml-2 h-4 w-4"}),"ادامه پرداخت"]}),(0,t.jsx)(h.default,{href:`/order/track?orderNumber=${e.orderNumber}`,children:(0,t.jsxs)(d.Button,{variant:"outline",children:[(0,t.jsx)(l.Package,{className:"ml-2 h-4 w-4"}),"جزئیات"]})})]})]})})},e.id))})})]}),j.paid.length>0&&(0,t.jsxs)(a.Card,{className:"mb-6",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(o.CheckCircle2,{className:"h-5 w-5 text-green-600"}),"سفارش‌های پرداخت شده (",j.paid.length,")"]})}),(0,t.jsx)(a.CardContent,{className:"pt-6",children:(0,t.jsx)("div",{className:"space-y-4",children:j.paid.map(e=>(0,t.jsx)(a.Card,{className:"border-l-4 border-l-green-500",children:(0,t.jsx)(a.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(l.Package,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-semibold",children:["شماره سفارش: ",e.orderNumber]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric"})})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"مبلغ کل:"}),(0,t.jsxs)("span",{className:"font-bold mr-2",children:[(e.total+e.shippingCost).toLocaleString("fa-IR")," تومان"]})]}),(0,t.jsx)(i.Badge,{className:"bg-green-100 text-green-800",children:"پرداخت شده"}),(0,t.jsxs)(i.Badge,{variant:"outline",children:["pending"===e.status&&"در انتظار پردازش","processing"===e.status&&"در حال پردازش","shipped"===e.status&&"ارسال شده","delivered"===e.status&&"تحویل داده شده"]})]})]}),(0,t.jsx)(h.default,{href:`/order/track?orderNumber=${e.orderNumber}`,children:(0,t.jsxs)(d.Button,{variant:"outline",children:[(0,t.jsx)(l.Package,{className:"ml-2 h-4 w-4"}),"پیگیری سفارش"]})})]})})},e.id))})})]}),j.failed.length>0&&(0,t.jsxs)(a.Card,{className:"mb-6",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(c.XCircle,{className:"h-5 w-5 text-red-600"}),"سفارش‌های ناموفق (",j.failed.length,")"]})}),(0,t.jsx)(a.CardContent,{className:"pt-6",children:(0,t.jsx)("div",{className:"space-y-4",children:j.failed.map(e=>(0,t.jsx)(a.Card,{className:"border-l-4 border-l-red-500",children:(0,t.jsx)(a.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(l.Package,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-semibold",children:["شماره سفارش: ",e.orderNumber]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString("fa-IR")})]})]}),(0,t.jsx)(i.Badge,{variant:"destructive",className:"mt-2",children:"پرداخت ناموفق"})]}),(0,t.jsxs)(d.Button,{onClick:()=>N(e),variant:"outline",children:[(0,t.jsx)(u.CreditCard,{className:"ml-2 h-4 w-4"}),"تلاش مجدد"]})]})})},e.id))})})]}),0===e.length&&(0,t.jsx)(a.Card,{children:(0,t.jsx)(a.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,t.jsx)(l.Package,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-bold mb-2",children:"شما هنوز سفارشی ثبت نکرده‌اید"}),(0,t.jsx)("p",{className:"text-muted-foreground text-center mb-6",children:"برای ثبت سفارش جدید، به صفحه محصولات بروید"}),(0,t.jsx)(h.default,{href:"/products",children:(0,t.jsx)(d.Button,{size:"lg",children:"مشاهده محصولات"})})]})})})]})})}function j(){return(0,t.jsx)(f.ProtectedRoute,{requireAuth:!0,children:(0,t.jsx)(g,{})})}e.s(["default",()=>j])},91079,e=>{e.v(t=>Promise.all(["static/chunks/617555628b6cfdbb.js"].map(t=>e.l(t))).then(()=>t(40171)))}]);
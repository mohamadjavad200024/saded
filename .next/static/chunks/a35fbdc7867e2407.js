(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99682,e=>{"use strict";var t=e.i(71645);function r(e){let r=t.useRef({value:e,previous:e});return t.useMemo(()=>(r.current.value!==e&&(r.current.previous=r.current.value,r.current.value=e),r.current.previous),[e])}e.s(["usePrevious",()=>r])},19036,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(81140),i=e.i(20783),a=e.i(30030),n=e.i(69340),o=e.i(99682),c=e.i(35804),d=e.i(48425),l="Switch",[u,p]=(0,a.createContextScope)(l),[m,h]=u(l),f=r.forwardRef((e,a)=>{let{__scopeSwitch:o,name:c,checked:u,defaultChecked:p,required:h,disabled:f,value:x="on",onCheckedChange:b,form:j,...y}=e,[w,C]=r.useState(null),k=(0,i.useComposedRefs)(a,e=>C(e)),N=r.useRef(!1),S=!w||j||!!w.closest("form"),[T,A]=(0,n.useControllableState)({prop:u,defaultProp:p??!1,onChange:b,caller:l});return(0,t.jsxs)(m,{scope:o,checked:T,disabled:f,children:[(0,t.jsx)(d.Primitive.button,{type:"button",role:"switch","aria-checked":T,"aria-required":h,"data-state":v(T),"data-disabled":f?"":void 0,disabled:f,value:x,...y,ref:k,onClick:(0,s.composeEventHandlers)(e.onClick,e=>{A(e=>!e),S&&(N.current=e.isPropagationStopped(),N.current||e.stopPropagation())})}),S&&(0,t.jsx)(g,{control:w,bubbles:!N.current,name:c,value:x,checked:T,required:h,disabled:f,form:j,style:{transform:"translateX(-100%)"}})]})});f.displayName=l;var x="SwitchThumb",b=r.forwardRef((e,r)=>{let{__scopeSwitch:s,...i}=e,a=h(x,s);return(0,t.jsx)(d.Primitive.span,{"data-state":v(a.checked),"data-disabled":a.disabled?"":void 0,...i,ref:r})});b.displayName=x;var g=r.forwardRef(({__scopeSwitch:e,control:s,checked:a,bubbles:n=!0,...d},l)=>{let u=r.useRef(null),p=(0,i.useComposedRefs)(u,l),m=(0,o.usePrevious)(a),h=(0,c.useSize)(s);return r.useEffect(()=>{let e=u.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(m!==a&&t){let r=new Event("click",{bubbles:n});t.call(e,a),e.dispatchEvent(r)}},[m,a,n]),(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...d,tabIndex:-1,ref:p,style:{...d.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function v(e){return e?"checked":"unchecked"}g.displayName="SwitchBubbleInput";var j=e.i(47163);let y=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)(f,{className:(0,j.cn)("peer inline-flex h-6 w-12 shrink-0 cursor-pointer items-center rounded-full border-2 transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-green-500 data-[state=checked]:border-green-500 data-[state=unchecked]:bg-muted data-[state=unchecked]:border-transparent px-0.5",e),...r,ref:s,children:(0,t.jsx)(b,{className:(0,j.cn)("pointer-events-none block h-5 w-5 rounded-full shadow-lg ring-0 transition-all duration-200 ease-in-out data-[state=checked]:-translate-x-6 data-[state=unchecked]:translate-x-0 data-[state=checked]:bg-primary-foreground data-[state=unchecked]:bg-foreground")})}));y.displayName=f.displayName,e.s(["Switch",()=>y],19036)},44745,e=>{"use strict";var t=e.i(43476),r=e.i(53145),s=e.i(94814),i=e.i(65638),a=e.i(67881),n=e.i(23750),o=e.i(10708),c=e.i(84762),d=e.i(19036),l=e.i(70065),u=e.i(17513),p=e.i(20682),m=e.i(18566),h=e.i(31278),f=e.i(88844),x=e.i(12598);let b=i.object({name:i.string().min(1,"نام دسته‌بندی الزامی است"),description:i.string().optional(),isActive:i.boolean()});function g({category:e,onSuccess:i}){let g=(0,m.useRouter)(),{addCategory:v,updateCategory:j,loadCategoriesFromDB:y}=(0,u.useCategoryStore)(),{toast:w}=(0,p.useToast)(),C=(0,x.useQueryClient)(),{register:k,handleSubmit:N,formState:{errors:S,isSubmitting:T},setValue:A,watch:P}=(0,r.useForm)({resolver:(0,s.zodResolver)(b),defaultValues:e?{name:e.name,description:e.description||"",isActive:e.isActive}:{name:"",description:"",isActive:!0}}),R=P("isActive"),E=async t=>{try{if(e){let r=await fetch(`/api/categories/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||e.message||"خطا در به‌روزرسانی دسته‌بندی")}let s=await r.json();j(s.data),C.invalidateQueries({queryKey:["categories"]}),await y(),w({title:"موفق",description:"دسته‌بندی با موفقیت به‌روزرسانی شد"})}else{let e=await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let t=await e.json().catch(()=>({})),r=t.error||t.message||"خطا در ایجاد دسته‌بندی";if("DATABASE_NOT_AVAILABLE"===t.code)throw Error(`${r}

برای رفع این مشکل:
1. اطمینان حاصل کنید که PostgreSQL نصب و در حال اجرا است
2. بررسی کنید که متغیرهای محیطی (DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PASSWORD) به درستی تنظیم شده‌اند
3. دستور "pnpm setup-postgres-retry" را برای راه‌اندازی دیتابیس اجرا کنید`);throw Error(r)}let r=await e.json();v(r.data),C.invalidateQueries({queryKey:["categories"]}),await y(),w({title:"موفق",description:"دسته‌بندی با موفقیت اضافه شد"})}C.invalidateQueries({queryKey:["categories"]}),i?.(),g.push("/admin/categories")}catch(e){w({title:"خطا",description:e instanceof Error?e.message:"خطایی رخ داد. لطفاً دوباره تلاش کنید.",variant:"destructive"})}};return(0,t.jsxs)("form",{onSubmit:N(E),className:"space-y-6",children:[(0,t.jsxs)(l.Card,{className:"shadow-sm",children:[(0,t.jsx)(l.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.Package,{className:"h-5 w-5 text-primary"}),"اطلاعات دسته‌بندی"]})}),(0,t.jsxs)(l.CardContent,{className:"space-y-4 pt-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"name",children:"نام دسته‌بندی *"}),(0,t.jsx)(n.Input,{id:"name",...k("name"),placeholder:"مثال: تعلیق و ترمز"}),S.name&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:S.name.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"description",children:"توضیحات"}),(0,t.jsx)(c.Textarea,{id:"description",...k("description"),placeholder:"توضیحات اختیاری درباره این دسته‌بندی...",rows:3})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-border/30",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)(o.Label,{children:"فعال"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"دسته‌بندی فعال است و در لیست‌ها نمایش داده می‌شود"})]}),(0,t.jsx)(d.Switch,{checked:R,onCheckedChange:e=>A("isActive",e)})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4 pt-4 border-t border-border/30",children:[(0,t.jsx)(a.Button,{type:"button",variant:"outline",onClick:()=>g.back(),size:"lg",children:"انصراف"}),(0,t.jsx)(a.Button,{type:"submit",disabled:T,size:"lg",className:"min-w-[140px]",children:T?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Loader2,{className:"ml-2 h-4 w-4 animate-spin"}),"در حال ذخیره..."]}):e?"ذخیره تغییرات":"افزودن دسته‌بندی"})]})]})}e.s(["CategoryForm",()=>g])},78267,e=>{"use strict";var t=e.i(43476),r=e.i(44745),s=e.i(70065),i=e.i(17513),a=e.i(71645);function n(){let{loadCategoriesFromDB:e}=(0,i.useCategoryStore)();return(0,a.useEffect)(()=>{e()},[e]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent",children:"افزودن دسته‌بندی جدید"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"اطلاعات دسته‌بندی جدید را وارد کنید"})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"فرم دسته‌بندی"})}),(0,t.jsx)(s.CardContent,{children:(0,t.jsx)(r.CategoryForm,{})})]})]})}e.s(["default",()=>n])}]);
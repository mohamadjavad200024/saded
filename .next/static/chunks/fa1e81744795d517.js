(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,41867,e=>{"use strict";var t=e.i(6344),s=e.i(36361),r=e.i(17513),a=e.i(60366),i=e.i(93226),n=e.i(73493);let l={siteName:"ساد",siteDescription:"فروشگاه آنلاین قطعات خودرو وارداتی",maintenanceMode:!1,allowRegistration:!0,emailNotifications:!0,lowStockThreshold:10,itemsPerPage:10,showNotifications:!0,theme:"system"},o={totalProducts:0,activeProducts:0,totalStock:0,lowStockProducts:0,totalCategories:0,activeCategories:0,totalOrders:0,pendingOrders:0,totalRevenue:0,averagePrice:0},c=async()=>{try{let e=await fetch("/api/site-settings",{credentials:"include"});if(e.ok){let t=await e.json();if(t.success&&t.data)return{...l,siteName:t.data.siteName||l.siteName,siteDescription:t.data.siteDescription||l.siteDescription,logoUrl:t.data.logoUrl||l.logoUrl,maintenanceMode:t.data.maintenanceMode??l.maintenanceMode,allowRegistration:t.data.allowRegistration??l.allowRegistration,emailNotifications:t.data.emailNotifications??l.emailNotifications,lowStockThreshold:t.data.lowStockThreshold??l.lowStockThreshold,itemsPerPage:t.data.itemsPerPage??l.itemsPerPage,showNotifications:t.data.showNotifications??l.showNotifications,theme:t.data.theme||l.theme}}}catch(e){console.error("Error loading admin settings from API:",e)}return l},d=(0,t.create)((e,t)=>({stats:null,isLoading:!1,settings:l,refreshStats:async()=>{e({isLoading:!0});try{let i=s.useProductStore.getState(),n=r.useCategoryStore.getState(),l=a.useOrderStore.getState(),o=i.products,c=n.categories,d=l.orders,u=o.filter(e=>e.enabled),m=u.reduce((e,t)=>e+(t.price||0),0),h=u.length>0?m/u.length:0,g=d.length,f=d.filter(e=>"pending"===e.status||"pending"===e.paymentStatus).length,p=d.filter(e=>"paid"===e.paymentStatus).reduce((e,t)=>e+(t.total+t.shippingCost),0),x={totalProducts:o.length,activeProducts:u.length,totalStock:o.reduce((e,t)=>e+t.stockCount,0),lowStockProducts:o.filter(e=>e.stockCount<t().settings.lowStockThreshold).length,totalCategories:c.length,activeCategories:c.filter(e=>e.isActive&&e.enabled).length,totalOrders:g,pendingOrders:f,totalRevenue:p,averagePrice:Math.round(h)};e({stats:x,isLoading:!1})}catch(t){n.logger.error("Error refreshing stats:",t),e({stats:o,isLoading:!1})}},updateSettings:(s,r=!0)=>{let a={...t().settings,...s};if(e({settings:a}),r&&1){let e=document.cookie;fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"admin-store.ts:164",message:"Client: About to send PUT request",data:{hasCookies:!!e,cookieCount:(e.match(/;/g)||[]).length+1,hasSadedSession:e.includes("saded_session"),saveToAPI:r},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(()=>{});let t=i.useAuthStore.getState(),s={"Content-Type":"application/json"};t.user?.id&&(s["x-user-id"]=t.user.id),fetch("/api/site-settings",{method:"PUT",credentials:"include",headers:s,body:JSON.stringify(a)}).then(e=>{if(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"admin-store.ts:175",message:"Client: PUT response received",data:{status:e.status,statusText:e.statusText,ok:e.ok},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{}),!e.ok)return e.json().then(t=>{throw fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"admin-store.ts:179",message:"Client: PUT error response",data:{status:e.status,error:t},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"H"})}).catch(()=>{}),Error(t.error||"Request failed")});try{localStorage.setItem("admin_site_settings",JSON.stringify(a))}catch(e){console.warn("Failed to save settings to localStorage:",e)}window.dispatchEvent(new Event("settingsUpdated"))}).catch(e=>{fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"admin-store.ts:186",message:"Client: PUT request failed",data:{error:e?.message||"unknown"},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"I"})}).catch(()=>{}),console.error("Error saving admin settings to API:",e)})}else r||fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"admin-store.ts:206",message:"Client: updateSettings called with saveToAPI=false (loading from API)",data:{saveToAPI:r},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"O"})}).catch(()=>{})},resetSettings:()=>{e({settings:l})}}));c().then(e=>{d.getState().updateSettings(e,!1);try{localStorage.setItem("admin_site_settings",JSON.stringify(e))}catch(e){console.warn("Failed to save settings to localStorage:",e)}}),window.addEventListener("settingsUpdated",()=>{c().then(e=>{d.getState().updateSettings(e,!1)})}),e.s(["useAdminStore",0,d])},48106,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(4967),a=e.i(88844),i=e.i(36361);function n({src:e,alt:n,fill:l=!1,width:o,height:c,className:d="",priority:u=!1,loading:m="eager",sizes:h,onError:g,placeholder:f="empty",blurDataURL:p,productId:x}){let b=(0,i.useProductStore)(),j=(0,s.useMemo)(()=>(0,r.getPlaceholderImage)(o||600,c||600),[o,c]),y=(0,s.useCallback)(()=>{if(e&&"string"==typeof e&&""!==e.trim()){let t=(0,r.normalizeImageUrl)(e.trim());if(t&&(0,r.validateImageUrl)(t))return t}if(x){let e=b.getProduct(x);if(e?.images&&Array.isArray(e.images)&&e.images.length>0){for(let t of e.images)if(t&&"string"==typeof t&&""!==t.trim()){let e=(0,r.normalizeImageUrl)(t.trim());if(e&&(0,r.validateImageUrl)(e))return e}}}return j},[e,x,j,b]),v=(0,s.useMemo)(()=>y(),[y]),[w,C]=(0,s.useState)(v),[N,S]=(0,s.useState)(!0),[T,k]=(0,s.useState)(!1),[I,P]=(0,s.useState)(!m||"eager"===m),E=(0,s.useRef)(null),R=(0,s.useRef)(0),D=(0,s.useRef)(null),O=(0,s.useRef)(null);(0,s.useEffect)(()=>{if("lazy"===m&&"IntersectionObserver"in window){let e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(P(!0),e.disconnect())})},{rootMargin:"50px",threshold:.01});return E.current&&(e.observe(E.current),O.current=e),()=>{O.current&&O.current.disconnect()}}P(!0)},[m]),(0,s.useEffect)(()=>{u&&v&&v!==j&&I&&(0,r.preloadImage)(v).catch(()=>{})},[u,v,j,I]),(0,s.useEffect)(()=>{v!==w&&(C(v),S(!0),k(!1),R.current=0,D.current&&clearTimeout(D.current))},[v,w]),(0,s.useEffect)(()=>{if(N&&w&&w!==j&&I)return D.current=setTimeout(()=>{N&&H()},3e4),()=>{D.current&&clearTimeout(D.current)}},[N,w,j,I]);let M=(0,s.useCallback)(()=>{D.current&&clearTimeout(D.current),S(!1),k(!1),R.current=0},[]),H=(0,s.useCallback)(()=>{D.current&&clearTimeout(D.current);let e=w||v;if(e===j){S(!1),k(!0),g?.();return}if(R.current<3){R.current+=1;let t=1e3*Math.pow(2,R.current-1),s=e;if((0,r.needsCacheBusting)(e))s=(0,r.addCacheBusting)(e);else{let t=e.includes("?")?"&":"?";s=`${e.split("&_t=")[0].split("?_t=")[0]}${t}_retry=${R.current}&_t=${Date.now()}`}D.current=setTimeout(()=>{E.current&&(E.current.src="",setTimeout(()=>{E.current&&(E.current.src=s)},100))},t)}else{if(S(!1),k(!0),x){let t=b.getProduct(x);if(t?.images&&Array.isArray(t.images)&&t.images.length>0){let s=t.images.find(t=>{if(!t||"string"!=typeof t||""===t.trim())return!1;let s=(0,r.normalizeImageUrl)(t.trim());return s&&(0,r.validateImageUrl)(s)&&s!==e&&s!==w});if(s){let e=(0,r.normalizeImageUrl)(s.trim());if(e&&(0,r.validateImageUrl)(e)){R.current=0,C(e),S(!0),k(!1);return}}}}C(j),g?.()}},[w,v,j,x,b,g]);(0,s.useEffect)(()=>()=>{D.current&&clearTimeout(D.current),O.current&&O.current.disconnect()},[]);let L=(0,s.useMemo)(()=>w&&""!==w.trim()?w:j,[w,j]),U={src:(0,s.useMemo)(()=>(0,r.validateImageUrl)(L),[L])?L:j,alt:n,onLoad:M,onError:H,loading:I?m:"lazy",className:"object-cover w-full h-full",style:{objectFit:"cover"},fetchPriority:u?"high":"auto",decoding:"async",crossOrigin:L.startsWith("http")&&!L.includes(window.location.origin)?"anonymous":void 0};return l?(0,t.jsxs)("div",{className:`relative ${d}`,style:{width:"100%",height:"100%"},children:[(0,t.jsx)("img",{...U,ref:E}),N&&!T&&(0,t.jsx)("div",{className:"absolute inset-0 bg-muted animate-pulse flex items-center justify-center z-10",children:(0,t.jsx)(a.Package,{className:"h-8 w-8 text-muted-foreground"})})]}):(0,t.jsxs)("div",{className:`relative ${d}`,style:{width:o,height:c},children:[(0,t.jsx)("img",{...U,ref:E}),N&&!T&&(0,t.jsx)("div",{className:"absolute inset-0 bg-muted animate-pulse flex items-center justify-center z-10",children:(0,t.jsx)(a.Package,{className:"h-8 w-8 text-muted-foreground"})})]})}e.s(["SafeImage",()=>n])},88511,e=>{"use strict";let t=(0,e.i(75254).default)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>t],88511)},47627,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(47163);let a=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:a,className:(0,r.cn)("w-full caption-bottom text-sm",e),...s})}));a.displayName="Table";let i=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)("thead",{ref:a,className:(0,r.cn)("[&_tr]:border-b border-border/30",e),...s}));i.displayName="TableHeader";let n=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)("tbody",{ref:a,className:(0,r.cn)("[&_tr:last-child]:border-0",e),...s}));n.displayName="TableBody",s.forwardRef(({className:e,...s},a)=>(0,t.jsx)("tfoot",{ref:a,className:(0,r.cn)("border-t border-border/30 bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...s})).displayName="TableFooter";let l=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)("tr",{ref:a,className:(0,r.cn)("border-b border-border/30 transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...s}));l.displayName="TableRow";let o=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)("th",{ref:a,className:(0,r.cn)("h-12 px-4 text-right align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...s}));o.displayName="TableHead";let c=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)("td",{ref:a,className:(0,r.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...s}));c.displayName="TableCell",s.forwardRef(({className:e,...s},a)=>(0,t.jsx)("caption",{ref:a,className:(0,r.cn)("mt-4 text-sm text-muted-foreground",e),...s})).displayName="TableCaption",e.s(["Table",()=>a,"TableBody",()=>n,"TableCell",()=>c,"TableHead",()=>o,"TableHeader",()=>i,"TableRow",()=>l])},41071,e=>{"use strict";let t=(0,e.i(75254).default)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>t],41071)},97548,e=>{"use strict";let t=(0,e.i(75254).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["Filter",()=>t],97548)},40160,e=>{"use strict";let t=(0,e.i(75254).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>t],40160)},25959,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(20783),a=e.i(30030),i=e.i(81140),n=e.i(69340),l=e.i(99682),o=e.i(35804),c=e.i(96626),d=e.i(48425),u="Checkbox",[m,h]=(0,a.createContextScope)(u),[g,f]=m(u);function p(e){let{__scopeCheckbox:r,checked:a,children:i,defaultChecked:l,disabled:o,form:c,name:d,onCheckedChange:m,required:h,value:f="on",internal_do_not_use_render:p}=e,[x,b]=(0,n.useControllableState)({prop:a,defaultProp:l??!1,onChange:m,caller:u}),[j,y]=s.useState(null),[v,w]=s.useState(null),C=s.useRef(!1),S=!j||!!c||!!j.closest("form"),T={checked:x,disabled:o,setChecked:b,control:j,setControl:y,name:d,form:c,value:f,hasConsumerStoppedPropagationRef:C,required:h,defaultChecked:!N(l)&&l,isFormControl:S,bubbleInput:v,setBubbleInput:w};return(0,t.jsx)(g,{scope:r,...T,children:"function"==typeof p?p(T):i})}var x="CheckboxTrigger",b=s.forwardRef(({__scopeCheckbox:e,onKeyDown:a,onClick:n,...l},o)=>{let{control:c,value:u,disabled:m,checked:h,required:g,setControl:p,setChecked:b,hasConsumerStoppedPropagationRef:j,isFormControl:y,bubbleInput:v}=f(x,e),w=(0,r.useComposedRefs)(o,p),C=s.useRef(h);return s.useEffect(()=>{let e=c?.form;if(e){let t=()=>b(C.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[c,b]),(0,t.jsx)(d.Primitive.button,{type:"button",role:"checkbox","aria-checked":N(h)?"mixed":h,"aria-required":g,"data-state":S(h),"data-disabled":m?"":void 0,disabled:m,value:u,...l,ref:w,onKeyDown:(0,i.composeEventHandlers)(a,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,i.composeEventHandlers)(n,e=>{b(e=>!!N(e)||!e),v&&y&&(j.current=e.isPropagationStopped(),j.current||e.stopPropagation())})})});b.displayName=x;var j=s.forwardRef((e,s)=>{let{__scopeCheckbox:r,name:a,checked:i,defaultChecked:n,required:l,disabled:o,value:c,onCheckedChange:d,form:u,...m}=e;return(0,t.jsx)(p,{__scopeCheckbox:r,checked:i,defaultChecked:n,disabled:o,required:l,onCheckedChange:d,name:a,form:u,value:c,internal_do_not_use_render:({isFormControl:e})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b,{...m,ref:s,__scopeCheckbox:r}),e&&(0,t.jsx)(C,{__scopeCheckbox:r})]})})});j.displayName=u;var y="CheckboxIndicator",v=s.forwardRef((e,s)=>{let{__scopeCheckbox:r,forceMount:a,...i}=e,n=f(y,r);return(0,t.jsx)(c.Presence,{present:a||N(n.checked)||!0===n.checked,children:(0,t.jsx)(d.Primitive.span,{"data-state":S(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:s,style:{pointerEvents:"none",...e.style}})})});v.displayName=y;var w="CheckboxBubbleInput",C=s.forwardRef(({__scopeCheckbox:e,...a},i)=>{let{control:n,hasConsumerStoppedPropagationRef:c,checked:u,defaultChecked:m,required:h,disabled:g,name:p,value:x,form:b,bubbleInput:j,setBubbleInput:y}=f(w,e),v=(0,r.useComposedRefs)(i,y),C=(0,l.usePrevious)(u),S=(0,o.useSize)(n);s.useEffect(()=>{if(!j)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!c.current;if(C!==u&&e){let s=new Event("click",{bubbles:t});j.indeterminate=N(u),e.call(j,!N(u)&&u),j.dispatchEvent(s)}},[j,C,u,c]);let T=s.useRef(!N(u)&&u);return(0,t.jsx)(d.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:m??T.current,required:h,disabled:g,name:p,value:x,form:b,...a,tabIndex:-1,ref:v,style:{...a.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function N(e){return"indeterminate"===e}function S(e){return N(e)?"indeterminate":e?"checked":"unchecked"}C.displayName=w;var T=e.i(43531),k=e.i(47163);let I=s.forwardRef(({className:e,...s},r)=>(0,t.jsx)(j,{ref:r,className:(0,k.cn)("peer h-4 w-4 shrink-0 rounded-sm border-[0.25px] border-primary/30 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:(0,t.jsx)(v,{className:(0,k.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(T.Check,{className:"h-4 w-4"})})}));I.displayName=j.displayName,e.s(["Checkbox",()=>I],25959)},48380,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(47167);var r=e.i(47627),a=e.i(67881),i=e.i(94179),n=e.i(25959),l=e.i(63415),o=e.i(41071),c=e.i(88511),d=e.i(27612),u=e.i(86536),m=e.i(77705),h=e.i(36361),g=e.i(20682),f=e.i(22016),p=e.i(48106),x=e.i(30374);function b({products:e,onRefresh:b}){let[j,y]=(0,s.useState)([]),[v,w]=(0,s.useState)(!1),[C,N]=(0,s.useState)(null),{deleteProduct:S,toggleProduct:T,deleteProducts:k,toggleProducts:I}=(0,h.useProductStore)(),{toast:P}=(0,g.useToast)(),E=async()=>{if(C)try{await S(C),P({title:"موفق",description:"محصول با موفقیت حذف شد"}),w(!1),N(null),b?.()}catch(e){P({title:"خطا",description:e instanceof Error?e.message:"خطا در حذف محصول",variant:"destructive"})}},R=async()=>{if(j.length>0)try{await k(j),P({title:"موفق",description:`${j.length} محصول حذف شد`}),y([]),b?.()}catch(e){P({title:"خطا",description:e instanceof Error?e.message:"خطا در حذف محصولات",variant:"destructive"})}},D=async e=>{try{await T(e),P({title:"موفق",description:"وضعیت محصول تغییر کرد"}),b?.()}catch(e){P({title:"خطا",description:e instanceof Error?e.message:"خطا در تغییر وضعیت محصول",variant:"destructive"})}},O=async e=>{if(j.length>0)try{await I(j,e),P({title:"موفق",description:`${j.length} محصول ${e?"فعال":"غیرفعال"} شد`}),y([]),b?.()}catch(e){P({title:"خطا",description:e instanceof Error?e.message:"خطا در تغییر وضعیت محصولات",variant:"destructive"})}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-4",children:[j.length>0&&(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:[j.length," محصول انتخاب شده"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(a.Button,{variant:"outline",size:"sm",onClick:()=>O(!0),children:[(0,t.jsx)(u.Eye,{className:"ml-2 h-4 w-4"}),"فعال کردن"]}),(0,t.jsxs)(a.Button,{variant:"outline",size:"sm",onClick:()=>O(!1),children:[(0,t.jsx)(m.EyeOff,{className:"ml-2 h-4 w-4"}),"غیرفعال کردن"]}),(0,t.jsxs)(a.Button,{variant:"destructive",size:"sm",onClick:R,children:[(0,t.jsx)(d.Trash2,{className:"ml-2 h-4 w-4"}),"حذف"]})]})]}),(0,t.jsx)("div",{className:"rounded-lg border border-border/30 shadow-sm overflow-hidden",children:(0,t.jsxs)(r.Table,{children:[(0,t.jsx)(r.TableHeader,{className:"bg-muted/50",children:(0,t.jsxs)(r.TableRow,{children:[(0,t.jsx)(r.TableHead,{className:"w-12",children:(0,t.jsx)(n.Checkbox,{checked:e.length>0&&j.length===e.length,onCheckedChange:t=>{t?y(e.map(e=>e.id)):y([])}})}),(0,t.jsx)(r.TableHead,{children:"تصویر"}),(0,t.jsx)(r.TableHead,{children:"نام"}),(0,t.jsx)(r.TableHead,{children:"برند"}),(0,t.jsx)(r.TableHead,{children:"دسته‌بندی"}),(0,t.jsx)(r.TableHead,{children:"قیمت"}),(0,t.jsx)(r.TableHead,{children:"موجودی"}),(0,t.jsx)(r.TableHead,{children:"وضعیت"}),(0,t.jsx)(r.TableHead,{className:"text-left",children:"عملیات"})]})}),(0,t.jsx)(r.TableBody,{children:0===e.length?(0,t.jsx)(r.TableRow,{children:(0,t.jsx)(r.TableCell,{colSpan:9,className:"text-center py-8",children:"محصولی یافت نشد"})}):e.map(e=>{let s;return(0,t.jsxs)(r.TableRow,{children:[(0,t.jsx)(r.TableCell,{children:(0,t.jsx)(n.Checkbox,{checked:j.includes(e.id),onCheckedChange:t=>{var s;return s=e.id,void(t?y([...j,s]):y(j.filter(e=>e!==s)))}})}),(0,t.jsx)(r.TableCell,{children:(0,t.jsx)("div",{className:"relative w-14 h-14 rounded-lg overflow-hidden border-2 border-border/30 shadow-sm group",children:e.images&&Array.isArray(e.images)&&e.images.length>0&&e.images[0]?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.SafeImage,{src:e.images[0],alt:e.name,fill:!0,className:"object-cover transition-transform group-hover:scale-110",productId:e.id,priority:!0,loading:"eager",onError:()=>{}}),e.images.length>1&&(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-xs px-1 py-0.5 text-center z-10",children:["+",e.images.length-1]})]}):(0,t.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-muted to-muted/50 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-xs text-muted-foreground font-medium",children:"بدون تصویر"})})})}),(0,t.jsx)(r.TableCell,{className:"font-medium",children:e.name}),(0,t.jsx)(r.TableCell,{children:e.brand}),(0,t.jsx)(r.TableCell,{children:e.category}),(0,t.jsxs)(r.TableCell,{children:[(s=e.price,new Intl.NumberFormat("fa-IR").format(s))," تومان"]}),(0,t.jsx)(r.TableCell,{children:(0,t.jsx)(i.Badge,{variant:e.stockCount<10?"warning":"success",children:e.stockCount})}),(0,t.jsx)(r.TableCell,{children:(0,t.jsx)(i.Badge,{variant:e.enabled?"success":"secondary",children:e.enabled?"فعال":"غیرفعال"})}),(0,t.jsx)(r.TableCell,{children:(0,t.jsxs)(l.DropdownMenu,{children:[(0,t.jsx)(l.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(a.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(o.MoreHorizontal,{className:"h-4 w-4"})})}),(0,t.jsxs)(l.DropdownMenuContent,{align:"end",children:[(0,t.jsx)(l.DropdownMenuLabel,{children:"عملیات"}),(0,t.jsx)(l.DropdownMenuSeparator,{}),(0,t.jsx)(l.DropdownMenuItem,{asChild:!0,children:(0,t.jsxs)(f.default,{href:`/admin/products/${e.id}`,children:[(0,t.jsx)(c.Edit,{className:"ml-2 h-4 w-4"}),"ویرایش"]})}),(0,t.jsx)(l.DropdownMenuItem,{onClick:()=>D(e.id),children:e.enabled?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.EyeOff,{className:"ml-2 h-4 w-4"}),"غیرفعال کردن"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Eye,{className:"ml-2 h-4 w-4"}),"فعال کردن"]})}),(0,t.jsx)(l.DropdownMenuSeparator,{}),(0,t.jsxs)(l.DropdownMenuItem,{className:"text-destructive",onClick:()=>{N(e.id),w(!0)},children:[(0,t.jsx)(d.Trash2,{className:"ml-2 h-4 w-4"}),"حذف"]})]})]})})]},e.id)})})]})})]}),(0,t.jsx)(x.Dialog,{open:v,onOpenChange:w,children:(0,t.jsxs)(x.DialogContent,{children:[(0,t.jsxs)(x.DialogHeader,{children:[(0,t.jsx)(x.DialogTitle,{children:"حذف محصول"}),(0,t.jsx)(x.DialogDescription,{children:"آیا از حذف این محصول اطمینان دارید؟ این عمل قابل بازگشت نیست."})]}),(0,t.jsxs)(x.DialogFooter,{children:[(0,t.jsx)(a.Button,{variant:"outline",onClick:()=>w(!1),children:"انصراف"}),(0,t.jsx)(a.Button,{variant:"destructive",onClick:E,children:"حذف"})]})]})})]})}var j=e.i(23750),y=e.i(70065),v=e.i(62870),w=e.i(7233),C=e.i(55436),N=e.i(40160),S=e.i(97548),T=e.i(41867),k=e.i(18566);function I(){let{products:e,setFilters:r,clearFilters:i,filters:n,loadProductsFromDB:l}=(0,h.useProductStore)(),{refreshStats:o}=(0,T.useAdminStore)(),c=(0,k.usePathname)(),[d,u]=(0,s.useState)(n.search||""),[m,g]=(0,s.useState)(n.categories?.[0]||"all"),[p,x]=(0,s.useState)("all"),[I,P]=(0,s.useState)(!0),[E,R]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{P(!0);try{await l(!0)}catch(e){console.error("Error loading products:",e)}finally{P(!1)}})()},[l,c]),(0,s.useEffect)(()=>{let e=()=>{l(!0)},t=()=>{l(!0)},s=e=>{("product-created"===e.key||"product-updated"===e.key)&&l(!0)};return window.addEventListener("product-created",e),window.addEventListener("product-updated",t),window.addEventListener("storage",s),()=>{window.removeEventListener("product-created",e),window.removeEventListener("product-updated",t),window.removeEventListener("storage",s)}},[l]),(0,s.useEffect)(()=>{o()},[o,e]);let D=(0,s.useMemo)(()=>{let t=e;if(t=t.filter(e=>{let t=e.name.toLowerCase();return!(t.includes("test")||t.includes("تست"))}),d){let e=d.toLowerCase();t=t.filter(t=>t.name.toLowerCase().includes(e)||t.brand?.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e))}return"all"!==m&&(t=t.filter(e=>e.category===m)),"active"===p?t=t.filter(e=>e.enabled):"inactive"===p&&(t=t.filter(e=>!e.enabled)),t},[e,d,m,p]),O=Array.from(new Set(e.map(e=>e.category).filter(e=>!!e)));return(0,t.jsxs)("div",{className:"space-y-6",children:[E&&(0,t.jsxs)(y.Card,{className:"shadow-sm",children:[(0,t.jsx)(y.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,t.jsx)(y.CardTitle,{children:"فیلترها و جستجو"})}),(0,t.jsxs)(y.CardContent,{children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"جستجو"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(C.Search,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(j.Input,{placeholder:"جستجو در محصولات...",value:d,onChange:e=>{var t;u(t=e.target.value),t?r({search:t}):i()},className:"pr-10"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"دسته‌بندی"}),(0,t.jsxs)(v.Select,{value:m,onValueChange:g,children:[(0,t.jsx)(v.SelectTrigger,{children:(0,t.jsx)(v.SelectValue,{placeholder:"همه دسته‌بندی‌ها"})}),(0,t.jsxs)(v.SelectContent,{children:[(0,t.jsx)(v.SelectItem,{value:"all",children:"همه دسته‌بندی‌ها"}),O.map(e=>(0,t.jsx)(v.SelectItem,{value:e,children:e},e))]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"وضعیت"}),(0,t.jsxs)(v.Select,{value:p,onValueChange:x,children:[(0,t.jsx)(v.SelectTrigger,{children:(0,t.jsx)(v.SelectValue,{placeholder:"همه وضعیت‌ها"})}),(0,t.jsxs)(v.SelectContent,{children:[(0,t.jsx)(v.SelectItem,{value:"all",children:"همه وضعیت‌ها"}),(0,t.jsx)(v.SelectItem,{value:"active",children:"فعال"}),(0,t.jsx)(v.SelectItem,{value:"inactive",children:"غیرفعال"})]})]})]})]}),(d||"all"!==m||"all"!==p)&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:()=>{u(""),g("all"),x("all"),i()},children:"پاک کردن فیلترها"})})]})]}),(0,t.jsxs)(y.Card,{className:"shadow-sm",children:[(0,t.jsx)(y.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(y.CardTitle,{children:["محصولات (",D.length,")"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(a.Button,{variant:E?"default":"outline",onClick:()=>R(!E),size:"sm",children:[(0,t.jsx)(S.Filter,{className:"ml-2 h-4 w-4"}),"فیلتر"]}),(0,t.jsxs)(a.Button,{variant:"outline",onClick:()=>{let e=new Blob([[["نام","برند","دسته‌بندی","قیمت","موجودی","وضعیت"],...D.map(e=>[e.name,e.brand,e.category,e.price.toString(),e.stockCount.toString(),e.enabled?"فعال":"غیرفعال"])].map(e=>e.join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=`products-${new Date().toISOString()}.csv`,t.click()},size:"sm",children:[(0,t.jsx)(N.Download,{className:"ml-2 h-4 w-4"}),"خروجی CSV"]}),(0,t.jsx)(a.Button,{asChild:!0,size:"sm",children:(0,t.jsxs)(f.default,{href:"/admin/products/new",children:[(0,t.jsx)(w.Plus,{className:"ml-2 h-4 w-4"}),"محصول جدید"]})})]})]})}),(0,t.jsx)(y.CardContent,{children:I?(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"در حال بارگذاری محصولات..."})}):(0,t.jsx)(b,{products:D,onRefresh:async()=>{await l(!0),o()}})})]})]})}e.s(["default",()=>I],48380)}]);
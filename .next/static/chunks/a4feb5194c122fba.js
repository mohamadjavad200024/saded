(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71876,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),s=e.i(70065),i=e.i(67881),n=e.i(23750),l=e.i(10708),o=e.i(60366),d=e.i(36361),c=e.i(55436),u=e.i(88844),m=e.i(46897),h=e.i(43432),g=e.i(63488),p=e.i(87316),x=e.i(15788),f=e.i(95468),j=e.i(3116),y=e.i(73884),v=e.i(1928),w=e.i(72664),b=e.i(69638),N=e.i(94983),S=e.i(57688),C=e.i(94179);e.i(74080);var k=e.i(91918),I=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,a)=>{let s=(0,k.createSlot)(`Primitive.${a}`),i=r.forwardRef((e,r)=>{let{asChild:i,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(i?s:a,{...n,ref:r})});return i.displayName=`Primitive.${a}`,{...e,[a]:i}},{}),R="Progress",[T,E]=function(e,a=[]){let s=[],i=()=>{let t=s.map(e=>r.createContext(e));return function(a){let s=a?.[e]||t;return r.useMemo(()=>({[`__scope${e}`]:{...a,[e]:s}}),[a,s])}};return i.scopeName=e,[function(a,i){let n=r.createContext(i);n.displayName=a+"Context";let l=s.length;s=[...s,i];let o=a=>{let{scope:s,children:i,...o}=a,d=s?.[e]?.[l]||n,c=r.useMemo(()=>o,Object.values(o));return(0,t.jsx)(d.Provider,{value:c,children:i})};return o.displayName=a+"Provider",[o,function(t,s){let o=s?.[e]?.[l]||n,d=r.useContext(o);if(d)return d;if(void 0!==i)return i;throw Error(`\`${t}\` must be used within \`${a}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let a=()=>{let a=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let s=a.reduce((t,{useScope:r,scopeName:a})=>{let s=r(e)[`__scope${a}`];return{...t,...s}},{});return r.useMemo(()=>({[`__scope${t.scopeName}`]:s}),[s])}};return a.scopeName=t.scopeName,a}(i,...a)]}(R),[$,L]=T(R),P=r.forwardRef((e,r)=>{var a,s;let{__scopeProgress:i,value:n=null,max:l,getValueLabel:o=A,...d}=e;(l||0===l)&&!B(l)&&console.error((a=`${l}`,`Invalid prop \`max\` of value \`${a}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let c=B(l)?l:100;null===n||_(n,c)||console.error((s=`${n}`,`Invalid prop \`value\` of value \`${s}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let u=_(n,c)?n:null,m=W(u)?o(u,c):void 0;return(0,t.jsx)($,{scope:i,value:u,max:c,children:(0,t.jsx)(I.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":W(u)?u:void 0,"aria-valuetext":m,role:"progressbar","data-state":O(u,c),"data-value":u??void 0,"data-max":c,...d,ref:r})})});P.displayName=R;var D="ProgressIndicator",M=r.forwardRef((e,r)=>{let{__scopeProgress:a,...s}=e,i=L(D,a);return(0,t.jsx)(I.div,{"data-state":O(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...s,ref:r})});function A(e,t){return`${Math.round(e/t*100)}%`}function O(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function W(e){return"number"==typeof e}function B(e){return W(e)&&!isNaN(e)&&e>0}function _(e,t){return W(e)&&!isNaN(e)&&e<=t&&e>=0}M.displayName=D;var U=e.i(47163);let q=r.forwardRef(({className:e,value:r,...a},s)=>(0,t.jsx)(P,{ref:s,className:(0,U.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...a,children:(0,t.jsx)(M,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));q.displayName=P.displayName;var z=e.i(52917),H=e.i(20682),F=e.i(16637),V=e.i(27651),J=e.i(44073),G=e.i(73493),K=e.i(46932),X=e.i(63415),Q=e.i(31278),Y=e.i(43531),Z=e.i(94771),ee=e.i(29006),et=e.i(92930),er=e.i(27612),ea=e.i(23585),es=e.i(37727),ei=e.i(78583),en=e.i(87951),el=e.i(26428);function eo({messages:e,messagesContainerRef:r,messagesEndRef:a,isSupportTyping:s,onReply:n,onEdit:l,onDelete:o}){return(0,t.jsxs)("div",{ref:r,className:"flex-1 min-h-0 overflow-y-auto p-5 sm:p-6 md:p-8 space-y-5 sm:space-y-6 bg-gradient-to-b from-background via-background/95 to-muted/5 scroll-smooth",children:[0===e.length&&(0,t.jsxs)(K.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center h-full min-h-[200px] text-center px-4",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mb-4 shadow-lg",children:(0,t.jsxs)("svg",{className:"h-10 w-10 text-primary/60",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("path",{d:"M8 10h.01M12 10h.01M16 10h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,t.jsx)("p",{className:"text-muted-foreground text-base font-medium leading-relaxed",children:"Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"}),(0,t.jsx)("p",{className:"text-muted-foreground/70 text-sm mt-2 leading-relaxed",children:"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."})]}),e.map((e,r)=>(0,t.jsx)(K.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},className:`flex ${"user"===e.sender?"justify-end":"justify-start"} items-end gap-2 group`,children:(0,t.jsxs)("div",{className:`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${"user"===e.sender?"bg-primary text-primary-foreground":"bg-muted text-foreground border border-border/40"}`,children:[e.text&&(0,t.jsx)("p",{className:"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5",children:e.text}),e.attachments&&e.attachments.length>0&&(0,t.jsx)("div",{className:`space-y-2 ${e.text?"mt-2":""}`,children:e.attachments.map((e,a)=>(0,t.jsxs)(K.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*a},className:"rounded-xl overflow-hidden",children:["image"===e.type&&e.url&&(0,t.jsx)("img",{src:e.url,alt:e.name||"ØªØµÙˆÛŒØ±",className:"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all",onClick:()=>window.open(e.url,"_blank"),onError:t=>{G.logger.error("Image load error:",e.url),t.target.style.display="none"}}),"file"===e.type&&(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",download:e.name,className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,t.jsx)(ei.FileText,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"font-medium truncate",children:e.name||"ÙØ§ÛŒÙ„"})]}),"location"===e.type&&(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,t.jsx)(m.MapPin,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"font-medium",children:e.name||"Ù…ÙˆÙ‚Ø¹ÛŒØª"})]}),"audio"===e.type&&e.url&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-background/50 rounded",children:[(0,t.jsx)(en.Mic,{className:"h-3.5 w-3.5"}),(0,t.jsx)("audio",{controls:!0,className:"flex-1 h-7 text-xs",children:(0,t.jsx)("source",{src:e.url})})]})]},e.id||`att-${r}-${a}`))}),(0,t.jsxs)("div",{className:`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${"user"===e.sender?"border-primary-foreground/20 justify-end":"border-border/30 justify-start"}`,children:[(0,t.jsx)("span",{className:`text-[10px] sm:text-xs ${"user"===e.sender?"text-primary-foreground/70":"text-muted-foreground"}`,children:new Date(e.timestamp).toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}),"user"===e.sender&&(0,t.jsxs)(t.Fragment,{children:["sending"===e.status&&(0,t.jsx)(Q.Loader2,{className:"h-3 w-3 text-primary-foreground/50 animate-spin"}),"sent"===e.status&&(0,t.jsx)(Y.Check,{className:"h-3 w-3 text-primary-foreground/40"}),"delivered"===e.status&&(0,t.jsx)(Z.CheckCheck,{className:"h-3 w-3 text-primary-foreground/40"}),"read"===e.status&&(0,t.jsx)(Z.CheckCheck,{className:"h-3 w-3 text-primary-foreground/70"}),"failed"===e.status&&(0,t.jsx)(es.X,{className:"h-3 w-3 text-destructive"}),!e.status&&(0,t.jsx)(Y.Check,{className:"h-3 w-3 text-primary-foreground/40"})]}),(0,t.jsx)("div",{className:"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsxs)(X.DropdownMenu,{children:[(0,t.jsx)(X.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-background/20",onClick:e=>{e.stopPropagation()},title:"Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±",children:(0,t.jsx)(ea.MoreVertical,{className:"h-3.5 w-3.5"})})}),(0,t.jsxs)(X.DropdownMenuContent,{align:"user"===e.sender?"end":"start",className:"min-w-[140px]",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)(X.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),n(e)},className:"cursor-pointer",children:[(0,t.jsx)(ee.Reply,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"Ù¾Ø§Ø³Ø®"})]}),"user"===e.sender&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.DropdownMenuSeparator,{}),(0,t.jsxs)(X.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),l(e)},className:"cursor-pointer",children:[(0,t.jsx)(et.Edit2,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"ÙˆÛŒØ±Ø§ÛŒØ´"})]})]}),(0,t.jsx)(X.DropdownMenuSeparator,{}),(0,t.jsxs)(X.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ")&&o(e.id)},className:"cursor-pointer text-destructive focus:text-destructive focus:bg-destructive/10",children:[(0,t.jsx)(er.Trash2,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"Ø­Ø°Ù"})]})]})]})})]})]})},e.id)),s&&(0,t.jsx)(K.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"flex justify-start items-end gap-2.5",children:(0,t.jsx)(el.TypingIndicator,{})}),(0,t.jsx)("div",{ref:a})]})}var ed=e.i(22085),ec=e.i(73042);function eu({step:e,isOnline:r,lastSeen:a,customerInfo:s,onEditInfo:n}){return(0,t.jsx)(z.SheetHeader,{className:"px-4 sm:px-6 py-2 border-b border-border/40",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsxs)(z.SheetTitle,{className:"text-base font-semibold text-foreground flex items-center gap-2",children:["Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹","chat"===e&&(0,t.jsx)(ec.OnlineStatusBadge,{isOnline:r,lastSeen:a instanceof Date?a.toISOString():"string"==typeof a?a:null,showText:!1})]})}),"chat"===e&&s.name&&s.phone&&(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:n,className:"h-8 w-8 rounded-lg hover:bg-primary/10 transition-colors",title:"ØªØºÛŒÛŒØ± Ø§Ø·Ù„Ø§Ø¹Ø§Øª",children:(0,t.jsxs)("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})})}let em=e=>{let t=Math.floor(e/60);return`${t}:${(e%60).toString().padStart(2,"0")}`};function eh({isOpen:e,onOpenChange:a,trigger:s}){let{toast:i}=(0,H.useToast)(),{showNotification:n,requestPermission:l}=(0,F.useNotifications)(),{showMessageNotification:o}=(0,J.usePersistentNotifications)(),{isOnline:d,lastSeen:c,checkStatus:u}=(0,V.useAdminPresence)({enabled:!0,heartbeatInterval:2e4}),[m,h]=(0,r.useState)([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}]),[g,p]=(0,r.useState)(""),[x,f]=(0,r.useState)(null),[j,y]=(0,r.useState)(null),v=()=>{{let e=localStorage.getItem("quickBuyChat_customerInfo"),t=localStorage.getItem("quickBuyChat_customerInfo_timestamp");if(e)try{let r=JSON.parse(e);if(t){let e=parseInt(t,10);if((Date.now()-e)/864e5>30)return localStorage.removeItem("quickBuyChat_customerInfo"),localStorage.removeItem("quickBuyChat_customerInfo_timestamp"),localStorage.removeItem("quickBuyChat_chatId"),{name:"",phone:"",email:""}}return r}catch{localStorage.removeItem("quickBuyChat_customerInfo"),localStorage.removeItem("quickBuyChat_customerInfo_timestamp")}}return{name:"",phone:"",email:""}},[w,b]=(0,r.useState)(v),N="chat",[S,C]=(0,r.useState)([]),[k,I]=(0,r.useState)(!1),[R,T]=(0,r.useState)(!1),[E,$]=(0,r.useState)(localStorage.getItem("quickBuyChat_chatId")),[L,P]=(0,r.useState)(!1),[D,M]=(0,r.useState)(!1),[A,O]=(0,r.useState)(null),W=(0,r.useRef)(null),B=(0,r.useRef)(null),_=(0,r.useRef)(null);(0,r.useRef)({});let U=(0,r.useRef)(null);(0,r.useRef)(new Set),(0,r.useRef)(new Map),(0,r.useRef)(new Map);let q=(0,r.useRef)(!1),K=(0,r.useRef)(null),X=(0,r.useRef)(null),Q=(0,r.useRef)(null),Y=(0,r.useRef)(null),Z=(0,r.useRef)(!1),ee=(0,r.useRef)(null),[et,er]=(0,r.useState)(!1),ea=(0,r.useCallback)(()=>{if(!Q.current)return void er(!1);let e=Q.current;er(e.scrollHeight-e.scrollTop-e.clientHeight>150)},[N]),es=(0,r.useCallback)((e=!1)=>{X.current&&(X.current.scrollIntoView({behavior:e?"auto":"smooth",block:"end"}),setTimeout(()=>{er(!1)},300))},[]);(0,r.useEffect)(()=>{let e=Q.current;if(!e)return void er(!1);let t=()=>{ea()};return e.addEventListener("scroll",t,{passive:!0}),ea(),setTimeout(()=>{ea()},100),()=>{e.removeEventListener("scroll",t)}},[N,ea,m.length]),(0,r.useEffect)(()=>{if(m.length>0&&!Z.current){Z.current=!0;let e=setTimeout(()=>{es(!0),setTimeout(()=>{ea()},500)},200);return()=>clearTimeout(e)}},[N,es,ea]),(0,r.useEffect)(()=>{},[N]),(0,r.useEffect)(()=>{if(m.length>0){let e=m[m.length-1];if(e.id===ee.current&&"user"===e.sender){let e=setTimeout(()=>{es(!1),setTimeout(()=>{ea()},500)},150);return()=>clearTimeout(e)}{let e=setTimeout(()=>{ea()},200);return()=>clearTimeout(e)}}},[m,N,es,ea]),(0,r.useEffect)(()=>{w.name&&w.phone&&(localStorage.setItem("quickBuyChat_customerInfo",JSON.stringify(w)),localStorage.setItem("quickBuyChat_customerInfo_timestamp",Date.now().toString()))},[w]),(0,r.useEffect)(()=>{E&&localStorage.setItem("quickBuyChat_chatId",E)},[E]),(0,r.useEffect)(()=>{if(e){let e=v(),t=localStorage.getItem("quickBuyChat_chatId");e.name&&e.phone?(b(e),ei(e,t)):window.location.href="/auth"}else p(""),C([]),I(!1),O(null),_.current&&(clearInterval(_.current),_.current=null),P(!1)},[e]);let ei=async(e,t)=>{try{let r="/api/chat?";if(t)r+=`chatId=${t}`;else{try{let e=await fetch("/api/chat/my",{credentials:"include"}),a=await e.json().catch(()=>null);e.ok&&a?.success&&a?.data?.chatId&&(t=String(a.data.chatId),r=`/api/chat?chatId=${t}`)}catch{}r+=`customerPhone=${encodeURIComponent(e.phone)}`,e.name&&(r+=`&customerName=${encodeURIComponent(e.name)}`)}let a=await fetch(r,{credentials:"include"});if(!a.ok)throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª");let s=await a.json();if(s.success&&s.data){let{chat:t,messages:r}=s.data;if(t&&r&&r.length>0){$(t.id),localStorage.setItem("quickBuyChat_chatId",t.id);let e=r.map(e=>{let t=[];if(e.attachments){if(Array.isArray(e.attachments))t=e.attachments.map(e=>{let t=e.url||e.fileUrl||e.filePath,r=e.type;return!r&&t&&(t.includes("/image-")||t.includes("image-")?r="image":(t.includes("/audio-")||t.includes("audio-"))&&(r="audio")),{id:e.id||`att-${Date.now()}-${Math.random()}`,type:r||e.type||"file",url:t,name:e.name||e.fileName,size:e.size||e.fileSize,duration:e.duration}});else if("string"==typeof e.attachments)try{let r=JSON.parse(e.attachments);Array.isArray(r)&&(t=r.map(e=>{let t=e.url||e.fileUrl||e.filePath,r=e.type;return!r&&t&&(t.includes("/image-")||t.includes("image-")?r="image":(t.includes("/audio-")||t.includes("audio-"))&&(r="audio")),{id:e.id||`att-${Date.now()}-${Math.random()}`,type:r||e.type||"file",url:t,name:e.name||e.fileName,size:e.size||e.fileSize,duration:e.duration}}))}catch(e){G.logger.error("Error parsing attachments JSON:",e)}}let r=t.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))});return t.length>0&&G.logger.debug(`Loaded message ${e.id} has ${r.length} valid attachment(s) out of ${t.length} total:`,r.map(e=>({id:e.id,type:e.type,url:e.url,name:e.name,hasUrl:!!e.url}))),{id:e.id,text:e.text||"",sender:e.sender,timestamp:new Date(e.createdAt),attachments:r.length>0?r:void 0,status:"user"===e.sender?e.status||"sent":void 0}}),a=e.map(e=>"user"!==e.sender||e.status?e:{...e,status:"sent"});if(h(a),e.length>0){let t=e[e.length-1].id;U.current=t,localStorage.setItem("quickBuyChat_lastMessageId",t),a.some(e=>"support"===e.sender&&"1"!==e.id)?q.current=!0:q.current=!1}else q.current=!1}else h([{id:"1",text:`Ø³Ù„Ø§Ù… ${e.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),q.current=!1}else h([{id:"1",text:`Ø³Ù„Ø§Ù… ${e.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),q.current=!1}catch(t){G.logger.error("Error loading chat history:",t),h([{id:"1",text:`Ø³Ù„Ø§Ù… ${e.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),q.current=!1}},en=async()=>{if(E)try{await fetch("/api/chat/status",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:E,sender:"user",action:"delivered"})})}catch(e){G.logger.error("Error marking messages as delivered:",e)}},el=async()=>{if(E)try{await fetch("/api/chat/status",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:E,sender:"user",action:"read"})})}catch(e){G.logger.error("Error marking messages as read:",e)}},ec=async()=>{if(E&&e&&1)try{P(!0);let e=U.current,t=`/api/chat?chatId=${E}`;e&&"1"!==e&&(t+=`&lastMessageId=${e}`);let r=await fetch(t,{credentials:"include"});if(!r.ok)throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯");let a=await r.json();if(a.success&&a.data?.messages&&Array.isArray(a.data.messages)){let e=a.data.messages;e.length>0&&(en(),setTimeout(()=>{el()},1e3));let t=e.map(e=>{let t=[];e.attachments&&Array.isArray(e.attachments)&&(t=e.attachments.map(e=>{let t=e.url||e.fileUrl||e.filePath,r=e.type;return!r&&t&&(t.includes("/image-")||t.includes("image-")?r="image":(t.includes("/audio-")||t.includes("audio-"))&&(r="audio")),{id:e.id||`att-${Date.now()}-${Math.random()}`,type:r||e.type||"file",url:t,name:e.name||e.fileName,size:e.size||e.fileSize,duration:e.duration}}));let r=t.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))});return{id:e.id,text:e.text||"",sender:e.sender,timestamp:new Date(e.createdAt),attachments:r.length>0?r:void 0,status:"user"===e.sender?e.status||"sent":void 0}});h(e=>{let r=new Set(e.map(e=>e.id)),a=t.filter(e=>!r.has(e.id)),s=e.filter(e=>!e.id.startsWith("system-")).map(e=>{let r=t.find(t=>t.id===e.id);return r&&"user"===e.sender&&r.status&&e.status!==r.status?{...e,status:r.status}:e});if(a.length>0){let e=a.some(e=>"support"===e.sender),t=s;e&&K.current&&(t=s.filter(e=>e.id!==K.current),K.current=null,q.current=!0);let r=[...t,...a],i=r[r.length-1];return i&&(U.current=i.id,localStorage.setItem("quickBuyChat_lastMessageId",i.id)),r}return s})}}catch(e){G.logger.error("Error polling for new messages:",e)}finally{P(!1)}},eh=async()=>{if(E)try{let e=await fetch(`/api/chat/typing?chatId=${E}&sender=support`,{credentials:"include"});if(e.ok){let t=await e.json();t.success&&M(t.data.isTyping||!1)}}catch(e){G.logger.error("Error checking typing status:",e)}},eg=async e=>{if(E)try{await fetch("/api/chat/typing",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:E,sender:"user",isTyping:e})})}catch(e){G.logger.error("Error sending typing status:",e)}};(0,r.useEffect)(()=>{l()},[]),(0,r.useEffect)(()=>{let t=t=>{let{chatId:r,isAdmin:s}=t.detail;(!1===s||void 0===s)&&(e||a(!0),r&&1&&localStorage.getItem("quickBuyChat_chatId")!==r&&(localStorage.setItem("quickBuyChat_chatId",r),setTimeout(()=>{e&&ec()},500)))};return window.addEventListener("openChat",t),()=>{window.removeEventListener("openChat",t)}},[e,a,E,N,ec]),(0,r.useEffect)(()=>{if(e&&E){en();let e=setTimeout(()=>{el()},2e3);return eh(),B.current=setInterval(()=>{eh()},3e3),_.current=setInterval(()=>{ec(),en()},5e3),ec(),u(),()=>{_.current&&(clearInterval(_.current),_.current=null),B.current&&(clearInterval(B.current),B.current=null),W.current&&(clearTimeout(W.current),W.current=null),clearTimeout(e),eg(!1)}}},[e,N,E,u]);let ep=async e=>{try{if((await fetch(`/api/chat/message/${e}`,{method:"DELETE",credentials:"include"})).ok)h(t=>t.filter(t=>t.id!==e)),i({title:"Ù…ÙˆÙÙ‚",description:"Ù¾ÛŒØ§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯"});else throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…")}catch(e){G.logger.error("Error deleting message:",e),i({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…",variant:"destructive"})}},ex=async()=>{let t=Y.current?.value??g;if(!t.trim()&&0===S.length)return;if(j){try{(await fetch(`/api/chat/message/${j.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({text:t,attachments:S})})).ok&&(h(e=>e.map(e=>e.id===j.id?{...e,text:t,attachments:S}:e)),y(null),p(""),C([]),i({title:"Ù…ÙˆÙÙ‚",description:"Ù¾ÛŒØ§Ù… ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯"}))}catch(e){G.logger.error("Error editing message:",e),i({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…",variant:"destructive"})}return}let r=S.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))});if(!t.trim()&&0===r.length)return void i({title:"Ø®Ø·Ø§",description:"Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù¾ÛŒØ§Ù… ÛŒØ§ ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯",variant:"destructive"});let s=t;x&&(s=`Ø¯Ø± Ù¾Ø§Ø³Ø® Ø¨Ù‡: ${x.text}

${t}`);let n={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,text:s,sender:"user",timestamp:new Date,attachments:r.length>0?r:void 0,status:"sending"};h(e=>{let t=[...e,n];return U.current=n.id,ee.current=n.id,localStorage.setItem("quickBuyChat_lastMessageId",n.id),t}),setTimeout(()=>{es(!1)},150);let l=[...S];p(""),C([]),I(!1),f(null);try{T(!0);let t={id:n.id,text:n.text,sender:n.sender,timestamp:n.timestamp.toISOString(),status:"sent",attachments:(l||[]).filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))})};n.attachments&&n.attachments.length>0&&G.logger.debug(`ğŸ“¤ Sending new message with ${n.attachments.length} attachment(s):`,n.attachments.map(e=>({id:e.id,type:e.type,url:e.url,name:e.name})));let r=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:E||void 0,customerInfo:w,messages:[t]})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||e.message||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…")}let s=await r.json();s.data?.chatId&&($(s.data.chatId),localStorage.setItem("quickBuyChat_chatId",s.data.chatId));let i=s.data?.messages?.find(e=>e.id===n.id),d=i?.status||"sent";h(e=>e.map(e=>e.id===n.id?{...e,status:d}:e));try{let t=await fetch("/api/admin/presence");if(t.ok){let r=await t.json();r.success&&r.data?.admins&&(Array.isArray(r.data.admins)&&r.data.admins.length>0||o("Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ","Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¢Ù†Ù„Ø§ÛŒÙ† Ù†ÛŒØ³Øª. Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡ Ùˆ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",{onOpen:()=>{e||a(!0)},chatId:E||void 0,metadata:{isAdminOffline:!0,isAdmin:!1}}))}}catch(e){G.logger.error("Error checking admin status:",e)}}catch(e){G.logger.error("Error saving message:",e),h(e=>e.map(e=>e.id===n.id?{...e,status:"failed"}:e)),p(s),C(l),i({title:"Ø®Ø·Ø§",description:e.message||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",variant:"destructive"})}finally{T(!1)}q.current||setTimeout(async()=>{let e=`system-${Date.now()}`;K.current=e,q.current=!0;let t={id:e,text:"Ù…ØªØ´Ú©Ø±Ù…! Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯. Ù‡Ù…Ú©Ø§Ø±Ø§Ù† Ù…Ø§ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¨Ø§ Ø´Ù…Ø§ ØªÙ…Ø§Ø³ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ú¯Ø±ÙØª.",sender:"support",timestamp:new Date};h(e=>[...e,t])},1e3)},ef=async(e,t,r=0)=>{try{let r=new FormData;r.append("file",e),r.append("type",t);let a=await fetch("/api/chat/upload",{method:"POST",body:r,credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({error:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„"}));throw Error(e.error||"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„")}return(await a.json()).data.url}catch(a){if(G.logger.error("Error uploading file:",a),r<3&&(a.message?.includes("fetch")||a.message?.includes("network")||a.message?.includes("timeout")||"NETWORK_ERROR"===a.code||"TypeError"===a.name)){let a=2e3*Math.pow(2,r);return G.logger.debug(`Retrying file upload in ${a}ms (attempt ${r+1}/3)`),0===r&&i({title:"Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...",description:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„. Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...",duration:2e3}),await new Promise(e=>setTimeout(e,a)),ef(e,t,r+1)}throw i({title:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„",description:a.message||"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯",variant:"destructive"}),a}},ej=function(e,t,a){let{toast:s}=(0,H.useToast)(),[i,n]=(0,r.useState)(!1),[l,o]=(0,r.useState)(0),[d,c]=(0,r.useState)(null),[u,m]=(0,r.useState)(null),[h,g]=(0,r.useState)(null),[p,x]=(0,r.useState)(!1),f=(0,r.useRef)(null),j=(0,r.useRef)([]),y=(0,r.useRef)(null),v=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void s({title:"Ø®Ø·Ø§",description:"Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ø¶Ø¨Ø· ØµØ¯Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯",variant:"destructive"});let e=await navigator.mediaDevices.getUserMedia({audio:!0});g(!0),x(!1);let t=new MediaRecorder(e);f.current=t,j.current=[],t.ondataavailable=e=>{e.data.size>0&&j.current.push(e.data)},t.onstop=()=>{let r=new Blob(j.current,{type:t.mimeType||"audio/webm"});c(r);let a=URL.createObjectURL(r);m(a),e.getTracks().forEach(e=>e.stop())},t.onerror=e=>{G.logger.error("MediaRecorder error:",e),s({title:"Ø®Ø·Ø§ Ø¯Ø± Ø¶Ø¨Ø· ØµØ¯Ø§",description:"Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¶Ø¨Ø· ØµØ¯Ø§ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",variant:"destructive"}),w()},t.start(),n(!0),o(0),y.current=setInterval(()=>{o(e=>e+1)},1e3),s({title:"Ø¶Ø¨Ø· ØµØ¯Ø§ Ø´Ø±ÙˆØ¹ Ø´Ø¯",description:"Ø¯Ø± Ø­Ø§Ù„ Ø¶Ø¨Ø· Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ..."})}catch(r){G.logger.error("Error starting recording:",r),g(!1);let e="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª.",t="";"NotAllowedError"===r.name||"PermissionDeniedError"===r.name?(e="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø¯ Ø´Ø¯",t="Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø®ÙˆØ¯ØŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯."):"NotFoundError"===r.name||"DevicesNotFoundError"===r.name?(e="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ÛŒØ§ÙØª Ù†Ø´Ø¯",t="Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¨Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø´Ù…Ø§ Ù…ØªØµÙ„ Ø§Ø³Øª."):"NotReadableError"===r.name||"TrackStartError"===r.name?(e="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª",t="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ØªÙˆØ³Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ Ø¨Ø¨Ù†Ø¯ÛŒØ¯."):"OverconstrainedError"===r.name||"ConstraintNotSatisfiedError"===r.name?(e="ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯",t="Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯."):t="Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯ ÛŒØ§ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.",s({title:e,description:t,variant:"destructive",duration:5e3}),("NotAllowedError"===r.name||"PermissionDeniedError"===r.name)&&x(!0)}},w=()=>{if(f.current&&"inactive"!==f.current.state)try{f.current.stop(),n(!1),y.current&&clearInterval(y.current),s({title:"Ø¶Ø¨Ø· ØµØ¯Ø§ Ù…ØªÙˆÙ‚Ù Ø´Ø¯",description:"Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ Ø´Ù…Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§ Ù„ØºÙˆ Ú©Ù†ÛŒØ¯."})}catch(e){G.logger.error("Error stopping recording:",e),s({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± ØªÙˆÙ‚Ù Ø¶Ø¨Ø· Ø±Ø® Ø¯Ø§Ø¯.",variant:"destructive"})}},b=async()=>{if(G.logger.info("saveRecording called",{hasAudioBlob:!!d,hasAudioUrl:!!u}),console.log("[Voice Widget] saveRecording called",{hasAudioBlob:!!d,hasAudioUrl:!!u,audioBlobSize:d?.size,audioUrl:u}),!d||!u){G.logger.warn("No audio blob or URL available"),console.log("[Voice Widget] No audio blob or URL available, returning"),alert("Ù‡ÛŒÚ† Ø¶Ø¨Ø· ØµÙˆØªÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª");return}try{console.log("[Voice Widget] Starting upload...");let r="webm",s=d.type||"audio/webm";s.includes("mp4")||s.includes("m4a")?r="m4a":s.includes("ogg")?r="ogg":s.includes("wav")?r="wav":s.includes("webm")&&(r="webm");let i=new File([d],`audio-${Date.now()}.${r}`,{type:s});console.log("[Voice Widget] Uploading audio file...");let n=await e(i,"audio");console.log("[Voice Widget] Upload successful, URL:",n);let h={id:Date.now().toString(),type:"audio",url:n,name:`Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ ${em(l)}`,size:d.size,duration:l};console.log("[Voice Widget] Adding attachment:",h),t(e=>{let t=[...e,h];return console.log("[Voice Widget] New attachments:",t),t}),c(null),u&&URL.revokeObjectURL(u),m(null),o(0),console.log("[Voice Widget] Auto-sending message..."),setTimeout(()=>{a()},100)}catch(e){}};return{isRecording:i,recordingTime:l,audioUrl:u,showPermissionGuide:p,setShowPermissionGuide:x,checkMicrophonePermission:async()=>{try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop()),!0}catch(e){return!1}},startRecording:v,stopRecording:w,cancelRecording:()=>{w(),c(null),u&&(URL.revokeObjectURL(u),m(null)),o(0)},saveRecording:b}}(ef,C,ex),ey=function(e,t,a,s){let{toast:i}=(0,H.useToast)(),n=(0,r.useRef)(null),l=(0,r.useRef)(null);return{imageInputRef:n,fileInputRef:l,handleFileSelect:async(r,a)=>{let s=r.target.files;if(s&&0!==s.length){for(let r of Array.from(s))try{let s=await e(r,a),i={id:Date.now().toString()+Math.random(),type:a,name:r.name,size:r.size,url:s};t(e=>[...e,i])}catch(e){}r.target.value=""}},handleRemoveAttachment:e=>{t(t=>{let r=t.find(t=>t.id===e);return r?.url&&URL.revokeObjectURL(r.url),t.filter(t=>t.id!==e)})},handleLocationShare:()=>{if(G.logger.info("handleLocationShare called"),console.log("[Location Widget] handleLocationShare called"),!navigator.geolocation){G.logger.warn("Geolocation not supported"),console.log("[Location Widget] Geolocation not supported"),i({title:"Ø®Ø·Ø§",description:"Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯",variant:"destructive"});return}let e="https:"===window.location.protocol||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;if(console.log("[Location Widget] Protocol:",window.location.protocol,"Hostname:",window.location.hostname,"IsSecure:",e),!e){G.logger.warn("Not on secure origin"),console.log("[Location Widget] Not on secure origin"),i({title:"Ø®Ø·Ø§",description:"Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø¨Ø§ÛŒØ¯ Ø§Ø² HTTPS Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ø¢Ø¯Ø±Ø³ Ø§Ù…Ù† Ø³Ø§ÛŒØª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",variant:"destructive"});return}i({title:"Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª...",description:"Ù„Ø·ÙØ§Ù‹ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø¯Ù‡ÛŒØ¯",duration:3e3}),G.logger.info("Requesting geolocation permission..."),console.log("[Location Widget] Requesting geolocation permission..."),navigator.geolocation.getCurrentPosition(e=>{G.logger.info("Location received:",e.coords),console.log("[Location Widget] Position received:",e.coords);let r={id:Date.now().toString(),type:"location",url:`https://www.google.com/maps?q=${e.coords.latitude},${e.coords.longitude}`,name:"Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ"};console.log("[Location Widget] Adding attachment:",r),t(e=>{let t=[...e,r];return console.log("[Location Widget] New attachments:",t),t}),a(!1),console.log("[Location Widget] Auto-sending message..."),setTimeout(()=>{s()},100)},e=>{G.logger.error("Error getting location:",e);let t="Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ";1===e.code?t="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø¯ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.":2===e.code?t="Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ GPS ÙØ¹Ø§Ù„ Ø§Ø³Øª.":3===e.code&&(t="Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø²Ù…Ø§Ù†â€ŒØ¨Ø± Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯."),i({title:"Ø®Ø·Ø§",description:t,variant:"destructive"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}}}(ef,C,I,ex),{isRecording:ev,recordingTime:ew,audioUrl:eb,showPermissionGuide:eN,setShowPermissionGuide:eS,checkMicrophonePermission:eC,startRecording:ek,stopRecording:eI,cancelRecording:eR,saveRecording:eT}=ej,{imageInputRef:eE,fileInputRef:e$,handleFileSelect:eL,handleRemoveAttachment:eP,handleLocationShare:eD}=ey;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{"data-chat-open":e&&1?"true":"false",style:{display:"none"}}),(0,t.jsxs)(z.Sheet,{open:e,onOpenChange:a,children:[s&&(0,t.jsx)(z.SheetTrigger,{asChild:!0,children:s}),(0,t.jsxs)(z.SheetContent,{side:"left",className:"w-full sm:w-[420px] md:w-[480px] p-0 flex flex-col border-l-2 border-border/40 bg-background shadow-2xl",children:[(0,t.jsx)(eu,{step:N,isOnline:d,lastSeen:c,customerInfo:w,onEditInfo:()=>{window.location.href="/auth"}}),(0,t.jsx)(eo,{messages:m,messagesContainerRef:Q,messagesEndRef:X,isSupportTyping:D,onReply:e=>{f(e),y(null)},onEdit:e=>{y(e),f(null),p(e.text||"")},onDelete:ep}),(0,t.jsx)(ed.ChatInput,{message:g,setMessage:p,attachments:S,setAttachments:C,showAttachmentOptions:k,setShowAttachmentOptions:I,isRecording:ev,recordingTime:ew,audioUrl:eb,isSaving:R,showScrollToBottom:et,showPermissionGuide:eN,setShowPermissionGuide:eS,textareaRef:Y,imageInputRef:eE,fileInputRef:e$,typingTimeoutRef:W,handleSendMessage:ex,handleFileSelect:eL,handleRemoveAttachment:eP,handleLocationShare:eD,startRecording:ek,stopRecording:eI,saveRecording:eT,cancelRecording:eR,sendTypingStatus:eg,scrollToBottom:es,formatTime:em,toast:i})]})]})]})}let eg={pending:{label:"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±",color:"bg-yellow-100 text-yellow-800",icon:j.Clock},processing:{label:"Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´",color:"bg-blue-100 text-blue-800",icon:u.Package},shipped:{label:"Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡",color:"bg-purple-100 text-purple-800",icon:x.Truck},delivered:{label:"ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡",color:"bg-green-100 text-green-800",icon:f.CheckCircle2},cancelled:{label:"Ù„ØºÙˆ Ø´Ø¯Ù‡",color:"bg-red-100 text-red-800",icon:y.XCircle}},ep={pending:{label:"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª",color:"bg-yellow-100 text-yellow-800"},paid:{label:"Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡",color:"bg-green-100 text-green-800"},failed:{label:"Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚",color:"bg-red-100 text-red-800"},refunded:{label:"Ø¨Ø§Ø²Ú¯Ø´Øª ÙˆØ¬Ù‡",color:"bg-gray-100 text-gray-800"}};function ex(){let e,k,I,R,T,E,$=(0,a.useSearchParams)().get("orderNumber")||"",[L,P]=(0,r.useState)($),[D,M]=(0,r.useState)(null),[A,O]=(0,r.useState)(!1),[W,B]=(0,r.useState)(!1),[_,U]=(0,r.useState)(!1),{orders:z,updateOrder:H}=(0,o.useOrderStore)(),{getProduct:F,loadProductsFromDB:V}=(0,d.useProductStore)(),J=()=>{(O(!1),M(null),B(!0),L.trim())?G(L):B(!1)},G=async e=>{try{let t=z.find(t=>t.orderNumber.toLowerCase()===e.toLowerCase().trim()||t.id===e.trim());if(t){M(t),O(!1);return}let r=await fetch(`/api/orders?orderNumber=${encodeURIComponent(e)}`);if(r.ok){let e=await r.json();if(e.success&&e.data&&e.data.length>0){let t=e.data[0];M(t),O(!1),H(t.id,t)}else O(!0)}else O(!0)}catch(e){console.error("Error fetching order:",e),O(!0)}};return(0,r.useEffect)(()=>{V(!0).catch(e=>{console.error("Error loading products for order tracking:",e)})},[V]),(0,r.useEffect)(()=>{$&&$.trim()&&(B(!0),G($))},[$]),(0,r.useEffect)(()=>{if(!D?.id)return;let e=setInterval(async()=>{try{let e=await fetch(`/api/orders/${D.id}`);if(e.ok){let t=await e.json();t.success&&t.data&&(M(t.data),H(t.data.id,t.data))}}catch(e){console.error("Error polling order status:",e)}},1e4);return()=>clearInterval(e)},[D?.id,H]),D&&eg[D.status]?.icon||j.Clock,(0,t.jsxs)("div",{className:"container mx-auto px-4 py-6 sm:py-8 md:py-12",children:[(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6 sm:mb-8",children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´"}),(0,t.jsxs)(i.Button,{onClick:()=>U(!0),variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,t.jsx)(N.MessageCircle,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Ú†Øª Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ†"}),(0,t.jsx)("span",{className:"sm:hidden",children:"Ú†Øª"})]})]}),(0,t.jsxs)(s.Card,{className:"mb-6",children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³ÙØ§Ø±Ø´"})}),(0,t.jsx)(s.CardContent,{children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(l.Label,{htmlFor:"orderNumber",children:"Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´"}),(0,t.jsx)(n.Input,{id:"orderNumber",placeholder:"Ù…Ø«Ø§Ù„: ORD-1234567890-001",value:L,onChange:e=>P(e.target.value),onKeyDown:e=>{"Enter"===e.key&&J()}})]}),(0,t.jsx)("div",{className:"flex items-end",children:(0,t.jsxs)(i.Button,{onClick:J,size:"lg",children:[(0,t.jsx)(c.Search,{className:"ml-2 h-4 w-4"}),"Ø¬Ø³ØªØ¬Ùˆ"]})})]})})]}),A&&W&&(0,t.jsx)(s.Card,{children:(0,t.jsx)(s.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,t.jsx)(y.XCircle,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Ø³ÙØ§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯"}),(0,t.jsx)("p",{className:"text-muted-foreground text-center mb-6",children:"Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."})]})})}),D&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(s.Card,{className:"border-2",children:[(0,t.jsx)(s.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,t.jsxs)(s.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(u.Package,{className:"h-5 w-5 text-primary"}),"Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´"]})}),(0,t.jsxs)(s.CardContent,{className:"pt-6",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute right-8 top-0 bottom-0 w-0.5 bg-border",children:(0,t.jsx)("div",{className:"absolute top-0 right-0 w-full bg-primary transition-all duration-500 ease-in-out",style:{height:`${-1===(k=(e=["pending","processing","shipped","delivered"]).indexOf(D.status))?0:(k+1)/e.length*100}%`}})}),(0,t.jsx)("div",{className:"space-y-8 relative z-10",children:[{status:"pending",label:"Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±",icon:v.ShoppingCart,description:"Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯"},{status:"processing",label:"Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´",icon:w.Box,description:"Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ"},{status:"shipped",label:"Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡",icon:x.Truck,description:"Ø¯Ø± Ù…Ø³ÛŒØ± ØªØ­ÙˆÛŒÙ„"},{status:"delivered",label:"ØªØ­ÙˆÛŒÙ„ Ø´Ø¯Ù‡",icon:f.CheckCircle2,description:"ØªØ­ÙˆÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯"}].map((e,r)=>{let a=["pending","processing","shipped","delivered"],s=a.indexOf(D.status),i=a.indexOf(e.status),n=s>=i&&"cancelled"!==D.status,l=s===i&&"cancelled"!==D.status,o=e.icon;return(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"relative z-10",children:(0,t.jsx)("div",{className:`w-16 h-16 rounded-full flex items-center justify-center transition-all duration-300 ${n?"bg-primary text-primary-foreground shadow-lg shadow-primary/50":l?"bg-primary/20 text-primary border-2 border-primary":"bg-muted text-muted-foreground"}`,children:n?(0,t.jsx)(b.CheckCircle,{className:"h-8 w-8"}):(0,t.jsx)(o,{className:"h-8 w-8"})})}),(0,t.jsxs)("div",{className:"flex-1 pt-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsx)("h3",{className:`font-semibold text-lg ${n||l?"text-foreground":"text-muted-foreground"}`,children:e.label}),l&&(0,t.jsx)(C.Badge,{variant:"default",className:"animate-pulse",children:"Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…"}),n&&!l&&(0,t.jsxs)(C.Badge,{variant:"success",className:"gap-1",children:[(0,t.jsx)(b.CheckCircle,{className:"h-3 w-3"}),"ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯"]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),l&&D.updatedAt&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:"," ",new Date(D.updatedAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]},e.status)})})]}),(0,t.jsxs)("div",{className:"mt-8 pt-6 border-t",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Ù¾ÛŒØ´Ø±ÙØª Ú©Ù„ÛŒ"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:-1===(R=(I=["pending","processing","shipped","delivered"]).indexOf(D.status))?"0%":`${Math.round((R+1)/I.length*100)}%`})]}),(0,t.jsx)(q,{value:-1===(E=(T=["pending","processing","shipped","delivered"]).indexOf(D.status))?0:(E+1)/T.length*100,className:"h-3"})]}),(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(u.Package,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´"}),(0,t.jsx)("p",{className:"font-semibold font-mono",children:D.orderNumber})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(p.Calendar,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª"}),(0,t.jsx)("p",{className:"font-semibold",children:new Date(D.createdAt).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric"})})]})]})]})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³ÙØ§Ø±Ø´"})}),(0,t.jsx)(s.CardContent,{children:(0,t.jsx)("div",{className:"space-y-4",children:Array.isArray(D.items)?D.items.map(e=>{let r=F(e.productId||e.id),a=e.image&&""!==e.image.trim()?e.image:"";!a&&r&&r.images&&r.images.length>0&&(a=r.images[0]);let s=a&&""!==a.trim();return(0,t.jsxs)("div",{className:"flex gap-4 pb-4 border-b last:border-0",children:[s?(0,t.jsx)("div",{className:"relative w-20 h-20 bg-muted rounded-lg overflow-hidden flex-shrink-0 border",children:(0,t.jsx)(S.default,{src:a,alt:e.name,fill:!0,className:"object-cover",unoptimized:a.startsWith("blob:")||a.startsWith("data:")})}):(0,t.jsx)("div",{className:"w-20 h-20 bg-muted rounded-lg flex items-center justify-center flex-shrink-0 border",children:(0,t.jsx)(u.Package,{className:"h-8 w-8 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold mb-1",children:e.name}),(0,t.jsxs)("div",{className:"flex justify-between text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{children:["ØªØ¹Ø¯Ø§Ø¯: ",e.quantity]}),(0,t.jsxs)("span",{className:"font-semibold text-foreground",children:[(e.price*e.quantity).toLocaleString("fa-IR")," ØªÙˆÙ…Ø§Ù†"]})]})]})]},e.id)}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(u.Package,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³ÙØ§Ø±Ø´ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª"})]})})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ"})}),(0,t.jsxs)(s.CardContent,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(u.Package,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ù†Ø§Ù…"}),(0,t.jsx)("p",{className:"font-semibold",children:D.customerName})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(h.Phone,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³"}),(0,t.jsx)("p",{className:"font-semibold",children:D.customerPhone})]})]}),D.customerEmail&&(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(g.Mail,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø§ÛŒÙ…ÛŒÙ„"}),(0,t.jsx)("p",{className:"font-semibold",children:D.customerEmail})]})]})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Ø¢Ø¯Ø±Ø³ Ø§Ø±Ø³Ø§Ù„"})}),(0,t.jsxs)(s.CardContent,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(m.MapPin,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø¢Ø¯Ø±Ø³"}),(0,t.jsxs)("p",{className:"font-semibold",children:[D.shippingAddress.city,"ØŒ ",D.shippingAddress.address]}),D.shippingAddress.postalCode&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Ú©Ø¯ Ù¾Ø³ØªÛŒ: ",D.shippingAddress.postalCode]})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-muted rounded-lg",children:(0,t.jsx)(x.Truck,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ø±ÙˆØ´ Ø§Ø±Ø³Ø§Ù„"}),(0,t.jsx)("p",{className:"font-semibold",children:"air"===D.shippingMethod?"Ù‡ÙˆØ§ÛŒÛŒ":"Ø¯Ø±ÛŒØ§ÛŒÛŒ"})]})]})]})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ§Ø±Ø´"})}),(0,t.jsx)(s.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Ø¬Ù…Ø¹ Ú©Ù„:"}),(0,t.jsxs)("span",{className:"font-semibold",children:[D.total.toLocaleString("fa-IR")," ØªÙˆÙ…Ø§Ù†"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„:"}),(0,t.jsx)("span",{className:"font-semibold",children:0===D.shippingCost?(0,t.jsx)("span",{className:"text-green-600",children:"Ø±Ø§ÛŒÚ¯Ø§Ù†"}):`${D.shippingCost.toLocaleString("fa-IR")} ØªÙˆÙ…Ø§Ù†`})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-3 border-t",children:[(0,t.jsx)("span",{className:"font-bold",children:"Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ:"}),(0,t.jsxs)("span",{className:"font-bold text-lg text-primary",children:[(D.total+D.shippingCost).toLocaleString("fa-IR")," ØªÙˆÙ…Ø§Ù†"]})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-3 border-t",children:[(0,t.jsx)("span",{children:"ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª:"}),(0,t.jsx)(C.Badge,{className:ep[D.paymentStatus]?.color,children:ep[D.paymentStatus]?.label})]})]})})]})]})]}),(0,t.jsx)(eh,{isOpen:_,onOpenChange:U})]})}function ef(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ..."}),children:(0,t.jsx)(ex,{})})}e.s(["default",()=>ef],71876)}]);
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10708,14294,e=>{"use strict";var t=e.i(92316),r=e.i(96040);e.i(68799);var a=e.i(83088),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,i)=>{let s=(0,a.createSlot)(`Primitive.${i}`),o=r.forwardRef((e,r)=>{let{asChild:a,...o}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(a?s:i,{...o,ref:r})});return o.displayName=`Primitive.${i}`,{...e,[i]:o}},{});e.s(["Primitive",()=>i],14294);var s=r.forwardRef((e,r)=>(0,t.jsx)(i.label,{...e,ref:r,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));s.displayName="Label";var o=e.i(94237),n=e.i(47163);let d=(0,o.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(s,{ref:a,className:(0,n.cn)(d(),e),...r}));c.displayName=s.displayName,e.s(["Label",()=>c],10708)},17513,e=>{"use strict";var t=e.i(82408),r=e.i(73493);let a=(0,t.create)((e,t)=>({categories:[],setCategories:t=>e({categories:t}),addCategory:t=>e(e=>{let r=e.categories.findIndex(e=>e.id===t.id);if(r>=0){let a=[...e.categories];return a[r]=t,{categories:a}}return{categories:[...e.categories,t]}}),updateCategory:t=>e(e=>{let r=e.categories.findIndex(e=>e.id===t.id);if(r>=0){let a=[...e.categories];return a[r]=t,{categories:a}}return e}),deleteCategory:t=>e(e=>({categories:e.categories.filter(e=>e.id!==t)})),toggleCategory:t=>e(e=>({categories:e.categories.map(e=>e.id===t?{...e,isActive:!e.isActive}:e)})),getCategory:e=>t().categories.find(t=>t.id===e),getActiveCategories:()=>t().categories.filter(e=>e.isActive&&e.enabled),getEnabledCategories:()=>t().categories.filter(e=>e.enabled),loadCategoriesFromDB:async(e=!1)=>{try{let r=await fetch(e?"/api/categories?all=true":"/api/categories");if(!r.ok)throw Error("خطا در بارگذاری دسته‌بندی‌ها");let a=(await r.json()).data||[];t().setCategories(a)}catch(e){r.logger.error("Error loading categories from DB:",e)}}}));e.s(["useCategoryStore",0,a])},70065,e=>{"use strict";var t=e.i(92316),r=e.i(96040),a=e.i(47163);let i=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("div",{ref:i,className:(0,a.cn)("rounded-lg border-[0.25px] border-border/3 bg-card text-card-foreground shadow-sm",e),...r}));i.displayName="Card";let s=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("div",{ref:i,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...r}));s.displayName="CardHeader";let o=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("h3",{ref:i,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r}));o.displayName="CardTitle";let n=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("p",{ref:i,className:(0,a.cn)("text-sm text-muted-foreground",e),...r}));n.displayName="CardDescription";let d=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("div",{ref:i,className:(0,a.cn)("p-6 pt-0",e),...r}));d.displayName="CardContent",r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("div",{ref:i,className:(0,a.cn)("flex items-center p-6 pt-0",e),...r})).displayName="CardFooter",e.s(["Card",()=>i,"CardContent",()=>d,"CardDescription",()=>n,"CardHeader",()=>s,"CardTitle",()=>o])},5685,e=>{"use strict";var t=e.i(96040);function r(e){let r=t.useRef({value:e,previous:e});return t.useMemo(()=>(r.current.value!==e&&(r.current.previous=r.current.value,r.current.value=e),r.current.previous),[e])}e.s(["usePrevious",()=>r])},19036,e=>{"use strict";var t=e.i(92316),r=e.i(96040),a=e.i(91967),i=e.i(60856),s=e.i(50439),o=e.i(68494),n=e.i(5685),d=e.i(40844),c=e.i(81026),l="Switch",[u,p]=(0,s.createContextScope)(l),[m,f]=u(l),g=r.forwardRef((e,s)=>{let{__scopeSwitch:n,name:d,checked:u,defaultChecked:p,required:f,disabled:g,value:h="on",onCheckedChange:x,form:y,...j}=e,[w,C]=r.useState(null),N=(0,i.useComposedRefs)(s,e=>C(e)),k=r.useRef(!1),S=!w||y||!!w.closest("form"),[R,A]=(0,o.useControllableState)({prop:u,defaultProp:p??!1,onChange:x,caller:l});return(0,t.jsxs)(m,{scope:n,checked:R,disabled:g,children:[(0,t.jsx)(c.Primitive.button,{type:"button",role:"switch","aria-checked":R,"aria-required":f,"data-state":v(R),"data-disabled":g?"":void 0,disabled:g,value:h,...j,ref:N,onClick:(0,a.composeEventHandlers)(e.onClick,e=>{A(e=>!e),S&&(k.current=e.isPropagationStopped(),k.current||e.stopPropagation())})}),S&&(0,t.jsx)(b,{control:w,bubbles:!k.current,name:d,value:h,checked:R,required:f,disabled:g,form:y,style:{transform:"translateX(-100%)"}})]})});g.displayName=l;var h="SwitchThumb",x=r.forwardRef((e,r)=>{let{__scopeSwitch:a,...i}=e,s=f(h,a);return(0,t.jsx)(c.Primitive.span,{"data-state":v(s.checked),"data-disabled":s.disabled?"":void 0,...i,ref:r})});x.displayName=h;var b=r.forwardRef(({__scopeSwitch:e,control:a,checked:s,bubbles:o=!0,...c},l)=>{let u=r.useRef(null),p=(0,i.useComposedRefs)(u,l),m=(0,n.usePrevious)(s),f=(0,d.useSize)(a);return r.useEffect(()=>{let e=u.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(m!==s&&t){let r=new Event("click",{bubbles:o});t.call(e,s),e.dispatchEvent(r)}},[m,s,o]),(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...c,tabIndex:-1,ref:p,style:{...c.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function v(e){return e?"checked":"unchecked"}b.displayName="SwitchBubbleInput";var y=e.i(47163);let j=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(g,{className:(0,y.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...r,ref:a,children:(0,t.jsx)(x,{className:(0,y.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));j.displayName=g.displayName,e.s(["Switch",()=>j],19036)},44745,e=>{"use strict";var t=e.i(92316),r=e.i(72836),a=e.i(84722),i=e.i(480),s=e.i(67881),o=e.i(23750),n=e.i(10708),d=e.i(84762),c=e.i(19036),l=e.i(70065),u=e.i(17513),p=e.i(20682),m=e.i(97923),f=e.i(86104),g=e.i(62767),h=e.i(10917);let x=i.object({name:i.string().min(1,"نام دسته‌بندی الزامی است"),description:i.string().optional(),isActive:i.boolean()});function b({category:e,onSuccess:i}){let b=(0,m.useRouter)(),{addCategory:v,updateCategory:y,loadCategoriesFromDB:j}=(0,u.useCategoryStore)(),{toast:w}=(0,p.useToast)(),C=(0,h.useQueryClient)(),{register:N,handleSubmit:k,formState:{errors:S,isSubmitting:R},setValue:A,watch:P}=(0,r.useForm)({resolver:(0,a.zodResolver)(x),defaultValues:e?{name:e.name,description:e.description||"",isActive:e.isActive}:{name:"",description:"",isActive:!0}}),T=P("isActive"),E=async t=>{try{if(e){let r=await fetch(`/api/categories/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||e.message||"خطا در به‌روزرسانی دسته‌بندی")}let a=await r.json();y(a.data),C.invalidateQueries({queryKey:["categories"]}),await j(),w({title:"موفق",description:"دسته‌بندی با موفقیت به‌روزرسانی شد"})}else{let e=await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let t=await e.json().catch(()=>({})),r=t.error||t.message||"خطا در ایجاد دسته‌بندی";if("DATABASE_NOT_AVAILABLE"===t.code)throw Error(`${r}

برای رفع این مشکل:
1. اطمینان حاصل کنید که PostgreSQL نصب و در حال اجرا است
2. بررسی کنید که متغیرهای محیطی (DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PASSWORD) به درستی تنظیم شده‌اند
3. دستور "pnpm setup-postgres-retry" را برای راه‌اندازی دیتابیس اجرا کنید`);throw Error(r)}let r=await e.json();v(r.data),C.invalidateQueries({queryKey:["categories"]}),await j(),w({title:"موفق",description:"دسته‌بندی با موفقیت اضافه شد"})}C.invalidateQueries({queryKey:["categories"]}),i?.(),b.push("/admin/categories")}catch(e){w({title:"خطا",description:e instanceof Error?e.message:"خطایی رخ داد. لطفاً دوباره تلاش کنید.",variant:"destructive"})}};return(0,t.jsxs)("form",{onSubmit:k(E),className:"space-y-6",children:[(0,t.jsxs)(l.Card,{className:"shadow-sm",children:[(0,t.jsx)(l.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.Package,{className:"h-5 w-5 text-primary"}),"اطلاعات دسته‌بندی"]})}),(0,t.jsxs)(l.CardContent,{className:"space-y-4 pt-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"name",children:"نام دسته‌بندی *"}),(0,t.jsx)(o.Input,{id:"name",...N("name"),placeholder:"مثال: تعلیق و ترمز"}),S.name&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:S.name.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"description",children:"توضیحات"}),(0,t.jsx)(d.Textarea,{id:"description",...N("description"),placeholder:"توضیحات اختیاری درباره این دسته‌بندی...",rows:3})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-border/30",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)(n.Label,{children:"فعال"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"دسته‌بندی فعال است و در لیست‌ها نمایش داده می‌شود"})]}),(0,t.jsx)(c.Switch,{checked:T,onCheckedChange:e=>A("isActive",e)})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4 pt-4 border-t border-border/30",children:[(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>b.back(),size:"lg",children:"انصراف"}),(0,t.jsx)(s.Button,{type:"submit",disabled:R,size:"lg",className:"min-w-[140px]",children:R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.Loader2,{className:"ml-2 h-4 w-4 animate-spin"}),"در حال ذخیره..."]}):e?"ذخیره تغییرات":"افزودن دسته‌بندی"})]})]})}e.s(["CategoryForm",()=>b])},78267,e=>{"use strict";var t=e.i(92316),r=e.i(44745),a=e.i(70065),i=e.i(17513),s=e.i(96040);function o(){let{loadCategoriesFromDB:e}=(0,i.useCategoryStore)();return(0,s.useEffect)(()=>{e()},[e]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent",children:"افزودن دسته‌بندی جدید"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"اطلاعات دسته‌بندی جدید را وارد کنید"})]}),(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"فرم دسته‌بندی"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)(r.CategoryForm,{})})]})]})}e.s(["default",()=>o])}]);
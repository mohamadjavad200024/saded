(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,48106,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(4967),i=e.i(88844),r=e.i(36361);function n({src:e,alt:n,fill:o=!1,width:c,height:l,className:d="",priority:m=!1,loading:h="eager",sizes:u,onError:p,placeholder:g="empty",blurDataURL:f,productId:b}){let y=(0,r.useProductStore)(),x=(0,s.useMemo)(()=>(0,a.getPlaceholderImage)(c||600,l||600),[c,l]),v=(0,s.useCallback)(()=>{if(e&&"string"==typeof e&&""!==e.trim()){let t=(0,a.normalizeImageUrl)(e.trim());if(t&&(0,a.validateImageUrl)(t))return t}if(b){let e=y.getProduct(b);if(e?.images&&Array.isArray(e.images)&&e.images.length>0){for(let t of e.images)if(t&&"string"==typeof t&&""!==t.trim()){let e=(0,a.normalizeImageUrl)(t.trim());if(e&&(0,a.validateImageUrl)(e))return e}}}return x},[e,b,x,y]),j=(0,s.useMemo)(()=>v(),[v]),[w,N]=(0,s.useState)(j),[I,S]=(0,s.useState)(!0),[T,C]=(0,s.useState)(!1),[k,O]=(0,s.useState)(!h||"eager"===h),P=(0,s.useRef)(null),E=(0,s.useRef)(0),L=(0,s.useRef)(null),D=(0,s.useRef)(null);(0,s.useEffect)(()=>{if("lazy"===h&&"IntersectionObserver"in window){let e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(O(!0),e.disconnect())})},{rootMargin:"50px",threshold:.01});return P.current&&(e.observe(P.current),D.current=e),()=>{D.current&&D.current.disconnect()}}O(!0)},[h]),(0,s.useEffect)(()=>{m&&j&&j!==x&&k&&(0,a.preloadImage)(j).catch(()=>{})},[m,j,x,k]),(0,s.useEffect)(()=>{j!==w&&(N(j),S(!0),C(!1),E.current=0,L.current&&clearTimeout(L.current))},[j,w]),(0,s.useEffect)(()=>{if(I&&w&&w!==x&&k)return L.current=setTimeout(()=>{I&&R()},3e4),()=>{L.current&&clearTimeout(L.current)}},[I,w,x,k]);let F=(0,s.useCallback)(()=>{L.current&&clearTimeout(L.current),S(!1),C(!1),E.current=0},[]),R=(0,s.useCallback)(()=>{L.current&&clearTimeout(L.current);let e=w||j;if(e===x){S(!1),C(!0),p?.();return}if(E.current<3){E.current+=1;let t=1e3*Math.pow(2,E.current-1),s=e;if((0,a.needsCacheBusting)(e))s=(0,a.addCacheBusting)(e);else{let t=e.includes("?")?"&":"?";s=`${e.split("&_t=")[0].split("?_t=")[0]}${t}_retry=${E.current}&_t=${Date.now()}`}L.current=setTimeout(()=>{P.current&&(P.current.src="",setTimeout(()=>{P.current&&(P.current.src=s)},100))},t)}else{if(S(!1),C(!0),b){let t=y.getProduct(b);if(t?.images&&Array.isArray(t.images)&&t.images.length>0){let s=t.images.find(t=>{if(!t||"string"!=typeof t||""===t.trim())return!1;let s=(0,a.normalizeImageUrl)(t.trim());return s&&(0,a.validateImageUrl)(s)&&s!==e&&s!==w});if(s){let e=(0,a.normalizeImageUrl)(s.trim());if(e&&(0,a.validateImageUrl)(e)){E.current=0,N(e),S(!0),C(!1);return}}}}N(x),p?.()}},[w,j,x,b,y,p]);(0,s.useEffect)(()=>()=>{L.current&&clearTimeout(L.current),D.current&&D.current.disconnect()},[]);let J=(0,s.useMemo)(()=>w&&""!==w.trim()?w:x,[w,x]),U={src:(0,s.useMemo)(()=>(0,a.validateImageUrl)(J),[J])?J:x,alt:n,onLoad:F,onError:R,loading:k?h:"lazy",className:"object-cover w-full h-full",style:{objectFit:"cover"},fetchPriority:m?"high":"auto",decoding:"async",crossOrigin:J.startsWith("http")&&!J.includes(window.location.origin)?"anonymous":void 0};return o?(0,t.jsxs)("div",{className:`relative ${d}`,style:{width:"100%",height:"100%"},children:[(0,t.jsx)("img",{...U,ref:P}),I&&!T&&(0,t.jsx)("div",{className:"absolute inset-0 bg-muted animate-pulse flex items-center justify-center z-10",children:(0,t.jsx)(i.Package,{className:"h-8 w-8 text-muted-foreground"})})]}):(0,t.jsxs)("div",{className:`relative ${d}`,style:{width:c,height:l},children:[(0,t.jsx)("img",{...U,ref:P}),I&&!T&&(0,t.jsx)("div",{className:"absolute inset-0 bg-muted animate-pulse flex items-center justify-center z-10",children:(0,t.jsx)(i.Package,{className:"h-8 w-8 text-muted-foreground"})})]})}e.s(["SafeImage",()=>n])},33488,e=>{"use strict";var t=e.i(6344),s=e.i(73493);let a={},i=(0,t.create)((e,t)=>({vehicles:[],filters:a,isLoading:!1,setVehicles:t=>e({vehicles:t}),addVehicle:t=>e(e=>{let s=e.vehicles.findIndex(e=>e.id===t.id);if(s>=0){let a=[...e.vehicles];return a[s]=t,{vehicles:a}}return{vehicles:[...e.vehicles,t]}}),updateVehicle:(t,s)=>e(e=>{let a=e.vehicles.findIndex(e=>e.id===t);if(a>=0){let t=[...e.vehicles];return t[a]={...t[a],...s,updatedAt:new Date},{vehicles:t}}return e}),deleteVehicle:t=>e(e=>({vehicles:e.vehicles.filter(e=>e.id!==t)})),getVehicle:e=>t().vehicles.find(t=>t.id===e),getEnabledVehicles:()=>t().vehicles.filter(e=>e.enabled),setFilters:t=>e(e=>({filters:{...e.filters,...t}})),clearFilters:()=>e({filters:a}),loadVehiclesFromDB:async()=>{e({isLoading:!0});try{let t=await fetch("/api/vehicles");if(!t.ok)throw Error("Failed to load vehicles");let s=await t.json();if(s.success&&s.data){let t=s.data.map(e=>({...e,models:Array.isArray(e.models)?e.models:e.models?JSON.parse(e.models):[],createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}));e({vehicles:t,isLoading:!1})}else throw Error(s.error||"Failed to load vehicles")}catch(t){throw s.logger.error("Error loading vehicles:",t),e({isLoading:!1}),t}}}));e.s(["useVehicleStore",0,i])},99682,e=>{"use strict";var t=e.i(71645);function s(e){let s=t.useRef({value:e,previous:e});return t.useMemo(()=>(s.current.value!==e&&(s.current.previous=s.current.value,s.current.value=e),s.current.previous),[e])}e.s(["usePrevious",()=>s])},7233,e=>{"use strict";let t=(0,e.i(75254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},19036,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(81140),i=e.i(20783),r=e.i(30030),n=e.i(69340),o=e.i(99682),c=e.i(35804),l=e.i(48425),d="Switch",[m,h]=(0,r.createContextScope)(d),[u,p]=m(d),g=s.forwardRef((e,r)=>{let{__scopeSwitch:o,name:c,checked:m,defaultChecked:h,required:p,disabled:g,value:f="on",onCheckedChange:b,form:v,...j}=e,[w,N]=s.useState(null),I=(0,i.useComposedRefs)(r,e=>N(e)),S=s.useRef(!1),T=!w||v||!!w.closest("form"),[C,k]=(0,n.useControllableState)({prop:m,defaultProp:h??!1,onChange:b,caller:d});return(0,t.jsxs)(u,{scope:o,checked:C,disabled:g,children:[(0,t.jsx)(l.Primitive.button,{type:"button",role:"switch","aria-checked":C,"aria-required":p,"data-state":x(C),"data-disabled":g?"":void 0,disabled:g,value:f,...j,ref:I,onClick:(0,a.composeEventHandlers)(e.onClick,e=>{k(e=>!e),T&&(S.current=e.isPropagationStopped(),S.current||e.stopPropagation())})}),T&&(0,t.jsx)(y,{control:w,bubbles:!S.current,name:c,value:f,checked:C,required:p,disabled:g,form:v,style:{transform:"translateX(-100%)"}})]})});g.displayName=d;var f="SwitchThumb",b=s.forwardRef((e,s)=>{let{__scopeSwitch:a,...i}=e,r=p(f,a);return(0,t.jsx)(l.Primitive.span,{"data-state":x(r.checked),"data-disabled":r.disabled?"":void 0,...i,ref:s})});b.displayName=f;var y=s.forwardRef(({__scopeSwitch:e,control:a,checked:r,bubbles:n=!0,...l},d)=>{let m=s.useRef(null),h=(0,i.useComposedRefs)(m,d),u=(0,o.usePrevious)(r),p=(0,c.useSize)(a);return s.useEffect(()=>{let e=m.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(u!==r&&t){let s=new Event("click",{bubbles:n});t.call(e,r),e.dispatchEvent(s)}},[u,r,n]),(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...l,tabIndex:-1,ref:h,style:{...l.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function x(e){return e?"checked":"unchecked"}y.displayName="SwitchBubbleInput";var v=e.i(47163);let j=s.forwardRef(({className:e,...s},a)=>(0,t.jsx)(g,{className:(0,v.cn)("peer inline-flex h-6 w-12 shrink-0 cursor-pointer items-center rounded-full border-2 transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-green-500 data-[state=checked]:border-green-500 data-[state=unchecked]:bg-muted data-[state=unchecked]:border-transparent px-0.5",e),...s,ref:a,children:(0,t.jsx)(b,{className:(0,v.cn)("pointer-events-none block h-5 w-5 rounded-full shadow-lg ring-0 transition-all duration-200 ease-in-out data-[state=checked]:-translate-x-6 data-[state=unchecked]:translate-x-0 data-[state=checked]:bg-primary-foreground data-[state=unchecked]:bg-foreground")})}));j.displayName=g.displayName,e.s(["Switch",()=>j],19036)},69074,e=>{"use strict";let t=(0,e.i(75254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>t],69074)},65399,e=>{"use strict";e.i(47167);var t=e.i(43476),s=e.i(53145),a=e.i(94814),i=e.i(65638),r=e.i(67881),n=e.i(23750),o=e.i(10708),c=e.i(19036),l=e.i(70065),d=e.i(33488),m=e.i(20682),h=e.i(18566),u=e.i(71645),p=e.i(31278),g=e.i(5125),f=e.i(7233),b=e.i(37727),y=e.i(12598),x=e.i(69074),v=e.i(73708),j=e.i(48106),w=e.i(47163);function N({image:e,onChange:s,className:a,label:i="لوگو"}){let[n,o]=(0,u.useState)(!1),c=(0,u.useRef)(null),{toast:l}=(0,m.useToast)(),d=async e=>{let t=e.target.files?.[0];if(t){if(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:27",message:"File selected",data:{fileName:t.name,fileSize:t.size,fileType:t.type},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{}),!t.type.startsWith("image/"))return void l({title:"خطا",description:"فقط فایل‌های تصویری مجاز هستند",variant:"destructive"});if(t.size>5242880)return void l({title:"خطا",description:"حجم فایل نباید بیشتر از 5 مگابایت باشد",variant:"destructive"});o(!0);try{let e=await new Promise((e,s)=>{let a=new FileReader;a.onload=t=>{let a=new Image;a.onload=()=>{fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:60",message:"Image loaded for compression",data:{originalWidth:a.width,originalHeight:a.height},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{});let t=document.createElement("canvas"),i=t.getContext("2d");if(!i)return void s(Error("Could not get canvas context"));let r=a.width,n=a.height;(r>800||n>800)&&(r>n?(n=n/r*800,r=800):(r=r/n*800,n=800)),t.width=r,t.height=n,i.drawImage(a,0,0,r,n);let o=t.toDataURL("image/jpeg",.85);if(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:90",message:"First compression done",data:{compressedWidth:r,compressedHeight:n,base64Length:o.length,isTooLarge:o.length>1048576},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{}),o.length>1048576){let s=t.toDataURL("image/jpeg",.7);fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:94",message:"Second compression done",data:{finalBase64Length:s.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{}),e(s)}else e(o)},a.onerror=()=>s(Error("Failed to load image")),a.src=t.target?.result},a.onerror=()=>s(Error("Failed to read file")),a.readAsDataURL(t)});fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:108",message:"Compression complete, calling onChange",data:{finalLength:e.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{}),s(e),o(!1),l({title:"موفق",description:"تصویر با موفقیت آپلود شد"})}catch(e){fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/single-image-upload.tsx:115",message:"Compression error",data:{error:e instanceof Error?e.message:String(e)},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"E"})}).catch(()=>{}),o(!1),l({title:"خطا",description:e instanceof Error?e.message:"خطا در آپلود تصویر",variant:"destructive"})}}};return(0,t.jsxs)("div",{className:(0,w.cn)("space-y-2",a),children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:i}),(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[e?(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("div",{className:"w-24 h-24 rounded-lg border-2 border-border overflow-hidden bg-muted flex items-center justify-center",children:(0,t.jsx)(j.SafeImage,{src:e,alt:i,className:"w-full h-full object-contain",fallback:(0,t.jsx)(v.Image,{className:"h-8 w-8 text-muted-foreground"})})}),(0,t.jsx)(r.Button,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{s(null),c.current&&(c.current.value="")},children:(0,t.jsx)(b.X,{className:"h-3 w-3"})})]}):(0,t.jsx)("div",{className:"w-24 h-24 rounded-lg border-2 border-dashed border-border flex items-center justify-center bg-muted/30",children:(0,t.jsx)(v.Image,{className:"h-8 w-8 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",onClick:()=>c.current?.click(),disabled:n,className:"w-full",children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Loader2,{className:"ml-2 h-4 w-4 animate-spin"}),"در حال آپلود..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Upload,{className:"ml-2 h-4 w-4"}),e?"تغییر لوگو":"آپلود لوگو"]})}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"فرمت‌های مجاز: JPG, PNG, GIF (حداکثر 5MB)"})]})]}),(0,t.jsx)("input",{ref:c,type:"file",accept:"image/*",onChange:d,className:"hidden"})]})}let I=i.object({name:i.string().min(1,"نام خودرو الزامی است"),logo:i.string().optional().nullable(),models:i.array(i.string()).default([]),enabled:i.boolean()});function S({vehicle:e,onSuccess:i}){let x=(0,h.useRouter)(),{addVehicle:v,updateVehicle:j,loadVehiclesFromDB:w}=(0,d.useVehicleStore)(),{toast:S}=(0,m.useToast)(),T=(0,y.useQueryClient)(),[C,k]=(0,u.useState)(""),{register:O,handleSubmit:P,formState:{errors:E,isSubmitting:L},setValue:D,watch:F}=(0,s.useForm)({resolver:(0,a.zodResolver)(I),defaultValues:e?{name:e.name,logo:e.logo||"",models:e.models||[],enabled:e.enabled}:{name:"",logo:"",models:[],enabled:!0}}),R=F("models")||[],J=F("enabled"),U=F("logo"),A=()=>{if(C.trim()){let e=F("models")||[];e.includes(C.trim())||(D("models",[...e,C.trim()]),k(""))}},B=async t=>{fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:83",message:"onSubmit entry",data:{hasVehicle:!!e,vehicleId:e?.id,logoType:typeof t.logo,logoLength:t.logo?t.logo.length:0},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{});try{let s=t.logo&&""!==t.logo.trim()?t.logo:null;if(s&&s.length>1048576){fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:120",message:"Logo too large, compressing",data:{originalLength:s.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{});try{s=await ((e,t=1048576)=>new Promise((s,a)=>{if(e.length<=t)return void s(e);let i=new Image;i.onload=()=>{let e=document.createElement("canvas"),r=e.getContext("2d");if(!r)return void a(Error("Could not get canvas context"));let n=i.width,o=i.height;for(let a of((n>800||o>800)&&(n>o?(o=o/n*800,n=800):(n=n/o*800,o=800)),e.width=n,e.height=o,r.drawImage(i,0,0,n,o),[.85,.7,.6,.5])){let i=e.toDataURL("image/jpeg",a);if(i.length<=t)return void s(i)}s(e.toDataURL("image/jpeg",.4))},i.onerror=()=>a(Error("Failed to load image")),i.src=e}))(s,1048576),fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:125",message:"Logo compressed",data:{compressedLength:s.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{})}catch(e){fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:128",message:"Compression failed",data:{error:e instanceof Error?e.message:String(e)},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{}),s=null}}let a={...t,logo:s};if(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:140",message:"Payload prepared",data:{payloadLogoType:typeof a.logo,payloadLogoLength:a.logo?a.logo.length:0,payloadLogoIsNull:null===a.logo},timestamp:Date.now(),sessionId:"debug-session",runId:"run2",hypothesisId:"F"})}).catch(()=>{}),e){let t;try{t=JSON.stringify(a),fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:102",message:"Before fetch PUT",data:{jsonLength:t.length,vehicleId:e.id},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{})}catch(e){throw fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:102",message:"JSON.stringify error",data:{error:e?.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),e}let s=await fetch(`/api/vehicles/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:t});if(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:110",message:"After fetch PUT",data:{responseOk:s.ok,responseStatus:s.status,responseStatusText:s.statusText},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),!s.ok){fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:110",message:"Response not OK",data:{status:s.status,statusText:s.statusText},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{});let e=await s.json().catch(e=>(fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:111",message:"Error response JSON parse failed",data:{error:e?.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),{}));throw fetch("http://127.0.0.1:7242/ingest/6e2493c0-cc8b-4c0b-9456-c04638b7e615",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"components/admin/vehicle-form.tsx:112",message:"Error data parsed",data:{errorMessage:e.error||e.message},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"})}).catch(()=>{}),Error(e.error||e.message||"خطا در به‌روزرسانی خودرو")}let i=await s.json();j(e.id,i.data),await w(),S({title:"موفق",description:"خودرو با موفقیت به‌روزرسانی شد"})}else{let e=await fetch("/api/vehicles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||"خطا در ایجاد خودرو")}let t=await e.json();v(t.data),await w(),S({title:"موفق",description:"خودرو با موفقیت اضافه شد"})}T.invalidateQueries({queryKey:["vehicles"]}),i?.(),x.push("/admin/vehicles")}catch(e){S({title:"خطا",description:e instanceof Error?e.message:"خطایی رخ داد. لطفاً دوباره تلاش کنید.",variant:"destructive"})}};return(0,t.jsxs)("form",{onSubmit:P(B),className:"space-y-6",children:[(0,t.jsxs)(l.Card,{className:"shadow-sm",children:[(0,t.jsx)(l.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.Car,{className:"h-5 w-5 text-primary"}),"اطلاعات خودرو"]})}),(0,t.jsxs)(l.CardContent,{className:"space-y-6 pt-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"name",children:"نام خودرو *"}),(0,t.jsx)(n.Input,{id:"name",...O("name"),placeholder:"مثال: BMW",className:"h-11"}),E.name&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:E.name.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(N,{image:U||null,onChange:e=>D("logo",e||null),label:"لوگو خودرو"}),E.logo&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:E.logo.message})]})]}),(0,t.jsxs)("div",{className:"space-y-3 pt-4 border-t border-border/30",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(o.Label,{className:"text-base font-semibold",children:"مدل‌های خودرو"}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:[R.length," مدل"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.Input,{value:C,onChange:e=>k(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),A())},placeholder:"نام مدل (مثال: X5)",className:"h-11"}),(0,t.jsxs)(r.Button,{type:"button",onClick:A,variant:"outline",className:"h-11 px-4",disabled:!C.trim(),children:[(0,t.jsx)(f.Plus,{className:"ml-2 h-4 w-4"}),"افزودن"]})]}),R.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-3 p-4 bg-muted/30 rounded-lg border border-border/30",children:R.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-background border border-border px-3 py-2 rounded-md shadow-sm hover:shadow-md transition-shadow",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:e}),(0,t.jsx)(r.Button,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-destructive/10 hover:text-destructive",onClick:()=>{D("models",(F("models")||[]).filter((e,t)=>t!==s))},children:(0,t.jsx)(b.X,{className:"h-3.5 w-3.5"})})]},s))}),0===R.length&&(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground border border-dashed border-border/30 rounded-lg bg-muted/20",children:[(0,t.jsx)(g.Car,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{className:"text-sm",children:"هنوز مدلی اضافه نشده است"})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-border/30",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)(o.Label,{children:"فعال"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"خودرو فعال است و در لیست‌ها نمایش داده می‌شود"})]}),(0,t.jsx)(c.Switch,{checked:J,onCheckedChange:e=>D("enabled",e)})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4 pt-4 border-t border-border/30",children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",onClick:()=>x.back(),size:"lg",children:"انصراف"}),(0,t.jsx)(r.Button,{type:"submit",disabled:L,size:"lg",className:"min-w-[140px]",children:L?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Loader2,{className:"ml-2 h-4 w-4 animate-spin"}),"در حال ذخیره..."]}):e?"ذخیره تغییرات":"افزودن خودرو"})]})]})}e.s(["VehicleForm",()=>S],65399)},47950,e=>{"use strict";var t=e.i(43476),s=e.i(65399),a=e.i(70065),i=e.i(33488),r=e.i(71645),n=e.i(18566),o=e.i(31278);function c(){let e=(0,n.useParams)().id,{getVehicle:c,loadVehiclesFromDB:l}=(0,i.useVehicleStore)(),[d,m]=(0,r.useState)(null),[h,u]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{(async()=>{u(!0);try{await l();let t=c(e);if(t)m(t);else{let t=await fetch(`/api/vehicles/${e}`);if(t.ok){let e=await t.json();m(e.data)}}}catch(e){console.error("Error loading vehicle:",e)}finally{u(!1)}})()},[e,c,l]),h)?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(o.Loader2,{className:"h-8 w-8 animate-spin text-primary"})}):d?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent",children:"ویرایش خودرو"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"اطلاعات خودرو را ویرایش کنید"})]}),(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"فرم خودرو"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)(s.VehicleForm,{vehicle:d})})]})]}):(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"خودرو یافت نشد"})})}e.s(["default",()=>c])}]);
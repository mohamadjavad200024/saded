(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},98183,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={assign:function(){return l},searchParamsToUrlQuery:function(){return o},urlQueryToSearchParams:function(){return i}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});function o(e){let t={};for(let[r,a]of e.entries()){let e=t[r];void 0===e?t[r]=a:Array.isArray(e)?e.push(a):t[r]=[e,a]}return t}function s(e){return"string"==typeof e?e:("number"!=typeof e||isNaN(e))&&"boolean"!=typeof e?"":String(e)}function i(e){let t=new URLSearchParams;for(let[r,a]of Object.entries(e))if(Array.isArray(a))for(let e of a)t.append(r,s(e));else t.set(r,s(a));return t}function l(e,...t){for(let r of t){for(let t of r.keys())e.delete(t);for(let[t,a]of r.entries())e.append(t,a)}return e}},95057,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={formatUrl:function(){return i},formatWithValidation:function(){return u},urlObjectKeys:function(){return l}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});let o=e.r(90809)._(e.r(98183)),s=/https?|ftp|gopher|file/;function i(e){let{auth:t,hostname:r}=e,a=e.protocol||"",n=e.pathname||"",i=e.hash||"",l=e.query||"",u=!1;t=t?encodeURIComponent(t).replace(/%3A/i,":")+"@":"",e.host?u=t+e.host:r&&(u=t+(~r.indexOf(":")?`[${r}]`:r),e.port&&(u+=":"+e.port)),l&&"object"==typeof l&&(l=String(o.urlQueryToSearchParams(l)));let d=e.search||l&&`?${l}`||"";return a&&!a.endsWith(":")&&(a+=":"),e.slashes||(!a||s.test(a))&&!1!==u?(u="//"+(u||""),n&&"/"!==n[0]&&(n="/"+n)):u||(u=""),i&&"#"!==i[0]&&(i="#"+i),d&&"?"!==d[0]&&(d="?"+d),n=n.replace(/[?#]/g,encodeURIComponent),d=d.replace("#","%23"),`${a}${u}${n}${d}${i}`}let l=["auth","hash","host","hostname","href","path","pathname","port","protocol","query","search","slashes"];function u(e){return i(e)}},18581,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"useMergedRef",{enumerable:!0,get:function(){return n}});let a=e.r(71645);function n(e,t){let r=(0,a.useRef)(null),n=(0,a.useRef)(null);return(0,a.useCallback)(a=>{if(null===a){let e=r.current;e&&(r.current=null,e());let t=n.current;t&&(n.current=null,t())}else e&&(r.current=o(e,a)),t&&(n.current=o(t,a))},[e,t])}function o(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},18967,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={DecodeError:function(){return y},MiddlewareNotFoundError:function(){return A},MissingStaticPage:function(){return v},NormalizeError:function(){return b},PageNotFoundError:function(){return S},SP:function(){return p},ST:function(){return m},WEB_VITALS:function(){return o},execOnce:function(){return s},getDisplayName:function(){return c},getLocationOrigin:function(){return u},getURL:function(){return d},isAbsoluteUrl:function(){return l},isResSent:function(){return g},loadGetInitialProps:function(){return h},normalizeRepeatedSlashes:function(){return f},stringifyError:function(){return E}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});let o=["CLS","FCP","FID","INP","LCP","TTFB"];function s(e){let t,r=!1;return(...a)=>(r||(r=!0,t=e(...a)),t)}let i=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,l=e=>i.test(e);function u(){let{protocol:e,hostname:t,port:r}=window.location;return`${e}//${t}${r?":"+r:""}`}function d(){let{href:e}=window.location,t=u();return e.substring(t.length)}function c(e){return"string"==typeof e?e:e.displayName||e.name||"Unknown"}function g(e){return e.finished||e.headersSent}function f(e){let t=e.split("?");return t[0].replace(/\\/g,"/").replace(/\/\/+/g,"/")+(t[1]?`?${t.slice(1).join("?")}`:"")}async function h(e,t){let r=t.res||t.ctx&&t.ctx.res;if(!e.getInitialProps)return t.ctx&&t.Component?{pageProps:await h(t.Component,t.ctx)}:{};let a=await e.getInitialProps(t);if(r&&g(r))return a;if(!a)throw Object.defineProperty(Error(`"${c(e)}.getInitialProps()" should resolve to an object. But found "${a}" instead.`),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return a}let p="undefined"!=typeof performance,m=p&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class y extends Error{}class b extends Error{}class S extends Error{constructor(e){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message=`Cannot find module for page: ${e}`}}class v extends Error{constructor(e,t){super(),this.message=`Failed to load static file for page: ${e} ${t}`}}class A extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}}function E(e){return JSON.stringify({message:e.message,stack:e.stack})}},73668,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isLocalURL",{enumerable:!0,get:function(){return o}});let a=e.r(18967),n=e.r(52817);function o(e){if(!(0,a.isAbsoluteUrl)(e))return!0;try{let t=(0,a.getLocationOrigin)(),r=new URL(e,t);return r.origin===t&&(0,n.hasBasePath)(r.pathname)}catch(e){return!1}}},84508,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"errorOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},22016,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={default:function(){return y},useLinkStatus:function(){return S}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});let o=e.r(90809),s=e.r(43476),i=o._(e.r(71645)),l=e.r(95057),u=e.r(8372),d=e.r(18581),c=e.r(18967),g=e.r(5550);e.r(33525);let f=e.r(91949),h=e.r(73668),p=e.r(9396);function m(e){return"string"==typeof e?e:(0,l.formatUrl)(e)}function y(t){var r;let a,n,o,[l,y]=(0,i.useOptimistic)(f.IDLE_LINK_STATUS),S=(0,i.useRef)(null),{href:v,as:A,children:E,prefetch:w=null,passHref:O,replace:C,shallow:T,scroll:I,onClick:P,onMouseEnter:j,onTouchStart:_,legacyBehavior:k=!1,onNavigate:N,ref:x,unstable_dynamicOnHover:D,...L}=t;a=E,k&&("string"==typeof a||"number"==typeof a)&&(a=(0,s.jsx)("a",{children:a}));let M=i.default.useContext(u.AppRouterContext),$=!1!==w,R=!1!==w?null===(r=w)||"auto"===r?p.FetchStrategy.PPR:p.FetchStrategy.Full:p.FetchStrategy.PPR,{href:U,as:z}=i.default.useMemo(()=>{let e=m(v);return{href:e,as:A?m(A):e}},[v,A]);if(k){if(a?.$$typeof===Symbol.for("react.lazy"))throw Object.defineProperty(Error("`<Link legacyBehavior>` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's `<a>` tag."),"__NEXT_ERROR_CODE",{value:"E863",enumerable:!1,configurable:!0});n=i.default.Children.only(a)}let F=k?n&&"object"==typeof n&&n.ref:x,J=i.default.useCallback(e=>(null!==M&&(S.current=(0,f.mountLinkInstance)(e,U,M,R,$,y)),()=>{S.current&&((0,f.unmountLinkForCurrentNavigation)(S.current),S.current=null),(0,f.unmountPrefetchableInstance)(e)}),[$,U,M,R,y]),B={ref:(0,d.useMergedRef)(J,F),onClick(t){k||"function"!=typeof P||P(t),k&&n.props&&"function"==typeof n.props.onClick&&n.props.onClick(t),!M||t.defaultPrevented||function(t,r,a,n,o,s,l){if("undefined"!=typeof window){let u,{nodeName:d}=t.currentTarget;if("A"===d.toUpperCase()&&((u=t.currentTarget.getAttribute("target"))&&"_self"!==u||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||t.nativeEvent&&2===t.nativeEvent.which)||t.currentTarget.hasAttribute("download"))return;if(!(0,h.isLocalURL)(r)){o&&(t.preventDefault(),location.replace(r));return}if(t.preventDefault(),l){let e=!1;if(l({preventDefault:()=>{e=!0}}),e)return}let{dispatchNavigateAction:c}=e.r(99781);i.default.startTransition(()=>{c(a||r,o?"replace":"push",s??!0,n.current)})}}(t,U,z,S,C,I,N)},onMouseEnter(e){k||"function"!=typeof j||j(e),k&&n.props&&"function"==typeof n.props.onMouseEnter&&n.props.onMouseEnter(e),M&&$&&(0,f.onNavigationIntent)(e.currentTarget,!0===D)},onTouchStart:function(e){k||"function"!=typeof _||_(e),k&&n.props&&"function"==typeof n.props.onTouchStart&&n.props.onTouchStart(e),M&&$&&(0,f.onNavigationIntent)(e.currentTarget,!0===D)}};return(0,c.isAbsoluteUrl)(z)?B.href=z:k&&!O&&("a"!==n.type||"href"in n.props)||(B.href=(0,g.addBasePath)(z)),o=k?i.default.cloneElement(n,B):(0,s.jsx)("a",{...L,...B,children:a}),(0,s.jsx)(b.Provider,{value:l,children:o})}e.r(84508);let b=(0,i.createContext)(f.IDLE_LINK_STATUS),S=()=>(0,i.useContext)(b);("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},79473,e=>{"use strict";let t={get url(){return`file://${e.P("node_modules/zustand/esm/middleware.mjs")}`}};function r(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var a;let n=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),o=null!=(a=r.getItem(e))?a:null;return o instanceof Promise?o.then(n):n(o)},setItem:(e,a)=>r.setItem(e,JSON.stringify(a,null==t?void 0:t.replacer)),removeItem:e=>r.removeItem(e)}}let a=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>a(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>a(t)(e)}}},n=(e,n)=>{if("getStorage"in n||"serialize"in n||"deserialize"in n)return(t.env?t.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),(t,r,o)=>{let s,i,l={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...n},u=!1,d=new Set,c=new Set;try{s=l.getStorage()}catch(e){}if(!s)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),t(...e)},r,o);let g=a(l.serialize),f=()=>{let e,t=g({state:l.partialize({...r()}),version:l.version}).then(e=>s.setItem(l.name,e)).catch(t=>{e=t});if(e)throw e;return t},h=o.setState;o.setState=(e,t)=>{h(e,t),f()};let p=e((...e)=>{t(...e),f()},r,o),m=()=>{var e;if(!s)return;u=!1,d.forEach(e=>e(r()));let n=(null==(e=l.onRehydrateStorage)?void 0:e.call(l,r()))||void 0;return a(s.getItem.bind(s))(l.name).then(e=>{if(e)return l.deserialize(e)}).then(e=>{if(e)if("number"!=typeof e.version||e.version===l.version)return e.state;else{if(l.migrate)return l.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}}).then(e=>{var a;return t(i=l.merge(e,null!=(a=r())?a:p),!0),f()}).then(()=>{null==n||n(i,void 0),u=!0,c.forEach(e=>e(i))}).catch(e=>{null==n||n(void 0,e)})};return o.persist={setOptions:e=>{l={...l,...e},e.getStorage&&(s=e.getStorage())},clearStorage:()=>{null==s||s.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>m(),hasHydrated:()=>u,onHydrate:e=>(d.add(e),()=>{d.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},m(),i||p};return(t,o,s)=>{let i,l={storage:r(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...n},u=!1,d=new Set,c=new Set,g=l.storage;if(!g)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),t(...e)},o,s);let f=()=>{let e=l.partialize({...o()});return g.setItem(l.name,{state:e,version:l.version})},h=s.setState;s.setState=(e,t)=>{h(e,t),f()};let p=e((...e)=>{t(...e),f()},o,s);s.getInitialState=()=>p;let m=()=>{var e,r;if(!g)return;u=!1,d.forEach(e=>{var t;return e(null!=(t=o())?t:p)});let n=(null==(r=l.onRehydrateStorage)?void 0:r.call(l,null!=(e=o())?e:p))||void 0;return a(g.getItem.bind(g))(l.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===l.version)return[!1,e.state];else{if(l.migrate)return[!0,l.migrate(e.state,e.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var r;let[a,n]=e;if(t(i=l.merge(n,null!=(r=o())?r:p),!0),a)return f()}).then(()=>{null==n||n(i,void 0),i=o(),u=!0,c.forEach(e=>e(i))}).catch(e=>{null==n||n(void 0,e)})};return s.persist={setOptions:e=>{l={...l,...e},e.storage&&(g=e.storage)},clearStorage:()=>{null==g||g.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>m(),hasHydrated:()=>u,onHydrate:e=>(d.add(e),()=>{d.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},l.skipHydration||m(),i||p}};e.s(["createJSONStorage",()=>r,"persist",()=>n])},93226,e=>{"use strict";var t=e.i(6344),r=e.i(79473);let a=(0,t.create)()((0,r.persist)((e,t)=>({user:null,isAuthenticated:!1,isCheckingAuth:!1,hasCheckedAuth:!1,register:async(t,r,a)=>{let n=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:t,phone:r,password:a})}),o=await n.json();if(!o.success)throw Error(o.error||o.message||"خطا در ثبت‌نام");e({user:{id:o.data.user.id,name:o.data.user.name,phone:o.data.user.phone,role:o.data.user.role||"user",createdAt:o.data.user.createdAt},isAuthenticated:!0,hasCheckedAuth:!0})},login:async(t,r)=>{let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({phone:t,password:r})}),n=await a.json();return!!n.success&&(e({user:{id:n.data.user.id,name:n.data.user.name,phone:n.data.user.phone,role:n.data.user.role||"user",createdAt:n.data.user.createdAt},isAuthenticated:!0,hasCheckedAuth:!0}),!0)},logout:async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch{}finally{e({user:null,isAuthenticated:!1,hasCheckedAuth:!0})}},checkAuth:async()=>{let{isCheckingAuth:r}=t();if(!r){e({isCheckingAuth:!0});try{let t=new AbortController,r=setTimeout(()=>t.abort(),1e4),a=await fetch("/api/auth/me",{method:"GET",credentials:"include",cache:"no-store",headers:{"Cache-Control":"no-cache"},signal:t.signal});clearTimeout(r);let n=await a.json().catch(()=>null);if(a.ok&&n?.success)if(n.data?.authenticated&&n.data?.user){let t=n.data.user;e({user:{id:t.id,name:t.name,phone:t.phone,role:t.role||"user",createdAt:t.createdAt},isAuthenticated:!0,hasCheckedAuth:!0})}else e({user:null,isAuthenticated:!1,hasCheckedAuth:!0});else e({user:null,isAuthenticated:!1,hasCheckedAuth:!0})}catch(t){e({user:null,isAuthenticated:!1,hasCheckedAuth:!0,isCheckingAuth:!1})}finally{e({isCheckingAuth:!1})}}},updateUser:r=>{let{user:a}=t();a&&e({user:{...a,...r}})}}),{name:"saded_auth",storage:(0,r.createJSONStorage)(()=>localStorage),partialize:e=>({user:e.user,isAuthenticated:e.isAuthenticated})}));e.s(["useAuthStore",0,a])},60366,e=>{"use strict";var t=e.i(6344),r=e.i(73493),a=e.i(93226);let n={},o=(0,t.create)((t,o)=>({orders:[],filters:n,isLoading:!1,setOrders:e=>t({orders:e}),addOrder:e=>t(t=>{let r=t.orders.findIndex(t=>t.id===e.id);if(r>=0){let a=[...t.orders];return a[r]=e,{orders:a}}return{orders:[...t.orders,e]}}),updateOrder:(e,r)=>t(t=>{let a=t.orders.findIndex(t=>t.id===e);if(a>=0){let e=[...t.orders];return e[a]={...e[a],...r},{orders:e}}return t}),updateOrderStatus:(e,r)=>t(t=>({orders:t.orders.map(t=>t.id===e?{...t,status:r,updatedAt:new Date}:t)})),updatePaymentStatus:(e,r)=>t(t=>({orders:t.orders.map(t=>t.id===e?{...t,paymentStatus:r,updatedAt:new Date}:t)})),deleteOrder:e=>t(t=>({orders:t.orders.filter(t=>t.id!==e)})),getOrder:e=>o().orders.find(t=>t.id===e),setFilters:e=>t(t=>({filters:{...t.filters,...e}})),clearFilters:()=>t({filters:n}),loadOrdersFromDB:async()=>{t({isLoading:!0});try{let n=new AbortController,o=setTimeout(()=>n.abort(),15e3),{fetchWithAuth:s}=await e.A(91079);r.logger.debug("Loading orders from database...");let i=a.useAuthStore.getState();console.log("[OrderStore] Auth state before request:",{isAuthenticated:i.isAuthenticated,hasUser:!!i.user,userId:i.user?.id,hasCheckedAuth:i.hasCheckedAuth});let l={"Cache-Control":"no-cache"};i.user?.id&&(l["x-user-id"]=i.user.id,console.log("[OrderStore] Adding userId header (fallback):",i.user.id));let u=await s("/api/orders",{signal:n.signal,credentials:"include",cache:"no-store",headers:l});if(console.log("[OrderStore] Response status:",u.status),clearTimeout(o),u.ok){let e;try{e=await u.json()}catch(e){r.logger.error("Error parsing orders response:",e),t({orders:[],isLoading:!1});return}if(console.log("[OrderStore] Response from /api/orders:",{success:e.success,dataLength:e.data?.length||0,hasData:!!e.data}),e.success&&e.data)try{let a=e.data.map(e=>{let t=[],a={};try{t=Array.isArray(e.items)?e.items:"string"==typeof e.items?JSON.parse(e.items):[]}catch(a){r.logger.warn("Error parsing items for order:",e.id,a),t=[]}try{a="object"==typeof e.shippingAddress&&null!==e.shippingAddress?e.shippingAddress:"string"==typeof e.shippingAddress?JSON.parse(e.shippingAddress):{}}catch(t){r.logger.warn("Error parsing shippingAddress for order:",e.id,t),a={}}return{...e,items:t,shippingAddress:a,total:Number(e.total)||0,shippingCost:Number(e.shippingCost)||0,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)}});r.logger.info(`✅ Loaded ${a.length} orders from database`),t({orders:a,isLoading:!1})}catch(e){r.logger.error("Error parsing orders data:",e),t({orders:[],isLoading:!1})}else r.logger.info("No orders found in database"),t({orders:[],isLoading:!1})}else{let e=await u.text().catch(()=>"Unknown error");if(r.logger.error(`Failed to load orders: ${u.status} - ${e}`),401===u.status)return void t({orders:[],isLoading:!1});t({orders:[],isLoading:!1})}}catch(e){e instanceof Error&&"AbortError"!==e.name&&r.logger.error("Error loading orders from DB:",e),t({orders:[],isLoading:!1})}}}));e.s(["useOrderStore",0,o])},61180,e=>{"use strict";var t=e.i(6344),r=e.i(79473),a=e.i(73493);let n=(0,r.createJSONStorage)(()=>({getItem:e=>{if("undefined"==typeof localStorage)return null;try{return localStorage.getItem(e)}catch(e){return a.logger.error("Error reading from localStorage:",e),null}},setItem:(e,t)=>{if("undefined"!=typeof localStorage)try{if(new Blob([t]).size>4194304){a.logger.warn("Cart data too large, clearing old items");try{let r=JSON.parse(t);if(r.state?.items&&Array.isArray(r.state.items)){r.state.items=r.state.items.slice(-50);let t=JSON.stringify(r);if(new Blob([t]).size<4194304)return void localStorage.setItem(e,t)}}catch(e){}throw localStorage.removeItem(e),Error("QUOTA_EXCEEDED")}localStorage.setItem(e,t)}catch(t){if(t?.name==="QuotaExceededError"||t?.message==="QUOTA_EXCEEDED"){a.logger.error("localStorage quota exceeded. Clearing cart data.");try{localStorage.removeItem(e);let t=JSON.stringify({state:{items:[],shippingMethod:null},version:0});localStorage.setItem(e,t)}catch(e){a.logger.error("Failed to clear localStorage:",e)}throw t}a.logger.error("Error writing to localStorage:",t)}},removeItem:e=>{if("undefined"!=typeof localStorage)try{localStorage.removeItem(e)}catch(e){a.logger.error("Error removing from localStorage:",e)}}}));function o(){let e=localStorage.getItem("cart-session-id");return e||(e=`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("cart-session-id",e)),e}let s=(0,t.create)()((0,r.persist)((e,t)=>({items:[],shippingMethod:null,sessionId:null,initializeSession:()=>{e({sessionId:o()})},syncToDatabase:async()=>{try{let e=t(),r=e.sessionId||o();if(!r)return void a.logger.warn("No session ID, skipping database sync");let n=e.items.map(e=>(a.logger.debug("Syncing item to DB:",{id:e.id,name:e.name,hasImage:!!e.image,imageLength:e.image?.length||0,imageType:e.image?.startsWith("data:")?"base64":"url"}),{...e})),s=await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:n,shippingMethod:e.shippingMethod,sessionId:r})});if(s.ok)try{let e=await s.json();e&&e.success}catch(e){}else{let e=`HTTP ${s.status}: ${s.statusText}`,t=null;try{(t=await s.json())&&"object"==typeof t&&(e=t.error||t.message||e)}catch(t){try{let t=await s.text();t&&(e=`${e} - ${t.substring(0,100)}`)}catch(e){a.logger.warn("Could not parse error response",{status:s.status})}}if(s.status>=400){let o={status:s.status,statusText:s.statusText,error:e,sessionId:r||"unknown",itemCount:n.length};t&&(o.errorData=t),a.logger.error("Failed to sync cart to database:",o)}}}catch(e){if(e instanceof Error)e.message.includes("fetch")||e.message.includes("network")||a.logger.error("Error syncing cart to database:",{message:e.message,name:e.name,sessionId:t().sessionId||o()});else{let r={sessionId:t().sessionId||o()||"unknown",itemCount:t().items.length};e&&"object"==typeof e?(r.error=e,r.message=e.message||e.toString()||"Unknown error",e.code&&(r.code=e.code),e.status&&(r.status=e.status)):r.message=String(e)||"Unknown error",a.logger.error("Failed to sync cart to database:",r)}}},loadFromDatabase:async()=>{try{let t=o();if(!t)return;let r=await fetch("/api/cart",{headers:{"x-cart-session-id":t}});if(r.ok){let n=await r.json();if(n.success&&n.data){a.logger.debug("Cart loaded from database:",{itemCount:n.data.items?.length||0,sessionId:t});let r=(n.data.items||[]).map(e=>(e.image&&e.image.trim(),e));e({items:r,shippingMethod:n.data.shippingMethod||null,sessionId:t})}else a.logger.debug("No cart data in response or empty cart")}else{let e=`HTTP ${r.status}`;try{let t=await r.json();t&&"object"==typeof t&&(e=t.error||t.message||e)}catch(a){let t=await r.text().catch(()=>"");t&&(e=`${e} - ${t.substring(0,100)}`)}r.status>=400&&a.logger.error("Failed to load cart from database:",{status:r.status,error:e,sessionId:t})}}catch(e){e instanceof Error?e.message.includes("fetch")||e.message.includes("network")||a.logger.error("Error loading cart from database:",{message:e.message,name:e.name,sessionId:o()}):a.logger.error("Error loading cart from database:",e)}},addItem:r=>{try{e(e=>{if(e.items.length>=100)return a.logger.warn("Cart limit reached (100 items). Please remove some items."),e;if(e.items.find(e=>e.id===r.id))return{items:e.items.map(e=>e.id===r.id?{...e,quantity:e.quantity+(r.quantity||1)}:e)};let n={items:[...e.items,{...r,image:r.image||"",quantity:r.quantity||1}]};return setTimeout(()=>{t().syncToDatabase()},100),n})}catch(e){throw e?.name==="QuotaExceededError"&&a.logger.error("Storage quota exceeded. Please clear your cart."),e}},updateQuantity:(r,n)=>{try{e(e=>{if(n<=0)return{items:e.items.filter(e=>e.id!==r)};let a={items:e.items.map(e=>e.id===r?{...e,quantity:n}:e)};return setTimeout(()=>{t().syncToDatabase()},100),a})}catch(e){throw e?.name==="QuotaExceededError"&&a.logger.error("Storage quota exceeded. Please clear your cart."),e}},removeItem:r=>{e(e=>{let a={items:e.items.filter(e=>e.id!==r)};return setTimeout(()=>{t().syncToDatabase()},100),a})},clearCart:()=>{e({items:[],shippingMethod:null}),setTimeout(()=>{t().syncToDatabase()},100)},getTotal:()=>t().items.reduce((e,t)=>e+t.price*t.quantity,0),getItemCount:()=>t().items.reduce((e,t)=>e+t.quantity,0),setShippingMethod:r=>{e({shippingMethod:r}),setTimeout(()=>{t().syncToDatabase()},100)}}),{name:"cart-storage",storage:n,partialize:e=>({items:e.items.slice(0,100).map(e=>{var t;return{...e,image:(t=e.image)&&"string"==typeof t?t.startsWith("data:image")?t.length<5e4?t:"":t.length>2e3?(a.logger.warn("Very long image URL detected, truncating:",t.substring(0,100)),t.substring(0,2e3)):t:""}}),shippingMethod:e.shippingMethod,sessionId:e.sessionId})}));e.s(["useCartStore",0,s])}]);
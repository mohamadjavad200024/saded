(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63488,e=>{"use strict";let t=(0,e.i(75254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>t],63488)},72520,e=>{"use strict";let t=(0,e.i(75254).default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>t],72520)},92161,e=>{"use strict";let t=(0,e.i(75254).default)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);e.s(["Menu",()=>t],92161)},39616,e=>{"use strict";let t=(0,e.i(75254).default)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Settings",()=>t],39616)},52917,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(26999),r=e.i(25913),i=e.i(37727),n=e.i(47163);let l=s.Root,o=s.Trigger;s.Close;let c=s.Portal,d=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)(s.Overlay,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a,ref:r}));d.displayName=s.Overlay.displayName;let m=(0,r.cva)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b-[0.25px] border-border/30 data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t-[0.25px] border-border/30 data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",right:"inset-y-0 right-0 h-full w-3/4 border-l-[0.25px] border-border/30 data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",left:"inset-y-0 left-0 h-full w-3/4 border-r-[0.25px] border-border/30 data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm"}},defaultVariants:{side:"right"}}),h=a.forwardRef(({side:e="right",className:a,children:r,...l},o)=>(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{}),(0,t.jsxs)(s.Content,{ref:o,className:(0,n.cn)(m({side:e}),a),...l,children:[r,(0,t.jsxs)(s.Close,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,t.jsx)(i.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));h.displayName=s.Content.displayName;let u=({className:e,...a})=>(0,t.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-right",e),...a});u.displayName="SheetHeader";let x=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)(s.Title,{ref:r,className:(0,n.cn)("text-lg font-semibold text-foreground",e),...a}));x.displayName=s.Title.displayName,a.forwardRef(({className:e,...a},r)=>(0,t.jsx)(s.Description,{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",e),...a})).displayName=s.Description.displayName,e.s(["Sheet",()=>l,"SheetContent",()=>h,"SheetHeader",()=>u,"SheetTitle",()=>x,"SheetTrigger",()=>o])},5125,95116,83086,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);e.s(["Car",()=>a],5125);let s=(0,t.default)("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);e.s(["Wrench",()=>s],95116);let r=(0,t.default)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);e.s(["Sparkles",()=>r],83086)},49786,e=>{"use strict";var t=e.i(43476),a=e.i(22016),s=e.i(55436),r=e.i(1928),i=e.i(84614),n=e.i(92161),l=e.i(37727),o=e.i(67881),c=e.i(23750),d=e.i(18566),m=e.i(47163),h=e.i(5125),u=e.i(95116),x=e.i(83086),p=e.i(39616);let g=[{name:"خانه",href:"/",icon:h.Car},{name:"محصولات",href:"/products",icon:u.Wrench},{name:"دسته‌بندی‌ها",href:"/categories",icon:x.Sparkles},{name:"خدمات",href:"/services",icon:p.Settings}];function f({mobile:e=!1,onNavigate:s}){let r=(0,d.usePathname)();return e?(0,t.jsx)("nav",{className:"flex flex-col space-y-2",children:g.map(e=>{let i=e.icon,n=r===e.href;return(0,t.jsxs)(a.default,{href:e.href,onClick:s,className:(0,m.cn)("flex items-center space-x-3 space-x-reverse px-4 py-3 rounded-lg text-base font-medium transition-colors",n?"bg-primary text-primary-foreground":"text-foreground hover:bg-accent hover:text-accent-foreground"),children:[(0,t.jsx)(i,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:e.name})]},e.href)})}):(0,t.jsx)("nav",{className:"hidden lg:flex items-center space-x-1 space-x-reverse",children:g.map(e=>{let s=e.icon,i=r===e.href;return(0,t.jsxs)(a.default,{href:e.href,className:(0,m.cn)("flex items-center space-x-2 space-x-reverse px-3 xl:px-4 py-2 rounded-md text-sm font-medium transition-colors",i?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent hover:text-accent-foreground"),children:[(0,t.jsx)(s,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden xl:inline",children:e.name})]},e.href)})})}var y=e.i(61180),j=e.i(71645),v=e.i(75254);let b=(0,v.default)("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),w=(0,v.default)("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);var N=e.i(63178);function k(){let{theme:e,setTheme:a,resolvedTheme:s}=(0,N.useTheme)(),[r,i]=j.useState(!1);if(j.useEffect(()=>{i(!0)},[]),!r)return(0,t.jsxs)(o.Button,{variant:"ghost",size:"icon",className:"h-9 w-9",children:[(0,t.jsx)(w,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"sr-only",children:"تغییر تم"})]});let n="dark"===s||"dark"===e;return(0,t.jsxs)(o.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 relative",onClick:()=>{a("dark"===(s||("system"===e?"light":e))?"light":"dark")},type:"button",children:[(0,t.jsx)(w,{className:`h-5 w-5 absolute transition-all duration-300 ${n?"rotate-90 scale-0 opacity-0":"rotate-0 scale-100 opacity-100"}`}),(0,t.jsx)(b,{className:`h-5 w-5 absolute transition-all duration-300 ${n?"rotate-0 scale-100 opacity-100":"-rotate-90 scale-0 opacity-0"}`}),(0,t.jsx)("span",{className:"sr-only",children:"تغییر تم"})]})}var C=e.i(52917);function S(){let[e,d]=(0,j.useState)(""),[m,h]=(0,j.useState)(!1),[u,x]=(0,j.useState)(!1),[p,g]=(0,j.useState)(!1),{getItemCount:v,initializeSession:b,loadFromDatabase:w,items:N}=(0,y.useCartStore)(),S=N.reduce((e,t)=>e+t.quantity,0);return(0,j.useEffect)(()=>{g(!0),(async()=>{try{b(),await w()}catch(e){console.error("Error initializing cart in header:",e)}})()},[b,w]),(0,t.jsxs)("header",{className:"sticky top-0 z-50 w-full border-b-[0.25px] border-border/30 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:[(0,t.jsxs)("div",{className:"container flex h-14 sm:h-16 items-center justify-between px-3 sm:px-4",children:[(0,t.jsx)(a.default,{href:"/",className:"flex items-center space-x-1.5 space-x-reverse min-w-0 flex-shrink-0",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xl sm:text-2xl font-bold text-primary leading-tight",children:"ساد"}),(0,t.jsx)("span",{className:"hidden sm:block text-[10px] sm:text-xs text-muted-foreground leading-tight",children:"قطعات خودرو وارداتی"})]})}),(0,t.jsx)("div",{className:"hidden lg:block",children:(0,t.jsx)(f,{})}),(0,t.jsx)("div",{className:"hidden lg:flex flex-1 max-w-xl mx-8",children:(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)(s.Search,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,t.jsx)(c.Input,{type:"search",placeholder:"جستجوی قطعه، برند یا شماره VIN...",value:e,onChange:e=>d(e.target.value),className:"pr-10 w-full h-9"})]})}),(0,t.jsxs)("div",{className:"flex items-center space-x-1 space-x-reverse flex-shrink-0",children:[(0,t.jsxs)(o.Button,{variant:"ghost",size:"icon",className:"lg:hidden h-9 w-9",onClick:()=>x(!u),children:[(0,t.jsx)(s.Search,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"sr-only",children:"جستجو"})]}),(0,t.jsx)(k,{}),(0,t.jsxs)(o.Button,{variant:"ghost",size:"icon",className:"hidden md:flex h-9 w-9",children:[(0,t.jsx)(i.User,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"sr-only",children:"حساب کاربری"})]}),(0,t.jsx)(a.default,{href:"/cart","aria-label":p?`سبد خرید با ${S} آیتم`:"سبد خرید",children:(0,t.jsxs)(o.Button,{variant:"ghost",size:"icon",className:"relative h-9 w-9","aria-label":p&&S>0?`سبد خرید (${S} آیتم)`:"سبد خرید",children:[(0,t.jsx)(r.ShoppingCart,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"sr-only",children:"سبد خرید"}),p&&S>0&&(0,t.jsx)("span",{className:"absolute -top-0.5 -left-0.5 h-4 w-4 sm:h-5 sm:w-5 rounded-full bg-secondary text-secondary-foreground text-[10px] sm:text-xs font-bold flex items-center justify-center","aria-label":`${S} آیتم در سبد خرید`,children:S>99?"99+":S})]})}),(0,t.jsxs)(C.Sheet,{open:m,onOpenChange:h,children:[(0,t.jsx)(C.SheetTrigger,{asChild:!0,children:(0,t.jsxs)(o.Button,{variant:"ghost",size:"icon",className:"lg:hidden h-9 w-9",children:[(0,t.jsx)(n.Menu,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"sr-only",children:"منو"})]})}),(0,t.jsxs)(C.SheetContent,{side:"right",className:"w-[280px] sm:w-[320px]",children:[(0,t.jsx)(C.SheetHeader,{children:(0,t.jsx)(C.SheetTitle,{children:"منو"})}),(0,t.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,t.jsx)(f,{mobile:!0,onNavigate:()=>h(!1)}),(0,t.jsxs)("div",{className:"pt-4 border-t-[0.25px] border-border/30 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"تم"}),(0,t.jsx)(k,{})]}),(0,t.jsx)(a.default,{href:"/profile",children:(0,t.jsxs)(o.Button,{variant:"ghost",className:"w-full justify-start",onClick:()=>h(!1),children:[(0,t.jsx)(i.User,{className:"h-4 w-4 ml-2"}),"حساب کاربری"]})})]})]})]})]})]})]}),u&&(0,t.jsx)("div",{className:"lg:hidden border-t-[0.25px] border-border/30 px-3 py-2 bg-background animate-in slide-in-from-top",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(s.Search,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,t.jsx)(c.Input,{type:"search",placeholder:"جستجو...",value:e,onChange:e=>d(e.target.value),className:"pr-10 h-9",autoFocus:!0}),(0,t.jsx)(o.Button,{variant:"ghost",size:"icon",className:"absolute left-1 top-1/2 transform -translate-y-1/2 h-7 w-7",onClick:()=>x(!1),children:(0,t.jsx)(l.X,{className:"h-4 w-4"})})]})})]})}e.s(["Header",()=>S],49786)},95242,e=>{"use strict";let t=(0,e.i(75254).default)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);e.s(["Pause",()=>t],95242)},41222,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(67881),i=e.i(84762),n=e.i(23750),l=e.i(63415),o=e.i(14764),c=e.i(94983),d=e.i(43432),m=e.i(63488),h=e.i(73708),u=e.i(82735),x=e.i(46897),p=e.i(78583),g=e.i(37727),f=e.i(87951),y=e.i(52044),j=e.i(95242),v=e.i(31278),b=e.i(43531),w=e.i(94771),N=e.i(29006),k=e.i(92930),C=e.i(27612),S=e.i(23585),M=e.i(64659),T=e.i(72520),z=e.i(46932),B=e.i(88653),E=e.i(20682),D=e.i(16637),I=e.i(73042),$=e.i(27651),R=e.i(26428),P=e.i(73493),O=e.i(49786);function L(){let e=(0,s.useRouter)(),{toast:L}=(0,E.useToast)(),{showNotification:A,requestPermission:H}=(0,D.useNotifications)(),{isOnline:q,lastSeen:F,checkStatus:U}=(0,$.useAdminPresence)({enabled:!0,heartbeatInterval:2e4}),[_,J]=(0,a.useState)([{id:"1",text:"سلام! خوش آمدید. برای خرید سریع لطفاً اطلاعات زیر را وارد کنید:",sender:"support",timestamp:new Date}]),[W,V]=(0,a.useState)(""),[K,X]=(0,a.useState)(null),[Z,G]=(0,a.useState)(null),[Q,Y]=(0,a.useState)("info"),ee=(0,a.useCallback)(()=>{try{let e=localStorage.getItem("quickBuyChat_customerInfo");if(e){let t=JSON.parse(e),a=t.expiration;if(a&&new Date(a)>new Date)return t.data;localStorage.removeItem("quickBuyChat_customerInfo")}}catch(e){P.logger.error("Error loading customer info:",e)}return{name:"",phone:"",email:""}},[]),[et,ea]=(0,a.useState)(ee),[es,er]=(0,a.useState)([]),[ei,en]=(0,a.useState)(!1),[el,eo]=(0,a.useState)(!1),[ec,ed]=(0,a.useState)(0),[em,eh]=(0,a.useState)(null),[eu,ex]=(0,a.useState)(null),[ep,eg]=(0,a.useState)(!1),[ef,ey]=(0,a.useState)(!1),[ej,ev]=(0,a.useState)(!1),[eb,ew]=(0,a.useState)(!1),[eN,ek]=(0,a.useState)(null),eC=(0,a.useRef)(null),eS=(0,a.useRef)(null),eM=(0,a.useRef)(null),eT=(0,a.useRef)(null),ez=(0,a.useRef)(null),eB=(0,a.useRef)(null),eE=(0,a.useRef)(null),eD=(0,a.useRef)(null);(0,a.useRef)(!1),(0,a.useEffect)(()=>{{let e=localStorage.getItem("quickBuyChat_chatId");e&&(ek(e),Y("chat"))}},[]),(0,a.useEffect)(()=>{if(et.name&&et.phone){let e=new Date;e.setHours(e.getHours()+24),localStorage.setItem("quickBuyChat_customerInfo",JSON.stringify({data:et,expiration:e.toISOString()}))}},[et]);let eI=(0,a.useCallback)(async()=>{if(!et.name||!et.phone)return void L({title:"خطا",description:"لطفاً نام و شماره تماس را وارد کنید",variant:"destructive"});try{let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerName:et.name,customerPhone:et.phone,customerEmail:et.email||void 0})});if(!e.ok)throw Error("خطا در ایجاد چت");let t=await e.json();if(t.success&&t.data?.id){let e=t.data.id;ek(e),localStorage.setItem("quickBuyChat_chatId",e),Y("chat"),J([{id:"1",text:"سلام! خوش آمدید. برای خرید سریع لطفاً اطلاعات زیر را وارد کنید:",sender:"support",timestamp:new Date}]),e_()}}catch(e){P.logger.error("Error creating chat:",e),L({title:"خطا",description:"خطا در ایجاد چت. لطفاً دوباره تلاش کنید.",variant:"destructive"})}},[et,L]),e$=(0,a.useCallback)(e=>{let t=Math.floor(e/60);return`${t.toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`},[]),eR=(0,a.useCallback)(async()=>{try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop()),!0}catch(e){return ew(!0),!1}},[]),eP=(0,a.useCallback)(async()=>{try{if(!await eR())return;let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);eD.current=t;let a=[];t.ondataavailable=e=>{e.data.size>0&&a.push(e.data)},t.onstop=()=>{let t=new Blob(a,{type:"audio/webm"});ex(t);let s=URL.createObjectURL(t);eh(s),e.getTracks().forEach(e=>e.stop())},t.start(),eo(!0),ed(0),eE.current=setInterval(()=>{ed(e=>e+1)},1e3)}catch(e){P.logger.error("Error starting recording:",e),L({title:"خطا",description:"خطا در شروع ضبط صدا",variant:"destructive"})}},[eR,L]),eO=(0,a.useCallback)(()=>{eD.current&&el&&(eD.current.stop(),eo(!1),eE.current&&(clearInterval(eE.current),eE.current=null))},[el]),eL=(0,a.useCallback)(()=>{eO(),eh(null),ex(null),ed(0)},[eO]),eA=(0,a.useCallback)(async()=>{if(eu&&em)try{eg(!0);let e=new FormData;e.append("file",eu,"recording.webm"),e.append("type","audio");let t=await fetch("/api/chat/upload",{method:"POST",body:e});if(!t.ok)throw Error("خطا در آپلود فایل");let a=await t.json();if(a.success&&a.data?.url){let e={id:`audio-${Date.now()}`,type:"audio",url:a.data.url,name:"پیام صوتی",duration:ec};er(t=>[...t,e]),eh(null),ex(null),ed(0)}}catch(e){P.logger.error("Error saving recording:",e),L({title:"خطا",description:"خطا در ذخیره پیام صوتی",variant:"destructive"})}finally{eg(!1)}},[eu,em,ec,L]),eH=(0,a.useCallback)(async(e,t)=>{let a=e.target.files;if(a&&0!==a.length){try{for(let e=0;e<a.length;e++){let s=a[e],r=new FormData;r.append("file",s),r.append("type",t);let i=await fetch("/api/chat/upload",{method:"POST",body:r});if(!i.ok)throw Error("خطا در آپلود فایل");let n=await i.json();if(n.success&&n.data?.url){let a={id:`${t}-${Date.now()}-${e}`,type:t,url:n.data.url,name:s.name,size:s.size};er(e=>[...e,a])}}}catch(e){P.logger.error("Error uploading file:",e),L({title:"خطا",description:"خطا در آپلود فایل",variant:"destructive"})}e.target&&(e.target.value="")}},[L]),eq=(0,a.useCallback)(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:a}=e.coords,s=`https://www.google.com/maps?q=${t},${a}`,r={id:`location-${Date.now()}`,type:"location",url:s,name:"موقعیت من"};er(e=>[...e,r]),en(!1)},e=>{P.logger.error("Error getting location:",e),L({title:"خطا",description:"خطا در دریافت موقعیت",variant:"destructive"})}):L({title:"خطا",description:"مرورگر شما از موقعیت‌یابی پشتیبانی نمی‌کند",variant:"destructive"})},[L]),eF=(0,a.useCallback)(e=>{er(t=>t.filter(t=>t.id!==e))},[]),eU=(0,a.useCallback)(async e=>{if(eN)try{await fetch("/api/chat/typing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:eN,sender:"user",isTyping:e})})}catch(e){}},[eN]),e_=(0,a.useCallback)(async()=>{if(eN)try{let e=await fetch(`/api/chat?chatId=${eN}`);if(!e.ok)return;let t=await e.json();if(t.success&&t.data?.messages){let e=t.data.messages.map(e=>({id:e.id,text:e.text||"",sender:e.sender,timestamp:new Date(e.createdAt),attachments:e.attachments?Array.isArray(e.attachments)?e.attachments:JSON.parse(e.attachments):[],status:e.status||("user"===e.sender?"sent":void 0)}));J(e)}}catch(e){P.logger.error("Error polling messages:",e)}},[eN]),eJ=(0,a.useCallback)(async()=>{if(eN)try{let e=await fetch(`/api/chat/typing?chatId=${eN}&sender=support`);if(e.ok){let t=await e.json();t.success&&ey(t.data?.isTyping||!1)}}catch(e){}},[eN]),eW=(0,a.useCallback)(async()=>{if(!eN)return void L({title:"خطا",description:"لطفاً ابتدا اطلاعات خود را وارد کنید",variant:"destructive"});if(!W.trim()&&0===es.length)return;if(Z){try{(await fetch(`/api/chat/message/${Z.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:W,attachments:es})})).ok&&(J(e=>e.map(e=>e.id===Z.id?{...e,text:W,attachments:es}:e)),G(null),V(""),er([]))}catch(e){P.logger.error("Error editing message:",e)}return}let e=`temp-${Date.now()}`,t={id:e,text:W,sender:"user",timestamp:new Date,attachments:es,status:"sending"};J(e=>[...e,t]),V(""),er([]),X(null),eB.current&&(clearTimeout(eB.current),eB.current=null),eU(!1);try{let t=await fetch("/api/chat/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:eN,text:W,attachments:es,replyingTo:K?.id})});if(!t.ok)throw Error("خطا در ارسال پیام");let a=await t.json();a.success&&a.data&&J(t=>t.map(t=>t.id===e?{...t,id:a.data.id,status:"sent"}:t))}catch(t){P.logger.error("Error sending message:",t),J(t=>t.filter(t=>t.id!==e)),L({title:"خطا",description:"خطا در ارسال پیام",variant:"destructive"})}setTimeout(()=>{eZ(!1)},100)},[eN,W,es,K,Z,eU,L]),eV=(0,a.useCallback)(e=>{X(e),G(null)},[]),eK=(0,a.useCallback)(e=>{G(e),X(null),V(e.text||"")},[]),eX=(0,a.useCallback)(async e=>{try{(await fetch(`/api/chat/message/${e}`,{method:"DELETE"})).ok&&J(t=>t.filter(t=>t.id!==e))}catch(e){P.logger.error("Error deleting message:",e)}},[]),eZ=(0,a.useCallback)((e=!1)=>{eC.current&&eC.current.scrollIntoView({behavior:e?"auto":"smooth",block:"end"})},[]),eG=(0,a.useCallback)(()=>{if(!eS.current)return void ev(!1);let e=eS.current;ev(e.scrollHeight-e.scrollTop-e.clientHeight>150)},[]);return(0,a.useEffect)(()=>{if(!eN||"chat"!==Q)return;e_();let e=setInterval(()=>{e_(),eJ()},3e3);return()=>clearInterval(e)},[eN,Q,e_,eJ]),(0,a.useEffect)(()=>{_.length>0&&"chat"===Q&&setTimeout(()=>{eZ(!0),eG()},100)},[_.length,Q,eZ,eG]),(0,a.useEffect)(()=>{let e=eS.current;if(!e)return;let t=()=>{eG()};return e.addEventListener("scroll",t,{passive:!0}),()=>e.removeEventListener("scroll",t)},[eG]),(0,a.useEffect)(()=>{H()},[H]),(0,t.jsxs)("div",{className:"flex min-h-screen flex-col",children:[(0,t.jsx)(O.Header,{}),(0,t.jsxs)("main",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,t.jsx)("div",{className:"border-b border-border/40 px-4 sm:px-6 py-3 bg-background",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:()=>e.back(),className:"h-8 w-8 rounded-lg",children:(0,t.jsx)(T.ArrowRight,{className:"h-4 w-4"})}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsxs)("h1",{className:"text-base font-semibold text-foreground flex items-center gap-2",children:["خرید سریع","chat"===Q&&(0,t.jsx)(I.OnlineStatusBadge,{isOnline:q,lastSeen:F,showText:!1})]})}),"chat"===Q&&et.name&&et.phone&&(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:()=>{Y("info"),J([{id:"1",text:"سلام! خوش آمدید. برای خرید سریع لطفاً اطلاعات زیر را وارد کنید:",sender:"support",timestamp:new Date}])},className:"h-8 w-8 rounded-lg hover:bg-primary/10 transition-colors",title:"تغییر اطلاعات",children:(0,t.jsxs)("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})}),(0,t.jsx)("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:"info"===Q?(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 sm:p-8 space-y-6 bg-gradient-to-b from-background via-background to-muted/10",children:[(0,t.jsxs)(z.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-center pb-2",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 mb-3 shadow-lg",children:(0,t.jsx)(c.MessageCircle,{className:"h-8 w-8 text-primary"})}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"لطفاً اطلاعات زیر را برای شروع خرید سریع وارد کنید"})]}),(0,t.jsxs)(z.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-5",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,t.jsxs)("svg",{className:"h-4 w-4 text-primary",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"نام و نام خانوادگی",(0,t.jsx)("span",{className:"text-destructive text-xs",children:"*"})]}),(0,t.jsx)(n.Input,{type:"text",placeholder:"مثال: علی احمدی",value:et.name,onChange:e=>ea({...et,name:e.target.value}),className:"h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,t.jsx)(d.Phone,{className:"h-4 w-4 text-primary"}),"شماره تماس",(0,t.jsx)("span",{className:"text-destructive text-xs",children:"*"})]}),(0,t.jsx)(n.Input,{type:"tel",placeholder:"09123456789",value:et.phone,onChange:e=>ea({...et,phone:e.target.value}),className:"h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,t.jsx)(m.Mail,{className:"h-4 w-4 text-primary"}),"ایمیل",(0,t.jsx)("span",{className:"text-xs text-muted-foreground font-normal",children:"(اختیاری)"})]}),(0,t.jsx)(n.Input,{type:"email",placeholder:"example@email.com",value:et.email,onChange:e=>ea({...et,email:e.target.value}),className:"h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"})]})]}),(0,t.jsxs)(z.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"pt-2",children:[(0,t.jsx)(r.Button,{onClick:eI,disabled:!et.name||!et.phone,className:"w-full h-13 text-base font-semibold bg-gradient-to-r from-primary via-primary to-primary/90 hover:from-primary/90 hover:via-primary/80 hover:to-primary/70 shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 transition-all duration-300 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed rounded-xl",children:(0,t.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["ادامه",(0,t.jsx)(z.motion.div,{animate:{x:[0,4,0]},transition:{repeat:1/0,duration:1.5,delay:.5},children:"→"})]})}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center mt-3",children:"با ادامه، شما شرایط و قوانین ما را می‌پذیرید"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{ref:eS,className:"flex-1 min-h-0 overflow-y-auto p-5 sm:p-6 md:p-8 space-y-5 sm:space-y-6 bg-gradient-to-b from-background via-background/95 to-muted/5 scroll-smooth",children:[0===_.length&&(0,t.jsxs)(z.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center h-full min-h-[200px] text-center px-4",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mb-4 shadow-lg",children:(0,t.jsx)(c.MessageCircle,{className:"h-10 w-10 text-primary/60"})}),(0,t.jsx)("p",{className:"text-muted-foreground text-base font-medium leading-relaxed",children:"هنوز پیامی ارسال نشده است"}),(0,t.jsx)("p",{className:"text-muted-foreground/70 text-sm mt-2 leading-relaxed",children:"پیام خود را بنویسید..."})]}),_.map(e=>(0,t.jsx)(z.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${"user"===e.sender?"justify-end":"justify-start"} items-end gap-2 group`,children:(0,t.jsxs)("div",{className:`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${"user"===e.sender?"bg-primary text-primary-foreground":"bg-muted text-foreground border border-border/40"}`,children:[e.text&&(0,t.jsx)("p",{className:"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5",children:e.text}),e.attachments&&e.attachments.length>0&&(0,t.jsx)("div",{className:`space-y-2 ${e.text?"mt-2":""}`,children:e.attachments.map(e=>(0,t.jsxs)("div",{className:"rounded-xl overflow-hidden",children:["image"===e.type&&e.url&&(0,t.jsx)("img",{src:e.url,alt:e.name||"تصویر",className:"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all",onClick:()=>window.open(e.url,"_blank")}),"file"===e.type&&(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",download:e.name,className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,t.jsx)(p.FileText,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"font-medium truncate",children:e.name||"فایل"})]}),"location"===e.type&&(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,t.jsx)(x.MapPin,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"font-medium",children:e.name||"موقعیت"})]}),"audio"===e.type&&e.url&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-background/50 rounded",children:[(0,t.jsx)(f.Mic,{className:"h-3.5 w-3.5"}),(0,t.jsx)("audio",{controls:!0,className:"flex-1 h-7 text-xs",children:(0,t.jsx)("source",{src:e.url})})]})]},e.id))}),(0,t.jsxs)("div",{className:`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${"user"===e.sender?"border-primary-foreground/20 justify-end":"border-border/30 justify-start"}`,children:[(0,t.jsx)("span",{className:`text-[10px] sm:text-xs ${"user"===e.sender?"text-primary-foreground/70":"text-muted-foreground"}`,children:new Date(e.timestamp).toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}),"user"===e.sender&&(0,t.jsxs)(t.Fragment,{children:["sending"===e.status&&(0,t.jsx)(v.Loader2,{className:"h-3 w-3 text-primary-foreground/50 animate-spin"}),"sent"===e.status&&(0,t.jsx)(b.Check,{className:"h-3 w-3 text-primary-foreground/40"}),"delivered"===e.status&&(0,t.jsx)(w.CheckCheck,{className:"h-3 w-3 text-primary-foreground/40"}),"read"===e.status&&(0,t.jsx)(w.CheckCheck,{className:"h-3 w-3 text-primary-foreground/70"}),!e.status&&(0,t.jsx)(b.Check,{className:"h-3 w-3 text-primary-foreground/40"})]}),(0,t.jsx)("div",{className:"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsxs)(l.DropdownMenu,{children:[(0,t.jsx)(l.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-background/20",children:(0,t.jsx)(S.MoreVertical,{className:"h-3.5 w-3.5"})})}),(0,t.jsxs)(l.DropdownMenuContent,{align:"user"===e.sender?"end":"start",className:"min-w-[140px]",children:[(0,t.jsxs)(l.DropdownMenuItem,{onClick:()=>eV(e),children:[(0,t.jsx)(N.Reply,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"پاسخ"})]}),"user"===e.sender&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.DropdownMenuSeparator,{}),(0,t.jsxs)(l.DropdownMenuItem,{onClick:()=>eK(e),children:[(0,t.jsx)(k.Edit2,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"ویرایش"})]})]}),(0,t.jsx)(l.DropdownMenuSeparator,{}),(0,t.jsxs)(l.DropdownMenuItem,{onClick:()=>{confirm("آیا مطمئن هستید که می‌خواهید این پیام را حذف کنید؟")&&eX(e.id)},className:"text-destructive focus:text-destructive focus:bg-destructive/10",children:[(0,t.jsx)(C.Trash2,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"حذف"})]})]})]})})]})]})},e.id)),ef&&(0,t.jsx)(z.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-start items-end gap-2.5",children:(0,t.jsx)(R.TypingIndicator,{})}),(0,t.jsx)("div",{ref:eC})]}),(0,t.jsxs)("div",{className:"border-t border-border/40 bg-background p-2 sm:p-3 space-y-2 relative flex-shrink-0",children:[(0,t.jsx)(B.AnimatePresence,{children:ej&&(0,t.jsx)(z.motion.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-10",children:(0,t.jsx)(r.Button,{onClick:()=>eZ(!1),size:"icon",className:"h-9 w-9 rounded-full shadow-lg hover:shadow-xl bg-primary text-primary-foreground hover:bg-primary/90 transition-all",title:"برو به آخرین پیام",children:(0,t.jsx)(M.ChevronDown,{className:"h-4 w-4"})})})}),(el||em)&&(0,t.jsx)(z.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"flex items-center gap-2 p-2 bg-destructive/10 border border-destructive/30 rounded-lg",children:el?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(z.motion.div,{animate:{scale:[1,1.1,1]},transition:{repeat:1/0,duration:1},className:"p-1.5 rounded-full bg-destructive/20",children:(0,t.jsx)(f.Mic,{className:"h-3.5 w-3.5 text-destructive"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-destructive leading-tight",children:"در حال ضبط"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:e$(ec)})]}),(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:eO,className:"h-7 w-7 text-destructive hover:bg-destructive/10 rounded-lg",children:(0,t.jsx)(y.Square,{className:"h-3 w-3 fill-current"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"p-1.5 rounded-full bg-primary/20",children:(0,t.jsx)(f.Mic,{className:"h-3.5 w-3.5 text-primary"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-xs font-medium leading-tight",children:"پیام صوتی آماده است"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:e$(ec)})]}),(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:eL,className:"h-7 w-7 text-muted-foreground hover:text-destructive rounded-lg",children:(0,t.jsx)(g.X,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(r.Button,{onClick:eA,size:"sm",className:"h-7 px-3 text-xs rounded-lg",children:"ذخیره"})]})}),ei&&(0,t.jsxs)(z.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"flex gap-2 p-2 bg-card rounded-lg border border-border/50 shadow-lg",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:()=>{eT.current?.click(),en(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,t.jsx)(h.Image,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:()=>{ez.current?.click(),en(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,t.jsx)(p.FileText,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:()=>{eq(),en(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,t.jsx)(x.MapPin,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:async()=>{en(!1),el?eO():(await eR()||L({title:"نیاز به دسترسی میکروفون",description:"برای ضبط صدا، لطفاً دسترسی میکروفون را در تنظیمات مرورگر فعال کنید.",variant:"destructive",duration:5e3}),eP())},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",disabled:el,children:el?(0,t.jsx)(j.Pause,{className:"h-3.5 w-3.5 text-destructive"}):(0,t.jsx)(f.Mic,{className:"h-3.5 w-3.5"})})]}),(0,t.jsx)("input",{ref:eT,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:e=>eH(e,"image")}),(0,t.jsx)("input",{ref:ez,type:"file",multiple:!0,className:"hidden",onChange:e=>eH(e,"file")}),(0,t.jsx)("div",{className:"flex items-end gap-2",children:(0,t.jsxs)("div",{className:"flex-1 relative",children:[es.length>0&&(0,t.jsx)("div",{className:"absolute top-2 right-2 left-2 z-10 pointer-events-none overflow-hidden",children:(0,t.jsx)("div",{className:"overflow-x-auto overflow-y-hidden scroll-smooth w-full [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:(0,t.jsx)("div",{className:"flex items-center gap-1.5 flex-nowrap",children:es.map(e=>(0,t.jsxs)("div",{className:"relative group pointer-events-auto flex-shrink-0 w-auto",children:[(0,t.jsxs)("div",{className:"bg-card/95 backdrop-blur-sm rounded-md p-1 border border-border/40 shadow-sm",children:["image"===e.type&&e.url&&(0,t.jsx)("img",{src:e.url,alt:e.name||"تصویر",className:"w-10 h-10 object-cover rounded"}),"file"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,t.jsx)(p.FileText,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,t.jsx)("p",{className:"text-[10px] truncate max-w-[50px] font-medium leading-tight",children:e.name})]}),"location"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,t.jsx)(x.MapPin,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,t.jsx)("span",{className:"text-[10px] font-medium whitespace-nowrap leading-tight",children:"موقعیت"})]}),"audio"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,t.jsx)(f.Mic,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,t.jsx)("span",{className:"text-[10px] font-medium whitespace-nowrap leading-tight",children:e.duration?e$(e.duration):"صدا"})]})]}),(0,t.jsx)("button",{onClick:()=>eF(e.id),className:"absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-20 hover:scale-110",children:(0,t.jsx)(g.X,{className:"h-2.5 w-2.5"})})]},e.id))})})}),(0,t.jsx)(i.Textarea,{ref:eM,value:W,onChange:e=>{V(e.target.value),eB.current&&clearTimeout(eB.current),e.target.value.trim().length>0?(eU(!0),eB.current=setTimeout(()=>{eU(!1)},2e3)):eU(!1)},onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),eB.current&&clearTimeout(eB.current),eU(!1),(W.trim()||es.length>0)&&eW())},placeholder:"پیام خود را بنویسید...",className:`min-h-[44px] max-h-[100px] resize-none text-sm leading-relaxed rounded-lg border pr-20 pl-3 py-2 ${es.length>0?"pt-12":""}`}),(0,t.jsxs)("div",{className:"absolute bottom-2 right-2 flex items-center gap-1",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:()=>en(!ei),className:`h-7 w-7 rounded-lg transition-all ${ei?"bg-primary/10 text-primary":"hover:bg-muted/60 text-muted-foreground hover:text-foreground"}`,children:(0,t.jsx)(u.Paperclip,{className:"h-4 w-4"})}),(W.trim()||es.length>0)&&!el&&(0,t.jsx)(t.Fragment,{children:ep?(0,t.jsx)(v.Loader2,{className:"h-4 w-4 text-primary animate-spin"}):(0,t.jsx)(r.Button,{onClick:eW,size:"icon",className:"h-7 w-7 rounded-lg transition-all",children:(0,t.jsx)(o.Send,{className:"h-3.5 w-3.5"})})})]})]})})]})]})})]})]})}e.s(["default",()=>L])}]);
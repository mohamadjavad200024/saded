(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,84213,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(52917),s=e.i(67881),i=e.i(84762),n=e.i(23750),o=e.i(63415),l=e.i(14764),c=e.i(43432),d=e.i(63488),u=e.i(73708),m=e.i(82735),h=e.i(46897),p=e.i(78583),g=e.i(37727),x=e.i(87951),f=e.i(52044);let y=(0,e.i(75254).default)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);var v=e.i(31278),w=e.i(43531),j=e.i(94771),b=e.i(29006),N=e.i(92930),k=e.i(27612),S=e.i(23585),C=e.i(64659),I=e.i(46932),T=e.i(88653),E=e.i(20682),M=e.i(16637),R=e.i(73042),$=e.i(27651),B=e.i(44073),D=e.i(26428),L=e.i(73493);function O({isOpen:e,onOpenChange:O,trigger:z}){let{toast:W}=(0,E.useToast)(),{showNotification:P,requestPermission:_}=(0,M.useNotifications)(),{showMessageNotification:q}=(0,B.usePersistentNotifications)(),{isOnline:A,lastSeen:U,checkStatus:F}=(0,$.useAdminPresence)({enabled:!0,heartbeatInterval:2e4}),[J,H]=(0,r.useState)([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}]),[K,V]=(0,r.useState)(""),[X,G]=(0,r.useState)(null),[Q,Y]=(0,r.useState)(null),Z=()=>{{let e=localStorage.getItem("quickBuyChat_customerInfo"),t=localStorage.getItem("quickBuyChat_customerInfo_timestamp");if(e)try{let r=JSON.parse(e);if(t){let e=parseInt(t,10);if((Date.now()-e)/864e5>30)return localStorage.removeItem("quickBuyChat_customerInfo"),localStorage.removeItem("quickBuyChat_customerInfo_timestamp"),localStorage.removeItem("quickBuyChat_chatId"),{name:"",phone:"",email:""}}return r}catch{localStorage.removeItem("quickBuyChat_customerInfo"),localStorage.removeItem("quickBuyChat_customerInfo_timestamp")}}return{name:"",phone:"",email:""}},[ee,et]=(0,r.useState)(Z),[er,ea]=(0,r.useState)("info"),[es,ei]=(0,r.useState)([]),[en,eo]=(0,r.useState)(!1),[el,ec]=(0,r.useState)(!1),[ed,eu]=(0,r.useState)(0),[em,eh]=(0,r.useState)(null),[ep,eg]=(0,r.useState)(null),[ex,ef]=(0,r.useState)(null),[ey,ev]=(0,r.useState)(null),[ew,ej]=(0,r.useState)(!1),[eb,eN]=(0,r.useState)(!1),[ek,eS]=(0,r.useState)(localStorage.getItem("quickBuyChat_chatId")),[eC,eI]=(0,r.useState)(!1),[eT,eE]=(0,r.useState)(!1),eM=(0,r.useRef)(null),eR=(0,r.useRef)(null),e$=(0,r.useRef)(null),eB=(0,r.useRef)(null),eD=(0,r.useRef)([]),eL=(0,r.useRef)(null);(0,r.useRef)({});let eO=(0,r.useRef)(null);(0,r.useRef)(new Set),(0,r.useRef)(new Map),(0,r.useRef)(new Map);let ez=(0,r.useRef)(!1),eW=(0,r.useRef)(null),eP=(0,r.useRef)(null),e_=(0,r.useRef)(null),eq=(0,r.useRef)(null),eA=(0,r.useRef)(null),eU=(0,r.useRef)(null),eF=(0,r.useRef)(!1),eJ=(0,r.useRef)(null),[eH,eK]=(0,r.useState)(!1),eV=(0,r.useCallback)(()=>{if(!e_.current||"chat"!==er)return void eK(!1);let e=e_.current;eK(e.scrollHeight-e.scrollTop-e.clientHeight>150)},[er]),eX=(0,r.useCallback)((e=!1)=>{eP.current&&(eP.current.scrollIntoView({behavior:e?"auto":"smooth",block:"end"}),setTimeout(()=>{eK(!1)},300))},[]);(0,r.useEffect)(()=>{let e=e_.current;if(!e||"chat"!==er)return void eK(!1);let t=()=>{eV()};return e.addEventListener("scroll",t,{passive:!0}),eV(),setTimeout(()=>{eV()},100),()=>{e.removeEventListener("scroll",t)}},[er,eV,J.length]),(0,r.useEffect)(()=>{if("chat"===er&&J.length>0&&!eF.current){eF.current=!0;let e=setTimeout(()=>{eX(!0),setTimeout(()=>{eV()},500)},200);return()=>clearTimeout(e)}},[er,eX,eV]),(0,r.useEffect)(()=>{"chat"!==er&&(eF.current=!1)},[er]),(0,r.useEffect)(()=>{if(J.length>0&&"chat"===er){let e=J[J.length-1];if(e.id===eJ.current&&"user"===e.sender){let e=setTimeout(()=>{eX(!1),setTimeout(()=>{eV()},500)},150);return()=>clearTimeout(e)}{let e=setTimeout(()=>{eV()},200);return()=>clearTimeout(e)}}},[J,er,eX,eV]),(0,r.useEffect)(()=>{ee.name&&ee.phone&&(localStorage.setItem("quickBuyChat_customerInfo",JSON.stringify(ee)),localStorage.setItem("quickBuyChat_customerInfo_timestamp",Date.now().toString()))},[ee]),(0,r.useEffect)(()=>{ek&&localStorage.setItem("quickBuyChat_chatId",ek)},[ek]),(0,r.useEffect)(()=>{if(e){let e=Z(),t=localStorage.getItem("quickBuyChat_chatId");e.name&&e.phone?(et(e),ea("chat"),e1(e,t)):(ea("info"),H([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}]))}else ea("info"),V(""),ei([]),eo(!1),ec(!1),eu(0),eh(null),eg(null),ef(null),eL.current&&clearInterval(eL.current),e$.current&&"inactive"!==e$.current.state&&e$.current.stop(),eB.current&&(clearInterval(eB.current),eB.current=null),eI(!1)},[e]);let eG=async()=>{try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop()),!0}catch(e){return!1}},eQ=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void W({title:"Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯",description:"Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ø¶Ø¨Ø· ØµØ¯Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…Ø±ÙˆØ±Ú¯Ø± Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",variant:"destructive"});let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});ev(!0);let t=new MediaRecorder(e,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":"audio/webm"});e$.current=t,eD.current=[],t.ondataavailable=e=>{e.data.size>0&&eD.current.push(e.data)},t.onstop=()=>{let r=new Blob(eD.current,{type:t.mimeType||"audio/webm"});eh(r);let a=URL.createObjectURL(r);eg(a),e.getTracks().forEach(e=>e.stop())},t.onerror=e=>{L.logger.error("MediaRecorder error:",e),W({title:"Ø®Ø·Ø§ Ø¯Ø± Ø¶Ø¨Ø· ØµØ¯Ø§",description:"Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¶Ø¨Ø· ØµØ¯Ø§ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",variant:"destructive"}),eY()},t.start(),ec(!0),eu(0),eL.current=setInterval(()=>{eu(e=>e+1)},1e3),W({title:"Ø¶Ø¨Ø· ØµØ¯Ø§ Ø´Ø±ÙˆØ¹ Ø´Ø¯",description:"Ø¯Ø± Ø­Ø§Ù„ Ø¶Ø¨Ø· Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ..."})}catch(r){L.logger.error("Error starting recording:",r),ev(!1);let e="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª.",t="";"NotAllowedError"===r.name||"PermissionDeniedError"===r.name?(e="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø¯ Ø´Ø¯",t="Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø®ÙˆØ¯ØŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯."):"NotFoundError"===r.name||"DevicesNotFoundError"===r.name?(e="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ÛŒØ§ÙØª Ù†Ø´Ø¯",t="Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¨Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø´Ù…Ø§ Ù…ØªØµÙ„ Ø§Ø³Øª."):"NotReadableError"===r.name||"TrackStartError"===r.name?(e="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª",t="Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ØªÙˆØ³Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ Ø¨Ø¨Ù†Ø¯ÛŒØ¯."):"OverconstrainedError"===r.name||"ConstraintNotSatisfiedError"===r.name?(e="ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯",t="Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯."):t="Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯ ÛŒØ§ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.",W({title:e,description:t,variant:"destructive",duration:5e3}),("NotAllowedError"===r.name||"PermissionDeniedError"===r.name)&&ej(!0)}},eY=()=>{if(e$.current&&"inactive"!==e$.current.state)try{e$.current.stop(),ec(!1),eL.current&&clearInterval(eL.current),W({title:"Ø¶Ø¨Ø· ØµØ¯Ø§ Ù…ØªÙˆÙ‚Ù Ø´Ø¯",description:"Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ Ø´Ù…Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§ Ù„ØºÙˆ Ú©Ù†ÛŒØ¯."})}catch(e){L.logger.error("Error stopping recording:",e),W({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± ØªÙˆÙ‚Ù Ø¶Ø¨Ø· Ø±Ø® Ø¯Ø§Ø¯.",variant:"destructive"})}},eZ=async()=>{if(em&&ep)try{let e="webm",t=em.type||"audio/webm";t.includes("mp4")||t.includes("m4a")?e="m4a":t.includes("ogg")?e="ogg":t.includes("wav")?e="wav":t.includes("webm")&&(e="webm");let r=new File([em],`audio-${Date.now()}.${e}`,{type:t}),a=await te(r,"audio"),s={id:Date.now().toString(),type:"audio",url:a,name:`Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ ${e0(ed)}`,size:em.size,duration:ed};ei(e=>[...e,s]),eh(null),ep&&URL.revokeObjectURL(ep),eg(null),eu(0)}catch(e){}},e0=e=>{let t=Math.floor(e/60);return`${t}:${(e%60).toString().padStart(2,"0")}`},e1=async(e,t)=>{try{let r="/api/chat?";t?r+=`chatId=${t}`:(r+=`customerPhone=${encodeURIComponent(e.phone)}`,e.name&&(r+=`&customerName=${encodeURIComponent(e.name)}`));let a=await fetch(r);if(!a.ok)throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª");let s=await a.json();if(s.success&&s.data){let{chat:t,messages:r}=s.data;if(t&&r&&r.length>0){eS(t.id),localStorage.setItem("quickBuyChat_chatId",t.id);let e=r.map(e=>{let t=[];if(e.attachments){if(Array.isArray(e.attachments))t=e.attachments.map(e=>{let t=e.url||e.fileUrl||e.filePath,r=e.type;return!r&&t&&(t.includes("/image-")||t.includes("image-")?r="image":(t.includes("/audio-")||t.includes("audio-"))&&(r="audio")),{id:e.id||`att-${Date.now()}-${Math.random()}`,type:r||e.type||"file",url:t,name:e.name||e.fileName,size:e.size||e.fileSize,duration:e.duration}});else if("string"==typeof e.attachments)try{let r=JSON.parse(e.attachments);Array.isArray(r)&&(t=r.map(e=>{let t=e.url||e.fileUrl||e.filePath,r=e.type;return!r&&t&&(t.includes("/image-")||t.includes("image-")?r="image":(t.includes("/audio-")||t.includes("audio-"))&&(r="audio")),{id:e.id||`att-${Date.now()}-${Math.random()}`,type:r||e.type||"file",url:t,name:e.name||e.fileName,size:e.size||e.fileSize,duration:e.duration}}))}catch(e){L.logger.error("Error parsing attachments JSON:",e)}}let r=t.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))});return t.length>0&&L.logger.debug(`Loaded message ${e.id} has ${r.length} valid attachment(s) out of ${t.length} total:`,r.map(e=>({id:e.id,type:e.type,url:e.url,name:e.name,hasUrl:!!e.url}))),{id:e.id,text:e.text||"",sender:e.sender,timestamp:new Date(e.createdAt),attachments:r.length>0?r:void 0,status:"user"===e.sender?e.status||"sent":void 0}}),a=e.map(e=>"user"!==e.sender||e.status?e:{...e,status:"sent"});if(H(a),e.length>0){let t=e[e.length-1].id;eO.current=t,localStorage.setItem("quickBuyChat_lastMessageId",t),a.some(e=>"support"===e.sender&&"1"!==e.id)?ez.current=!0:ez.current=!1}else ez.current=!1;ea("chat")}else ea("chat"),H([{id:"1",text:`Ø³Ù„Ø§Ù… ${e.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),ez.current=!1}else ea("chat"),H([{id:"1",text:`Ø³Ù„Ø§Ù… ${e.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),ez.current=!1}catch(t){L.logger.error("Error loading chat history:",t),ea("chat"),H([{id:"1",text:`Ø³Ù„Ø§Ù… ${e.name}! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date}]),ez.current=!1}},e2=async()=>{if(ek)try{await fetch("/api/chat/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ek,sender:"user",action:"delivered"})})}catch(e){L.logger.error("Error marking messages as delivered:",e)}},e4=async()=>{if(ek)try{await fetch("/api/chat/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ek,sender:"user",action:"read"})})}catch(e){L.logger.error("Error marking messages as read:",e)}},e5=async()=>{if(ek&&e&&"chat"===er)try{eI(!0);let e=eO.current,t=`/api/chat?chatId=${ek}`;e&&"1"!==e&&(t+=`&lastMessageId=${e}`);let r=await fetch(t);if(!r.ok)throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯");let a=await r.json();if(a.success&&a.data?.messages&&Array.isArray(a.data.messages)){let e=a.data.messages;e.length>0&&(e2(),setTimeout(()=>{e4()},1e3));let t=e.map(e=>{let t=[];e.attachments&&Array.isArray(e.attachments)&&(t=e.attachments.map(e=>{let t=e.url||e.fileUrl||e.filePath,r=e.type;return!r&&t&&(t.includes("/image-")||t.includes("image-")?r="image":(t.includes("/audio-")||t.includes("audio-"))&&(r="audio")),{id:e.id||`att-${Date.now()}-${Math.random()}`,type:r||e.type||"file",url:t,name:e.name||e.fileName,size:e.size||e.fileSize,duration:e.duration}}));let r=t.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))});return{id:e.id,text:e.text||"",sender:e.sender,timestamp:new Date(e.createdAt),attachments:r.length>0?r:void 0,status:"user"===e.sender?e.status||"sent":void 0}});H(e=>{let r=new Set(e.map(e=>e.id)),a=t.filter(e=>!r.has(e.id)),s=e.filter(e=>!e.id.startsWith("system-")).map(e=>{let r=t.find(t=>t.id===e.id);return r&&"user"===e.sender&&r.status&&e.status!==r.status?{...e,status:r.status}:e});if(a.length>0){let e=a.some(e=>"support"===e.sender),t=s;e&&eW.current&&(t=s.filter(e=>e.id!==eW.current),eW.current=null,ez.current=!0);let r=[...t,...a],i=r[r.length-1];return i&&(eO.current=i.id,localStorage.setItem("quickBuyChat_lastMessageId",i.id)),r}return s})}}catch(e){L.logger.error("Error polling for new messages:",e)}finally{eI(!1)}},e3=async()=>{if(ek)try{let e=await fetch(`/api/chat/typing?chatId=${ek}&sender=support`);if(e.ok){let t=await e.json();t.success&&eE(t.data.isTyping||!1)}}catch(e){L.logger.error("Error checking typing status:",e)}},e7=async e=>{if(ek)try{await fetch("/api/chat/typing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ek,sender:"user",isTyping:e})})}catch(e){L.logger.error("Error sending typing status:",e)}};(0,r.useEffect)(()=>{_()},[]),(0,r.useEffect)(()=>{let t=t=>{let{chatId:r,isAdmin:a}=t.detail;(!1===a||void 0===a)&&(e||O(!0),"chat"!==er&&ea("chat"),r&&1&&localStorage.getItem("quickBuyChat_chatId")!==r&&(localStorage.setItem("quickBuyChat_chatId",r),setTimeout(()=>{e&&"chat"===er&&e5()},500)))};return window.addEventListener("openChat",t),()=>{window.removeEventListener("openChat",t)}},[e,O,ek,er,e5]),(0,r.useEffect)(()=>{if(e&&"chat"===er&&ek){e2();let e=setTimeout(()=>{e4()},2e3);return e3(),eR.current=setInterval(()=>{e3()},3e3),eB.current=setInterval(()=>{e5(),e2()},5e3),e5(),F(),()=>{eB.current&&(clearInterval(eB.current),eB.current=null),eR.current&&(clearInterval(eR.current),eR.current=null),eM.current&&(clearTimeout(eM.current),eM.current=null),clearTimeout(e),e7(!1)}}},[e,er,ek,F]);let e6=async(e=!0,t=0)=>{if(0!==J.length)try{eN(!0);let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ek||void 0,customerInfo:ee,messages:J.map(e=>({id:e.id,text:e.text,sender:e.sender,timestamp:e.timestamp.toISOString(),attachments:e.attachments?e.attachments.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))}):[]}))})});if(!t.ok){let e=await t.json().catch(()=>({error:"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ú†Øª"}));throw Error(e.error||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ú†Øª")}let r=await t.json();r.data.chatId&&(eS(r.data.chatId),localStorage.setItem("quickBuyChat_chatId",r.data.chatId)),e&&W({title:"Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",description:"Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯"})}catch(r){if(L.logger.error("Error saving chat:",r),t<3&&(r.message?.includes("fetch")||r.message?.includes("network")||r.message?.includes("timeout")||"NETWORK_ERROR"===r.code)){let r=1e3*Math.pow(2,t);L.logger.debug(`Retrying save in ${r}ms (attempt ${t+1}/3)`),setTimeout(()=>{e6(e,t+1)},r);return}e&&W({title:"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡",description:r.message||"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯",variant:"destructive"})}finally{0===t&&eN(!1)}},e8=async e=>{try{if((await fetch(`/api/chat/message/${e}`,{method:"DELETE"})).ok)H(t=>t.filter(t=>t.id!==e)),W({title:"Ù…ÙˆÙÙ‚",description:"Ù¾ÛŒØ§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯"});else throw Error("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…")}catch(e){L.logger.error("Error deleting message:",e),W({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…",variant:"destructive"})}},e9=async()=>{if(!K.trim()&&0===es.length)return;if(Q){try{(await fetch(`/api/chat/message/${Q.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:K,attachments:es})})).ok&&(H(e=>e.map(e=>e.id===Q.id?{...e,text:K,attachments:es}:e)),Y(null),V(""),ei([]),W({title:"Ù…ÙˆÙÙ‚",description:"Ù¾ÛŒØ§Ù… ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯"}))}catch(e){L.logger.error("Error editing message:",e),W({title:"Ø®Ø·Ø§",description:"Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…",variant:"destructive"})}return}let t=es.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))});if(!K.trim()&&0===t.length)return void W({title:"Ø®Ø·Ø§",description:"Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù¾ÛŒØ§Ù… ÛŒØ§ ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯",variant:"destructive"});let r=K;X&&(r=`Ø¯Ø± Ù¾Ø§Ø³Ø® Ø¨Ù‡: ${X.text}

${K}`);let a={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,text:r,sender:"user",timestamp:new Date,attachments:t.length>0?t:void 0,status:"sending"};H(e=>{let t=[...e,a];return eO.current=a.id,eJ.current=a.id,localStorage.setItem("quickBuyChat_lastMessageId",a.id),t}),setTimeout(()=>{eX(!1)},150);let s=[...es];V(""),ei([]),eo(!1),G(null);try{eN(!0);let t=[...J,a].map(e=>({id:e.id,text:e.text,sender:e.sender,timestamp:e.timestamp.toISOString(),status:e.id===a.id?"sent":e.status||("user"===e.sender?"sent":void 0),attachments:e.attachments?e.attachments.filter(e=>{let t=e.url;return t&&!t.startsWith("blob:")&&!t.startsWith("data:")&&(t.startsWith("http")||t.startsWith("/"))}):[]}));a.attachments&&a.attachments.length>0&&L.logger.debug(`ğŸ“¤ Sending new message with ${a.attachments.length} attachment(s):`,a.attachments.map(e=>({id:e.id,type:e.type,url:e.url,name:e.name})));let r=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:ek||void 0,customerInfo:ee,messages:t})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.message||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…")}let s=await r.json();s.data?.chatId&&(eS(s.data.chatId),localStorage.setItem("quickBuyChat_chatId",s.data.chatId));let i=s.data?.messages?.find(e=>e.id===a.id),n=i?.status||"sent";H(e=>e.map(e=>e.id===a.id?{...e,status:n}:e));try{let t=await fetch("/api/admin/presence");if(t.ok){let r=await t.json();r.success&&r.data?.admins&&(Array.isArray(r.data.admins)&&r.data.admins.length>0||q("Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ","Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¢Ù†Ù„Ø§ÛŒÙ† Ù†ÛŒØ³Øª. Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡ Ùˆ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",{onOpen:()=>{e||O(!0)},chatId:ek||void 0,metadata:{isAdminOffline:!0,isAdmin:!1}}))}}catch(e){L.logger.error("Error checking admin status:",e)}}catch(e){L.logger.error("Error saving message:",e),H(e=>e.map(e=>e.id===a.id?{...e,status:"sent"}:e)),V(r),ei(s),W({title:"Ø®Ø·Ø§",description:e.message||"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",variant:"destructive"})}finally{eN(!1)}ez.current||setTimeout(async()=>{let e=`system-${Date.now()}`;eW.current=e,ez.current=!0;let t={id:e,text:"Ù…ØªØ´Ú©Ø±Ù…! Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯. Ù‡Ù…Ú©Ø§Ø±Ø§Ù† Ù…Ø§ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¨Ø§ Ø´Ù…Ø§ ØªÙ…Ø§Ø³ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ú¯Ø±ÙØª.",sender:"support",timestamp:new Date};H(e=>[...e,t])},1e3)},te=async(e,t,r=0)=>{try{let r=new FormData;r.append("file",e),r.append("type",t);let a=await fetch("/api/chat/upload",{method:"POST",body:r});if(!a.ok){let e=await a.json().catch(()=>({error:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„"}));throw Error(e.error||"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„")}return(await a.json()).data.url}catch(a){if(L.logger.error("Error uploading file:",a),r<3&&(a.message?.includes("fetch")||a.message?.includes("network")||a.message?.includes("timeout")||"NETWORK_ERROR"===a.code||"TypeError"===a.name)){let a=2e3*Math.pow(2,r);return L.logger.debug(`Retrying file upload in ${a}ms (attempt ${r+1}/3)`),0===r&&W({title:"Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...",description:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„. Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...",duration:2e3}),await new Promise(e=>setTimeout(e,a)),te(e,t,r+1)}throw W({title:"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„",description:a.message||"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯",variant:"destructive"}),a}},tt=async(e,t)=>{let r=e.target.files;if(r&&0!==r.length){for(let e of Array.from(r))try{let r=await te(e,t),a={id:Date.now().toString()+Math.random(),type:t,name:e.name,size:e.size,url:r};ei(e=>[...e,a])}catch(e){}e.target.value=""}},tr=async()=>{if(!ee.name||!ee.phone)return;localStorage.setItem("quickBuyChat_customerInfo",JSON.stringify(ee)),ez.current=!1,eW.current=null,ea("chat");let e={id:Date.now().toString(),text:`Ø³Ù„Ø§Ù… ${ee.name}! Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.`,sender:"support",timestamp:new Date};H(t=>[...t,e]),await e6(!1)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{"data-chat-open":e&&"chat"===er?"true":"false",style:{display:"none"}}),(0,t.jsxs)(a.Sheet,{open:e,onOpenChange:O,children:[z&&(0,t.jsx)(a.SheetTrigger,{asChild:!0,children:z}),(0,t.jsx)(a.SheetContent,{side:"left",className:"w-full sm:w-[420px] md:w-[480px] p-0 flex flex-col border-l-2 border-border/40 bg-background shadow-2xl",children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.SheetHeader,{className:"px-4 sm:px-6 py-2 border-b border-border/40",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsxs)(a.SheetTitle,{className:"text-base font-semibold text-foreground flex items-center gap-2",children:["Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹","chat"===er&&(0,t.jsx)(R.OnlineStatusBadge,{isOnline:A,lastSeen:U,showText:!1})]})}),"chat"===er&&ee.name&&ee.phone&&(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>{ea("info"),H([{id:"1",text:"Ø³Ù„Ø§Ù…! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",sender:"support",timestamp:new Date}])},className:"h-8 w-8 rounded-lg hover:bg-primary/10 transition-colors",title:"ØªØºÛŒÛŒØ± Ø§Ø·Ù„Ø§Ø¹Ø§Øª",children:(0,t.jsxs)("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})}),"info"===er?(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 sm:p-8 space-y-6 bg-gradient-to-b from-background via-background to-muted/10",children:[(0,t.jsxs)(I.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-center pb-2",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 mb-3 shadow-lg",children:(0,t.jsxs)("svg",{className:"h-8 w-8 text-primary",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("path",{d:"M8 10h.01M12 10h.01M16 10h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø®Ø±ÛŒØ¯ Ø³Ø±ÛŒØ¹ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"})]}),(0,t.jsxs)(I.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-5",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,t.jsxs)("svg",{className:"h-4 w-4 text-primary",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ",(0,t.jsx)("span",{className:"text-destructive text-xs",children:"*"})]}),(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(n.Input,{type:"text",placeholder:"Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ",value:ee.name,onChange:e=>et({...ee,name:e.target.value}),className:"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"}),(0,t.jsx)("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,t.jsxs)("svg",{className:"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,t.jsx)(c.Phone,{className:"h-4 w-4 text-primary"}),"Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³",(0,t.jsx)("span",{className:"text-destructive text-xs",children:"*"})]}),(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(n.Input,{type:"tel",placeholder:"09123456789",value:ee.phone,onChange:e=>et({...ee,phone:e.target.value}),className:"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"}),(0,t.jsx)("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,t.jsx)(c.Phone,{className:"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,t.jsx)(d.Mail,{className:"h-4 w-4 text-primary"}),"Ø§ÛŒÙ…ÛŒÙ„",(0,t.jsx)("span",{className:"text-xs text-muted-foreground font-normal",children:"(Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"})]}),(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)(n.Input,{type:"email",placeholder:"example@email.com",value:ee.email,onChange:e=>et({...ee,email:e.target.value}),className:"pr-12 h-12 text-base border-2 border-border/40 focus:border-primary/60 focus:ring-2 focus:ring-primary/20 rounded-xl transition-all bg-background/50 hover:bg-background"}),(0,t.jsx)("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,t.jsx)(d.Mail,{className:"h-5 w-5 text-muted-foreground/60 group-focus-within:text-primary transition-colors"})})]})]})]}),(0,t.jsxs)(I.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"pt-2",children:[(0,t.jsx)(s.Button,{onClick:tr,disabled:!ee.name||!ee.phone,className:"w-full h-13 text-base font-semibold bg-gradient-to-r from-primary via-primary to-primary/90 hover:from-primary/90 hover:via-primary/80 hover:to-primary/70 shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 transition-all duration-300 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed rounded-xl",children:(0,t.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["Ø§Ø¯Ø§Ù…Ù‡",(0,t.jsx)(I.motion.div,{animate:{x:[0,4,0]},transition:{repeat:1/0,duration:1.5,delay:.5},children:"â†’"})]})}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center mt-3",children:"Ø¨Ø§ Ø§Ø¯Ø§Ù…Ù‡ØŒ Ø´Ù…Ø§ Ø´Ø±Ø§ÛŒØ· Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ù…Ø§ Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒØ¯"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{ref:e_,className:"flex-1 overflow-y-auto p-5 sm:p-6 md:p-8 space-y-5 sm:space-y-6 bg-gradient-to-b from-background via-background/95 to-muted/5 scroll-smooth",children:[0===J.length&&(0,t.jsxs)(I.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center h-full min-h-[200px] text-center px-4",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mb-4 shadow-lg",children:(0,t.jsxs)("svg",{className:"h-10 w-10 text-primary/60",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("path",{d:"M8 10h.01M12 10h.01M16 10h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,t.jsx)("p",{className:"text-muted-foreground text-base font-medium leading-relaxed",children:"Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"}),(0,t.jsx)("p",{className:"text-muted-foreground/70 text-sm mt-2 leading-relaxed",children:"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."})]}),J.map((e,r)=>(0,t.jsx)(I.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},className:`flex ${"user"===e.sender?"justify-end":"justify-start"} items-end gap-2 group`,children:(0,t.jsxs)("div",{className:`max-w-[85%] sm:max-w-[75%] md:max-w-[70%] rounded-lg px-2.5 sm:px-3 py-2 transition-all ${"user"===e.sender?"bg-primary text-primary-foreground":"bg-muted text-foreground border border-border/40"}`,children:[e.text&&(0,t.jsx)("p",{className:"text-xs sm:text-sm leading-relaxed whitespace-pre-wrap break-words mb-1.5",children:e.text}),e.attachments&&e.attachments.length>0&&(0,t.jsx)("div",{className:`space-y-2 ${e.text?"mt-2":""}`,children:e.attachments.map((e,a)=>(0,t.jsxs)(I.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*a},className:"rounded-xl overflow-hidden",children:["image"===e.type&&e.url&&(0,t.jsx)("img",{src:e.url,alt:e.name||"ØªØµÙˆÛŒØ±",className:"max-w-full max-h-[150px] sm:max-h-[180px] rounded cursor-pointer hover:opacity-90 transition-all",onClick:()=>window.open(e.url,"_blank"),onError:t=>{L.logger.error("Image load error:",e.url),t.target.style.display="none"}}),"file"===e.type&&(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",download:e.name,className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,t.jsx)(p.FileText,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"font-medium truncate",children:e.name||"ÙØ§ÛŒÙ„"})]}),"location"===e.type&&(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-background/50 rounded hover:bg-background/70 transition-all text-xs",children:[(0,t.jsx)(h.MapPin,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"font-medium",children:e.name||"Ù…ÙˆÙ‚Ø¹ÛŒØª"})]}),"audio"===e.type&&e.url&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-background/50 rounded",children:[(0,t.jsx)(x.Mic,{className:"h-3.5 w-3.5"}),(0,t.jsx)("audio",{controls:!0,className:"flex-1 h-7 text-xs",children:(0,t.jsx)("source",{src:e.url})})]})]},e.id||`att-${r}-${a}`))}),(0,t.jsxs)("div",{className:`flex items-center gap-1.5 mt-1.5 pt-1.5 border-t ${"user"===e.sender?"border-primary-foreground/20 justify-end":"border-border/30 justify-start"}`,children:[(0,t.jsx)("span",{className:`text-[10px] sm:text-xs ${"user"===e.sender?"text-primary-foreground/70":"text-muted-foreground"}`,children:new Date(e.timestamp).toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})}),"user"===e.sender&&(0,t.jsxs)(t.Fragment,{children:["sending"===e.status&&(0,t.jsx)(v.Loader2,{className:"h-3 w-3 text-primary-foreground/50 animate-spin"}),"sent"===e.status&&(0,t.jsx)(w.Check,{className:"h-3 w-3 text-primary-foreground/40"}),"delivered"===e.status&&(0,t.jsx)(j.CheckCheck,{className:"h-3 w-3 text-primary-foreground/40"}),"read"===e.status&&(0,t.jsx)(j.CheckCheck,{className:"h-3 w-3 text-primary-foreground/70"}),!e.status&&(0,t.jsx)(w.Check,{className:"h-3 w-3 text-primary-foreground/40"})]}),(0,t.jsx)("div",{className:"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsxs)(o.DropdownMenu,{children:[(0,t.jsx)(o.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-background/20",onClick:e=>{e.stopPropagation()},title:"Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±",children:(0,t.jsx)(S.MoreVertical,{className:"h-3.5 w-3.5"})})}),(0,t.jsxs)(o.DropdownMenuContent,{align:"user"===e.sender?"end":"start",className:"min-w-[140px]",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)(o.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),G(e),Y(null)},className:"cursor-pointer",children:[(0,t.jsx)(b.Reply,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"Ù¾Ø§Ø³Ø®"})]}),"user"===e.sender&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.DropdownMenuSeparator,{}),(0,t.jsxs)(o.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),Y(e),G(null),V(e.text||"")},className:"cursor-pointer",children:[(0,t.jsx)(N.Edit2,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"ÙˆÛŒØ±Ø§ÛŒØ´"})]})]}),(0,t.jsx)(o.DropdownMenuSeparator,{}),(0,t.jsxs)(o.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ")&&e8(e.id)},className:"cursor-pointer text-destructive focus:text-destructive focus:bg-destructive/10",children:[(0,t.jsx)(k.Trash2,{className:"h-4 w-4 ml-2"}),(0,t.jsx)("span",{children:"Ø­Ø°Ù"})]})]})]})})]})]})},e.id)),eT&&(0,t.jsx)(I.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"flex justify-start items-end gap-2.5",children:(0,t.jsx)(D.TypingIndicator,{})}),(0,t.jsx)("div",{ref:eP})]}),(0,t.jsxs)("div",{className:"border-t border-border/40 bg-background p-2 sm:p-3 space-y-2 relative",children:[(0,t.jsx)(T.AnimatePresence,{children:eH&&(0,t.jsx)(I.motion.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-10",children:(0,t.jsx)(s.Button,{onClick:()=>eX(!1),size:"icon",className:"h-9 w-9 rounded-full shadow-lg hover:shadow-xl bg-primary text-primary-foreground hover:bg-primary/90 transition-all",title:"Ø¨Ø±Ùˆ Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…",children:(0,t.jsx)(C.ChevronDown,{className:"h-4 w-4"})})})}),ew&&(0,t.jsx)(I.motion.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},className:"p-3 bg-destructive/5 border-2 border-destructive/20 rounded-xl shadow-sm",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(x.Mic,{className:"h-3.5 w-3.5 text-destructive mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-destructive mb-1.5 leading-tight",children:"Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù†ÛŒØ§Ø² Ø§Ø³Øª"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Ù„Ø·ÙØ§Ù‹ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯"})]}),(0,t.jsx)("button",{onClick:()=>ej(!1),className:"p-0.5 rounded hover:bg-destructive/10 transition-colors flex-shrink-0",children:(0,t.jsx)(g.X,{className:"h-3 w-3 text-destructive"})})]})}),(el||ep)&&(0,t.jsx)(I.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"flex items-center gap-2 p-2 bg-destructive/10 border border-destructive/30 rounded-lg",children:el?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I.motion.div,{animate:{scale:[1,1.1,1]},transition:{repeat:1/0,duration:1},className:"p-1.5 rounded-full bg-destructive/20",children:(0,t.jsx)(x.Mic,{className:"h-3.5 w-3.5 text-destructive"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-destructive leading-tight",children:"Ø¯Ø± Ø­Ø§Ù„ Ø¶Ø¨Ø·"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:e0(ed)})]}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:eY,className:"h-7 w-7 text-destructive hover:bg-destructive/10 rounded-lg",children:(0,t.jsx)(f.Square,{className:"h-3 w-3 fill-current"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"p-1.5 rounded-full bg-primary/20",children:(0,t.jsx)(x.Mic,{className:"h-3.5 w-3.5 text-primary"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-xs font-medium leading-tight",children:"Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground font-mono",children:e0(ed)})]}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>{eY(),eh(null),ep&&(URL.revokeObjectURL(ep),eg(null)),eu(0)},className:"h-7 w-7 text-muted-foreground hover:text-destructive rounded-lg",children:(0,t.jsx)(g.X,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(s.Button,{onClick:eZ,size:"sm",className:"h-7 px-3 text-xs rounded-lg",children:"Ø°Ø®ÛŒØ±Ù‡"})]})}),en&&(0,t.jsxs)(I.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"flex gap-2 p-2 bg-card rounded-lg border border-border/50 shadow-lg",children:[(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>{eU.current?.click(),eo(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,t.jsx)(u.Image,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>{eA.current?.click(),eo(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,t.jsx)(p.FileText,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let t={id:Date.now().toString(),type:"location",url:`https://www.google.com/maps?q=${e.coords.latitude},${e.coords.longitude}`,name:"Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ"};ei(e=>[...e,t]),eo(!1)},e=>{L.logger.error("Error getting location:",e),alert("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ")}):alert("Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯"),eo(!1)},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",children:(0,t.jsx)(h.MapPin,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:async()=>{eo(!1),el?eY():(await eG()||W({title:"Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†",description:"Ø¨Ø±Ø§ÛŒ Ø¶Ø¨Ø· ØµØ¯Ø§ØŒ Ù„Ø·ÙØ§Ù‹ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±ÙˆØ±Ú¯Ø± ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.",variant:"destructive",duration:5e3}),eQ())},className:"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-all rounded-lg",disabled:el,children:el?(0,t.jsx)(y,{className:"h-3.5 w-3.5 text-destructive"}):(0,t.jsx)(x.Mic,{className:"h-3.5 w-3.5"})})]}),(0,t.jsx)("input",{ref:eU,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:e=>tt(e,"image")}),(0,t.jsx)("input",{ref:eA,type:"file",multiple:!0,className:"hidden",onChange:e=>tt(e,"file")}),(0,t.jsx)("div",{className:"flex items-end gap-2",children:(0,t.jsxs)("div",{className:"flex-1 relative",children:[es.length>0&&(0,t.jsx)("div",{className:"absolute top-2 right-2 left-2 z-10 pointer-events-none overflow-hidden",children:(0,t.jsx)("div",{className:"overflow-x-auto overflow-y-hidden scroll-smooth w-full [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:(0,t.jsx)("div",{className:"flex items-center gap-1.5 flex-nowrap",children:es.map(e=>(0,t.jsxs)("div",{className:"relative group pointer-events-auto flex-shrink-0 w-auto",children:[(0,t.jsxs)("div",{className:"bg-card/95 backdrop-blur-sm rounded-md p-1 border border-border/40 shadow-sm",children:["image"===e.type&&e.url&&(0,t.jsx)("img",{src:e.url,alt:e.name||"ØªØµÙˆÛŒØ±",className:"w-10 h-10 object-cover rounded"}),"file"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,t.jsx)(p.FileText,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,t.jsx)("p",{className:"text-[10px] truncate max-w-[50px] font-medium leading-tight",children:e.name})]}),"location"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,t.jsx)(h.MapPin,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,t.jsx)("span",{className:"text-[10px] font-medium whitespace-nowrap leading-tight",children:"Ù…ÙˆÙ‚Ø¹ÛŒØª"})]}),"audio"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-1 px-1.5 py-1",children:[(0,t.jsx)(x.Mic,{className:"h-3 w-3 flex-shrink-0 text-primary"}),(0,t.jsx)("span",{className:"text-[10px] font-medium whitespace-nowrap leading-tight",children:e.duration?e0(e.duration):"ØµØ¯Ø§"})]})]}),(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void ei(e=>{let r=e.find(e=>e.id===t);return r?.url&&URL.revokeObjectURL(r.url),e.filter(e=>e.id!==t)})},className:"absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-20 hover:scale-110",children:(0,t.jsx)(g.X,{className:"h-2.5 w-2.5"})})]},e.id))})})}),(0,t.jsx)(i.Textarea,{ref:eq,value:K,onChange:e=>{V(e.target.value),eM.current&&clearTimeout(eM.current),e.target.value.trim().length>0?(e7(!0),eM.current=setTimeout(()=>{e7(!1)},2e3)):e7(!1)},onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),eM.current&&clearTimeout(eM.current),e7(!1),(K.trim()||es.length>0)&&e9())},placeholder:"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...",className:`min-h-[44px] max-h-[100px] resize-none text-sm leading-relaxed rounded-lg border pr-20 pl-3 py-2 ${es.length>0?"pt-12":""}`}),(0,t.jsxs)("div",{className:"absolute bottom-2 right-2 flex items-center gap-1",children:[(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>eo(!en),className:`h-7 w-7 rounded-lg transition-all ${en?"bg-primary/10 text-primary":"hover:bg-muted/60 text-muted-foreground hover:text-foreground"}`,children:(0,t.jsx)(m.Paperclip,{className:"h-4 w-4"})}),(K.trim()||es.length>0)&&!el&&(0,t.jsx)(t.Fragment,{children:eb?(0,t.jsx)(v.Loader2,{className:"h-4 w-4 text-primary animate-spin"}):(0,t.jsx)(s.Button,{onClick:e9,size:"icon",className:"h-7 w-7 rounded-lg transition-all",children:(0,t.jsx)(l.Send,{className:"h-3.5 w-3.5"})})})]})]})})]})]})]})})]})]})}e.s(["QuickBuyChat",()=>O],84213)}]);
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99682,e=>{"use strict";var t=e.i(71645);function r(e){let r=t.useRef({value:e,previous:e});return t.useMemo(()=>(r.current.value!==e&&(r.current.previous=r.current.value,r.current.value=e),r.current.previous),[e])}e.s(["usePrevious",()=>r])},19036,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(81140),a=e.i(20783),i=e.i(30030),n=e.i(69340),o=e.i(99682),c=e.i(35804),l=e.i(48425),d="Switch",[u,h]=(0,i.createContextScope)(d),[m,p]=u(d),f=r.forwardRef((e,i)=>{let{__scopeSwitch:o,name:c,checked:u,defaultChecked:h,required:p,disabled:f,value:x="on",onCheckedChange:g,form:b,...v}=e,[w,N]=r.useState(null),k=(0,a.useComposedRefs)(i,e=>N(e)),C=r.useRef(!1),S=!w||b||!!w.closest("form"),[R,A]=(0,n.useControllableState)({prop:u,defaultProp:h??!1,onChange:g,caller:d});return(0,t.jsxs)(m,{scope:o,checked:R,disabled:f,children:[(0,t.jsx)(l.Primitive.button,{type:"button",role:"switch","aria-checked":R,"aria-required":p,"data-state":y(R),"data-disabled":f?"":void 0,disabled:f,value:x,...v,ref:k,onClick:(0,s.composeEventHandlers)(e.onClick,e=>{A(e=>!e),S&&(C.current=e.isPropagationStopped(),C.current||e.stopPropagation())})}),S&&(0,t.jsx)(j,{control:w,bubbles:!C.current,name:c,value:x,checked:R,required:p,disabled:f,form:b,style:{transform:"translateX(-100%)"}})]})});f.displayName=d;var x="SwitchThumb",g=r.forwardRef((e,r)=>{let{__scopeSwitch:s,...a}=e,i=p(x,s);return(0,t.jsx)(l.Primitive.span,{"data-state":y(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:r})});g.displayName=x;var j=r.forwardRef(({__scopeSwitch:e,control:s,checked:i,bubbles:n=!0,...l},d)=>{let u=r.useRef(null),h=(0,a.useComposedRefs)(u,d),m=(0,o.usePrevious)(i),p=(0,c.useSize)(s);return r.useEffect(()=>{let e=u.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(m!==i&&t){let r=new Event("click",{bubbles:n});t.call(e,i),e.dispatchEvent(r)}},[m,i,n]),(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...l,tabIndex:-1,ref:h,style:{...l.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function y(e){return e?"checked":"unchecked"}j.displayName="SwitchBubbleInput";var b=e.i(47163);let v=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)(f,{className:(0,b.cn)("peer inline-flex h-6 w-12 shrink-0 cursor-pointer items-center rounded-full border-2 transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-green-500 data-[state=checked]:border-green-500 data-[state=unchecked]:bg-muted data-[state=unchecked]:border-transparent px-0.5",e),...r,ref:s,children:(0,t.jsx)(g,{className:(0,b.cn)("pointer-events-none block h-5 w-5 rounded-full shadow-lg ring-0 transition-all duration-200 ease-in-out data-[state=checked]:-translate-x-6 data-[state=unchecked]:translate-x-0 data-[state=checked]:bg-primary-foreground data-[state=unchecked]:bg-foreground")})}));v.displayName=f.displayName,e.s(["Switch",()=>v],19036)},72520,e=>{"use strict";let t=(0,e.i(75254).default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>t],72520)},44745,e=>{"use strict";var t=e.i(43476),r=e.i(53145),s=e.i(94814),a=e.i(65638),i=e.i(67881),n=e.i(23750),o=e.i(10708),c=e.i(84762),l=e.i(19036),d=e.i(70065),u=e.i(17513),h=e.i(20682),m=e.i(18566),p=e.i(31278),f=e.i(88844),x=e.i(12598);let g=a.object({name:a.string().min(1,"نام دسته‌بندی الزامی است"),description:a.string().optional(),isActive:a.boolean()});function j({category:e,onSuccess:a}){let j=(0,m.useRouter)(),{addCategory:y,updateCategory:b,loadCategoriesFromDB:v}=(0,u.useCategoryStore)(),{toast:w}=(0,h.useToast)(),N=(0,x.useQueryClient)(),{register:k,handleSubmit:C,formState:{errors:S,isSubmitting:R},setValue:A,watch:E}=(0,r.useForm)({resolver:(0,s.zodResolver)(g),defaultValues:e?{name:e.name,description:e.description||"",isActive:e.isActive}:{name:"",description:"",isActive:!0}}),T=E("isActive"),P=async t=>{try{if(e){let r=await fetch(`/api/categories/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||e.message||"خطا در به‌روزرسانی دسته‌بندی")}let s=await r.json();b(s.data),N.invalidateQueries({queryKey:["categories"]}),await v(),w({title:"موفق",description:"دسته‌بندی با موفقیت به‌روزرسانی شد"})}else{let e=await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let t=await e.json().catch(()=>({})),r=t.error||t.message||"خطا در ایجاد دسته‌بندی";if("DATABASE_NOT_AVAILABLE"===t.code)throw Error(`${r}

برای رفع این مشکل:
1. اطمینان حاصل کنید که PostgreSQL نصب و در حال اجرا است
2. بررسی کنید که متغیرهای محیطی (DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PASSWORD) به درستی تنظیم شده‌اند
3. دستور "pnpm setup-postgres-retry" را برای راه‌اندازی دیتابیس اجرا کنید`);throw Error(r)}let r=await e.json();y(r.data),N.invalidateQueries({queryKey:["categories"]}),await v(),w({title:"موفق",description:"دسته‌بندی با موفقیت اضافه شد"})}N.invalidateQueries({queryKey:["categories"]}),a?.(),j.push("/admin/categories")}catch(e){w({title:"خطا",description:e instanceof Error?e.message:"خطایی رخ داد. لطفاً دوباره تلاش کنید.",variant:"destructive"})}};return(0,t.jsxs)("form",{onSubmit:C(P),className:"space-y-6",children:[(0,t.jsxs)(d.Card,{className:"shadow-sm",children:[(0,t.jsx)(d.CardHeader,{className:"bg-gradient-to-r from-primary/5 to-transparent border-b",children:(0,t.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.Package,{className:"h-5 w-5 text-primary"}),"اطلاعات دسته‌بندی"]})}),(0,t.jsxs)(d.CardContent,{className:"space-y-4 pt-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"name",children:"نام دسته‌بندی *"}),(0,t.jsx)(n.Input,{id:"name",...k("name"),placeholder:"مثال: تعلیق و ترمز"}),S.name&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:S.name.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Label,{htmlFor:"description",children:"توضیحات"}),(0,t.jsx)(c.Textarea,{id:"description",...k("description"),placeholder:"توضیحات اختیاری درباره این دسته‌بندی...",rows:3})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-border/30",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)(o.Label,{children:"فعال"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"دسته‌بندی فعال است و در لیست‌ها نمایش داده می‌شود"})]}),(0,t.jsx)(l.Switch,{checked:T,onCheckedChange:e=>A("isActive",e)})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4 pt-4 border-t border-border/30",children:[(0,t.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>j.back(),size:"lg",children:"انصراف"}),(0,t.jsx)(i.Button,{type:"submit",disabled:R,size:"lg",className:"min-w-[140px]",children:R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Loader2,{className:"ml-2 h-4 w-4 animate-spin"}),"در حال ذخیره..."]}):e?"ذخیره تغییرات":"افزودن دسته‌بندی"})]})]})}e.s(["CategoryForm",()=>j])},51629,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(18566),a=e.i(44745),i=e.i(70065),n=e.i(17513),o=e.i(67881),c=e.i(72520),l=e.i(31278),d=e.i(22016);function u({params:e}){let{id:u}=(0,r.use)(e);(0,s.useRouter)();let{getCategory:h,loadCategoriesFromDB:m,addCategory:p}=(0,n.useCategoryStore)(),[f,x]=(0,r.useState)(null),[g,j]=(0,r.useState)(!0),[y,b]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{j(!0),b(null);try{await m();let e=h(u);if(!e){let t=await fetch(`/api/categories/${u}`);if(!t.ok){if(404===t.status)return void b("دسته‌بندی یافت نشد");throw Error("خطا در دریافت دسته‌بندی")}let r=await t.json();if(!r.success||!r.data)return void b("دسته‌بندی یافت نشد");(e=r.data)&&p(e)}e?x(e):b("دسته‌بندی یافت نشد")}catch(e){console.error("Error loading category:",e),b(e instanceof Error?e.message:"خطا در بارگذاری داده‌ها")}finally{j(!1)}})()},[u,h,m,p]),g)?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-4",children:[(0,t.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"در حال بارگذاری..."})]}):y||!f?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-4",children:[(0,t.jsx)("p",{className:"text-destructive",children:y||"دسته‌بندی یافت نشد"}),(0,t.jsx)(o.Button,{variant:"outline",asChild:!0,children:(0,t.jsxs)(d.default,{href:"/admin/categories",children:[(0,t.jsx)(c.ArrowRight,{className:"ml-2 h-4 w-4"}),"بازگشت به لیست"]})})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent",children:"ویرایش دسته‌بندی"}),(0,t.jsxs)("p",{className:"text-muted-foreground mt-1",children:["ویرایش اطلاعات: ",f.name]})]}),(0,t.jsx)(o.Button,{variant:"outline",asChild:!0,children:(0,t.jsxs)(d.default,{href:"/admin/categories",children:[(0,t.jsx)(c.ArrowRight,{className:"ml-2 h-4 w-4"}),"بازگشت به لیست"]})})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsx)(i.CardTitle,{children:"فرم ویرایش دسته‌بندی"})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)(a.CategoryForm,{category:f})})]})]})}e.s(["default",()=>u])}]);
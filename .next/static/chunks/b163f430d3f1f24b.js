(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73708,e=>{"use strict";let t=(0,e.i(75254).default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["Image",()=>t],73708)},78583,e=>{"use strict";let t=(0,e.i(75254).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],78583)},94983,e=>{"use strict";let t=(0,e.i(75254).default)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);e.s(["MessageCircle",()=>t],94983)},3116,e=>{"use strict";let t=(0,e.i(75254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],3116)},16637,44073,e=>{"use strict";var t=e.i(71645),i=e.i(73493);function r(){let[e,r]=(0,t.useState)("default"),a=(0,t.useRef)(null);(0,t.useEffect)(()=>{"Notification"in window&&(r(Notification.permission),"default"===Notification.permission&&Notification.requestPermission().then(e=>{r(e)}))},[]);let n=async()=>{if(!("Notification"in window))return!1;if("granted"===Notification.permission)return!0;let e=await Notification.requestPermission();return r(e),"granted"===e},s=async(e,t=!0)=>{if("Notification"in window){if(("granted"===Notification.permission||await n())&&(!t||a.current!==e.tag)){!1!==e.sound&&(()=>{try{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),i=e.createGain();t.connect(i),i.connect(e.destination),t.frequency.setValueAtTime(800,e.currentTime),t.frequency.setValueAtTime(600,e.currentTime+.1),t.frequency.setValueAtTime(800,e.currentTime+.2),i.gain.setValueAtTime(.3,e.currentTime),i.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)}catch(e){i.logger.error("Error playing notification sound:",e)}})();try{let t=new Notification(e.title,{body:e.body,icon:e.icon||"/favicon.ico",badge:e.badge||"/favicon.ico",tag:e.tag,requireInteraction:e.requireInteraction||!1,dir:"rtl",lang:"fa"});return e.tag&&(a.current=e.tag),setTimeout(()=>{t.close()},5e3),t.onclick=()=>{window.focus(),t.close()},t}catch(e){i.logger.error("Error showing notification:",e)}}}};return{permission:e,requestPermission:n,showNotification:s,isSupported:"Notification"in window}}e.s(["useNotifications",()=>r],16637);var a=e.i(6344),n=e.i(79473);let s=(0,a.create)()((0,n.persist)((e,t)=>({notifications:[],addNotification:r=>{let a=r.metadata?.notificationId||`notif-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n=t().notifications.find(e=>e.id===a);if(n&&!n.dismissed)return i.logger.debug(`[Notification Store] Updating existing notification ${a}`),e(e=>({notifications:e.notifications.map(e=>e.id===a?{...e,...r,timestamp:Date.now(),read:!1,dismissed:!1}:e)})),a;let s={...r,id:a,timestamp:Date.now(),read:!1,dismissed:!1};return i.logger.debug(`[Notification Store] Adding new notification ${a}`,{type:s.type,title:s.title,chatId:s.metadata?.chatId,isAdmin:s.metadata?.isAdmin}),e(e=>({notifications:[s,...e.notifications.filter(e=>e.id!==a)].slice(0,50)})),a},removeNotification:t=>{e(e=>({notifications:e.notifications.filter(e=>e.id!==t)}))},markAsRead:t=>{e(e=>({notifications:e.notifications.map(e=>e.id===t?{...e,read:!0}:e)}))},markAllAsRead:()=>{e(e=>({notifications:e.notifications.map(e=>({...e,read:!0}))}))},dismissNotification:i=>{let r=t().notifications.find(e=>e.id===i);r?.onDismiss&&r.onDismiss(),e(e=>({notifications:e.notifications.filter(e=>e.id!==i)}))},dismissAll:()=>{e(e=>({notifications:e.notifications.filter(e=>e.persistent)}))},getUnreadCount:()=>t().notifications.filter(e=>!e.read&&!e.dismissed).length,getUnreadCountExcludingChat:e=>e?t().notifications.filter(t=>!t.read&&!t.dismissed&&!(t.metadata?.chatId===e&&t.metadata?.isAdmin)).length:t().getUnreadCount(),getNotificationsExcludingChat:e=>e?t().notifications.filter(t=>!(t.metadata?.chatId===e&&t.metadata?.isAdmin)):t().notifications,clearAll:()=>{e({notifications:[]})}}),{name:"notification-storage",partialize:e=>({notifications:e.notifications.filter(e=>e.read).slice(0,20)})}));function o(){let{notifications:e,addNotification:a,removeNotification:n,markAsRead:o,markAllAsRead:l,dismissNotification:d,getUnreadCount:c}=s(),{showNotification:u}=r(),m=(0,t.useCallback)((e,t)=>{try{let e=new(window.AudioContext||window.webkitAudioContext),i=e.createOscillator(),r=e.createGain();i.connect(r),r.connect(e.destination),"urgent"===t||"high"===t?(i.frequency.setValueAtTime(1e3,e.currentTime),i.frequency.setValueAtTime(800,e.currentTime+.1),i.frequency.setValueAtTime(1e3,e.currentTime+.2),i.frequency.setValueAtTime(800,e.currentTime+.3),i.frequency.setValueAtTime(1e3,e.currentTime+.4),r.gain.setValueAtTime(.3,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),i.start(e.currentTime),i.stop(e.currentTime+.5)):(i.frequency.setValueAtTime(800,e.currentTime),i.frequency.setValueAtTime(600,e.currentTime+.1),i.frequency.setValueAtTime(800,e.currentTime+.2),r.gain.setValueAtTime(.3,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),i.start(e.currentTime),i.stop(e.currentTime+.3))}catch(e){i.logger.error("Error playing notification sound:",e)}},[]),g=(0,t.useCallback)(e=>{if("vibrate"in navigator)try{navigator.vibrate(e)}catch(e){i.logger.error("Error vibrating device:",e)}},[]),h=(0,t.useCallback)(e=>{let{type:t="message",priority:i="medium",title:r,message:n,sender:s,avatar:o,actions:l,onConfirm:d,onDismiss:c,metadata:h,persistent:f=!0,sound:p=!0,vibration:y=!1}=e;return p&&m(t,i),y&&"urgent"===i&&g([200,100,200]),u({title:r,body:n,tag:`persistent-${Date.now()}`,requireInteraction:f,sound:!1}).catch(()=>{}),a({type:t,priority:i,title:r,message:n,sender:s,avatar:o,actions:l,onConfirm:d,onDismiss:c,metadata:h,persistent:f,sound:p,vibration:y})},[a,m,g,u]),f=(0,t.useCallback)((e,t,i)=>{let{avatar:r,onOpen:a,chatId:n,metadata:s}=i||{},l=n?`msg-${n}`:void 0;return h({type:"message",priority:"high",title:`پیام جدید از ${e}`,message:t,sender:e,avatar:r,persistent:!0,sound:!0,actions:n?[{label:"مشاهده",action:()=>{let e=new CustomEvent("openChat",{detail:{chatId:n,isAdmin:s?.isAdmin!==!1}});window.dispatchEvent(e),a&&a(),l&&(o(l),d(l))},variant:"default"}]:a?[{label:"مشاهده",action:()=>{a&&a()},variant:"default"}]:void 0,onConfirm:a,metadata:{chatId:n,notificationId:l,...s}})},[h,o,d]);return{notifications:e.filter(e=>!e.dismissed),showNotification:h,showMessageNotification:f,removeNotification:n,markAsRead:o,markAllAsRead:l,dismissNotification:d,unreadCount:c()}}e.s(["usePersistentNotifications",()=>o],44073)},52571,e=>{"use strict";let t=(0,e.i(75254).default)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);e.s(["Info",()=>t],52571)},73860,e=>{"use strict";var t=e.i(71645),i=e.i(16637),r=e.i(44073),a=e.i(73493);function n({isUser:e=!1,chatId:n,onNewMessage:s}){let{showNotification:o}=(0,i.useNotifications)(),{showMessageNotification:l}=(0,r.usePersistentNotifications)(),d=(0,t.useRef)({isOnline:!1,lastChecked:0}),c=(0,t.useRef)(null),u=(0,t.useRef)(null),m=(0,t.useRef)(0),g=(0,t.useRef)(new Set),h=(0,t.useRef)(new Map),f=(0,t.useRef)(new Map);(0,t.useEffect)(()=>{if(e&&1&&localStorage.getItem("quickBuyChat_chatId")&&!n){let e=localStorage.getItem("quickBuyChat_lastMessageId");e&&(u.current=e)}},[e,n]);let p=(0,t.useCallback)(async()=>{try{let e=Date.now();if(e-d.current.lastChecked<5e3)return d.current.isOnline;let t=await fetch("/api/admin/presence");if(!t.ok)return!1;let i=await t.json();if(i.success&&i.data?.admins&&Array.isArray(i.data.admins)){let t=i.data.admins.length>0;return d.current={isOnline:t,lastChecked:e},t}return!1}catch(e){return a.logger.error("Error checking admin status:",e),!1}},[]),y=(0,t.useCallback)(async()=>{try{let t,i,r="",d=n;if(e){if(!(d=d||localStorage.getItem("quickBuyChat_chatId")))return;r=`/api/chat?chatId=${d}`,u.current&&"1"!==u.current&&(r+=`&lastMessageId=${u.current}`)}else r="/api/chat";try{let e=new AbortController,i=setTimeout(()=>e.abort(),1e4);t=await fetch(r,{signal:e.signal}),clearTimeout(i)}catch(e){e instanceof Error&&"AbortError"!==e.name&&a.logger.warn("[Chat Polling] Network error (will retry):",e.message);return}if(!t.ok){if(429===t.status){let e=t.headers.get("Retry-After");e&&parseInt(e,10);return}t.status;return}try{i=await t.json()}catch(e){a.logger.error("Error parsing chat response:",e);return}if(e){let e=null!==document.querySelector('[data-chat-open="true"]');if(i.success&&i.data?.messages&&Array.isArray(i.data.messages)){let t=i.data.messages,r=t.filter(e=>"support"===e.sender&&!g.current.has(e.id));if(r.length>0){let n=r[r.length-1],c=n.text||"پیام جدید دریافت شد",m=c.length>50?c.substring(0,50)+"...":c;r.forEach(e=>{g.current.add(e.id)});let y=t.map(e=>e.id);y.length>0&&(u.current=y[y.length-1],u.current&&localStorage.setItem("quickBuyChat_lastMessageId",u.current));let w=await p();if(e)a.logger.debug("New support message detected but chat is open, skipping notification");else{let e=`user-${d}-${n.id}`,t=Date.now(),r=f.current.get(e)||0;if(t-r<5e3){a.logger.debug(`[User Notification] ⏭️ Skipping duplicate notification for ${d}`),s&&s(n,i.data.chat);return}let c=h.current.get(e);c&&clearTimeout(c);let u=setTimeout(()=>{a.logger.debug("New support message detected, showing notification:",m),f.current.set(e,Date.now()),o({title:"پیام جدید از پشتیبانی",body:m,tag:`support-${n.id}`,requireInteraction:!1,sound:!0}).catch(e=>{a.logger.error("[User Notification] Error showing browser notification:",e)}),l("پشتیبانی",m,{onOpen:()=>{s&&s(n)},chatId:d||void 0,metadata:{messageId:n.id,chatId:d,isAdminOffline:!w,isAdmin:!1}}),h.current.delete(e)},300);h.current.set(e,u)}s&&s(n,i.data.chat)}else if(t.length>0){let e=t[t.length-1].id;e!==u.current&&(u.current=e,localStorage.setItem("quickBuyChat_lastMessageId",e))}}}else if(i.success&&i.data?.chats&&Array.isArray(i.data.chats)){let e=i.data.chats;for(let t of(a.logger.debug(`[Admin Polling] ✅ Polling active - Checking ${e.length} chats for new messages`),e))try{let e,i=m.current>0?m.current:Date.now()-6e4,r=new Date(i).toISOString();try{let i=new AbortController,a=setTimeout(()=>i.abort(),5e3);e=await fetch(`/api/chat?chatId=${t.id}&since=${r}`,{signal:i.signal}),clearTimeout(a)}catch(e){continue}if(!e.ok){e.status;continue}let n=await e.json();if(n.success&&n.data?.messages&&Array.isArray(n.data.messages)){let e=n.data.messages;a.logger.debug(`[Admin Polling] Chat ${t.id} (${t.customerName}): Found ${e.length} total messages`);let r=e.filter(e=>{let t="user"===e.sender,r=!g.current.has(e.id),n=new Date(e.createdAt).getTime()>i;return n&&!t&&a.logger.debug(`[Admin Polling] Skipping message from ${e.sender} (only user messages trigger notifications)`),t&&r&&n});if(a.logger.debug(`[Admin Polling] Chat ${t.id}: Found ${r.length} new user messages (received from user)`),e.filter(e=>"support"===e.sender&&new Date(e.createdAt).getTime()>i).length,r.length>0){let e=r[r.length-1];if("user"!==e.sender){a.logger.warn(`[Admin Notification] ⚠️ Skipping notification - message sender is "${e.sender}", expected "user"`),g.current.add(e.id);continue}if(g.current.has(e.id)){a.logger.debug(`[Admin Notification] Message ${e.id} already processed, skipping`);continue}let i=!1;{let e=localStorage.getItem("admin_selected_chat_id");if(e&&(i=e===t.id),!i){let e=document.querySelector('[data-admin-chat-open="true"]');if(e){let r=e.getAttribute("data-selected-chat-id");r&&""!==r&&r===t.id&&(i=!0)}}}a.logger.debug(`[Admin Notification] Chat ${t.id} (${t.customerName}): isOpen=${i}, messageId=${e.id}`);let n=`admin-${t.id}-${e.id}`,o=Date.now(),l=f.current.get(n)||0;if(o-l<5e3){a.logger.debug(`[Admin Notification] ⏭️ Skipping duplicate notification for chat ${t.id} (shown ${Math.round((o-l)/1e3)}s ago)`),g.current.add(e.id),s&&s(e,t);continue}g.current.add(e.id),s&&s(e,t)}}else a.logger.warn(`[Admin Polling] Chat ${t.id}: Invalid response format`,n)}catch(e){a.logger.error(`[Admin Polling] Error polling chat ${t.id}:`,e)}m.current=Date.now(),a.logger.debug(`[Admin Polling] ✅ Polling completed, next poll in 3 seconds`)}else a.logger.warn("[Admin Polling] Invalid response format or no chats found",i)}catch(e){}},[e,n,o,l,s,p]);return(0,t.useEffect)(()=>{if(e){let e=n||localStorage.getItem("quickBuyChat_chatId");if(!e)return void a.logger.debug("Global polling: No chatId found, skipping polling");a.logger.debug("Global polling: Starting polling for chatId:",e)}else a.logger.debug("Global polling: Starting admin polling");return a.logger.debug("[Admin Polling] Starting initial poll..."),y(),c.current=setInterval(()=>{y()},5e3),()=>{c.current&&(clearInterval(c.current),c.current=null),h.current.forEach(e=>clearTimeout(e)),h.current.clear()}},[y,e,n]),{stopPolling:()=>{c.current&&(clearInterval(c.current),c.current=null),h.current.forEach(e=>clearTimeout(e)),h.current.clear()}}}e.s(["useGlobalChatPolling",()=>n])},45423,e=>{"use strict";let t=(0,e.i(75254).default)("Bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);e.s(["Bell",()=>t],45423)},12012,73306,e=>{"use strict";var t=e.i(43476),i=e.i(71645),r=e.i(46932),a=e.i(94983),n=e.i(37727),s=e.i(63209),o=e.i(52571),l=e.i(45423),d=e.i(84614),c=e.i(1928),u=e.i(3116),m=e.i(67881),g=e.i(94179),h=e.i(47163);function f({notification:e,onConfirm:f,onDismiss:p,onMarkAsRead:y}){var w;let b,x,v,N=(e=>{switch(e){case"message":return a.MessageCircle;case"order":return c.ShoppingCart;case"alert":return s.AlertCircle;case"system":return o.Info;default:return l.Bell}})(e.type),[k,A]=i.useState(!1);return(0,t.jsx)(r.motion.div,{initial:{opacity:0,y:-50,scale:.95,x:20},animate:{opacity:1,y:0,scale:1,x:0},exit:{opacity:0,y:-20,scale:.95,x:20,transition:{duration:.2}},whileHover:{scale:1.02,y:-2},transition:{type:"spring",stiffness:300,damping:25},className:(0,h.cn)("relative w-full max-w-lg sm:max-w-xl pointer-events-auto",!e.read&&"ring-2 ring-primary/40 shadow-lg"),onAnimationComplete:()=>{"urgent"!==e.priority&&"message"!==e.type||k||A(!0)},children:(0,t.jsxs)(r.motion.div,{className:(0,h.cn)("group relative w-full rounded-lg sm:rounded-xl py-2 px-2.5 sm:py-3 sm:px-4 shadow-sm sm:shadow-lg backdrop-blur-sm sm:backdrop-blur-md transition-all duration-300 cursor-pointer border","urgent"===e.priority?"bg-gradient-to-br from-red-50/95 via-background to-red-50/60 dark:from-red-950/30 dark:via-background dark:to-red-950/15 border-red-200/50 dark:border-red-800/30 hover:border-red-300 dark:hover:border-red-700":"high"===e.priority?"bg-gradient-to-br from-orange-50/60 via-background to-orange-50/40 dark:from-orange-950/15 dark:via-background dark:to-orange-950/8 border-orange-200/40 dark:border-orange-800/20 hover:border-orange-300 dark:hover:border-orange-700":"bg-gradient-to-br from-background via-background to-primary/8 border-border/50 hover:border-primary/30",!e.read&&"shadow-md hover:shadow-lg"),onClick:()=>{f&&f(),e.onConfirm&&e.onConfirm(),y&&y()},whileHover:{boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},children:[(0,t.jsx)("div",{className:(0,h.cn)("absolute top-0 right-0 left-0 h-0.5 sm:h-1 rounded-t-lg sm:rounded-t-xl",(e=>{switch(e){case"urgent":return"bg-red-500";case"high":return"bg-orange-500";case"medium":default:return"bg-blue-500";case"low":return"bg-gray-500"}})(e.priority))}),!e.read&&(0,t.jsx)(r.motion.div,{className:"absolute top-1.5 left-1.5 sm:top-2 sm:left-2 w-2 h-2 sm:w-2.5 sm:h-2.5 rounded-full bg-primary shadow-lg",animate:{scale:[1,1.3,1],opacity:[1,.7,1]},transition:{repeat:1/0,duration:2},children:(0,t.jsx)(r.motion.div,{className:"absolute inset-0 rounded-full bg-primary/50",animate:{scale:[1,2,2],opacity:[.5,0,0]},transition:{repeat:1/0,duration:2}})}),(0,t.jsxs)("div",{className:"flex items-start gap-1.5 sm:gap-3",children:[(0,t.jsxs)(r.motion.div,{className:"relative flex-shrink-0",initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15,delay:.1},children:[e.avatar?(0,t.jsxs)(r.motion.div,{className:"relative w-7 h-7 sm:w-10 sm:h-10 rounded-full overflow-hidden ring-2 ring-primary/30 shadow-md",whileHover:{scale:1.1},transition:{type:"spring",stiffness:400,damping:17},children:[(0,t.jsx)("img",{src:e.avatar,alt:e.sender||e.title,className:"w-full h-full object-cover"}),!e.read&&(0,t.jsx)(r.motion.div,{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 sm:w-3.5 sm:h-3.5 bg-green-500 rounded-full border-2 border-background",initial:{scale:0},animate:{scale:1},transition:{delay:.2}})]}):(0,t.jsx)(r.motion.div,{className:(0,h.cn)("w-7 h-7 sm:w-10 sm:h-10 rounded-full flex items-center justify-center shadow-md ring-2 ring-primary/20","message"===e.type?"bg-gradient-to-br from-primary/25 via-primary/20 to-accent/25":"order"===e.type?"bg-gradient-to-br from-green-500/25 via-green-500/20 to-green-400/25":"bg-gradient-to-br from-blue-500/25 via-blue-500/20 to-blue-400/25"),whileHover:{scale:1.1,rotate:5},transition:{type:"spring",stiffness:400,damping:17},children:(0,t.jsx)(N,{className:"h-3.5 w-3.5 sm:h-5 sm:w-5 text-primary"})}),"urgent"===e.priority&&(0,t.jsx)(r.motion.div,{className:"absolute -top-0.5 -right-0.5 sm:-top-1 sm:-right-1 w-4 h-4 sm:w-5 sm:h-5 bg-red-500 rounded-full border border-background sm:border-2 shadow-md sm:shadow-lg flex items-center justify-center",animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1},children:(0,t.jsx)(l.Bell,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-white"})})]}),(0,t.jsx)("div",{className:"flex-1 min-w-0 space-y-1 sm:space-y-2",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-1 sm:gap-2",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 sm:gap-1.5 mb-0.5 sm:mb-1 flex-wrap",children:[(0,t.jsx)("h4",{className:"text-xs sm:text-sm font-semibold text-foreground truncate",children:e.title}),(0,t.jsx)(g.Badge,{variant:(e=>{switch(e){case"urgent":return"destructive";case"high":return"secondary";default:return"default"}})(e.priority),className:"text-[9px] sm:text-[10px] px-1 sm:px-1.5 py-0 h-4 sm:h-5",children:"urgent"===e.priority?"فوری":"high"===e.priority?"مهم":"medium"===e.priority?"متوسط":"کم"})]}),e.sender&&(0,t.jsxs)("p",{className:"text-[9px] sm:text-[10px] text-muted-foreground mb-0.5 sm:mb-1 flex items-center gap-0.5 sm:gap-1",children:[(0,t.jsx)(d.User,{className:"h-2 w-2 sm:h-2.5 sm:w-2.5"}),e.sender]}),(0,t.jsx)(r.motion.p,{className:(0,h.cn)("text-[10px] sm:text-xs text-muted-foreground leading-tight sm:leading-relaxed transition-all duration-300",k?"line-clamp-none":"line-clamp-2"),initial:{opacity:.8},animate:{opacity:1},transition:{delay:.1},children:e.message}),(0,t.jsxs)("div",{className:"flex items-center gap-1 sm:gap-1.5 mt-0.5 sm:mt-1 text-[9px] sm:text-[10px] text-muted-foreground",children:[(0,t.jsx)(u.Clock,{className:"h-2 w-2 sm:h-2.5 sm:w-2.5"}),(0,t.jsx)("span",{children:(w=e.timestamp,v=Math.floor((x=Math.floor((b=Math.floor((Date.now()-w)/1e3))/60))/60),b<60?"همین الان":x<60?`${x} دقیقه پیش`:v<24?`${v} ساعت پیش`:new Date(w).toLocaleDateString("fa-IR",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]}),(0,t.jsx)(r.motion.div,{whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,t.jsx)(m.Button,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),p&&p(),e.onDismiss&&e.onDismiss()},className:"h-5 w-5 sm:h-7 sm:w-7 rounded-full hover:bg-destructive/10 hover:text-destructive flex-shrink-0 transition-colors",children:(0,t.jsx)(n.X,{className:"h-2.5 w-2.5 sm:h-3.5 sm:w-3.5"})})})]})})]}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/3 sm:from-primary/5 via-transparent to-accent/3 sm:to-accent/5 pointer-events-none rounded-lg sm:rounded-xl"}),"urgent"===e.priority&&(0,t.jsx)(r.motion.div,{className:"absolute inset-0 rounded-lg sm:rounded-xl border border-red-500/20 sm:border-2 sm:border-red-500/30",animate:{opacity:[.5,1,.5],scale:[1,1.02,1]},transition:{repeat:1/0,duration:2}})]})})}e.i(47167);var p=e.i(88653),y=e.i(44073);function w({position:e="top-right",maxNotifications:a=5,className:n}){let s,{notifications:o,markAsRead:d,markAllAsRead:c,dismissNotification:u,unreadCount:m}=(0,y.usePersistentNotifications)(),[w,b]=i.useState(null);i.useEffect(()=>{let e=()=>{b(localStorage.getItem("admin_selected_chat_id"))};e();let t=t=>{"admin_selected_chat_id"===t.key&&e()},i=e=>{e.detail?.chatId&&b(e.detail.chatId)},r=()=>{b(null)};window.addEventListener("storage",t),window.addEventListener("openChat",i),window.addEventListener("chatOpened",e=>{e.detail?.chatId&&b(e.detail.chatId)}),window.addEventListener("closeChat",r),window.addEventListener("chatClosed",r);let a=setInterval(e,500);return()=>{window.removeEventListener("storage",t),window.removeEventListener("openChat",i),window.removeEventListener("closeChat",r),clearInterval(a)}},[]);let x=o.filter(e=>!!e.persistent&&!e.dismissed&&(!(e.metadata?.isAdmin&&e.metadata?.chatId)||!w||e.metadata.chatId!==w)).sort((e,t)=>{if(e.read!==t.read)return e.read?1:-1;let i={urgent:4,high:3,medium:2,low:1},r=(i[t.priority]||0)-(i[e.priority]||0);return 0!==r?r:t.timestamp-e.timestamp}).slice(0,a);return 0===x.length?null:(0,t.jsxs)("div",{className:(0,h.cn)("fixed z-[9999] pointer-events-none flex flex-col gap-2 sm:gap-3",{"top-right":"top-4 right-4","top-left":"top-4 left-4","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4"}[e],n),children:[(0,t.jsx)(p.AnimatePresence,{mode:"popLayout",children:x.map((i,a)=>(0,t.jsx)(r.motion.div,{layout:!0,initial:{opacity:0,scale:.8,y:-20,x:e.includes("right")?20:-20},animate:{opacity:1,scale:1,y:0,x:0},exit:{opacity:0,scale:.8,y:-20,x:e.includes("right")?20:-20,transition:{duration:.2}},transition:{type:"spring",stiffness:300,damping:25,delay:.05*a},className:"pointer-events-auto",children:(0,t.jsx)(f,{notification:i,onConfirm:()=>{if(i.metadata?.chatId){let e=new CustomEvent("openChat",{detail:{chatId:i.metadata.chatId,isAdmin:!1!==i.metadata.isAdmin}});window.dispatchEvent(e)}i.onConfirm&&i.onConfirm(),d(i.id),u(i.id)},onDismiss:()=>{u(i.id)},onMarkAsRead:()=>{d(i.id)}})},i.id))}),(s=x.filter(e=>!e.read).length)>0?(0,t.jsx)(r.motion.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:180},transition:{type:"spring",stiffness:300,damping:20},className:(0,h.cn)("fixed pointer-events-none z-[10000]","top-right"===e?"top-2 right-2":"top-left"===e?"top-2 left-2":"bottom-right"===e?"bottom-2 right-2":"bottom-2 left-2"),children:(0,t.jsxs)(g.Badge,{variant:"destructive",className:"h-6 px-2 text-xs font-bold shadow-lg flex items-center gap-1.5 animate-pulse",children:[(0,t.jsx)(l.Bell,{className:"h-3 w-3"}),s]})}):null]})}e.s(["NotificationCenter",()=>w],73306),e.s([],12012)},38808,81947,e=>{"use strict";e.i(47167);var t,i=e.i(43476),r=e.i(71645),a=e.i(63209),n=e.i(25913),s=e.i(47163);let o=(0,n.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pr-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:right-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive bg-destructive/10",warning:"border-yellow-500/50 text-yellow-700 dark:text-yellow-400 dark:border-yellow-400 [&>svg]:text-yellow-600 dark:[&>svg]:text-yellow-400 bg-yellow-50 dark:bg-yellow-950/20"}},defaultVariants:{variant:"default"}}),l=r.forwardRef(({className:e,variant:t,...r},a)=>(0,i.jsx)("div",{ref:a,role:"alert",className:(0,s.cn)(o({variant:t}),e),...r}));l.displayName="Alert";let d=r.forwardRef(({className:e,...t},r)=>(0,i.jsx)("h5",{ref:r,className:(0,s.cn)("mb-1 font-medium leading-none tracking-tight",e),...t}));d.displayName="AlertTitle";let c=r.forwardRef(({className:e,...t},r)=>(0,i.jsx)("div",{ref:r,className:(0,s.cn)("text-sm [&_p]:leading-relaxed",e),...t}));c.displayName="AlertDescription",e.s(["Alert",()=>l,"AlertDescription",()=>c,"AlertTitle",()=>d],81947);var u=e.i(67881);let m=new class{isDevelopment=!1;isProduction=!0;shouldLog(e){return"error"===e||"warn"===e||this.isDevelopment}log(...e){this.shouldLog("log")&&console.log(...e)}error(...e){console.error(...e)}warn(...e){console.warn(...e)}info(...e){this.shouldLog("info")&&console.info(...e)}debug(...e){this.shouldLog("debug")&&console.debug(...e)}dbQuery(e,t){this.isDevelopment&&console.log("[DB Query]",e.substring(0,100),t?`[${t.length} params]`:"")}apiRequest(e,t,i){this.isDevelopment&&console.log(`[API] ${e} ${t}${i?` ${i}`:""}`)}};class g extends Error{status;code;details;constructor(e,t,i,r){super(e),this.name="AppError",this.status=t,this.code=i,this.details=r,Object.setPrototypeOf(this,g.prototype)}}(t={}).TIMEOUT="TIMEOUT",t.NETWORK="NETWORK",t.ABORTED="ABORTED",t.UNKNOWN="UNKNOWN";class h extends Error{type;originalError;constructor(e,t="UNKNOWN",i){super(e),this.name="NetworkError",this.type=t,this.originalError=i,Object.setPrototypeOf(this,h.prototype)}}class f extends r.default.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){let i,r;i=e instanceof g?{message:e.message,status:e.status,code:e.code,details:e.details}:e instanceof h?{message:e.message,code:e.type,details:e.originalError}:e instanceof Error?{message:e.message}:"string"==typeof e?{message:e}:{message:"خطای نامشخص رخ داد"},r="[ErrorBoundary] ",m.error(`${r}${i.message}`,{status:i.status,code:i.code,details:i.details})}handleReset=()=>{this.setState({hasError:!1,error:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,i.jsxs)(l,{variant:"destructive",className:"max-w-md",children:[(0,i.jsx)(a.AlertCircle,{className:"h-4 w-4"}),(0,i.jsx)(d,{children:"خطایی رخ داد"}),(0,i.jsxs)(c,{className:"mt-2",children:[(0,i.jsx)("p",{className:"mb-4",children:"متأسفانه خطایی در سیستم رخ داده است. لطفاً صفحه را رفرش کنید."}),!1,(0,i.jsx)(u.Button,{onClick:this.handleReset,className:"mt-4",variant:"outline",children:"تلاش مجدد"})]})]})}):this.props.children}}e.s(["ErrorBoundary",()=>f],38808)}]);
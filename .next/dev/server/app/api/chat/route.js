/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/route";
exports.ids = ["app/api/chat/route"];
exports.modules = {

/***/ "(rsc)/./app/api/chat/route.ts":
/*!*******************************!*\
  !*** ./app/api/chat/route.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var _lib_db_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/db/index */ \"(rsc)/./lib/db/index.ts\");\n/* harmony import */ var _lib_api_route_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/api-route-helpers */ \"(rsc)/./lib/api-route-helpers.ts\");\n/* harmony import */ var _lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/api-error-handler */ \"(rsc)/./lib/api-error-handler.ts\");\n/* harmony import */ var _lib_cache__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/cache */ \"(rsc)/./lib/cache.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _lib_rate_limit__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/rate-limit */ \"(rsc)/./lib/rate-limit.ts\");\n\n\n\n\n\n\n/**\n * POST /api/chat - Create a new chat and save messages\n */ async function POST(request) {\n    // Rate limiting: 20 requests per minute per IP\n    const rateLimitResponse = await (0,_lib_rate_limit__WEBPACK_IMPORTED_MODULE_5__.rateLimit)(20, 60000)(request);\n    if (rateLimitResponse) {\n        return rateLimitResponse;\n    }\n    try {\n        const body = await request.json().catch(()=>{\n            throw new _lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.AppError(\"Invalid JSON in request body\", 400, \"INVALID_JSON\");\n        });\n        const { customerInfo, messages } = body;\n        if (!customerInfo || !customerInfo.name || !customerInfo.phone) {\n            throw new _lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.AppError(\"Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª\", 400, \"MISSING_CUSTOMER_INFO\");\n        }\n        if (!messages || !Array.isArray(messages) || messages.length === 0) {\n            throw new _lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.AppError(\"Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù¾ÛŒØ§Ù… Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª\", 400, \"MISSING_MESSAGES\");\n        }\n        // Ensure tables exist (create in order to handle foreign keys)\n        try {\n            // Create chats table first\n            await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`\n        CREATE TABLE IF NOT EXISTS quick_buy_chats (\n          id VARCHAR(255) PRIMARY KEY,\n          \"customerName\" VARCHAR(255) NOT NULL,\n          \"customerPhone\" VARCHAR(255) NOT NULL,\n          \"customerEmail\" VARCHAR(255),\n          status VARCHAR(50) NOT NULL DEFAULT 'active',\n          \"createdAt\" TIMESTAMP NOT NULL DEFAULT NOW(),\n          \"updatedAt\" TIMESTAMP NOT NULL DEFAULT NOW()\n        );\n      `);\n            // Create messages table (depends on chats)\n            await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`\n        CREATE TABLE IF NOT EXISTS chat_messages (\n          id VARCHAR(255) PRIMARY KEY,\n          \"chatId\" VARCHAR(255) NOT NULL REFERENCES quick_buy_chats(id) ON DELETE CASCADE,\n          text TEXT,\n          sender VARCHAR(50) NOT NULL,\n          attachments JSONB DEFAULT '[]'::jsonb,\n          status VARCHAR(50) DEFAULT 'sent',\n          \"createdAt\" TIMESTAMP NOT NULL DEFAULT NOW()\n        );\n      `);\n            // Add status column if it doesn't exist (for existing tables)\n            await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`\n        ALTER TABLE chat_messages \n        ADD COLUMN IF NOT EXISTS status VARCHAR(50) DEFAULT 'sent';\n      `);\n            // Create attachments table (depends on messages)\n            await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`\n        CREATE TABLE IF NOT EXISTS chat_attachments (\n          id VARCHAR(255) PRIMARY KEY,\n          \"messageId\" VARCHAR(255) NOT NULL REFERENCES chat_messages(id) ON DELETE CASCADE,\n          type VARCHAR(50) NOT NULL,\n          \"filePath\" VARCHAR(500),\n          \"fileName\" VARCHAR(255),\n          \"fileSize\" BIGINT,\n          \"fileUrl\" VARCHAR(500),\n          \"createdAt\" TIMESTAMP NOT NULL DEFAULT NOW()\n        );\n      `);\n            // Create indexes\n            await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`\n        CREATE INDEX IF NOT EXISTS idx_chat_messages_chatId ON chat_messages(\"chatId\");\n        CREATE INDEX IF NOT EXISTS idx_chat_attachments_messageId ON chat_attachments(\"messageId\");\n      `);\n        } catch (createError) {\n            if (createError?.code !== \"42P07\" && !createError?.message?.includes(\"already exists\")) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.error(\"Error creating chat tables:\", createError);\n            }\n        }\n        // Check if chatId is provided (for updating existing chat)\n        const providedChatId = body.chatId;\n        let chatId;\n        const now = new Date().toISOString();\n        if (providedChatId) {\n            // Update existing chat\n            chatId = providedChatId;\n            await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`UPDATE quick_buy_chats \n         SET \"updatedAt\" = $1 \n         WHERE id = $2`, [\n                now,\n                chatId\n            ]);\n        } else {\n            // Create new chat\n            chatId = `chat-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n            await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`INSERT INTO quick_buy_chats (id, \"customerName\", \"customerPhone\", \"customerEmail\", status, \"createdAt\", \"updatedAt\")\n         VALUES ($1, $2, $3, $4, $5, $6, $7)`, [\n                chatId,\n                customerInfo.name.trim(),\n                customerInfo.phone.trim(),\n                customerInfo.email?.trim() || null,\n                \"active\",\n                now,\n                now\n            ]);\n        }\n        // Get existing message IDs to avoid duplicates\n        const existingMessages = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRows)(`SELECT id FROM chat_messages WHERE \"chatId\" = $1`, [\n            chatId\n        ]);\n        const existingMessageIds = new Set(existingMessages.map((m)=>m.id));\n        // Save messages and their attachments\n        const savedMessages = [];\n        for (const message of messages){\n            const messageId = message.id || `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n            const messageCreatedAt = message.timestamp ? new Date(message.timestamp).toISOString() : now;\n            const isNewMessage = !existingMessageIds.has(messageId);\n            // Filter attachments to only include valid URLs (not blob/data URLs)\n            const validAttachments = message.attachments && Array.isArray(message.attachments) ? message.attachments.filter((att)=>{\n                const url = att.url || att.fileUrl || att.filePath;\n                const isValid = url && !url.startsWith('blob:') && !url.startsWith('data:') && (url.startsWith('http') || url.startsWith('/'));\n                if (!isValid && url) {\n                    _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.warn(`Filtered out invalid attachment URL for message ${messageId}:`, {\n                        url,\n                        attachment: att\n                    });\n                }\n                return isValid;\n            }) : [];\n            // Log attachments being saved (only in development)\n            if (validAttachments.length > 0) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.debug(`ðŸ’¾ Saving ${validAttachments.length} attachment(s) for message ${messageId}:`, validAttachments.map((att)=>({\n                        id: att.id,\n                        type: att.type,\n                        url: att.url || att.fileUrl,\n                        name: att.name\n                    })));\n            }\n            // Get message status from request or default based on sender\n            const messageStatus = message.status || (message.sender === \"user\" ? \"sent\" : null);\n            // Save message using UPSERT to avoid duplicates\n            await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`INSERT INTO chat_messages (id, \"chatId\", text, sender, attachments, status, \"createdAt\")\n         VALUES ($1, $2, $3, $4, $5, $6, $7)\n         ON CONFLICT (id) DO UPDATE SET\n           text = EXCLUDED.text,\n           attachments = EXCLUDED.attachments,\n           status = COALESCE(EXCLUDED.status, chat_messages.status)`, [\n                messageId,\n                chatId,\n                message.text || null,\n                message.sender,\n                JSON.stringify(validAttachments),\n                messageStatus,\n                messageCreatedAt\n            ]);\n            // ALWAYS save attachments, even if message already exists (important for images)\n            if (validAttachments && Array.isArray(validAttachments) && validAttachments.length > 0) {\n                for (const attachment of validAttachments){\n                    // Ensure we have a valid URL for the attachment\n                    const attachmentUrl = attachment.url || attachment.fileUrl || null;\n                    if (attachmentUrl && !attachmentUrl.startsWith('blob:') && !attachmentUrl.startsWith('data:')) {\n                        // Only save if URL is not a blob URL or data URL (those are temporary)\n                        // Ensure we have a valid type\n                        const attachmentType = attachment.type || (attachmentUrl.includes(\"image-\") ? \"image\" : attachmentUrl.includes(\"audio-\") ? \"audio\" : \"file\");\n                        try {\n                            // First, check if attachment with this URL already exists for this message\n                            const existingAttachment = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRow)(`SELECT id FROM chat_attachments WHERE \"messageId\" = $1 AND \"fileUrl\" = $2`, [\n                                messageId,\n                                attachmentUrl\n                            ]);\n                            const attachmentId = existingAttachment?.id || attachment.id || `att-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n                            if (existingAttachment) {\n                                // Update existing attachment\n                                await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`UPDATE chat_attachments \n                   SET type = $1, \"fileName\" = $2, \"fileSize\" = $3, \"fileUrl\" = $4\n                   WHERE id = $5`, [\n                                    attachmentType,\n                                    attachment.name || null,\n                                    attachment.size || null,\n                                    attachmentUrl,\n                                    attachmentId\n                                ]);\n                                _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.debug(`Updated existing attachment ${attachmentId} for message ${messageId}:`, {\n                                    type: attachmentType,\n                                    url: attachmentUrl,\n                                    name: attachment.name\n                                });\n                            } else {\n                                // Insert new attachment\n                                await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`INSERT INTO chat_attachments (id, \"messageId\", type, \"filePath\", \"fileName\", \"fileSize\", \"fileUrl\", \"createdAt\")\n                   VALUES ($1, $2, $3, $4, $5, $6, $7, $8)`, [\n                                    attachmentId,\n                                    messageId,\n                                    attachmentType,\n                                    attachmentUrl,\n                                    attachment.name || null,\n                                    attachment.size || null,\n                                    attachmentUrl,\n                                    now\n                                ]);\n                                _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.debug(`Saved new attachment ${attachmentId} for message ${messageId}:`, {\n                                    type: attachmentType,\n                                    originalType: attachment.type,\n                                    url: attachmentUrl,\n                                    name: attachment.name\n                                });\n                            }\n                        } catch (error) {\n                            _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.error(`Error saving attachment for message ${messageId}:`, error);\n                        }\n                    } else if (!attachmentUrl) {\n                        _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.warn(`Attachment has no URL, skipping database save:`, attachment);\n                    } else {\n                        _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.warn(`Attachment has temporary URL (blob/data), skipping database save:`, attachmentUrl);\n                    }\n                }\n            }\n            // Get the saved message with status from database\n            const savedMessage = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRow)(`SELECT id, status FROM chat_messages WHERE id = $1`, [\n                messageId\n            ]);\n            savedMessages.push({\n                id: messageId,\n                chatId,\n                text: message.text,\n                sender: message.sender,\n                attachments: message.attachments || [],\n                createdAt: messageCreatedAt,\n                status: savedMessage?.status || messageStatus\n            });\n        }\n        return (0,_lib_api_route_helpers__WEBPACK_IMPORTED_MODULE_1__.createSuccessResponse)({\n            chatId,\n            messages: savedMessages\n        });\n    } catch (error) {\n        return (0,_lib_api_route_helpers__WEBPACK_IMPORTED_MODULE_1__.createErrorResponse)(error);\n    }\n}\n/**\n * GET /api/chat - Get chat by ID or list chats\n */ async function GET(request) {\n    // Rate limiting: 120 requests per minute per IP (increased for polling - allows 2 requests per second)\n    const rateLimitResponse = await (0,_lib_rate_limit__WEBPACK_IMPORTED_MODULE_5__.rateLimit)(120, 60000)(request);\n    if (rateLimitResponse) {\n        return rateLimitResponse;\n    }\n    try {\n        const { searchParams } = new URL(request.url);\n        const chatId = searchParams.get(\"chatId\");\n        const lastMessageId = searchParams.get(\"lastMessageId\"); // For polling new messages\n        const since = searchParams.get(\"since\"); // ISO timestamp for polling\n        if (chatId) {\n            // Get single chat with messages\n            let chat;\n            try {\n                chat = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRow)(`SELECT * FROM quick_buy_chats WHERE id = $1`, [\n                    chatId\n                ]);\n            } catch (dbError) {\n                // If table doesn't exist, return 404\n                if (dbError?.code === \"42P01\" || dbError?.message?.includes(\"does not exist\")) {\n                    throw new _lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.AppError(\"Ú†Øª ÛŒØ§ÙØª Ù†Ø´Ø¯\", 404, \"CHAT_NOT_FOUND\");\n                }\n                throw dbError;\n            }\n            if (!chat) {\n                throw new _lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.AppError(\"Ú†Øª ÛŒØ§ÙØª Ù†Ø´Ø¯\", 404, \"CHAT_NOT_FOUND\");\n            }\n            // Build query based on polling parameters\n            const page = parseInt(searchParams.get(\"page\") || \"1\", 10);\n            const limit = Math.min(100, Math.max(1, parseInt(searchParams.get(\"limit\") || \"50\", 10)));\n            const offset = (page - 1) * limit;\n            let messagesQuery = `SELECT * FROM chat_messages WHERE \"chatId\" = $1`;\n            const queryParams = [\n                chatId\n            ];\n            if (lastMessageId) {\n                // Get messages after the last known message ID (for polling)\n                // First get the createdAt of the last message, then get messages after that time\n                const lastMessage = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRow)(`SELECT \"createdAt\" FROM chat_messages WHERE id = $1`, [\n                    lastMessageId\n                ]);\n                if (lastMessage) {\n                    messagesQuery += ` AND \"createdAt\" > $2 ORDER BY \"createdAt\" ASC LIMIT $3`;\n                    queryParams.push(lastMessage.createdAt, limit);\n                } else {\n                    // Fallback: use id comparison if createdAt not found\n                    messagesQuery += ` AND id != $2 ORDER BY \"createdAt\" ASC LIMIT $3`;\n                    queryParams.push(lastMessageId, limit);\n                }\n            } else if (since) {\n                // Get messages after a specific timestamp (for polling)\n                messagesQuery += ` AND \"createdAt\" > $2 ORDER BY \"createdAt\" ASC LIMIT $3`;\n                queryParams.push(since, limit);\n            } else {\n                // Get paginated messages (for initial load)\n                messagesQuery += ` ORDER BY \"createdAt\" DESC LIMIT $2 OFFSET $3`;\n                queryParams.push(limit, offset);\n            }\n            let messages = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRows)(messagesQuery, queryParams);\n            // If not polling, reverse order to show newest first (but we fetched DESC, so reverse)\n            if (!lastMessageId && !since) {\n                messages = messages.reverse();\n            }\n            // Optimize: Get all attachments in one query instead of N+1 queries\n            const messageIds = messages.map((m)=>m.id);\n            let allDbAttachments = [];\n            if (messageIds.length > 0) {\n                // Use IN clause to get all attachments in one query\n                const placeholders = messageIds.map((_, i)=>`$${i + 1}`).join(',');\n                allDbAttachments = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRows)(`SELECT * FROM chat_attachments WHERE \"messageId\" IN (${placeholders})`, messageIds);\n            }\n            // Group attachments by messageId for O(1) lookup\n            const attachmentsByMessageId = new Map();\n            allDbAttachments.forEach((att)=>{\n                if (!attachmentsByMessageId.has(att.messageId)) {\n                    attachmentsByMessageId.set(att.messageId, []);\n                }\n                attachmentsByMessageId.get(att.messageId).push(att);\n            });\n            // Process messages and merge attachments\n            for (const message of messages){\n                // First try to get attachments from JSONB field\n                let jsonAttachments = [];\n                if (message.attachments) {\n                    if (Array.isArray(message.attachments)) {\n                        // Already an array (PostgreSQL JSONB returns as array)\n                        jsonAttachments = message.attachments;\n                    } else if (typeof message.attachments === 'string') {\n                        // Try to parse if it's a string\n                        try {\n                            const parsed = JSON.parse(message.attachments);\n                            jsonAttachments = Array.isArray(parsed) ? parsed : [\n                                parsed\n                            ];\n                        } catch (e) {\n                            _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.error(`Error parsing attachments JSON for message ${message.id}:`, e);\n                            jsonAttachments = [];\n                        }\n                    } else if (typeof message.attachments === 'object' && message.attachments !== null) {\n                        // Single object, convert to array\n                        jsonAttachments = Array.isArray(message.attachments) ? message.attachments : [\n                            message.attachments\n                        ];\n                    }\n                }\n                // Get attachments from database table (already loaded)\n                const dbAttachments = attachmentsByMessageId.get(message.id) || [];\n                // Merge attachments - prefer database table attachments (they are more reliable)\n                const allAttachments = [];\n                const addedUrls = new Set();\n                // First add database table attachments (these are the source of truth)\n                dbAttachments.forEach((att)=>{\n                    if (att.fileUrl && !att.fileUrl.startsWith('blob:') && !att.fileUrl.startsWith('data:')) {\n                        // Only add if URL exists and is not a temporary blob/data URL\n                        // Ensure type is preserved (important for audio, etc.)\n                        allAttachments.push({\n                            id: att.id,\n                            type: att.type || \"file\",\n                            url: att.fileUrl,\n                            name: att.fileName,\n                            size: att.fileSize\n                        });\n                        addedUrls.add(att.fileUrl);\n                    }\n                });\n                // Then add JSON attachments if not already in database and not temporary URLs\n                if (Array.isArray(jsonAttachments) && jsonAttachments.length > 0) {\n                    jsonAttachments.forEach((att)=>{\n                        const attachmentUrl = att.url || att.fileUrl || att.filePath;\n                        // Skip if URL is temporary or already added\n                        if (attachmentUrl && !attachmentUrl.startsWith('blob:') && !attachmentUrl.startsWith('data:') && !addedUrls.has(attachmentUrl)) {\n                            // Check if we already have this attachment by URL (even if ID is different)\n                            const existingByUrl = allAttachments.find((a)=>a.url === attachmentUrl);\n                            if (!existingByUrl) {\n                                allAttachments.push({\n                                    id: att.id || `att-${Date.now()}-${Math.random()}`,\n                                    type: att.type || \"file\",\n                                    url: attachmentUrl,\n                                    name: att.name || att.fileName,\n                                    size: att.size || att.fileSize,\n                                    duration: att.duration\n                                });\n                                addedUrls.add(attachmentUrl);\n                            }\n                        }\n                    });\n                }\n                message.attachments = allAttachments;\n            }\n            return (0,_lib_api_route_helpers__WEBPACK_IMPORTED_MODULE_1__.createSuccessResponse)({\n                chat,\n                messages\n            });\n        } else {\n            // Check if we should find chat by customer info\n            const customerPhone = searchParams.get(\"customerPhone\");\n            const customerName = searchParams.get(\"customerName\");\n            if (customerPhone) {\n                // Find chat by customer phone (and optionally name)\n                let chat;\n                if (customerName) {\n                    chat = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRow)(`SELECT * FROM quick_buy_chats \n             WHERE \"customerPhone\" = $1 AND \"customerName\" = $2 \n             ORDER BY \"createdAt\" DESC LIMIT 1`, [\n                        customerPhone,\n                        customerName\n                    ]);\n                } else {\n                    chat = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRow)(`SELECT * FROM quick_buy_chats \n             WHERE \"customerPhone\" = $1 \n             ORDER BY \"createdAt\" DESC LIMIT 1`, [\n                        customerPhone\n                    ]);\n                }\n                if (chat) {\n                    // Get messages for this chat\n                    const messages = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRows)(`SELECT * FROM chat_messages WHERE \"chatId\" = $1 ORDER BY \"createdAt\" ASC`, [\n                        chat.id\n                    ]);\n                    // Optimize: Get all attachments in one query instead of N+1 queries\n                    const messageIds = messages.map((m)=>m.id);\n                    let allDbAttachments = [];\n                    if (messageIds.length > 0) {\n                        // Use IN clause to get all attachments in one query\n                        const placeholders = messageIds.map((_, i)=>`$${i + 1}`).join(',');\n                        allDbAttachments = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRows)(`SELECT * FROM chat_attachments WHERE \"messageId\" IN (${placeholders})`, messageIds);\n                    }\n                    // Group attachments by messageId for O(1) lookup\n                    const attachmentsByMessageId = new Map();\n                    allDbAttachments.forEach((att)=>{\n                        if (!attachmentsByMessageId.has(att.messageId)) {\n                            attachmentsByMessageId.set(att.messageId, []);\n                        }\n                        attachmentsByMessageId.get(att.messageId).push(att);\n                    });\n                    // Process messages and merge attachments\n                    for (const message of messages){\n                        // First try to get attachments from JSONB field\n                        let jsonAttachments = [];\n                        if (message.attachments) {\n                            if (Array.isArray(message.attachments)) {\n                                // PostgreSQL JSONB returns as array\n                                jsonAttachments = message.attachments;\n                            } else if (typeof message.attachments === 'string') {\n                                // Try to parse if it's a string\n                                try {\n                                    const parsed = JSON.parse(message.attachments);\n                                    jsonAttachments = Array.isArray(parsed) ? parsed : [\n                                        parsed\n                                    ];\n                                } catch (e) {\n                                    // Only log in development\n                                    if (true) {\n                                        _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.error(`Error parsing attachments JSON for message ${message.id}:`, e);\n                                    }\n                                    jsonAttachments = [];\n                                }\n                            } else if (typeof message.attachments === 'object' && message.attachments !== null) {\n                                // Single object, convert to array\n                                jsonAttachments = Array.isArray(message.attachments) ? message.attachments : [\n                                    message.attachments\n                                ];\n                            }\n                        }\n                        // Get attachments from database table (already loaded)\n                        const dbAttachments = attachmentsByMessageId.get(message.id) || [];\n                        // Merge attachments - prefer database table attachments (they are more reliable)\n                        const allAttachments = [];\n                        const addedUrls = new Set();\n                        // First add database table attachments (these are the source of truth)\n                        dbAttachments.forEach((att)=>{\n                            if (att.fileUrl && !att.fileUrl.startsWith('blob:') && !att.fileUrl.startsWith('data:')) {\n                                // Only add if URL exists and is not a temporary blob/data URL\n                                // Ensure type is preserved (important for audio, etc.)\n                                allAttachments.push({\n                                    id: att.id,\n                                    type: att.type || \"file\",\n                                    url: att.fileUrl,\n                                    name: att.fileName,\n                                    size: att.fileSize\n                                });\n                                addedUrls.add(att.fileUrl);\n                            }\n                        });\n                        // Then add JSON attachments if not already in database and not temporary URLs\n                        if (Array.isArray(jsonAttachments) && jsonAttachments.length > 0) {\n                            jsonAttachments.forEach((att)=>{\n                                const attachmentUrl = att.url || att.fileUrl || att.filePath;\n                                // Skip if URL is temporary or already added\n                                if (attachmentUrl && !attachmentUrl.startsWith('blob:') && !attachmentUrl.startsWith('data:') && !addedUrls.has(attachmentUrl)) {\n                                    // Check if we already have this attachment by URL (even if ID is different)\n                                    const existingByUrl = allAttachments.find((a)=>a.url === attachmentUrl);\n                                    if (!existingByUrl) {\n                                        allAttachments.push({\n                                            id: att.id || `att-${Date.now()}-${Math.random()}`,\n                                            type: att.type || \"file\",\n                                            url: attachmentUrl,\n                                            name: att.name || att.fileName,\n                                            size: att.size || att.fileSize,\n                                            duration: att.duration\n                                        });\n                                        addedUrls.add(attachmentUrl);\n                                    }\n                                }\n                            });\n                        }\n                        message.attachments = allAttachments;\n                    }\n                    return (0,_lib_api_route_helpers__WEBPACK_IMPORTED_MODULE_1__.createSuccessResponse)({\n                        chat,\n                        messages\n                    });\n                } else {\n                    // No chat found\n                    return (0,_lib_api_route_helpers__WEBPACK_IMPORTED_MODULE_1__.createSuccessResponse)({\n                        chat: null,\n                        messages: []\n                    });\n                }\n            } else {\n                // Get list of chats\n                try {\n                    // Try cache first (cache for 10 seconds since chat list changes frequently)\n                    const cacheKey = _lib_cache__WEBPACK_IMPORTED_MODULE_3__.cacheKeys.chatList();\n                    const cached = _lib_cache__WEBPACK_IMPORTED_MODULE_3__.cache.get(cacheKey);\n                    if (cached) {\n                        return (0,_lib_api_route_helpers__WEBPACK_IMPORTED_MODULE_1__.createSuccessResponse)({\n                            chats: cached\n                        });\n                    }\n                    const chats = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRows)(`SELECT * FROM quick_buy_chats ORDER BY \"createdAt\" DESC LIMIT 50`);\n                    // Optimize: Get unread counts for all chats in one query using GROUP BY\n                    const chatIds = chats.map((c)=>c.id);\n                    let unreadCountsMap = new Map();\n                    if (chatIds.length > 0) {\n                        try {\n                            // Use IN clause with GROUP BY to get all unread counts in one query\n                            const placeholders = chatIds.map((_, i)=>`$${i + 1}`).join(',');\n                            const unreadCounts = await (0,_lib_db_index__WEBPACK_IMPORTED_MODULE_0__.getRows)(`SELECT \"chatId\", COUNT(*) as count \n                 FROM chat_messages \n                 WHERE \"chatId\" IN (${placeholders})\n                   AND sender = 'user' \n                   AND (status IS NULL OR (status != 'read' AND status IN ('sent', 'delivered', 'sending')))\n                 GROUP BY \"chatId\"`, chatIds);\n                            // Create map for O(1) lookup\n                            unreadCounts.forEach((result)=>{\n                                unreadCountsMap.set(result.chatId, parseInt(result.count || \"0\", 10));\n                            });\n                        } catch (error) {\n                            // If error getting unread counts, log and continue with 0 counts\n                            if (true) {\n                                _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.error(`Error getting unread counts:`, error);\n                            }\n                        }\n                    }\n                    // Map chats with unread counts\n                    const chatsWithUnreadCount = chats.map((chat)=>({\n                            ...chat,\n                            unreadCount: unreadCountsMap.get(chat.id) || 0\n                        }));\n                    // Cache the result for 10 seconds\n                    _lib_cache__WEBPACK_IMPORTED_MODULE_3__.cache.set(cacheKey, chatsWithUnreadCount, 10000);\n                    return (0,_lib_api_route_helpers__WEBPACK_IMPORTED_MODULE_1__.createSuccessResponse)({\n                        chats: chatsWithUnreadCount\n                    });\n                } catch (dbError) {\n                    // If table doesn't exist, return empty array instead of error\n                    if (dbError?.code === \"42P01\" || dbError?.message?.includes(\"does not exist\")) {\n                        _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.warn(\"Chat table does not exist yet, returning empty chats list\");\n                        return (0,_lib_api_route_helpers__WEBPACK_IMPORTED_MODULE_1__.createSuccessResponse)({\n                            chats: []\n                        });\n                    }\n                    throw dbError;\n                }\n            }\n        }\n    } catch (error) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_4__.logger.error(\"[GET /api/chat] Error:\", error);\n        return (0,_lib_api_route_helpers__WEBPACK_IMPORTED_MODULE_1__.createErrorResponse)(error);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QSxJQUFJOzRCQUNQa0QsYUFBYUwsZ0JBQWdCaEQsR0FBRyxDQUFDRyxLQUFLekMsRUFBRSxLQUFLO3dCQUMvQztvQkFFQSxrQ0FBa0M7b0JBQ2xDdEMsNkNBQUtBLENBQUNvRyxHQUFHLENBQUNrQixVQUFVVSxzQkFBc0I7b0JBRTFDLE9BQU9sSSw2RUFBcUJBLENBQUM7d0JBQUUySCxPQUFPTztvQkFBcUI7Z0JBQzdELEVBQUUsT0FBT2hELFNBQWM7b0JBQ3JCLDhEQUE4RDtvQkFDOUQsSUFBSUEsU0FBUzlELFNBQVMsV0FBVzhELFNBQVM3RCxTQUFTQyxTQUFTLG1CQUFtQjt3QkFDN0VsQiwrQ0FBTUEsQ0FBQ29ELElBQUksQ0FBQzt3QkFDWixPQUFPeEQsNkVBQXFCQSxDQUFDOzRCQUFFMkgsT0FBTyxFQUFFO3dCQUFDO29CQUMzQztvQkFDQSxNQUFNekM7Z0JBQ1I7WUFDRjtRQUNGO0lBQ0YsRUFBRSxPQUFPM0QsT0FBTztRQUNkbkIsK0NBQU1BLENBQUNtQixLQUFLLENBQUMsMEJBQTBCQTtRQUN2QyxPQUFPeEIsMkVBQW1CQSxDQUFDd0I7SUFDN0I7QUFDRiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxNb2hhbWFkSmF2YWRcXE9uZURyaXZlXFxEZXNrdG9wXFxzYWRlZCAtIENvcHkgKDQpXFxhcHBcXGFwaVxcY2hhdFxccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgZ2V0Um93LCBydW5RdWVyeSwgZ2V0Um93cyB9IGZyb20gXCJAL2xpYi9kYi9pbmRleFwiO1xuaW1wb3J0IHsgY3JlYXRlRXJyb3JSZXNwb25zZSwgY3JlYXRlU3VjY2Vzc1Jlc3BvbnNlIH0gZnJvbSBcIkAvbGliL2FwaS1yb3V0ZS1oZWxwZXJzXCI7XG5pbXBvcnQgeyBBcHBFcnJvciB9IGZyb20gXCJAL2xpYi9hcGktZXJyb3ItaGFuZGxlclwiO1xuaW1wb3J0IHsgY2FjaGUsIGNhY2hlS2V5cyB9IGZyb20gXCJAL2xpYi9jYWNoZVwiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIkAvbGliL2xvZ2dlclwiO1xuaW1wb3J0IHsgcmF0ZUxpbWl0IH0gZnJvbSBcIkAvbGliL3JhdGUtbGltaXRcIjtcblxuLyoqXG4gKiBQT1NUIC9hcGkvY2hhdCAtIENyZWF0ZSBhIG5ldyBjaGF0IGFuZCBzYXZlIG1lc3NhZ2VzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIC8vIFJhdGUgbGltaXRpbmc6IDIwIHJlcXVlc3RzIHBlciBtaW51dGUgcGVyIElQXG4gIGNvbnN0IHJhdGVMaW1pdFJlc3BvbnNlID0gYXdhaXQgcmF0ZUxpbWl0KDIwLCA2MDAwMCkocmVxdWVzdCk7XG4gIGlmIChyYXRlTGltaXRSZXNwb25zZSkge1xuICAgIHJldHVybiByYXRlTGltaXRSZXNwb25zZTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpLmNhdGNoKCgpID0+IHtcbiAgICAgIHRocm93IG5ldyBBcHBFcnJvcihcIkludmFsaWQgSlNPTiBpbiByZXF1ZXN0IGJvZHlcIiwgNDAwLCBcIklOVkFMSURfSlNPTlwiKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHsgY3VzdG9tZXJJbmZvLCBtZXNzYWdlcyB9ID0gYm9keTtcblxuICAgIGlmICghY3VzdG9tZXJJbmZvIHx8ICFjdXN0b21lckluZm8ubmFtZSB8fCAhY3VzdG9tZXJJbmZvLnBob25lKSB7XG4gICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoXCLYp9i32YTYp9i52KfYqiDZhdi02KrYsduMINin2YTYstin2YXbjCDYp9iz2KpcIiwgNDAwLCBcIk1JU1NJTkdfQ1VTVE9NRVJfSU5GT1wiKTtcbiAgICB9XG5cbiAgICBpZiAoIW1lc3NhZ2VzIHx8ICFBcnJheS5pc0FycmF5KG1lc3NhZ2VzKSB8fCBtZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBBcHBFcnJvcihcItit2K/Yp9mC2YQg24zaqSDZvtuM2KfZhSDYp9mE2LLYp9mF24wg2KfYs9iqXCIsIDQwMCwgXCJNSVNTSU5HX01FU1NBR0VTXCIpO1xuICAgIH1cblxuICAgIC8vIEVuc3VyZSB0YWJsZXMgZXhpc3QgKGNyZWF0ZSBpbiBvcmRlciB0byBoYW5kbGUgZm9yZWlnbiBrZXlzKVxuICAgIHRyeSB7XG4gICAgICAvLyBDcmVhdGUgY2hhdHMgdGFibGUgZmlyc3RcbiAgICAgIGF3YWl0IHJ1blF1ZXJ5KGBcbiAgICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgcXVpY2tfYnV5X2NoYXRzIChcbiAgICAgICAgICBpZCBWQVJDSEFSKDI1NSkgUFJJTUFSWSBLRVksXG4gICAgICAgICAgXCJjdXN0b21lck5hbWVcIiBWQVJDSEFSKDI1NSkgTk9UIE5VTEwsXG4gICAgICAgICAgXCJjdXN0b21lclBob25lXCIgVkFSQ0hBUigyNTUpIE5PVCBOVUxMLFxuICAgICAgICAgIFwiY3VzdG9tZXJFbWFpbFwiIFZBUkNIQVIoMjU1KSxcbiAgICAgICAgICBzdGF0dXMgVkFSQ0hBUig1MCkgTk9UIE5VTEwgREVGQVVMVCAnYWN0aXZlJyxcbiAgICAgICAgICBcImNyZWF0ZWRBdFwiIFRJTUVTVEFNUCBOT1QgTlVMTCBERUZBVUxUIE5PVygpLFxuICAgICAgICAgIFwidXBkYXRlZEF0XCIgVElNRVNUQU1QIE5PVCBOVUxMIERFRkFVTFQgTk9XKClcbiAgICAgICAgKTtcbiAgICAgIGApO1xuXG4gICAgICAvLyBDcmVhdGUgbWVzc2FnZXMgdGFibGUgKGRlcGVuZHMgb24gY2hhdHMpXG4gICAgICBhd2FpdCBydW5RdWVyeShgXG4gICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGNoYXRfbWVzc2FnZXMgKFxuICAgICAgICAgIGlkIFZBUkNIQVIoMjU1KSBQUklNQVJZIEtFWSxcbiAgICAgICAgICBcImNoYXRJZFwiIFZBUkNIQVIoMjU1KSBOT1QgTlVMTCBSRUZFUkVOQ0VTIHF1aWNrX2J1eV9jaGF0cyhpZCkgT04gREVMRVRFIENBU0NBREUsXG4gICAgICAgICAgdGV4dCBURVhULFxuICAgICAgICAgIHNlbmRlciBWQVJDSEFSKDUwKSBOT1QgTlVMTCxcbiAgICAgICAgICBhdHRhY2htZW50cyBKU09OQiBERUZBVUxUICdbXSc6Ompzb25iLFxuICAgICAgICAgIHN0YXR1cyBWQVJDSEFSKDUwKSBERUZBVUxUICdzZW50JyxcbiAgICAgICAgICBcImNyZWF0ZWRBdFwiIFRJTUVTVEFNUCBOT1QgTlVMTCBERUZBVUxUIE5PVygpXG4gICAgICAgICk7XG4gICAgICBgKTtcbiAgICAgIFxuICAgICAgLy8gQWRkIHN0YXR1cyBjb2x1bW4gaWYgaXQgZG9lc24ndCBleGlzdCAoZm9yIGV4aXN0aW5nIHRhYmxlcylcbiAgICAgIGF3YWl0IHJ1blF1ZXJ5KGBcbiAgICAgICAgQUxURVIgVEFCTEUgY2hhdF9tZXNzYWdlcyBcbiAgICAgICAgQUREIENPTFVNTiBJRiBOT1QgRVhJU1RTIHN0YXR1cyBWQVJDSEFSKDUwKSBERUZBVUxUICdzZW50JztcbiAgICAgIGApO1xuXG4gICAgICAvLyBDcmVhdGUgYXR0YWNobWVudHMgdGFibGUgKGRlcGVuZHMgb24gbWVzc2FnZXMpXG4gICAgICBhd2FpdCBydW5RdWVyeShgXG4gICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGNoYXRfYXR0YWNobWVudHMgKFxuICAgICAgICAgIGlkIFZBUkNIQVIoMjU1KSBQUklNQVJZIEtFWSxcbiAgICAgICAgICBcIm1lc3NhZ2VJZFwiIFZBUkNIQVIoMjU1KSBOT1QgTlVMTCBSRUZFUkVOQ0VTIGNoYXRfbWVzc2FnZXMoaWQpIE9OIERFTEVURSBDQVNDQURFLFxuICAgICAgICAgIHR5cGUgVkFSQ0hBUig1MCkgTk9UIE5VTEwsXG4gICAgICAgICAgXCJmaWxlUGF0aFwiIFZBUkNIQVIoNTAwKSxcbiAgICAgICAgICBcImZpbGVOYW1lXCIgVkFSQ0hBUigyNTUpLFxuICAgICAgICAgIFwiZmlsZVNpemVcIiBCSUdJTlQsXG4gICAgICAgICAgXCJmaWxlVXJsXCIgVkFSQ0hBUig1MDApLFxuICAgICAgICAgIFwiY3JlYXRlZEF0XCIgVElNRVNUQU1QIE5PVCBOVUxMIERFRkFVTFQgTk9XKClcbiAgICAgICAgKTtcbiAgICAgIGApO1xuXG4gICAgICAvLyBDcmVhdGUgaW5kZXhlc1xuICAgICAgYXdhaXQgcnVuUXVlcnkoYFxuICAgICAgICBDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfY2hhdF9tZXNzYWdlc19jaGF0SWQgT04gY2hhdF9tZXNzYWdlcyhcImNoYXRJZFwiKTtcbiAgICAgICAgQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X2NoYXRfYXR0YWNobWVudHNfbWVzc2FnZUlkIE9OIGNoYXRfYXR0YWNobWVudHMoXCJtZXNzYWdlSWRcIik7XG4gICAgICBgKTtcbiAgICB9IGNhdGNoIChjcmVhdGVFcnJvcjogYW55KSB7XG4gICAgICBpZiAoY3JlYXRlRXJyb3I/LmNvZGUgIT09IFwiNDJQMDdcIiAmJiAhY3JlYXRlRXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKFwiYWxyZWFkeSBleGlzdHNcIikpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgY2hhdCB0YWJsZXM6XCIsIGNyZWF0ZUVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBjaGF0SWQgaXMgcHJvdmlkZWQgKGZvciB1cGRhdGluZyBleGlzdGluZyBjaGF0KVxuICAgIGNvbnN0IHByb3ZpZGVkQ2hhdElkID0gYm9keS5jaGF0SWQ7XG4gICAgbGV0IGNoYXRJZDogc3RyaW5nO1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuICAgIGlmIChwcm92aWRlZENoYXRJZCkge1xuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIGNoYXRcbiAgICAgIGNoYXRJZCA9IHByb3ZpZGVkQ2hhdElkO1xuICAgICAgYXdhaXQgcnVuUXVlcnkoXG4gICAgICAgIGBVUERBVEUgcXVpY2tfYnV5X2NoYXRzIFxuICAgICAgICAgU0VUIFwidXBkYXRlZEF0XCIgPSAkMSBcbiAgICAgICAgIFdIRVJFIGlkID0gJDJgLFxuICAgICAgICBbbm93LCBjaGF0SWRdXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDcmVhdGUgbmV3IGNoYXRcbiAgICAgIGNoYXRJZCA9IGBjaGF0LSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcbiAgICAgIGF3YWl0IHJ1blF1ZXJ5KFxuICAgICAgICBgSU5TRVJUIElOVE8gcXVpY2tfYnV5X2NoYXRzIChpZCwgXCJjdXN0b21lck5hbWVcIiwgXCJjdXN0b21lclBob25lXCIsIFwiY3VzdG9tZXJFbWFpbFwiLCBzdGF0dXMsIFwiY3JlYXRlZEF0XCIsIFwidXBkYXRlZEF0XCIpXG4gICAgICAgICBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSwgJDYsICQ3KWAsXG4gICAgICAgIFtcbiAgICAgICAgICBjaGF0SWQsXG4gICAgICAgICAgY3VzdG9tZXJJbmZvLm5hbWUudHJpbSgpLFxuICAgICAgICAgIGN1c3RvbWVySW5mby5waG9uZS50cmltKCksXG4gICAgICAgICAgY3VzdG9tZXJJbmZvLmVtYWlsPy50cmltKCkgfHwgbnVsbCxcbiAgICAgICAgICBcImFjdGl2ZVwiLFxuICAgICAgICAgIG5vdyxcbiAgICAgICAgICBub3csXG4gICAgICAgIF1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gR2V0IGV4aXN0aW5nIG1lc3NhZ2UgSURzIHRvIGF2b2lkIGR1cGxpY2F0ZXNcbiAgICBjb25zdCBleGlzdGluZ01lc3NhZ2VzID0gYXdhaXQgZ2V0Um93czx7IGlkOiBzdHJpbmcgfT4oXG4gICAgICBgU0VMRUNUIGlkIEZST00gY2hhdF9tZXNzYWdlcyBXSEVSRSBcImNoYXRJZFwiID0gJDFgLFxuICAgICAgW2NoYXRJZF1cbiAgICApO1xuICAgIGNvbnN0IGV4aXN0aW5nTWVzc2FnZUlkcyA9IG5ldyBTZXQoZXhpc3RpbmdNZXNzYWdlcy5tYXAoKG0pID0+IG0uaWQpKTtcblxuICAgIC8vIFNhdmUgbWVzc2FnZXMgYW5kIHRoZWlyIGF0dGFjaG1lbnRzXG4gICAgY29uc3Qgc2F2ZWRNZXNzYWdlcyA9IFtdO1xuICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlcykge1xuICAgICAgY29uc3QgbWVzc2FnZUlkID0gbWVzc2FnZS5pZCB8fCBgbXNnLSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcbiAgICAgIFxuICAgICAgY29uc3QgbWVzc2FnZUNyZWF0ZWRBdCA9IG1lc3NhZ2UudGltZXN0YW1wID8gbmV3IERhdGUobWVzc2FnZS50aW1lc3RhbXApLnRvSVNPU3RyaW5nKCkgOiBub3c7XG4gICAgICBcbiAgICAgIGNvbnN0IGlzTmV3TWVzc2FnZSA9ICFleGlzdGluZ01lc3NhZ2VJZHMuaGFzKG1lc3NhZ2VJZCk7XG5cbiAgICAgIC8vIEZpbHRlciBhdHRhY2htZW50cyB0byBvbmx5IGluY2x1ZGUgdmFsaWQgVVJMcyAobm90IGJsb2IvZGF0YSBVUkxzKVxuICAgICAgY29uc3QgdmFsaWRBdHRhY2htZW50cyA9IG1lc3NhZ2UuYXR0YWNobWVudHMgJiYgQXJyYXkuaXNBcnJheShtZXNzYWdlLmF0dGFjaG1lbnRzKSBcbiAgICAgICAgPyBtZXNzYWdlLmF0dGFjaG1lbnRzLmZpbHRlcigoYXR0OiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IGF0dC51cmwgfHwgYXR0LmZpbGVVcmwgfHwgYXR0LmZpbGVQYXRoO1xuICAgICAgICAgICAgY29uc3QgaXNWYWxpZCA9IHVybCAmJiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICF1cmwuc3RhcnRzV2l0aCgnYmxvYjonKSAmJiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICF1cmwuc3RhcnRzV2l0aCgnZGF0YTonKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgKHVybC5zdGFydHNXaXRoKCdodHRwJykgfHwgdXJsLnN0YXJ0c1dpdGgoJy8nKSk7XG4gICAgICAgICAgICBpZiAoIWlzVmFsaWQgJiYgdXJsKSB7XG4gICAgICAgICAgICAgIGxvZ2dlci53YXJuKGBGaWx0ZXJlZCBvdXQgaW52YWxpZCBhdHRhY2htZW50IFVSTCBmb3IgbWVzc2FnZSAke21lc3NhZ2VJZH06YCwgeyB1cmwsIGF0dGFjaG1lbnQ6IGF0dCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpc1ZhbGlkO1xuICAgICAgICAgIH0pXG4gICAgICAgIDogW107XG4gICAgICBcbiAgICAgIC8vIExvZyBhdHRhY2htZW50cyBiZWluZyBzYXZlZCAob25seSBpbiBkZXZlbG9wbWVudClcbiAgICAgIGlmICh2YWxpZEF0dGFjaG1lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGDwn5K+IFNhdmluZyAke3ZhbGlkQXR0YWNobWVudHMubGVuZ3RofSBhdHRhY2htZW50KHMpIGZvciBtZXNzYWdlICR7bWVzc2FnZUlkfTpgLCBcbiAgICAgICAgICB2YWxpZEF0dGFjaG1lbnRzLm1hcCgoYXR0OiBhbnkpID0+ICh7IFxuICAgICAgICAgICAgaWQ6IGF0dC5pZCwgXG4gICAgICAgICAgICB0eXBlOiBhdHQudHlwZSwgXG4gICAgICAgICAgICB1cmw6IGF0dC51cmwgfHwgYXR0LmZpbGVVcmwsXG4gICAgICAgICAgICBuYW1lOiBhdHQubmFtZSBcbiAgICAgICAgICB9KSlcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IG1lc3NhZ2Ugc3RhdHVzIGZyb20gcmVxdWVzdCBvciBkZWZhdWx0IGJhc2VkIG9uIHNlbmRlclxuICAgICAgY29uc3QgbWVzc2FnZVN0YXR1cyA9IG1lc3NhZ2Uuc3RhdHVzIHx8IChtZXNzYWdlLnNlbmRlciA9PT0gXCJ1c2VyXCIgPyBcInNlbnRcIiA6IG51bGwpO1xuICAgICAgXG4gICAgICAvLyBTYXZlIG1lc3NhZ2UgdXNpbmcgVVBTRVJUIHRvIGF2b2lkIGR1cGxpY2F0ZXNcbiAgICAgIGF3YWl0IHJ1blF1ZXJ5KFxuICAgICAgICBgSU5TRVJUIElOVE8gY2hhdF9tZXNzYWdlcyAoaWQsIFwiY2hhdElkXCIsIHRleHQsIHNlbmRlciwgYXR0YWNobWVudHMsIHN0YXR1cywgXCJjcmVhdGVkQXRcIilcbiAgICAgICAgIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcpXG4gICAgICAgICBPTiBDT05GTElDVCAoaWQpIERPIFVQREFURSBTRVRcbiAgICAgICAgICAgdGV4dCA9IEVYQ0xVREVELnRleHQsXG4gICAgICAgICAgIGF0dGFjaG1lbnRzID0gRVhDTFVERUQuYXR0YWNobWVudHMsXG4gICAgICAgICAgIHN0YXR1cyA9IENPQUxFU0NFKEVYQ0xVREVELnN0YXR1cywgY2hhdF9tZXNzYWdlcy5zdGF0dXMpYCxcbiAgICAgICAgW1xuICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgICBjaGF0SWQsXG4gICAgICAgICAgbWVzc2FnZS50ZXh0IHx8IG51bGwsXG4gICAgICAgICAgbWVzc2FnZS5zZW5kZXIsXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkodmFsaWRBdHRhY2htZW50cyksXG4gICAgICAgICAgbWVzc2FnZVN0YXR1cyxcbiAgICAgICAgICBtZXNzYWdlQ3JlYXRlZEF0LFxuICAgICAgICBdXG4gICAgICApO1xuXG4gICAgICAvLyBBTFdBWVMgc2F2ZSBhdHRhY2htZW50cywgZXZlbiBpZiBtZXNzYWdlIGFscmVhZHkgZXhpc3RzIChpbXBvcnRhbnQgZm9yIGltYWdlcylcbiAgICAgIGlmICh2YWxpZEF0dGFjaG1lbnRzICYmIEFycmF5LmlzQXJyYXkodmFsaWRBdHRhY2htZW50cykgJiYgdmFsaWRBdHRhY2htZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgYXR0YWNobWVudCBvZiB2YWxpZEF0dGFjaG1lbnRzKSB7XG4gICAgICAgICAgLy8gRW5zdXJlIHdlIGhhdmUgYSB2YWxpZCBVUkwgZm9yIHRoZSBhdHRhY2htZW50XG4gICAgICAgICAgY29uc3QgYXR0YWNobWVudFVybCA9IGF0dGFjaG1lbnQudXJsIHx8IGF0dGFjaG1lbnQuZmlsZVVybCB8fCBudWxsO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChhdHRhY2htZW50VXJsICYmICFhdHRhY2htZW50VXJsLnN0YXJ0c1dpdGgoJ2Jsb2I6JykgJiYgIWF0dGFjaG1lbnRVcmwuc3RhcnRzV2l0aCgnZGF0YTonKSkge1xuICAgICAgICAgICAgLy8gT25seSBzYXZlIGlmIFVSTCBpcyBub3QgYSBibG9iIFVSTCBvciBkYXRhIFVSTCAodGhvc2UgYXJlIHRlbXBvcmFyeSlcbiAgICAgICAgICAgIC8vIEVuc3VyZSB3ZSBoYXZlIGEgdmFsaWQgdHlwZVxuICAgICAgICAgICAgY29uc3QgYXR0YWNobWVudFR5cGUgPSBhdHRhY2htZW50LnR5cGUgfHwgKGF0dGFjaG1lbnRVcmwuaW5jbHVkZXMoXCJpbWFnZS1cIikgPyBcImltYWdlXCIgOiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRhY2htZW50VXJsLmluY2x1ZGVzKFwiYXVkaW8tXCIpID8gXCJhdWRpb1wiIDogXCJmaWxlXCIpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAvLyBGaXJzdCwgY2hlY2sgaWYgYXR0YWNobWVudCB3aXRoIHRoaXMgVVJMIGFscmVhZHkgZXhpc3RzIGZvciB0aGlzIG1lc3NhZ2VcbiAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdBdHRhY2htZW50ID0gYXdhaXQgZ2V0Um93PGFueT4oXG4gICAgICAgICAgICAgICAgYFNFTEVDVCBpZCBGUk9NIGNoYXRfYXR0YWNobWVudHMgV0hFUkUgXCJtZXNzYWdlSWRcIiA9ICQxIEFORCBcImZpbGVVcmxcIiA9ICQyYCxcbiAgICAgICAgICAgICAgICBbbWVzc2FnZUlkLCBhdHRhY2htZW50VXJsXVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgY29uc3QgYXR0YWNobWVudElkID0gZXhpc3RpbmdBdHRhY2htZW50Py5pZCB8fCBhdHRhY2htZW50LmlkIHx8IGBhdHQtJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nQXR0YWNobWVudCkge1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyBhdHRhY2htZW50XG4gICAgICAgICAgICAgICAgYXdhaXQgcnVuUXVlcnkoXG4gICAgICAgICAgICAgICAgICBgVVBEQVRFIGNoYXRfYXR0YWNobWVudHMgXG4gICAgICAgICAgICAgICAgICAgU0VUIHR5cGUgPSAkMSwgXCJmaWxlTmFtZVwiID0gJDIsIFwiZmlsZVNpemVcIiA9ICQzLCBcImZpbGVVcmxcIiA9ICQ0XG4gICAgICAgICAgICAgICAgICAgV0hFUkUgaWQgPSAkNWAsXG4gICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRUeXBlLFxuICAgICAgICAgICAgICAgICAgICBhdHRhY2htZW50Lm5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgYXR0YWNobWVudC5zaXplIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRVcmwsXG4gICAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRJZCxcbiAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgVXBkYXRlZCBleGlzdGluZyBhdHRhY2htZW50ICR7YXR0YWNobWVudElkfSBmb3IgbWVzc2FnZSAke21lc3NhZ2VJZH06YCwgeyBcbiAgICAgICAgICAgICAgICAgIHR5cGU6IGF0dGFjaG1lbnRUeXBlLCBcbiAgICAgICAgICAgICAgICAgIHVybDogYXR0YWNobWVudFVybCxcbiAgICAgICAgICAgICAgICAgIG5hbWU6IGF0dGFjaG1lbnQubmFtZSBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJbnNlcnQgbmV3IGF0dGFjaG1lbnRcbiAgICAgICAgICAgICAgICBhd2FpdCBydW5RdWVyeShcbiAgICAgICAgICAgICAgICAgIGBJTlNFUlQgSU5UTyBjaGF0X2F0dGFjaG1lbnRzIChpZCwgXCJtZXNzYWdlSWRcIiwgdHlwZSwgXCJmaWxlUGF0aFwiLCBcImZpbGVOYW1lXCIsIFwiZmlsZVNpemVcIiwgXCJmaWxlVXJsXCIsIFwiY3JlYXRlZEF0XCIpXG4gICAgICAgICAgICAgICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgpYCxcbiAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgYXR0YWNobWVudElkLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlSWQsXG4gICAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRUeXBlLFxuICAgICAgICAgICAgICAgICAgICBhdHRhY2htZW50VXJsLFxuICAgICAgICAgICAgICAgICAgICBhdHRhY2htZW50Lm5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgYXR0YWNobWVudC5zaXplIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRVcmwsXG4gICAgICAgICAgICAgICAgICAgIG5vdyxcbiAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgU2F2ZWQgbmV3IGF0dGFjaG1lbnQgJHthdHRhY2htZW50SWR9IGZvciBtZXNzYWdlICR7bWVzc2FnZUlkfTpgLCB7IFxuICAgICAgICAgICAgICAgICAgdHlwZTogYXR0YWNobWVudFR5cGUsIFxuICAgICAgICAgICAgICAgICAgb3JpZ2luYWxUeXBlOiBhdHRhY2htZW50LnR5cGUsXG4gICAgICAgICAgICAgICAgICB1cmw6IGF0dGFjaG1lbnRVcmwsXG4gICAgICAgICAgICAgICAgICBuYW1lOiBhdHRhY2htZW50Lm5hbWUgXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoYEVycm9yIHNhdmluZyBhdHRhY2htZW50IGZvciBtZXNzYWdlICR7bWVzc2FnZUlkfTpgLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICghYXR0YWNobWVudFVybCkge1xuICAgICAgICAgICAgbG9nZ2VyLndhcm4oYEF0dGFjaG1lbnQgaGFzIG5vIFVSTCwgc2tpcHBpbmcgZGF0YWJhc2Ugc2F2ZTpgLCBhdHRhY2htZW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbG9nZ2VyLndhcm4oYEF0dGFjaG1lbnQgaGFzIHRlbXBvcmFyeSBVUkwgKGJsb2IvZGF0YSksIHNraXBwaW5nIGRhdGFiYXNlIHNhdmU6YCwgYXR0YWNobWVudFVybCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCB0aGUgc2F2ZWQgbWVzc2FnZSB3aXRoIHN0YXR1cyBmcm9tIGRhdGFiYXNlXG4gICAgICBjb25zdCBzYXZlZE1lc3NhZ2UgPSBhd2FpdCBnZXRSb3c8YW55PihcbiAgICAgICAgYFNFTEVDVCBpZCwgc3RhdHVzIEZST00gY2hhdF9tZXNzYWdlcyBXSEVSRSBpZCA9ICQxYCxcbiAgICAgICAgW21lc3NhZ2VJZF1cbiAgICAgICk7XG4gICAgICBcbiAgICAgIHNhdmVkTWVzc2FnZXMucHVzaCh7XG4gICAgICAgIGlkOiBtZXNzYWdlSWQsXG4gICAgICAgIGNoYXRJZCxcbiAgICAgICAgdGV4dDogbWVzc2FnZS50ZXh0LFxuICAgICAgICBzZW5kZXI6IG1lc3NhZ2Uuc2VuZGVyLFxuICAgICAgICBhdHRhY2htZW50czogbWVzc2FnZS5hdHRhY2htZW50cyB8fCBbXSxcbiAgICAgICAgY3JlYXRlZEF0OiBtZXNzYWdlQ3JlYXRlZEF0LFxuICAgICAgICBzdGF0dXM6IHNhdmVkTWVzc2FnZT8uc3RhdHVzIHx8IG1lc3NhZ2VTdGF0dXMsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gY3JlYXRlU3VjY2Vzc1Jlc3BvbnNlKHtcbiAgICAgIGNoYXRJZCxcbiAgICAgIG1lc3NhZ2VzOiBzYXZlZE1lc3NhZ2VzLFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBjcmVhdGVFcnJvclJlc3BvbnNlKGVycm9yKTtcbiAgfVxufVxuXG4vKipcbiAqIEdFVCAvYXBpL2NoYXQgLSBHZXQgY2hhdCBieSBJRCBvciBsaXN0IGNoYXRzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgLy8gUmF0ZSBsaW1pdGluZzogMTIwIHJlcXVlc3RzIHBlciBtaW51dGUgcGVyIElQIChpbmNyZWFzZWQgZm9yIHBvbGxpbmcgLSBhbGxvd3MgMiByZXF1ZXN0cyBwZXIgc2Vjb25kKVxuICBjb25zdCByYXRlTGltaXRSZXNwb25zZSA9IGF3YWl0IHJhdGVMaW1pdCgxMjAsIDYwMDAwKShyZXF1ZXN0KTtcbiAgaWYgKHJhdGVMaW1pdFJlc3BvbnNlKSB7XG4gICAgcmV0dXJuIHJhdGVMaW1pdFJlc3BvbnNlO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgY29uc3QgY2hhdElkID0gc2VhcmNoUGFyYW1zLmdldChcImNoYXRJZFwiKTtcbiAgICBjb25zdCBsYXN0TWVzc2FnZUlkID0gc2VhcmNoUGFyYW1zLmdldChcImxhc3RNZXNzYWdlSWRcIik7IC8vIEZvciBwb2xsaW5nIG5ldyBtZXNzYWdlc1xuICAgIGNvbnN0IHNpbmNlID0gc2VhcmNoUGFyYW1zLmdldChcInNpbmNlXCIpOyAvLyBJU08gdGltZXN0YW1wIGZvciBwb2xsaW5nXG5cbiAgICBpZiAoY2hhdElkKSB7XG4gICAgICAvLyBHZXQgc2luZ2xlIGNoYXQgd2l0aCBtZXNzYWdlc1xuICAgICAgbGV0IGNoYXQ7XG4gICAgICB0cnkge1xuICAgICAgICBjaGF0ID0gYXdhaXQgZ2V0Um93PGFueT4oXG4gICAgICAgICAgYFNFTEVDVCAqIEZST00gcXVpY2tfYnV5X2NoYXRzIFdIRVJFIGlkID0gJDFgLFxuICAgICAgICAgIFtjaGF0SWRdXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChkYkVycm9yOiBhbnkpIHtcbiAgICAgICAgLy8gSWYgdGFibGUgZG9lc24ndCBleGlzdCwgcmV0dXJuIDQwNFxuICAgICAgICBpZiAoZGJFcnJvcj8uY29kZSA9PT0gXCI0MlAwMVwiIHx8IGRiRXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKFwiZG9lcyBub3QgZXhpc3RcIikpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoXCLahtiqINuM2KfZgdiqINmG2LTYr1wiLCA0MDQsIFwiQ0hBVF9OT1RfRk9VTkRcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZGJFcnJvcjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFjaGF0KSB7XG4gICAgICAgIHRocm93IG5ldyBBcHBFcnJvcihcItqG2Kog24zYp9mB2Kog2YbYtNivXCIsIDQwNCwgXCJDSEFUX05PVF9GT1VORFwiKTtcbiAgICAgIH1cblxuICAgICAgLy8gQnVpbGQgcXVlcnkgYmFzZWQgb24gcG9sbGluZyBwYXJhbWV0ZXJzXG4gICAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldChcInBhZ2VcIikgfHwgXCIxXCIsIDEwKTtcbiAgICAgIGNvbnN0IGxpbWl0ID0gTWF0aC5taW4oMTAwLCBNYXRoLm1heCgxLCBwYXJzZUludChzZWFyY2hQYXJhbXMuZ2V0KFwibGltaXRcIikgfHwgXCI1MFwiLCAxMCkpKTtcbiAgICAgIGNvbnN0IG9mZnNldCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcbiAgICAgIFxuICAgICAgbGV0IG1lc3NhZ2VzUXVlcnkgPSBgU0VMRUNUICogRlJPTSBjaGF0X21lc3NhZ2VzIFdIRVJFIFwiY2hhdElkXCIgPSAkMWA7XG4gICAgICBjb25zdCBxdWVyeVBhcmFtczogYW55W10gPSBbY2hhdElkXTtcbiAgICAgIFxuICAgICAgaWYgKGxhc3RNZXNzYWdlSWQpIHtcbiAgICAgICAgLy8gR2V0IG1lc3NhZ2VzIGFmdGVyIHRoZSBsYXN0IGtub3duIG1lc3NhZ2UgSUQgKGZvciBwb2xsaW5nKVxuICAgICAgICAvLyBGaXJzdCBnZXQgdGhlIGNyZWF0ZWRBdCBvZiB0aGUgbGFzdCBtZXNzYWdlLCB0aGVuIGdldCBtZXNzYWdlcyBhZnRlciB0aGF0IHRpbWVcbiAgICAgICAgY29uc3QgbGFzdE1lc3NhZ2UgPSBhd2FpdCBnZXRSb3c8YW55PihcbiAgICAgICAgICBgU0VMRUNUIFwiY3JlYXRlZEF0XCIgRlJPTSBjaGF0X21lc3NhZ2VzIFdIRVJFIGlkID0gJDFgLFxuICAgICAgICAgIFtsYXN0TWVzc2FnZUlkXVxuICAgICAgICApO1xuICAgICAgICBpZiAobGFzdE1lc3NhZ2UpIHtcbiAgICAgICAgICBtZXNzYWdlc1F1ZXJ5ICs9IGAgQU5EIFwiY3JlYXRlZEF0XCIgPiAkMiBPUkRFUiBCWSBcImNyZWF0ZWRBdFwiIEFTQyBMSU1JVCAkM2A7XG4gICAgICAgICAgcXVlcnlQYXJhbXMucHVzaChsYXN0TWVzc2FnZS5jcmVhdGVkQXQsIGxpbWl0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGYWxsYmFjazogdXNlIGlkIGNvbXBhcmlzb24gaWYgY3JlYXRlZEF0IG5vdCBmb3VuZFxuICAgICAgICAgIG1lc3NhZ2VzUXVlcnkgKz0gYCBBTkQgaWQgIT0gJDIgT1JERVIgQlkgXCJjcmVhdGVkQXRcIiBBU0MgTElNSVQgJDNgO1xuICAgICAgICAgIHF1ZXJ5UGFyYW1zLnB1c2gobGFzdE1lc3NhZ2VJZCwgbGltaXQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHNpbmNlKSB7XG4gICAgICAgIC8vIEdldCBtZXNzYWdlcyBhZnRlciBhIHNwZWNpZmljIHRpbWVzdGFtcCAoZm9yIHBvbGxpbmcpXG4gICAgICAgIG1lc3NhZ2VzUXVlcnkgKz0gYCBBTkQgXCJjcmVhdGVkQXRcIiA+ICQyIE9SREVSIEJZIFwiY3JlYXRlZEF0XCIgQVNDIExJTUlUICQzYDtcbiAgICAgICAgcXVlcnlQYXJhbXMucHVzaChzaW5jZSwgbGltaXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gR2V0IHBhZ2luYXRlZCBtZXNzYWdlcyAoZm9yIGluaXRpYWwgbG9hZClcbiAgICAgICAgbWVzc2FnZXNRdWVyeSArPSBgIE9SREVSIEJZIFwiY3JlYXRlZEF0XCIgREVTQyBMSU1JVCAkMiBPRkZTRVQgJDNgO1xuICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKGxpbWl0LCBvZmZzZXQpO1xuICAgICAgfVxuXG4gICAgICBsZXQgbWVzc2FnZXMgPSBhd2FpdCBnZXRSb3dzPGFueT4obWVzc2FnZXNRdWVyeSwgcXVlcnlQYXJhbXMpO1xuICAgICAgXG4gICAgICAvLyBJZiBub3QgcG9sbGluZywgcmV2ZXJzZSBvcmRlciB0byBzaG93IG5ld2VzdCBmaXJzdCAoYnV0IHdlIGZldGNoZWQgREVTQywgc28gcmV2ZXJzZSlcbiAgICAgIGlmICghbGFzdE1lc3NhZ2VJZCAmJiAhc2luY2UpIHtcbiAgICAgICAgbWVzc2FnZXMgPSBtZXNzYWdlcy5yZXZlcnNlKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9wdGltaXplOiBHZXQgYWxsIGF0dGFjaG1lbnRzIGluIG9uZSBxdWVyeSBpbnN0ZWFkIG9mIE4rMSBxdWVyaWVzXG4gICAgICBjb25zdCBtZXNzYWdlSWRzID0gbWVzc2FnZXMubWFwKChtOiBhbnkpID0+IG0uaWQpO1xuICAgICAgbGV0IGFsbERiQXR0YWNobWVudHM6IGFueVtdID0gW107XG4gICAgICBcbiAgICAgIGlmIChtZXNzYWdlSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gVXNlIElOIGNsYXVzZSB0byBnZXQgYWxsIGF0dGFjaG1lbnRzIGluIG9uZSBxdWVyeVxuICAgICAgICBjb25zdCBwbGFjZWhvbGRlcnMgPSBtZXNzYWdlSWRzLm1hcCgoXywgaSkgPT4gYCQke2kgKyAxfWApLmpvaW4oJywnKTtcbiAgICAgICAgYWxsRGJBdHRhY2htZW50cyA9IGF3YWl0IGdldFJvd3M8YW55PihcbiAgICAgICAgICBgU0VMRUNUICogRlJPTSBjaGF0X2F0dGFjaG1lbnRzIFdIRVJFIFwibWVzc2FnZUlkXCIgSU4gKCR7cGxhY2Vob2xkZXJzfSlgLFxuICAgICAgICAgIG1lc3NhZ2VJZHNcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gR3JvdXAgYXR0YWNobWVudHMgYnkgbWVzc2FnZUlkIGZvciBPKDEpIGxvb2t1cFxuICAgICAgY29uc3QgYXR0YWNobWVudHNCeU1lc3NhZ2VJZCA9IG5ldyBNYXA8c3RyaW5nLCBhbnlbXT4oKTtcbiAgICAgIGFsbERiQXR0YWNobWVudHMuZm9yRWFjaCgoYXR0KSA9PiB7XG4gICAgICAgIGlmICghYXR0YWNobWVudHNCeU1lc3NhZ2VJZC5oYXMoYXR0Lm1lc3NhZ2VJZCkpIHtcbiAgICAgICAgICBhdHRhY2htZW50c0J5TWVzc2FnZUlkLnNldChhdHQubWVzc2FnZUlkLCBbXSk7XG4gICAgICAgIH1cbiAgICAgICAgYXR0YWNobWVudHNCeU1lc3NhZ2VJZC5nZXQoYXR0Lm1lc3NhZ2VJZCkhLnB1c2goYXR0KTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBQcm9jZXNzIG1lc3NhZ2VzIGFuZCBtZXJnZSBhdHRhY2htZW50c1xuICAgICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIG1lc3NhZ2VzKSB7XG4gICAgICAgIC8vIEZpcnN0IHRyeSB0byBnZXQgYXR0YWNobWVudHMgZnJvbSBKU09OQiBmaWVsZFxuICAgICAgICBsZXQganNvbkF0dGFjaG1lbnRzOiBhbnlbXSA9IFtdO1xuICAgICAgICBpZiAobWVzc2FnZS5hdHRhY2htZW50cykge1xuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1lc3NhZ2UuYXR0YWNobWVudHMpKSB7XG4gICAgICAgICAgICAvLyBBbHJlYWR5IGFuIGFycmF5IChQb3N0Z3JlU1FMIEpTT05CIHJldHVybnMgYXMgYXJyYXkpXG4gICAgICAgICAgICBqc29uQXR0YWNobWVudHMgPSBtZXNzYWdlLmF0dGFjaG1lbnRzO1xuICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG1lc3NhZ2UuYXR0YWNobWVudHMgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgaWYgaXQncyBhIHN0cmluZ1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShtZXNzYWdlLmF0dGFjaG1lbnRzKTtcbiAgICAgICAgICAgICAganNvbkF0dGFjaG1lbnRzID0gQXJyYXkuaXNBcnJheShwYXJzZWQpID8gcGFyc2VkIDogW3BhcnNlZF07XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgcGFyc2luZyBhdHRhY2htZW50cyBKU09OIGZvciBtZXNzYWdlICR7bWVzc2FnZS5pZH06YCwgZSk7XG4gICAgICAgICAgICAgIGpzb25BdHRhY2htZW50cyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG1lc3NhZ2UuYXR0YWNobWVudHMgPT09ICdvYmplY3QnICYmIG1lc3NhZ2UuYXR0YWNobWVudHMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIFNpbmdsZSBvYmplY3QsIGNvbnZlcnQgdG8gYXJyYXlcbiAgICAgICAgICAgIGpzb25BdHRhY2htZW50cyA9IEFycmF5LmlzQXJyYXkobWVzc2FnZS5hdHRhY2htZW50cykgPyBtZXNzYWdlLmF0dGFjaG1lbnRzIDogW21lc3NhZ2UuYXR0YWNobWVudHNdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gR2V0IGF0dGFjaG1lbnRzIGZyb20gZGF0YWJhc2UgdGFibGUgKGFscmVhZHkgbG9hZGVkKVxuICAgICAgICBjb25zdCBkYkF0dGFjaG1lbnRzID0gYXR0YWNobWVudHNCeU1lc3NhZ2VJZC5nZXQobWVzc2FnZS5pZCkgfHwgW107XG4gICAgICAgIFxuICAgICAgICAvLyBNZXJnZSBhdHRhY2htZW50cyAtIHByZWZlciBkYXRhYmFzZSB0YWJsZSBhdHRhY2htZW50cyAodGhleSBhcmUgbW9yZSByZWxpYWJsZSlcbiAgICAgICAgY29uc3QgYWxsQXR0YWNobWVudHM6IGFueVtdID0gW107XG4gICAgICAgIGNvbnN0IGFkZGVkVXJscyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgICAgICBcbiAgICAgICAgLy8gRmlyc3QgYWRkIGRhdGFiYXNlIHRhYmxlIGF0dGFjaG1lbnRzICh0aGVzZSBhcmUgdGhlIHNvdXJjZSBvZiB0cnV0aClcbiAgICAgICAgZGJBdHRhY2htZW50cy5mb3JFYWNoKChhdHQpID0+IHtcbiAgICAgICAgICBpZiAoYXR0LmZpbGVVcmwgJiYgIWF0dC5maWxlVXJsLnN0YXJ0c1dpdGgoJ2Jsb2I6JykgJiYgIWF0dC5maWxlVXJsLnN0YXJ0c1dpdGgoJ2RhdGE6JykpIHtcbiAgICAgICAgICAgIC8vIE9ubHkgYWRkIGlmIFVSTCBleGlzdHMgYW5kIGlzIG5vdCBhIHRlbXBvcmFyeSBibG9iL2RhdGEgVVJMXG4gICAgICAgICAgICAvLyBFbnN1cmUgdHlwZSBpcyBwcmVzZXJ2ZWQgKGltcG9ydGFudCBmb3IgYXVkaW8sIGV0Yy4pXG4gICAgICAgICAgICBhbGxBdHRhY2htZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgaWQ6IGF0dC5pZCxcbiAgICAgICAgICAgICAgdHlwZTogYXR0LnR5cGUgfHwgXCJmaWxlXCIsIC8vIERlZmF1bHQgdG8gXCJmaWxlXCIgaWYgdHlwZSBpcyBtaXNzaW5nXG4gICAgICAgICAgICAgIHVybDogYXR0LmZpbGVVcmwsXG4gICAgICAgICAgICAgIG5hbWU6IGF0dC5maWxlTmFtZSxcbiAgICAgICAgICAgICAgc2l6ZTogYXR0LmZpbGVTaXplLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhZGRlZFVybHMuYWRkKGF0dC5maWxlVXJsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gVGhlbiBhZGQgSlNPTiBhdHRhY2htZW50cyBpZiBub3QgYWxyZWFkeSBpbiBkYXRhYmFzZSBhbmQgbm90IHRlbXBvcmFyeSBVUkxzXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGpzb25BdHRhY2htZW50cykgJiYganNvbkF0dGFjaG1lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBqc29uQXR0YWNobWVudHMuZm9yRWFjaCgoYXR0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhdHRhY2htZW50VXJsID0gYXR0LnVybCB8fCBhdHQuZmlsZVVybCB8fCBhdHQuZmlsZVBhdGg7XG4gICAgICAgICAgICAvLyBTa2lwIGlmIFVSTCBpcyB0ZW1wb3Jhcnkgb3IgYWxyZWFkeSBhZGRlZFxuICAgICAgICAgICAgaWYgKGF0dGFjaG1lbnRVcmwgJiYgXG4gICAgICAgICAgICAgICAgIWF0dGFjaG1lbnRVcmwuc3RhcnRzV2l0aCgnYmxvYjonKSAmJiBcbiAgICAgICAgICAgICAgICAhYXR0YWNobWVudFVybC5zdGFydHNXaXRoKCdkYXRhOicpICYmXG4gICAgICAgICAgICAgICAgIWFkZGVkVXJscy5oYXMoYXR0YWNobWVudFVybCkpIHtcbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UgYWxyZWFkeSBoYXZlIHRoaXMgYXR0YWNobWVudCBieSBVUkwgKGV2ZW4gaWYgSUQgaXMgZGlmZmVyZW50KVxuICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0J5VXJsID0gYWxsQXR0YWNobWVudHMuZmluZChhID0+IGEudXJsID09PSBhdHRhY2htZW50VXJsKTtcbiAgICAgICAgICAgICAgaWYgKCFleGlzdGluZ0J5VXJsKSB7XG4gICAgICAgICAgICAgICAgYWxsQXR0YWNobWVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICBpZDogYXR0LmlkIHx8IGBhdHQtJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCl9YCxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IGF0dC50eXBlIHx8IFwiZmlsZVwiLCAvLyBFbnN1cmUgdHlwZSBpcyBhbHdheXMgc2V0XG4gICAgICAgICAgICAgICAgICB1cmw6IGF0dGFjaG1lbnRVcmwsXG4gICAgICAgICAgICAgICAgICBuYW1lOiBhdHQubmFtZSB8fCBhdHQuZmlsZU5hbWUsXG4gICAgICAgICAgICAgICAgICBzaXplOiBhdHQuc2l6ZSB8fCBhdHQuZmlsZVNpemUsXG4gICAgICAgICAgICAgICAgICBkdXJhdGlvbjogYXR0LmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGFkZGVkVXJscy5hZGQoYXR0YWNobWVudFVybCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgbWVzc2FnZS5hdHRhY2htZW50cyA9IGFsbEF0dGFjaG1lbnRzO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gY3JlYXRlU3VjY2Vzc1Jlc3BvbnNlKHtcbiAgICAgICAgY2hhdCxcbiAgICAgICAgbWVzc2FnZXMsXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ2hlY2sgaWYgd2Ugc2hvdWxkIGZpbmQgY2hhdCBieSBjdXN0b21lciBpbmZvXG4gICAgICBjb25zdCBjdXN0b21lclBob25lID0gc2VhcmNoUGFyYW1zLmdldChcImN1c3RvbWVyUGhvbmVcIik7XG4gICAgICBjb25zdCBjdXN0b21lck5hbWUgPSBzZWFyY2hQYXJhbXMuZ2V0KFwiY3VzdG9tZXJOYW1lXCIpO1xuXG4gICAgICBpZiAoY3VzdG9tZXJQaG9uZSkge1xuICAgICAgICAvLyBGaW5kIGNoYXQgYnkgY3VzdG9tZXIgcGhvbmUgKGFuZCBvcHRpb25hbGx5IG5hbWUpXG4gICAgICAgIGxldCBjaGF0O1xuICAgICAgICBpZiAoY3VzdG9tZXJOYW1lKSB7XG4gICAgICAgICAgY2hhdCA9IGF3YWl0IGdldFJvdzxhbnk+KFxuICAgICAgICAgICAgYFNFTEVDVCAqIEZST00gcXVpY2tfYnV5X2NoYXRzIFxuICAgICAgICAgICAgIFdIRVJFIFwiY3VzdG9tZXJQaG9uZVwiID0gJDEgQU5EIFwiY3VzdG9tZXJOYW1lXCIgPSAkMiBcbiAgICAgICAgICAgICBPUkRFUiBCWSBcImNyZWF0ZWRBdFwiIERFU0MgTElNSVQgMWAsXG4gICAgICAgICAgICBbY3VzdG9tZXJQaG9uZSwgY3VzdG9tZXJOYW1lXVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2hhdCA9IGF3YWl0IGdldFJvdzxhbnk+KFxuICAgICAgICAgICAgYFNFTEVDVCAqIEZST00gcXVpY2tfYnV5X2NoYXRzIFxuICAgICAgICAgICAgIFdIRVJFIFwiY3VzdG9tZXJQaG9uZVwiID0gJDEgXG4gICAgICAgICAgICAgT1JERVIgQlkgXCJjcmVhdGVkQXRcIiBERVNDIExJTUlUIDFgLFxuICAgICAgICAgICAgW2N1c3RvbWVyUGhvbmVdXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjaGF0KSB7XG4gICAgICAgICAgLy8gR2V0IG1lc3NhZ2VzIGZvciB0aGlzIGNoYXRcbiAgICAgICAgICBjb25zdCBtZXNzYWdlcyA9IGF3YWl0IGdldFJvd3M8YW55PihcbiAgICAgICAgICAgIGBTRUxFQ1QgKiBGUk9NIGNoYXRfbWVzc2FnZXMgV0hFUkUgXCJjaGF0SWRcIiA9ICQxIE9SREVSIEJZIFwiY3JlYXRlZEF0XCIgQVNDYCxcbiAgICAgICAgICAgIFtjaGF0LmlkXVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBPcHRpbWl6ZTogR2V0IGFsbCBhdHRhY2htZW50cyBpbiBvbmUgcXVlcnkgaW5zdGVhZCBvZiBOKzEgcXVlcmllc1xuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VJZHMgPSBtZXNzYWdlcy5tYXAoKG06IGFueSkgPT4gbS5pZCk7XG4gICAgICAgICAgbGV0IGFsbERiQXR0YWNobWVudHM6IGFueVtdID0gW107XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKG1lc3NhZ2VJZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy8gVXNlIElOIGNsYXVzZSB0byBnZXQgYWxsIGF0dGFjaG1lbnRzIGluIG9uZSBxdWVyeVxuICAgICAgICAgICAgY29uc3QgcGxhY2Vob2xkZXJzID0gbWVzc2FnZUlkcy5tYXAoKF8sIGkpID0+IGAkJHtpICsgMX1gKS5qb2luKCcsJyk7XG4gICAgICAgICAgICBhbGxEYkF0dGFjaG1lbnRzID0gYXdhaXQgZ2V0Um93czxhbnk+KFxuICAgICAgICAgICAgICBgU0VMRUNUICogRlJPTSBjaGF0X2F0dGFjaG1lbnRzIFdIRVJFIFwibWVzc2FnZUlkXCIgSU4gKCR7cGxhY2Vob2xkZXJzfSlgLFxuICAgICAgICAgICAgICBtZXNzYWdlSWRzXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBHcm91cCBhdHRhY2htZW50cyBieSBtZXNzYWdlSWQgZm9yIE8oMSkgbG9va3VwXG4gICAgICAgICAgY29uc3QgYXR0YWNobWVudHNCeU1lc3NhZ2VJZCA9IG5ldyBNYXA8c3RyaW5nLCBhbnlbXT4oKTtcbiAgICAgICAgICBhbGxEYkF0dGFjaG1lbnRzLmZvckVhY2goKGF0dCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFhdHRhY2htZW50c0J5TWVzc2FnZUlkLmhhcyhhdHQubWVzc2FnZUlkKSkge1xuICAgICAgICAgICAgICBhdHRhY2htZW50c0J5TWVzc2FnZUlkLnNldChhdHQubWVzc2FnZUlkLCBbXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhdHRhY2htZW50c0J5TWVzc2FnZUlkLmdldChhdHQubWVzc2FnZUlkKSEucHVzaChhdHQpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gUHJvY2VzcyBtZXNzYWdlcyBhbmQgbWVyZ2UgYXR0YWNobWVudHNcbiAgICAgICAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgbWVzc2FnZXMpIHtcbiAgICAgICAgICAgIC8vIEZpcnN0IHRyeSB0byBnZXQgYXR0YWNobWVudHMgZnJvbSBKU09OQiBmaWVsZFxuICAgICAgICAgICAgbGV0IGpzb25BdHRhY2htZW50czogYW55W10gPSBbXTtcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLmF0dGFjaG1lbnRzKSB7XG4gICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1lc3NhZ2UuYXR0YWNobWVudHMpKSB7XG4gICAgICAgICAgICAgICAgLy8gUG9zdGdyZVNRTCBKU09OQiByZXR1cm5zIGFzIGFycmF5XG4gICAgICAgICAgICAgICAganNvbkF0dGFjaG1lbnRzID0gbWVzc2FnZS5hdHRhY2htZW50cztcbiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbWVzc2FnZS5hdHRhY2htZW50cyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgaWYgaXQncyBhIHN0cmluZ1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKG1lc3NhZ2UuYXR0YWNobWVudHMpO1xuICAgICAgICAgICAgICAgICAganNvbkF0dGFjaG1lbnRzID0gQXJyYXkuaXNBcnJheShwYXJzZWQpID8gcGFyc2VkIDogW3BhcnNlZF07XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgLy8gT25seSBsb2cgaW4gZGV2ZWxvcG1lbnRcbiAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoYEVycm9yIHBhcnNpbmcgYXR0YWNobWVudHMgSlNPTiBmb3IgbWVzc2FnZSAke21lc3NhZ2UuaWR9OmAsIGUpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAganNvbkF0dGFjaG1lbnRzID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBtZXNzYWdlLmF0dGFjaG1lbnRzID09PSAnb2JqZWN0JyAmJiBtZXNzYWdlLmF0dGFjaG1lbnRzICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgLy8gU2luZ2xlIG9iamVjdCwgY29udmVydCB0byBhcnJheVxuICAgICAgICAgICAgICAgIGpzb25BdHRhY2htZW50cyA9IEFycmF5LmlzQXJyYXkobWVzc2FnZS5hdHRhY2htZW50cykgPyBtZXNzYWdlLmF0dGFjaG1lbnRzIDogW21lc3NhZ2UuYXR0YWNobWVudHNdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEdldCBhdHRhY2htZW50cyBmcm9tIGRhdGFiYXNlIHRhYmxlIChhbHJlYWR5IGxvYWRlZClcbiAgICAgICAgICAgIGNvbnN0IGRiQXR0YWNobWVudHMgPSBhdHRhY2htZW50c0J5TWVzc2FnZUlkLmdldChtZXNzYWdlLmlkKSB8fCBbXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTWVyZ2UgYXR0YWNobWVudHMgLSBwcmVmZXIgZGF0YWJhc2UgdGFibGUgYXR0YWNobWVudHMgKHRoZXkgYXJlIG1vcmUgcmVsaWFibGUpXG4gICAgICAgICAgICBjb25zdCBhbGxBdHRhY2htZW50czogYW55W10gPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGFkZGVkVXJscyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBGaXJzdCBhZGQgZGF0YWJhc2UgdGFibGUgYXR0YWNobWVudHMgKHRoZXNlIGFyZSB0aGUgc291cmNlIG9mIHRydXRoKVxuICAgICAgICAgICAgZGJBdHRhY2htZW50cy5mb3JFYWNoKChhdHQpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGF0dC5maWxlVXJsICYmICFhdHQuZmlsZVVybC5zdGFydHNXaXRoKCdibG9iOicpICYmICFhdHQuZmlsZVVybC5zdGFydHNXaXRoKCdkYXRhOicpKSB7XG4gICAgICAgICAgICAgICAgLy8gT25seSBhZGQgaWYgVVJMIGV4aXN0cyBhbmQgaXMgbm90IGEgdGVtcG9yYXJ5IGJsb2IvZGF0YSBVUkxcbiAgICAgICAgICAgICAgICAvLyBFbnN1cmUgdHlwZSBpcyBwcmVzZXJ2ZWQgKGltcG9ydGFudCBmb3IgYXVkaW8sIGV0Yy4pXG4gICAgICAgICAgICAgICAgYWxsQXR0YWNobWVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICBpZDogYXR0LmlkLFxuICAgICAgICAgICAgICAgICAgdHlwZTogYXR0LnR5cGUgfHwgXCJmaWxlXCIsIC8vIERlZmF1bHQgdG8gXCJmaWxlXCIgaWYgdHlwZSBpcyBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICB1cmw6IGF0dC5maWxlVXJsLFxuICAgICAgICAgICAgICAgICAgbmFtZTogYXR0LmZpbGVOYW1lLFxuICAgICAgICAgICAgICAgICAgc2l6ZTogYXR0LmZpbGVTaXplLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGFkZGVkVXJscy5hZGQoYXR0LmZpbGVVcmwpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVGhlbiBhZGQgSlNPTiBhdHRhY2htZW50cyBpZiBub3QgYWxyZWFkeSBpbiBkYXRhYmFzZSBhbmQgbm90IHRlbXBvcmFyeSBVUkxzXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShqc29uQXR0YWNobWVudHMpICYmIGpzb25BdHRhY2htZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGpzb25BdHRhY2htZW50cy5mb3JFYWNoKChhdHQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBhdHRhY2htZW50VXJsID0gYXR0LnVybCB8fCBhdHQuZmlsZVVybCB8fCBhdHQuZmlsZVBhdGg7XG4gICAgICAgICAgICAgICAgLy8gU2tpcCBpZiBVUkwgaXMgdGVtcG9yYXJ5IG9yIGFscmVhZHkgYWRkZWRcbiAgICAgICAgICAgICAgICBpZiAoYXR0YWNobWVudFVybCAmJiBcbiAgICAgICAgICAgICAgICAgICAgIWF0dGFjaG1lbnRVcmwuc3RhcnRzV2l0aCgnYmxvYjonKSAmJiBcbiAgICAgICAgICAgICAgICAgICAgIWF0dGFjaG1lbnRVcmwuc3RhcnRzV2l0aCgnZGF0YTonKSAmJlxuICAgICAgICAgICAgICAgICAgICAhYWRkZWRVcmxzLmhhcyhhdHRhY2htZW50VXJsKSkge1xuICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UgYWxyZWFkeSBoYXZlIHRoaXMgYXR0YWNobWVudCBieSBVUkwgKGV2ZW4gaWYgSUQgaXMgZGlmZmVyZW50KVxuICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdCeVVybCA9IGFsbEF0dGFjaG1lbnRzLmZpbmQoYSA9PiBhLnVybCA9PT0gYXR0YWNobWVudFVybCk7XG4gICAgICAgICAgICAgICAgICBpZiAoIWV4aXN0aW5nQnlVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgYWxsQXR0YWNobWVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgaWQ6IGF0dC5pZCB8fCBgYXR0LSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpfWAsXG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogYXR0LnR5cGUgfHwgXCJmaWxlXCIsIC8vIEVuc3VyZSB0eXBlIGlzIGFsd2F5cyBzZXRcbiAgICAgICAgICAgICAgICAgICAgICB1cmw6IGF0dGFjaG1lbnRVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgbmFtZTogYXR0Lm5hbWUgfHwgYXR0LmZpbGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgIHNpemU6IGF0dC5zaXplIHx8IGF0dC5maWxlU2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogYXR0LmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYWRkZWRVcmxzLmFkZChhdHRhY2htZW50VXJsKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBtZXNzYWdlLmF0dGFjaG1lbnRzID0gYWxsQXR0YWNobWVudHM7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGNyZWF0ZVN1Y2Nlc3NSZXNwb25zZSh7XG4gICAgICAgICAgICBjaGF0LFxuICAgICAgICAgICAgbWVzc2FnZXMsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gTm8gY2hhdCBmb3VuZFxuICAgICAgICAgIHJldHVybiBjcmVhdGVTdWNjZXNzUmVzcG9uc2Uoe1xuICAgICAgICAgICAgY2hhdDogbnVsbCxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gR2V0IGxpc3Qgb2YgY2hhdHNcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBUcnkgY2FjaGUgZmlyc3QgKGNhY2hlIGZvciAxMCBzZWNvbmRzIHNpbmNlIGNoYXQgbGlzdCBjaGFuZ2VzIGZyZXF1ZW50bHkpXG4gICAgICAgICAgY29uc3QgY2FjaGVLZXkgPSBjYWNoZUtleXMuY2hhdExpc3QoKTtcbiAgICAgICAgICBjb25zdCBjYWNoZWQgPSBjYWNoZS5nZXQ8YW55PihjYWNoZUtleSk7XG4gICAgICAgICAgaWYgKGNhY2hlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVN1Y2Nlc3NSZXNwb25zZSh7IGNoYXRzOiBjYWNoZWQgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgZ2V0Um93czxhbnk+KFxuICAgICAgICAgICAgYFNFTEVDVCAqIEZST00gcXVpY2tfYnV5X2NoYXRzIE9SREVSIEJZIFwiY3JlYXRlZEF0XCIgREVTQyBMSU1JVCA1MGBcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gT3B0aW1pemU6IEdldCB1bnJlYWQgY291bnRzIGZvciBhbGwgY2hhdHMgaW4gb25lIHF1ZXJ5IHVzaW5nIEdST1VQIEJZXG4gICAgICAgICAgY29uc3QgY2hhdElkcyA9IGNoYXRzLm1hcCgoYzogYW55KSA9PiBjLmlkKTtcbiAgICAgICAgICBsZXQgdW5yZWFkQ291bnRzTWFwID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoY2hhdElkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAvLyBVc2UgSU4gY2xhdXNlIHdpdGggR1JPVVAgQlkgdG8gZ2V0IGFsbCB1bnJlYWQgY291bnRzIGluIG9uZSBxdWVyeVxuICAgICAgICAgICAgICBjb25zdCBwbGFjZWhvbGRlcnMgPSBjaGF0SWRzLm1hcCgoXywgaSkgPT4gYCQke2kgKyAxfWApLmpvaW4oJywnKTtcbiAgICAgICAgICAgICAgY29uc3QgdW5yZWFkQ291bnRzID0gYXdhaXQgZ2V0Um93czx7IGNoYXRJZDogc3RyaW5nOyBjb3VudDogc3RyaW5nIH0+KFxuICAgICAgICAgICAgICAgIGBTRUxFQ1QgXCJjaGF0SWRcIiwgQ09VTlQoKikgYXMgY291bnQgXG4gICAgICAgICAgICAgICAgIEZST00gY2hhdF9tZXNzYWdlcyBcbiAgICAgICAgICAgICAgICAgV0hFUkUgXCJjaGF0SWRcIiBJTiAoJHtwbGFjZWhvbGRlcnN9KVxuICAgICAgICAgICAgICAgICAgIEFORCBzZW5kZXIgPSAndXNlcicgXG4gICAgICAgICAgICAgICAgICAgQU5EIChzdGF0dXMgSVMgTlVMTCBPUiAoc3RhdHVzICE9ICdyZWFkJyBBTkQgc3RhdHVzIElOICgnc2VudCcsICdkZWxpdmVyZWQnLCAnc2VuZGluZycpKSlcbiAgICAgICAgICAgICAgICAgR1JPVVAgQlkgXCJjaGF0SWRcImAsXG4gICAgICAgICAgICAgICAgY2hhdElkc1xuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gQ3JlYXRlIG1hcCBmb3IgTygxKSBsb29rdXBcbiAgICAgICAgICAgICAgdW5yZWFkQ291bnRzLmZvckVhY2goKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIHVucmVhZENvdW50c01hcC5zZXQocmVzdWx0LmNoYXRJZCwgcGFyc2VJbnQocmVzdWx0LmNvdW50IHx8IFwiMFwiLCAxMCkpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIC8vIElmIGVycm9yIGdldHRpbmcgdW5yZWFkIGNvdW50cywgbG9nIGFuZCBjb250aW51ZSB3aXRoIDAgY291bnRzXG4gICAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgZ2V0dGluZyB1bnJlYWQgY291bnRzOmAsIGVycm9yKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBNYXAgY2hhdHMgd2l0aCB1bnJlYWQgY291bnRzXG4gICAgICAgICAgY29uc3QgY2hhdHNXaXRoVW5yZWFkQ291bnQgPSBjaGF0cy5tYXAoKGNoYXQ6IGFueSkgPT4gKHtcbiAgICAgICAgICAgIC4uLmNoYXQsXG4gICAgICAgICAgICB1bnJlYWRDb3VudDogdW5yZWFkQ291bnRzTWFwLmdldChjaGF0LmlkKSB8fCAwLFxuICAgICAgICAgIH0pKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDYWNoZSB0aGUgcmVzdWx0IGZvciAxMCBzZWNvbmRzXG4gICAgICAgICAgY2FjaGUuc2V0KGNhY2hlS2V5LCBjaGF0c1dpdGhVbnJlYWRDb3VudCwgMTAwMDApO1xuXG4gICAgICAgICAgcmV0dXJuIGNyZWF0ZVN1Y2Nlc3NSZXNwb25zZSh7IGNoYXRzOiBjaGF0c1dpdGhVbnJlYWRDb3VudCB9KTtcbiAgICAgICAgfSBjYXRjaCAoZGJFcnJvcjogYW55KSB7XG4gICAgICAgICAgLy8gSWYgdGFibGUgZG9lc24ndCBleGlzdCwgcmV0dXJuIGVtcHR5IGFycmF5IGluc3RlYWQgb2YgZXJyb3JcbiAgICAgICAgICBpZiAoZGJFcnJvcj8uY29kZSA9PT0gXCI0MlAwMVwiIHx8IGRiRXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKFwiZG9lcyBub3QgZXhpc3RcIikpIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKFwiQ2hhdCB0YWJsZSBkb2VzIG5vdCBleGlzdCB5ZXQsIHJldHVybmluZyBlbXB0eSBjaGF0cyBsaXN0XCIpO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVN1Y2Nlc3NSZXNwb25zZSh7IGNoYXRzOiBbXSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhyb3cgZGJFcnJvcjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoXCJbR0VUIC9hcGkvY2hhdF0gRXJyb3I6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gY3JlYXRlRXJyb3JSZXNwb25zZShlcnJvcik7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbImdldFJvdyIsInJ1blF1ZXJ5IiwiZ2V0Um93cyIsImNyZWF0ZUVycm9yUmVzcG9uc2UiLCJjcmVhdGVTdWNjZXNzUmVzcG9uc2UiLCJBcHBFcnJvciIsImNhY2hlIiwiY2FjaGVLZXlzIiwibG9nZ2VyIiwicmF0ZUxpbWl0IiwiUE9TVCIsInJlcXVlc3QiLCJyYXRlTGltaXRSZXNwb25zZSIsImJvZHkiLCJqc29uIiwiY2F0Y2giLCJjdXN0b21lckluZm8iLCJtZXNzYWdlcyIsIm5hbWUiLCJwaG9uZSIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsImNyZWF0ZUVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsImVycm9yIiwicHJvdmlkZWRDaGF0SWQiLCJjaGF0SWQiLCJub3ciLCJEYXRlIiwidG9JU09TdHJpbmciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ0cmltIiwiZW1haWwiLCJleGlzdGluZ01lc3NhZ2VzIiwiZXhpc3RpbmdNZXNzYWdlSWRzIiwiU2V0IiwibWFwIiwibSIsImlkIiwic2F2ZWRNZXNzYWdlcyIsIm1lc3NhZ2VJZCIsIm1lc3NhZ2VDcmVhdGVkQXQiLCJ0aW1lc3RhbXAiLCJpc05ld01lc3NhZ2UiLCJoYXMiLCJ2YWxpZEF0dGFjaG1lbnRzIiwiYXR0YWNobWVudHMiLCJmaWx0ZXIiLCJhdHQiLCJ1cmwiLCJmaWxlVXJsIiwiZmlsZVBhdGgiLCJpc1ZhbGlkIiwic3RhcnRzV2l0aCIsIndhcm4iLCJhdHRhY2htZW50IiwiZGVidWciLCJ0eXBlIiwibWVzc2FnZVN0YXR1cyIsInN0YXR1cyIsInNlbmRlciIsInRleHQiLCJKU09OIiwic3RyaW5naWZ5IiwiYXR0YWNobWVudFVybCIsImF0dGFjaG1lbnRUeXBlIiwiZXhpc3RpbmdBdHRhY2htZW50IiwiYXR0YWNobWVudElkIiwic2l6ZSIsIm9yaWdpbmFsVHlwZSIsInNhdmVkTWVzc2FnZSIsInB1c2giLCJjcmVhdGVkQXQiLCJHRVQiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJnZXQiLCJsYXN0TWVzc2FnZUlkIiwic2luY2UiLCJjaGF0IiwiZGJFcnJvciIsInBhZ2UiLCJwYXJzZUludCIsImxpbWl0IiwibWluIiwibWF4Iiwib2Zmc2V0IiwibWVzc2FnZXNRdWVyeSIsInF1ZXJ5UGFyYW1zIiwibGFzdE1lc3NhZ2UiLCJyZXZlcnNlIiwibWVzc2FnZUlkcyIsImFsbERiQXR0YWNobWVudHMiLCJwbGFjZWhvbGRlcnMiLCJfIiwiaSIsImpvaW4iLCJhdHRhY2htZW50c0J5TWVzc2FnZUlkIiwiTWFwIiwiZm9yRWFjaCIsInNldCIsImpzb25BdHRhY2htZW50cyIsInBhcnNlZCIsInBhcnNlIiwiZSIsImRiQXR0YWNobWVudHMiLCJhbGxBdHRhY2htZW50cyIsImFkZGVkVXJscyIsImZpbGVOYW1lIiwiZmlsZVNpemUiLCJhZGQiLCJleGlzdGluZ0J5VXJsIiwiZmluZCIsImEiLCJkdXJhdGlvbiIsImN1c3RvbWVyUGhvbmUiLCJjdXN0b21lck5hbWUiLCJwcm9jZXNzIiwiY2FjaGVLZXkiLCJjaGF0TGlzdCIsImNhY2hlZCIsImNoYXRzIiwiY2hhdElkcyIsImMiLCJ1bnJlYWRDb3VudHNNYXAiLCJ1bnJlYWRDb3VudHMiLCJyZXN1bHQiLCJjb3VudCIsImNoYXRzV2l0aFVucmVhZENvdW50IiwidW5yZWFkQ291bnQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/chat/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/api-error-handler.ts":
/*!**********************************!*\
  !*** ./lib/api-error-handler.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AppError: () => (/* binding */ AppError),\n/* harmony export */   NetworkError: () => (/* binding */ NetworkError),\n/* harmony export */   NetworkErrorType: () => (/* binding */ NetworkErrorType),\n/* harmony export */   getUserFriendlyMessage: () => (/* binding */ getUserFriendlyMessage),\n/* harmony export */   logError: () => (/* binding */ logError),\n/* harmony export */   parseError: () => (/* binding */ parseError)\n/* harmony export */ });\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/**\r\n * Centralized Error Handler\r\n * Provides consistent error handling and logging across the application\r\n */ class AppError extends Error {\n    constructor(message, status, code, details){\n        super(message);\n        this.name = \"AppError\";\n        this.status = status;\n        this.code = code;\n        this.details = details;\n        Object.setPrototypeOf(this, AppError.prototype);\n    }\n}\n/**\r\n * Network error types\r\n */ var NetworkErrorType = /*#__PURE__*/ function(NetworkErrorType) {\n    NetworkErrorType[\"TIMEOUT\"] = \"TIMEOUT\";\n    NetworkErrorType[\"NETWORK\"] = \"NETWORK\";\n    NetworkErrorType[\"ABORTED\"] = \"ABORTED\";\n    NetworkErrorType[\"UNKNOWN\"] = \"UNKNOWN\";\n    return NetworkErrorType;\n}({});\nclass NetworkError extends Error {\n    constructor(message, type = \"UNKNOWN\", originalError){\n        super(message);\n        this.name = \"NetworkError\";\n        this.type = type;\n        this.originalError = originalError;\n        Object.setPrototypeOf(this, NetworkError.prototype);\n    }\n}\n/**\r\n * Import centralized logger\r\n */ \n/**\r\n * Parse error from various sources\r\n */ function parseError(error) {\n    if (error instanceof AppError) {\n        return {\n            message: error.message,\n            status: error.status,\n            code: error.code,\n            details: error.details\n        };\n    }\n    if (error instanceof NetworkError) {\n        return {\n            message: error.message,\n            code: error.type,\n            details: error.originalError\n        };\n    }\n    if (error instanceof Error) {\n        return {\n            message: error.message\n        };\n    }\n    if (typeof error === \"string\") {\n        return {\n            message: error\n        };\n    }\n    return {\n        message: \"Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ Ø±Ø® Ø¯Ø§Ø¯\"\n    };\n}\n/**\r\n * Get user-friendly error message\r\n */ function getUserFriendlyMessage(error) {\n    const parsed = parseError(error);\n    // Network errors\n    if (parsed.code === \"TIMEOUT\") {\n        return \"Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø´Ø¯Ù† Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø® Ù„ØºÙˆ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.\";\n    }\n    if (parsed.code === \"NETWORK\") {\n        return \"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±. Ù„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.\";\n    }\n    if (parsed.code === \"ABORTED\") {\n        return \"Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù„ØºÙˆ Ø´Ø¯.\";\n    }\n    // HTTP status codes\n    if (parsed.status) {\n        switch(parsed.status){\n            case 400:\n                return parsed.message || \"Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.\";\n            case 401:\n                return \"Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.\";\n            case 403:\n                return \"Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ù…Ù†Ø¨Ø¹ Ù†Ø¯Ø§Ø±ÛŒØ¯.\";\n            case 404:\n                return \"Ù…Ù†Ø¨Ø¹ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.\";\n            case 429:\n                return \"ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ú©Ù…ÛŒ ØµØ¨Ø± Ú©Ù†ÛŒØ¯.\";\n            case 500:\n                return \"Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±. Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯Ø§Ù‹ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.\";\n            case 502:\n            case 503:\n            case 504:\n                return \"Ø³Ø±ÙˆØ± Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯Ø§Ù‹ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.\";\n            default:\n                return parsed.message || \"Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯.\";\n        }\n    }\n    return parsed.message || \"Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ Ø±Ø® Ø¯Ø§Ø¯.\";\n}\n/**\r\n * Log error (only in development)\r\n */ function logError(error, context) {\n    const parsed = parseError(error);\n    const contextMsg = context ? `[${context}] ` : \"\";\n    _lib_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(`${contextMsg}${parsed.message}`, {\n        status: parsed.status,\n        code: parsed.code,\n        details: parsed.details\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUU7UUFDN0NDLFFBQVFlLE9BQU9mLE1BQU07UUFDckJDLE1BQU1jLE9BQU9kLElBQUk7UUFDakJDLFNBQVNhLE9BQU9iLE9BQU87SUFDekI7QUFDRiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxNb2hhbWFkSmF2YWRcXE9uZURyaXZlXFxEZXNrdG9wXFxzYWRlZCAtIENvcHkgKDQpXFxsaWJcXGFwaS1lcnJvci1oYW5kbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDZW50cmFsaXplZCBFcnJvciBIYW5kbGVyXHJcbiAqIFByb3ZpZGVzIGNvbnNpc3RlbnQgZXJyb3IgaGFuZGxpbmcgYW5kIGxvZ2dpbmcgYWNyb3NzIHRoZSBhcHBsaWNhdGlvblxyXG4gKi9cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQXBpRXJyb3Ige1xyXG4gIG1lc3NhZ2U6IHN0cmluZztcclxuICBzdGF0dXM/OiBudW1iZXI7XHJcbiAgY29kZT86IHN0cmluZztcclxuICBkZXRhaWxzPzogdW5rbm93bjtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEFwcEVycm9yIGV4dGVuZHMgRXJyb3Ige1xyXG4gIHN0YXR1cz86IG51bWJlcjtcclxuICBjb2RlPzogc3RyaW5nO1xyXG4gIGRldGFpbHM/OiB1bmtub3duO1xyXG5cclxuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcsIHN0YXR1cz86IG51bWJlciwgY29kZT86IHN0cmluZywgZGV0YWlscz86IHVua25vd24pIHtcclxuICAgIHN1cGVyKG1lc3NhZ2UpO1xyXG4gICAgdGhpcy5uYW1lID0gXCJBcHBFcnJvclwiO1xyXG4gICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XHJcbiAgICB0aGlzLmNvZGUgPSBjb2RlO1xyXG4gICAgdGhpcy5kZXRhaWxzID0gZGV0YWlscztcclxuICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBBcHBFcnJvci5wcm90b3R5cGUpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIE5ldHdvcmsgZXJyb3IgdHlwZXNcclxuICovXHJcbmV4cG9ydCBlbnVtIE5ldHdvcmtFcnJvclR5cGUge1xyXG4gIFRJTUVPVVQgPSBcIlRJTUVPVVRcIixcclxuICBORVRXT1JLID0gXCJORVRXT1JLXCIsXHJcbiAgQUJPUlRFRCA9IFwiQUJPUlRFRFwiLFxyXG4gIFVOS05PV04gPSBcIlVOS05PV05cIixcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIE5ldHdvcmtFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICB0eXBlOiBOZXR3b3JrRXJyb3JUeXBlO1xyXG4gIG9yaWdpbmFsRXJyb3I/OiBFcnJvcjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBtZXNzYWdlOiBzdHJpbmcsXHJcbiAgICB0eXBlOiBOZXR3b3JrRXJyb3JUeXBlID0gTmV0d29ya0Vycm9yVHlwZS5VTktOT1dOLFxyXG4gICAgb3JpZ2luYWxFcnJvcj86IEVycm9yXHJcbiAgKSB7XHJcbiAgICBzdXBlcihtZXNzYWdlKTtcclxuICAgIHRoaXMubmFtZSA9IFwiTmV0d29ya0Vycm9yXCI7XHJcbiAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG4gICAgdGhpcy5vcmlnaW5hbEVycm9yID0gb3JpZ2luYWxFcnJvcjtcclxuICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBOZXR3b3JrRXJyb3IucHJvdG90eXBlKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbXBvcnQgY2VudHJhbGl6ZWQgbG9nZ2VyXHJcbiAqL1xyXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XHJcblxyXG4vKipcclxuICogUGFyc2UgZXJyb3IgZnJvbSB2YXJpb3VzIHNvdXJjZXNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUVycm9yKGVycm9yOiB1bmtub3duKTogQXBpRXJyb3Ige1xyXG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIEFwcEVycm9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICBzdGF0dXM6IGVycm9yLnN0YXR1cyxcclxuICAgICAgY29kZTogZXJyb3IuY29kZSxcclxuICAgICAgZGV0YWlsczogZXJyb3IuZGV0YWlscyxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBOZXR3b3JrRXJyb3IpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIGNvZGU6IGVycm9yLnR5cGUsXHJcbiAgICAgIGRldGFpbHM6IGVycm9yLm9yaWdpbmFsRXJyb3IsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgaWYgKHR5cGVvZiBlcnJvciA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbWVzc2FnZTogZXJyb3IsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIG1lc3NhZ2U6IFwi2K7Yt9in24wg2YbYp9mF2LTYrti1INix2K4g2K/Yp9ivXCIsXHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCB1c2VyLWZyaWVuZGx5IGVycm9yIG1lc3NhZ2VcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VyRnJpZW5kbHlNZXNzYWdlKGVycm9yOiB1bmtub3duKTogc3RyaW5nIHtcclxuICBjb25zdCBwYXJzZWQgPSBwYXJzZUVycm9yKGVycm9yKTtcclxuXHJcbiAgLy8gTmV0d29yayBlcnJvcnNcclxuICBpZiAocGFyc2VkLmNvZGUgPT09IE5ldHdvcmtFcnJvclR5cGUuVElNRU9VVCkge1xyXG4gICAgcmV0dXJuIFwi2K/Ysdiu2YjYp9iz2Kog2LTZhdinINio2Ycg2K/ZhNuM2YQg2LfZiNmE2KfZhtuMINi02K/ZhiDYstmF2KfZhiDZvtin2LPYriDZhNi62Ygg2LTYry4g2YTYt9mB2KfZiyDYr9mI2KjYp9ix2Ycg2KrZhNin2LQg2qnZhtuM2K8uXCI7XHJcbiAgfVxyXG5cclxuICBpZiAocGFyc2VkLmNvZGUgPT09IE5ldHdvcmtFcnJvclR5cGUuTkVUV09SSykge1xyXG4gICAgcmV0dXJuIFwi2K7Yt9inINiv2LEg2KfYsdiq2KjYp9i3INio2Kcg2LPYsdmI2LEuINmE2LfZgdin2Ysg2KfYqti12KfZhCDYp9uM2YbYqtix2YbYqiDYrtmI2K8g2LHYpyDYqNix2LHYs9uMINqp2YbbjNivLlwiO1xyXG4gIH1cclxuXHJcbiAgaWYgKHBhcnNlZC5jb2RlID09PSBOZXR3b3JrRXJyb3JUeXBlLkFCT1JURUQpIHtcclxuICAgIHJldHVybiBcItiv2LHYrtmI2KfYs9iqINmE2LrZiCDYtNivLlwiO1xyXG4gIH1cclxuXHJcbiAgLy8gSFRUUCBzdGF0dXMgY29kZXNcclxuICBpZiAocGFyc2VkLnN0YXR1cykge1xyXG4gICAgc3dpdGNoIChwYXJzZWQuc3RhdHVzKSB7XHJcbiAgICAgIGNhc2UgNDAwOlxyXG4gICAgICAgIHJldHVybiBwYXJzZWQubWVzc2FnZSB8fCBcItiv2LHYrtmI2KfYs9iqINmG2KfZhdi52KrYqNixINin2LPYqi5cIjtcclxuICAgICAgY2FzZSA0MDE6XHJcbiAgICAgICAgcmV0dXJuIFwi2YTYt9mB2KfZiyDYr9mI2KjYp9ix2Ycg2YjYp9ix2K8g2LTZiNuM2K8uXCI7XHJcbiAgICAgIGNhc2UgNDAzOlxyXG4gICAgICAgIHJldHVybiBcIti02YXYpyDYr9iz2KrYsdiz24wg2KjZhyDYp9uM2YYg2YXZhtio2Lkg2YbYr9in2LHbjNivLlwiO1xyXG4gICAgICBjYXNlIDQwNDpcclxuICAgICAgICByZXR1cm4gXCLZhdmG2KjYuSDZhdmI2LHYryDZhti42LEg24zYp9mB2Kog2YbYtNivLlwiO1xyXG4gICAgICBjYXNlIDQyOTpcclxuICAgICAgICByZXR1cm4gXCLYqti52K/Yp9ivINiv2LHYrtmI2KfYs9iq4oCM2YfYp9uMINi02YXYpyDYqNuM2LQg2KfYsiDYrdivINmF2KzYp9iyINin2LPYqi4g2YTYt9mB2KfZiyDaqdmF24wg2LXYqNixINqp2YbbjNivLlwiO1xyXG4gICAgICBjYXNlIDUwMDpcclxuICAgICAgICByZXR1cm4gXCLYrti32KfbjCDYs9ix2YjYsS4g2YTYt9mB2KfZiyDYqNi52K/Yp9mLINiq2YTYp9i0INqp2YbbjNivLlwiO1xyXG4gICAgICBjYXNlIDUwMjpcclxuICAgICAgY2FzZSA1MDM6XHJcbiAgICAgIGNhc2UgNTA0OlxyXG4gICAgICAgIHJldHVybiBcItiz2LHZiNixINiv2LEg2K/Ys9iq2LHYsyDZhtuM2LPYqi4g2YTYt9mB2KfZiyDYqNi52K/Yp9mLINiq2YTYp9i0INqp2YbbjNivLlwiO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiBwYXJzZWQubWVzc2FnZSB8fCBcItiu2LfYp9uM24wg2LHYriDYr9in2K8uXCI7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcGFyc2VkLm1lc3NhZ2UgfHwgXCLYrti32KfbjCDZhtin2YXYtNiu2LUg2LHYriDYr9in2K8uXCI7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBMb2cgZXJyb3IgKG9ubHkgaW4gZGV2ZWxvcG1lbnQpXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbG9nRXJyb3IoZXJyb3I6IHVua25vd24sIGNvbnRleHQ/OiBzdHJpbmcpOiB2b2lkIHtcclxuICBjb25zdCBwYXJzZWQgPSBwYXJzZUVycm9yKGVycm9yKTtcclxuICBjb25zdCBjb250ZXh0TXNnID0gY29udGV4dCA/IGBbJHtjb250ZXh0fV0gYCA6IFwiXCI7XHJcbiAgXHJcbiAgbG9nZ2VyLmVycm9yKGAke2NvbnRleHRNc2d9JHtwYXJzZWQubWVzc2FnZX1gLCB7XHJcbiAgICBzdGF0dXM6IHBhcnNlZC5zdGF0dXMsXHJcbiAgICBjb2RlOiBwYXJzZWQuY29kZSxcclxuICAgIGRldGFpbHM6IHBhcnNlZC5kZXRhaWxzLFxyXG4gIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJBcHBFcnJvciIsIkVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsImNvZGUiLCJkZXRhaWxzIiwibmFtZSIsIk9iamVjdCIsInNldFByb3RvdHlwZU9mIiwicHJvdG90eXBlIiwiTmV0d29ya0Vycm9yVHlwZSIsIk5ldHdvcmtFcnJvciIsInR5cGUiLCJvcmlnaW5hbEVycm9yIiwibG9nZ2VyIiwicGFyc2VFcnJvciIsImVycm9yIiwiZ2V0VXNlckZyaWVuZGx5TWVzc2FnZSIsInBhcnNlZCIsImxvZ0Vycm9yIiwiY29udGV4dCIsImNvbnRleHRNc2ciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/api-error-handler.ts\n");

/***/ }),

/***/ "(rsc)/./lib/api-route-helpers.ts":
/*!**********************************!*\
  !*** ./lib/api-route-helpers.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createErrorResponse: () => (/* binding */ createErrorResponse),\n/* harmony export */   createSuccessResponse: () => (/* binding */ createSuccessResponse),\n/* harmony export */   validateRequestBody: () => (/* binding */ validateRequestBody),\n/* harmony export */   withErrorHandling: () => (/* binding */ withErrorHandling)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/api/server.js\");\n/* harmony import */ var _api_error_handler__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./api-error-handler */ \"(rsc)/./lib/api-error-handler.ts\");\n/**\r\n * API Route Helpers\r\n * Provides standardized error handling and response formatting for API routes\r\n */ \n\n/**\r\n * Create standardized error response\r\n */ function createErrorResponse(error, defaultStatus = 500) {\n    let message = \"Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±\";\n    let status = defaultStatus;\n    let code;\n    let details;\n    if (error instanceof Error) {\n        message = error.message;\n        if (\"status\" in error && typeof error.status === \"number\") {\n            status = error.status;\n        }\n        if (\"code\" in error && typeof error.code === \"string\") {\n            code = error.code;\n        }\n        if (\"details\" in error) {\n            details = error.details;\n        }\n    } else if (typeof error === \"string\") {\n        message = error;\n    } else if (error && typeof error === \"object\" && \"message\" in error) {\n        message = String(error.message);\n        if (\"status\" in error && typeof error.status === \"number\") {\n            status = error.status;\n        }\n    }\n    // Log error in development\n    (0,_api_error_handler__WEBPACK_IMPORTED_MODULE_1__.logError)(error, \"API Route\");\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        success: false,\n        error: message,\n        ...code ? {\n            code\n        } : {},\n        ... true && details ? {\n            details\n        } : {}\n    }, {\n        status\n    });\n}\n/**\r\n * Create standardized success response\r\n */ function createSuccessResponse(data, status = 200, pagination) {\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        success: true,\n        data,\n        ...pagination && {\n            pagination\n        }\n    }, {\n        status\n    });\n}\n/**\r\n * Wrap route handler with error handling\r\n */ function withErrorHandling(handler) {\n    return async (request, context)=>{\n        try {\n            return await handler(request, context);\n        } catch (error) {\n            return createErrorResponse(error);\n        }\n    };\n}\n/**\r\n * Validate request body\r\n */ function validateRequestBody(body, validator) {\n    if (!body) {\n        throw new Error(\"Request body is required\");\n    }\n    if (validator && !validator(body)) {\n        throw new Error(\"Invalid request body\");\n    }\n    return body;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXBpLXJvdXRlLWhlbHBlcnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7OztDQUdDLEdBRTBDO0FBQ0k7QUFTL0M7O0NBRUMsR0FDTSxTQUFTRSxvQkFDZEMsS0FBYyxFQUNkQyxnQkFBd0IsR0FBRztJQUUzQixJQUFJQyxVQUFVO0lBQ2QsSUFBSUMsU0FBU0Y7SUFDYixJQUFJRztJQUNKLElBQUlDO0lBRUosSUFBSUwsaUJBQWlCTSxPQUFPO1FBQzFCSixVQUFVRixNQUFNRSxPQUFPO1FBQ3ZCLElBQUksWUFBWUYsU0FBUyxPQUFPQSxNQUFNRyxNQUFNLEtBQUssVUFBVTtZQUN6REEsU0FBU0gsTUFBTUcsTUFBTTtRQUN2QjtRQUNBLElBQUksVUFBVUgsU0FBUyxPQUFPQSxNQUFNSSxJQUFJLEtBQUssVUFBVTtZQUNyREEsT0FBT0osTUFBTUksSUFBSTtRQUNuQjtRQUNBLElBQUksYUFBYUosT0FBTztZQUN0QkssVUFBVUwsTUFBTUssT0FBTztRQUN6QjtJQUNGLE9BQU8sSUFBSSxPQUFPTCxVQUFVLFVBQVU7UUFDcENFLFVBQVVGO0lBQ1osT0FBTyxJQUFJQSxTQUFTLE9BQU9BLFVBQVUsWUFBWSxhQUFhQSxPQUFPO1FBQ25FRSxVQUFVSyxPQUFPUCxNQUFNRSxPQUFPO1FBQzlCLElBQUksWUFBWUYsU0FBUyxPQUFPQSxNQUFNRyxNQUFNLEtBQUssVUFBVTtZQUN6REEsU0FBU0gsTUFBTUcsTUFBTTtRQUN2QjtJQUNGO0lBRUEsMkJBQTJCO0lBQzNCTCw0REFBUUEsQ0FBQ0UsT0FBTztJQUVoQixPQUFPSCxxREFBWUEsQ0FBQ1csSUFBSSxDQUN0QjtRQUNFQyxTQUFTO1FBQ1RULE9BQU9FO1FBQ1AsR0FBSUUsT0FBTztZQUFFQTtRQUFLLElBQUksQ0FBQyxDQUFDO1FBQ3hCLEdBQUlNLEtBQXNDLElBQUlMLFVBQVU7WUFBRUE7UUFBUSxJQUFJLENBQUMsQ0FBQztJQUMxRSxHQUNBO1FBQUVGO0lBQU87QUFFYjtBQUVBOztDQUVDLEdBQ00sU0FBU1Esc0JBQ2RDLElBQU8sRUFDUFQsU0FBaUIsR0FBRyxFQUNwQlUsVUFLQztJQUVELE9BQU9oQixxREFBWUEsQ0FBQ1csSUFBSSxDQUN0QjtRQUNFQyxTQUFTO1FBQ1RHO1FBQ0EsR0FBSUMsY0FBYztZQUFFQTtRQUFXLENBQUM7SUFDbEMsR0FDQTtRQUFFVjtJQUFPO0FBRWI7QUFFQTs7Q0FFQyxHQUNNLFNBQVNXLGtCQUNkQyxPQUFtRTtJQUVuRSxPQUFPLE9BQU9DLFNBQWtCQztRQUM5QixJQUFJO1lBQ0YsT0FBTyxNQUFNRixRQUFRQyxTQUFTQztRQUNoQyxFQUFFLE9BQU9qQixPQUFPO1lBQ2QsT0FBT0Qsb0JBQW9CQztRQUM3QjtJQUNGO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLFNBQVNrQixvQkFDZEMsSUFBYSxFQUNiQyxTQUF3QztJQUV4QyxJQUFJLENBQUNELE1BQU07UUFDVCxNQUFNLElBQUliLE1BQU07SUFDbEI7SUFFQSxJQUFJYyxhQUFhLENBQUNBLFVBQVVELE9BQU87UUFDakMsTUFBTSxJQUFJYixNQUFNO0lBQ2xCO0lBRUEsT0FBT2E7QUFDVCIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxNb2hhbWFkSmF2YWRcXE9uZURyaXZlXFxEZXNrdG9wXFxzYWRlZCAtIENvcHkgKDQpXFxsaWJcXGFwaS1yb3V0ZS1oZWxwZXJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBBUEkgUm91dGUgSGVscGVyc1xyXG4gKiBQcm92aWRlcyBzdGFuZGFyZGl6ZWQgZXJyb3IgaGFuZGxpbmcgYW5kIHJlc3BvbnNlIGZvcm1hdHRpbmcgZm9yIEFQSSByb3V0ZXNcclxuICovXHJcblxyXG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcclxuaW1wb3J0IHsgbG9nRXJyb3IgfSBmcm9tIFwiLi9hcGktZXJyb3ItaGFuZGxlclwiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBBcGlSb3V0ZUVycm9yIHtcclxuICBtZXNzYWdlOiBzdHJpbmc7XHJcbiAgc3RhdHVzPzogbnVtYmVyO1xyXG4gIGNvZGU/OiBzdHJpbmc7XHJcbiAgZGV0YWlscz86IHVua25vd247XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgc3RhbmRhcmRpemVkIGVycm9yIHJlc3BvbnNlXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRXJyb3JSZXNwb25zZShcclxuICBlcnJvcjogdW5rbm93bixcclxuICBkZWZhdWx0U3RhdHVzOiBudW1iZXIgPSA1MDBcclxuKTogTmV4dFJlc3BvbnNlIHtcclxuICBsZXQgbWVzc2FnZSA9IFwi2K7Yt9in24wg2LPYsdmI2LFcIjtcclxuICBsZXQgc3RhdHVzID0gZGVmYXVsdFN0YXR1cztcclxuICBsZXQgY29kZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gIGxldCBkZXRhaWxzOiB1bmtub3duO1xyXG5cclxuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XHJcbiAgICBpZiAoXCJzdGF0dXNcIiBpbiBlcnJvciAmJiB0eXBlb2YgZXJyb3Iuc3RhdHVzID09PSBcIm51bWJlclwiKSB7XHJcbiAgICAgIHN0YXR1cyA9IGVycm9yLnN0YXR1cztcclxuICAgIH1cclxuICAgIGlmIChcImNvZGVcIiBpbiBlcnJvciAmJiB0eXBlb2YgZXJyb3IuY29kZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICBjb2RlID0gZXJyb3IuY29kZTtcclxuICAgIH1cclxuICAgIGlmIChcImRldGFpbHNcIiBpbiBlcnJvcikge1xyXG4gICAgICBkZXRhaWxzID0gZXJyb3IuZGV0YWlscztcclxuICAgIH1cclxuICB9IGVsc2UgaWYgKHR5cGVvZiBlcnJvciA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgbWVzc2FnZSA9IGVycm9yO1xyXG4gIH0gZWxzZSBpZiAoZXJyb3IgJiYgdHlwZW9mIGVycm9yID09PSBcIm9iamVjdFwiICYmIFwibWVzc2FnZVwiIGluIGVycm9yKSB7XHJcbiAgICBtZXNzYWdlID0gU3RyaW5nKGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgaWYgKFwic3RhdHVzXCIgaW4gZXJyb3IgJiYgdHlwZW9mIGVycm9yLnN0YXR1cyA9PT0gXCJudW1iZXJcIikge1xyXG4gICAgICBzdGF0dXMgPSBlcnJvci5zdGF0dXM7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBMb2cgZXJyb3IgaW4gZGV2ZWxvcG1lbnRcclxuICBsb2dFcnJvcihlcnJvciwgXCJBUEkgUm91dGVcIik7XHJcblxyXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBtZXNzYWdlLFxyXG4gICAgICAuLi4oY29kZSA/IHsgY29kZSB9IDoge30pLFxyXG4gICAgICAuLi4ocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwiZGV2ZWxvcG1lbnRcIiAmJiBkZXRhaWxzID8geyBkZXRhaWxzIH0gOiB7fSksXHJcbiAgICB9LFxyXG4gICAgeyBzdGF0dXMgfVxyXG4gICk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgc3RhbmRhcmRpemVkIHN1Y2Nlc3MgcmVzcG9uc2VcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTdWNjZXNzUmVzcG9uc2U8VD4oXHJcbiAgZGF0YTogVCxcclxuICBzdGF0dXM6IG51bWJlciA9IDIwMCxcclxuICBwYWdpbmF0aW9uPzoge1xyXG4gICAgcGFnZTogbnVtYmVyO1xyXG4gICAgbGltaXQ6IG51bWJlcjtcclxuICAgIHRvdGFsOiBudW1iZXI7XHJcbiAgICB0b3RhbFBhZ2VzOiBudW1iZXI7XHJcbiAgfVxyXG4pOiBOZXh0UmVzcG9uc2Uge1xyXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgIHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YSxcclxuICAgICAgLi4uKHBhZ2luYXRpb24gJiYgeyBwYWdpbmF0aW9uIH0pLFxyXG4gICAgfSxcclxuICAgIHsgc3RhdHVzIH1cclxuICApO1xyXG59XHJcblxyXG4vKipcclxuICogV3JhcCByb3V0ZSBoYW5kbGVyIHdpdGggZXJyb3IgaGFuZGxpbmdcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB3aXRoRXJyb3JIYW5kbGluZyhcclxuICBoYW5kbGVyOiAocmVxdWVzdDogUmVxdWVzdCwgY29udGV4dD86IGFueSkgPT4gUHJvbWlzZTxOZXh0UmVzcG9uc2U+XHJcbikge1xyXG4gIHJldHVybiBhc3luYyAocmVxdWVzdDogUmVxdWVzdCwgY29udGV4dD86IGFueSk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBjcmVhdGVFcnJvclJlc3BvbnNlKGVycm9yKTtcclxuICAgIH1cclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogVmFsaWRhdGUgcmVxdWVzdCBib2R5XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVSZXF1ZXN0Qm9keTxUPihcclxuICBib2R5OiB1bmtub3duLFxyXG4gIHZhbGlkYXRvcj86IChkYXRhOiB1bmtub3duKSA9PiBkYXRhIGlzIFRcclxuKTogVCB7XHJcbiAgaWYgKCFib2R5KSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJSZXF1ZXN0IGJvZHkgaXMgcmVxdWlyZWRcIik7XHJcbiAgfVxyXG5cclxuICBpZiAodmFsaWRhdG9yICYmICF2YWxpZGF0b3IoYm9keSkpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcmVxdWVzdCBib2R5XCIpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGJvZHkgYXMgVDtcclxufVxyXG5cclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImxvZ0Vycm9yIiwiY3JlYXRlRXJyb3JSZXNwb25zZSIsImVycm9yIiwiZGVmYXVsdFN0YXR1cyIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJjb2RlIiwiZGV0YWlscyIsIkVycm9yIiwiU3RyaW5nIiwianNvbiIsInN1Y2Nlc3MiLCJwcm9jZXNzIiwiY3JlYXRlU3VjY2Vzc1Jlc3BvbnNlIiwiZGF0YSIsInBhZ2luYXRpb24iLCJ3aXRoRXJyb3JIYW5kbGluZyIsImhhbmRsZXIiLCJyZXF1ZXN0IiwiY29udGV4dCIsInZhbGlkYXRlUmVxdWVzdEJvZHkiLCJib2R5IiwidmFsaWRhdG9yIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/api-route-helpers.ts\n");

/***/ }),

/***/ "(rsc)/./lib/cache.ts":
/*!**********************!*\
  !*** ./lib/cache.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cache: () => (/* binding */ cache),\n/* harmony export */   cacheKeys: () => (/* binding */ cacheKeys),\n/* harmony export */   withCache: () => (/* binding */ withCache)\n/* harmony export */ });\n/**\r\n * Simple in-memory cache for API responses\r\n * Used to reduce database queries and improve performance\r\n */ class SimpleCache {\n    /**\r\n   * Get value from cache\r\n   */ get(key) {\n        const entry = this.cache.get(key);\n        if (!entry) {\n            return null;\n        }\n        // Check if entry has expired\n        const now = Date.now();\n        if (now - entry.timestamp > entry.ttl) {\n            this.cache.delete(key);\n            return null;\n        }\n        return entry.data;\n    }\n    /**\r\n   * Set value in cache\r\n   */ set(key, data, ttl = 60000) {\n        // Remove oldest entries if cache is full\n        if (this.cache.size >= this.maxSize) {\n            const firstKey = this.cache.keys().next().value;\n            this.cache.delete(firstKey);\n        }\n        this.cache.set(key, {\n            data,\n            timestamp: Date.now(),\n            ttl\n        });\n    }\n    /**\r\n   * Delete value from cache\r\n   */ delete(key) {\n        this.cache.delete(key);\n    }\n    /**\r\n   * Clear all cache entries\r\n   */ clear() {\n        this.cache.clear();\n    }\n    /**\r\n   * Clear expired entries\r\n   */ clearExpired() {\n        const now = Date.now();\n        for (const [key, entry] of this.cache.entries()){\n            if (now - entry.timestamp > entry.ttl) {\n                this.cache.delete(key);\n            }\n        }\n    }\n    /**\r\n   * Get cache size\r\n   */ size() {\n        return this.cache.size;\n    }\n    constructor(){\n        this.cache = new Map();\n        this.maxSize = 1000; // Maximum number of entries\n    }\n}\n// Create singleton instance\nconst cache = new SimpleCache();\n// Clean up expired entries every 5 minutes\nif (typeof setInterval !== 'undefined') {\n    setInterval(()=>{\n        cache.clearExpired();\n    }, 5 * 60 * 1000);\n}\n/**\r\n * Cache key generators\r\n */ const cacheKeys = {\n    chat: (chatId)=>`chat:${chatId}`,\n    chatMessages: (chatId, page, limit)=>`chat:messages:${chatId}:${page || 1}:${limit || 50}`,\n    chatList: (page, limit)=>`chat:list:${page || 1}:${limit || 50}`,\n    products: (page, limit, filters)=>`products:${page || 1}:${limit || 50}:${filters || ''}`,\n    product: (productId)=>`product:${productId}`,\n    categories: ()=>`categories:all`,\n    category: (categoryId)=>`category:${categoryId}`,\n    orders: (filters)=>`orders:${filters || ''}`,\n    order: (orderId)=>`order:${orderId}`\n};\n/**\r\n * Helper to wrap async function with cache\r\n */ async function withCache(key, fn, ttl = 60000 // Default 1 minute\n) {\n    // Try to get from cache first\n    const cached = cache.get(key);\n    if (cached !== null) {\n        return cached;\n    }\n    // Execute function and cache result\n    const result = await fn();\n    cache.set(key, result, ttl);\n    return result;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFNBQVMsRUFBRUEsWUFBWTtJQUMxREMsUUFBUSxDQUFDTixVQUFxQixDQUFDLE9BQU8sRUFBRUEsV0FBVyxJQUFJO0lBQ3ZETyxPQUFPLENBQUNDLFVBQW9CLENBQUMsTUFBTSxFQUFFQSxTQUFTO0FBQ2hELEVBQUU7QUFFRjs7Q0FFQyxHQUNNLGVBQWVDLFVBQ3BCdEMsR0FBVyxFQUNYdUMsRUFBb0IsRUFDcEJqQyxNQUFjLE1BQU0sbUJBQW1CO0FBQXBCO0lBRW5CLDhCQUE4QjtJQUM5QixNQUFNa0MsU0FBU3RDLE1BQU1ILEdBQUcsQ0FBSUM7SUFDNUIsSUFBSXdDLFdBQVcsTUFBTTtRQUNuQixPQUFPQTtJQUNUO0lBRUEsb0NBQW9DO0lBQ3BDLE1BQU1DLFNBQVMsTUFBTUY7SUFDckJyQyxNQUFNTyxHQUFHLENBQUNULEtBQUt5QyxRQUFRbkM7SUFDdkIsT0FBT21DO0FBQ1QiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcTW9oYW1hZEphdmFkXFxPbmVEcml2ZVxcRGVza3RvcFxcc2FkZWQgLSBDb3B5ICg0KVxcbGliXFxjYWNoZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogU2ltcGxlIGluLW1lbW9yeSBjYWNoZSBmb3IgQVBJIHJlc3BvbnNlc1xyXG4gKiBVc2VkIHRvIHJlZHVjZSBkYXRhYmFzZSBxdWVyaWVzIGFuZCBpbXByb3ZlIHBlcmZvcm1hbmNlXHJcbiAqL1xyXG5cclxuaW50ZXJmYWNlIENhY2hlRW50cnk8VD4ge1xyXG4gIGRhdGE6IFQ7XHJcbiAgdGltZXN0YW1wOiBudW1iZXI7XHJcbiAgdHRsOiBudW1iZXI7IC8vIFRpbWUgdG8gbGl2ZSBpbiBtaWxsaXNlY29uZHNcclxufVxyXG5cclxuY2xhc3MgU2ltcGxlQ2FjaGUge1xyXG4gIHByaXZhdGUgY2FjaGUgPSBuZXcgTWFwPHN0cmluZywgQ2FjaGVFbnRyeTxhbnk+PigpO1xyXG4gIHByaXZhdGUgbWF4U2l6ZSA9IDEwMDA7IC8vIE1heGltdW0gbnVtYmVyIG9mIGVudHJpZXNcclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHZhbHVlIGZyb20gY2FjaGVcclxuICAgKi9cclxuICBnZXQ8VD4oa2V5OiBzdHJpbmcpOiBUIHwgbnVsbCB7XHJcbiAgICBjb25zdCBlbnRyeSA9IHRoaXMuY2FjaGUuZ2V0KGtleSk7XHJcbiAgICBcclxuICAgIGlmICghZW50cnkpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgZW50cnkgaGFzIGV4cGlyZWRcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICBpZiAobm93IC0gZW50cnkudGltZXN0YW1wID4gZW50cnkudHRsKSB7XHJcbiAgICAgIHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBlbnRyeS5kYXRhIGFzIFQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdmFsdWUgaW4gY2FjaGVcclxuICAgKi9cclxuICBzZXQ8VD4oa2V5OiBzdHJpbmcsIGRhdGE6IFQsIHR0bDogbnVtYmVyID0gNjAwMDApOiB2b2lkIHtcclxuICAgIC8vIFJlbW92ZSBvbGRlc3QgZW50cmllcyBpZiBjYWNoZSBpcyBmdWxsXHJcbiAgICBpZiAodGhpcy5jYWNoZS5zaXplID49IHRoaXMubWF4U2l6ZSkge1xyXG4gICAgICBjb25zdCBmaXJzdEtleSA9IHRoaXMuY2FjaGUua2V5cygpLm5leHQoKS52YWx1ZTtcclxuICAgICAgdGhpcy5jYWNoZS5kZWxldGUoZmlyc3RLZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2FjaGUuc2V0KGtleSwge1xyXG4gICAgICBkYXRhLFxyXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXHJcbiAgICAgIHR0bCxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVsZXRlIHZhbHVlIGZyb20gY2FjaGVcclxuICAgKi9cclxuICBkZWxldGUoa2V5OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbGVhciBhbGwgY2FjaGUgZW50cmllc1xyXG4gICAqL1xyXG4gIGNsZWFyKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jYWNoZS5jbGVhcigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2xlYXIgZXhwaXJlZCBlbnRyaWVzXHJcbiAgICovXHJcbiAgY2xlYXJFeHBpcmVkKCk6IHZvaWQge1xyXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcclxuICAgIGZvciAoY29uc3QgW2tleSwgZW50cnldIG9mIHRoaXMuY2FjaGUuZW50cmllcygpKSB7XHJcbiAgICAgIGlmIChub3cgLSBlbnRyeS50aW1lc3RhbXAgPiBlbnRyeS50dGwpIHtcclxuICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgY2FjaGUgc2l6ZVxyXG4gICAqL1xyXG4gIHNpemUoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmNhY2hlLnNpemU7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBDcmVhdGUgc2luZ2xldG9uIGluc3RhbmNlXHJcbmV4cG9ydCBjb25zdCBjYWNoZSA9IG5ldyBTaW1wbGVDYWNoZSgpO1xyXG5cclxuLy8gQ2xlYW4gdXAgZXhwaXJlZCBlbnRyaWVzIGV2ZXJ5IDUgbWludXRlc1xyXG5pZiAodHlwZW9mIHNldEludGVydmFsICE9PSAndW5kZWZpbmVkJykge1xyXG4gIHNldEludGVydmFsKCgpID0+IHtcclxuICAgIGNhY2hlLmNsZWFyRXhwaXJlZCgpO1xyXG4gIH0sIDUgKiA2MCAqIDEwMDApO1xyXG59XHJcblxyXG4vKipcclxuICogQ2FjaGUga2V5IGdlbmVyYXRvcnNcclxuICovXHJcbmV4cG9ydCBjb25zdCBjYWNoZUtleXMgPSB7XHJcbiAgY2hhdDogKGNoYXRJZDogc3RyaW5nKSA9PiBgY2hhdDoke2NoYXRJZH1gLFxyXG4gIGNoYXRNZXNzYWdlczogKGNoYXRJZDogc3RyaW5nLCBwYWdlPzogbnVtYmVyLCBsaW1pdD86IG51bWJlcikgPT4gXHJcbiAgICBgY2hhdDptZXNzYWdlczoke2NoYXRJZH06JHtwYWdlIHx8IDF9OiR7bGltaXQgfHwgNTB9YCxcclxuICBjaGF0TGlzdDogKHBhZ2U/OiBudW1iZXIsIGxpbWl0PzogbnVtYmVyKSA9PiBcclxuICAgIGBjaGF0Omxpc3Q6JHtwYWdlIHx8IDF9OiR7bGltaXQgfHwgNTB9YCxcclxuICBwcm9kdWN0czogKHBhZ2U/OiBudW1iZXIsIGxpbWl0PzogbnVtYmVyLCBmaWx0ZXJzPzogc3RyaW5nKSA9PiBcclxuICAgIGBwcm9kdWN0czoke3BhZ2UgfHwgMX06JHtsaW1pdCB8fCA1MH06JHtmaWx0ZXJzIHx8ICcnfWAsXHJcbiAgcHJvZHVjdDogKHByb2R1Y3RJZDogc3RyaW5nKSA9PiBgcHJvZHVjdDoke3Byb2R1Y3RJZH1gLFxyXG4gIGNhdGVnb3JpZXM6ICgpID0+IGBjYXRlZ29yaWVzOmFsbGAsXHJcbiAgY2F0ZWdvcnk6IChjYXRlZ29yeUlkOiBzdHJpbmcpID0+IGBjYXRlZ29yeToke2NhdGVnb3J5SWR9YCxcclxuICBvcmRlcnM6IChmaWx0ZXJzPzogc3RyaW5nKSA9PiBgb3JkZXJzOiR7ZmlsdGVycyB8fCAnJ31gLFxyXG4gIG9yZGVyOiAob3JkZXJJZDogc3RyaW5nKSA9PiBgb3JkZXI6JHtvcmRlcklkfWAsXHJcbn07XHJcblxyXG4vKipcclxuICogSGVscGVyIHRvIHdyYXAgYXN5bmMgZnVuY3Rpb24gd2l0aCBjYWNoZVxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHdpdGhDYWNoZTxUPihcclxuICBrZXk6IHN0cmluZyxcclxuICBmbjogKCkgPT4gUHJvbWlzZTxUPixcclxuICB0dGw6IG51bWJlciA9IDYwMDAwIC8vIERlZmF1bHQgMSBtaW51dGVcclxuKTogUHJvbWlzZTxUPiB7XHJcbiAgLy8gVHJ5IHRvIGdldCBmcm9tIGNhY2hlIGZpcnN0XHJcbiAgY29uc3QgY2FjaGVkID0gY2FjaGUuZ2V0PFQ+KGtleSk7XHJcbiAgaWYgKGNhY2hlZCAhPT0gbnVsbCkge1xyXG4gICAgcmV0dXJuIGNhY2hlZDtcclxuICB9XHJcblxyXG4gIC8vIEV4ZWN1dGUgZnVuY3Rpb24gYW5kIGNhY2hlIHJlc3VsdFxyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZuKCk7XHJcbiAgY2FjaGUuc2V0KGtleSwgcmVzdWx0LCB0dGwpO1xyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJTaW1wbGVDYWNoZSIsImdldCIsImtleSIsImVudHJ5IiwiY2FjaGUiLCJub3ciLCJEYXRlIiwidGltZXN0YW1wIiwidHRsIiwiZGVsZXRlIiwiZGF0YSIsInNldCIsInNpemUiLCJtYXhTaXplIiwiZmlyc3RLZXkiLCJrZXlzIiwibmV4dCIsInZhbHVlIiwiY2xlYXIiLCJjbGVhckV4cGlyZWQiLCJlbnRyaWVzIiwiTWFwIiwic2V0SW50ZXJ2YWwiLCJjYWNoZUtleXMiLCJjaGF0IiwiY2hhdElkIiwiY2hhdE1lc3NhZ2VzIiwicGFnZSIsImxpbWl0IiwiY2hhdExpc3QiLCJwcm9kdWN0cyIsImZpbHRlcnMiLCJwcm9kdWN0IiwicHJvZHVjdElkIiwiY2F0ZWdvcmllcyIsImNhdGVnb3J5IiwiY2F0ZWdvcnlJZCIsIm9yZGVycyIsIm9yZGVyIiwib3JkZXJJZCIsIndpdGhDYWNoZSIsImZuIiwiY2FjaGVkIiwicmVzdWx0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/cache.ts\n");

/***/ }),

/***/ "(rsc)/./lib/db/index.ts":
/*!*************************!*\
  !*** ./lib/db/index.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getDatabaseType: () => (/* binding */ getDatabaseType),\n/* harmony export */   getRow: () => (/* binding */ getRow),\n/* harmony export */   getRows: () => (/* binding */ getRows),\n/* harmony export */   initializeDatabase: () => (/* binding */ initializeDatabase),\n/* harmony export */   runQuery: () => (/* binding */ runQuery),\n/* harmony export */   testConnection: () => (/* binding */ testConnection)\n/* harmony export */ });\n/**\r\n * Database Wrapper\r\n * \r\n * Ø§ÛŒÙ† ÙØ§ÛŒÙ„ ÛŒÚ© interface ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² PostgreSQL ÙØ±Ø§Ù‡Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯\r\n */ /**\r\n * Get single row from database\r\n */ async function getRow(sql, params = []) {\n    try {\n        const { queryOne } = await __webpack_require__.e(/*! import() */ \"_rsc_lib_db_postgres_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ./postgres */ \"(rsc)/./lib/db/postgres.ts\"));\n        // Convert ? placeholders to PostgreSQL $1, $2, etc.\n        const pgSql = convertToPostgresSQL(sql);\n        return await queryOne(pgSql, params);\n    } catch (error) {\n        console.error(\"Database error in getRow:\", {\n            sql,\n            params,\n            error: error?.message,\n            code: error?.code\n        });\n        throw error;\n    }\n}\n/**\r\n * Get multiple rows from database\r\n */ async function getRows(sql, params = []) {\n    try {\n        const { queryAll } = await __webpack_require__.e(/*! import() */ \"_rsc_lib_db_postgres_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ./postgres */ \"(rsc)/./lib/db/postgres.ts\"));\n        // Convert ? placeholders to PostgreSQL $1, $2, etc.\n        const pgSql = convertToPostgresSQL(sql);\n        return await queryAll(pgSql, params);\n    } catch (error) {\n        console.error(\"Database error in getRows:\", {\n            sql,\n            params,\n            error: error?.message,\n            code: error?.code\n        });\n        throw error;\n    }\n}\n/**\r\n * Run a query (INSERT, UPDATE, DELETE)\r\n */ async function runQuery(sql, params = []) {\n    const { query } = await __webpack_require__.e(/*! import() */ \"_rsc_lib_db_postgres_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ./postgres */ \"(rsc)/./lib/db/postgres.ts\"));\n    const pgSql = convertToPostgresSQL(sql);\n    const result = await query(pgSql, params);\n    return {\n        changes: result.rowCount || 0,\n        lastInsertRowid: undefined\n    };\n}\n/**\r\n * Convert SQL to PostgreSQL SQL\r\n * - Converts ? placeholders to $1, $2, etc.\r\n * - Handles basic syntax differences\r\n */ function convertToPostgresSQL(sql) {\n    let pgSql = sql;\n    let paramIndex = 1;\n    // First, replace ? with $1, $2, etc.\n    pgSql = pgSql.replace(/\\?/g, ()=>`$${paramIndex++}`);\n    // Convert column names that need quoting (PostgreSQL is case-sensitive)\n    // Only replace if not already quoted\n    const columnsToQuote = [\n        'createdAt',\n        'updatedAt',\n        'originalPrice',\n        'vinEnabled',\n        'airShippingEnabled',\n        'seaShippingEnabled',\n        'stockCount',\n        'inStock',\n        'orderNumber',\n        'userId',\n        'customerName',\n        'customerPhone',\n        'customerEmail',\n        'shippingCost',\n        'shippingMethod',\n        'shippingAddress',\n        'paymentStatus',\n        'isActive'\n    ];\n    columnsToQuote.forEach((col)=>{\n        // Replace column name only if not already quoted and not part of a quoted string\n        const regex = new RegExp(`\\\\b${col}\\\\b(?![^\"]*\"(?:[^\"]*\"[^\"]*\")*[^\"]*$)`, 'gi');\n        pgSql = pgSql.replace(regex, `\"${col}\"`);\n    });\n    return pgSql;\n}\n/**\r\n * Initialize database\r\n */ async function initializeDatabase() {\n    const { ensureDatabase, initializeTables } = await __webpack_require__.e(/*! import() */ \"_rsc_lib_db_postgres_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ./postgres */ \"(rsc)/./lib/db/postgres.ts\"));\n    await ensureDatabase();\n    await initializeTables();\n}\n/**\r\n * Test database connection\r\n */ async function testConnection() {\n    try {\n        const { testConnection } = await __webpack_require__.e(/*! import() */ \"_rsc_lib_db_postgres_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ./postgres */ \"(rsc)/./lib/db/postgres.ts\"));\n        return await testConnection();\n    } catch (error) {\n        return false;\n    }\n}\n/**\r\n * Get database type\r\n */ function getDatabaseType() {\n    return \"postgres\";\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZGIvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7Q0FJQyxHQUVEOztDQUVDLEdBQ00sZUFBZUEsT0FDcEJDLEdBQVcsRUFDWEMsU0FBZ0IsRUFBRTtJQUVsQixJQUFJO1FBQ0YsTUFBTSxFQUFFQyxRQUFRLEVBQUUsR0FBRyxNQUFNLG9LQUFvQjtRQUMvQyxvREFBb0Q7UUFDcEQsTUFBTUMsUUFBUUMscUJBQXFCSjtRQUNuQyxPQUFPLE1BQU1FLFNBQVlDLE9BQU9GO0lBQ2xDLEVBQUUsT0FBT0ksT0FBWTtRQUNuQkMsUUFBUUQsS0FBSyxDQUFDLDZCQUE2QjtZQUN6Q0w7WUFDQUM7WUFDQUksT0FBT0EsT0FBT0U7WUFDZEMsTUFBTUgsT0FBT0c7UUFDZjtRQUNBLE1BQU1IO0lBQ1I7QUFDRjtBQUVBOztDQUVDLEdBQ00sZUFBZUksUUFDcEJULEdBQVcsRUFDWEMsU0FBZ0IsRUFBRTtJQUVsQixJQUFJO1FBQ0YsTUFBTSxFQUFFUyxRQUFRLEVBQUUsR0FBRyxNQUFNLG9LQUFvQjtRQUMvQyxvREFBb0Q7UUFDcEQsTUFBTVAsUUFBUUMscUJBQXFCSjtRQUNuQyxPQUFPLE1BQU1VLFNBQVlQLE9BQU9GO0lBQ2xDLEVBQUUsT0FBT0ksT0FBWTtRQUNuQkMsUUFBUUQsS0FBSyxDQUFDLDhCQUE4QjtZQUMxQ0w7WUFDQUM7WUFDQUksT0FBT0EsT0FBT0U7WUFDZEMsTUFBTUgsT0FBT0c7UUFDZjtRQUNBLE1BQU1IO0lBQ1I7QUFDRjtBQUVBOztDQUVDLEdBQ00sZUFBZU0sU0FDcEJYLEdBQVcsRUFDWEMsU0FBZ0IsRUFBRTtJQUVsQixNQUFNLEVBQUVXLEtBQUssRUFBRSxHQUFHLE1BQU0sb0tBQW9CO0lBQzVDLE1BQU1ULFFBQVFDLHFCQUFxQko7SUFDbkMsTUFBTWEsU0FBUyxNQUFNRCxNQUFNVCxPQUFPRjtJQUNsQyxPQUFPO1FBQ0xhLFNBQVNELE9BQU9FLFFBQVEsSUFBSTtRQUM1QkMsaUJBQWlCQztJQUNuQjtBQUNGO0FBRUE7Ozs7Q0FJQyxHQUNELFNBQVNiLHFCQUFxQkosR0FBVztJQUN2QyxJQUFJRyxRQUFRSDtJQUNaLElBQUlrQixhQUFhO0lBRWpCLHFDQUFxQztJQUNyQ2YsUUFBUUEsTUFBTWdCLE9BQU8sQ0FBQyxPQUFPLElBQU0sQ0FBQyxDQUFDLEVBQUVELGNBQWM7SUFFckQsd0VBQXdFO0lBQ3hFLHFDQUFxQztJQUNyQyxNQUFNRSxpQkFBaUI7UUFDckI7UUFBYTtRQUFhO1FBQWlCO1FBQzNDO1FBQXNCO1FBQXNCO1FBQzVDO1FBQVc7UUFBZTtRQUFVO1FBQ3BDO1FBQWlCO1FBQWlCO1FBQ2xDO1FBQWtCO1FBQW1CO1FBQWlCO0tBQ3ZEO0lBRURBLGVBQWVDLE9BQU8sQ0FBQ0MsQ0FBQUE7UUFDckIsaUZBQWlGO1FBQ2pGLE1BQU1DLFFBQVEsSUFBSUMsT0FBTyxDQUFDLEdBQUcsRUFBRUYsSUFBSSxvQ0FBb0MsQ0FBQyxFQUFFO1FBQzFFbkIsUUFBUUEsTUFBTWdCLE9BQU8sQ0FBQ0ksT0FBTyxDQUFDLENBQUMsRUFBRUQsSUFBSSxDQUFDLENBQUM7SUFDekM7SUFFQSxPQUFPbkI7QUFDVDtBQUVBOztDQUVDLEdBQ00sZUFBZXNCO0lBQ3BCLE1BQU0sRUFBRUMsY0FBYyxFQUFFQyxnQkFBZ0IsRUFBRSxHQUFHLE1BQU0sb0tBQW9CO0lBQ3ZFLE1BQU1EO0lBQ04sTUFBTUM7QUFDUjtBQUVBOztDQUVDLEdBQ00sZUFBZUM7SUFDcEIsSUFBSTtRQUNGLE1BQU0sRUFBRUEsY0FBYyxFQUFFLEdBQUcsTUFBTSxvS0FBb0I7UUFDckQsT0FBTyxNQUFNQTtJQUNmLEVBQUUsT0FBT3ZCLE9BQU87UUFDZCxPQUFPO0lBQ1Q7QUFDRjtBQUVBOztDQUVDLEdBQ00sU0FBU3dCO0lBQ2QsT0FBTztBQUNUIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXE1vaGFtYWRKYXZhZFxcT25lRHJpdmVcXERlc2t0b3BcXHNhZGVkIC0gQ29weSAoNClcXGxpYlxcZGJcXGluZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBEYXRhYmFzZSBXcmFwcGVyXHJcbiAqIFxyXG4gKiDYp9uM2YYg2YHYp9uM2YQg24zaqSBpbnRlcmZhY2Ug24zaqdm+2KfYsdqG2Ycg2KjYsdin24wg2KfYs9iq2YHYp9iv2Ycg2KfYsiBQb3N0Z3JlU1FMINmB2LHYp9mH2YUg2YXbjOKAjNqp2YbYr1xyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBHZXQgc2luZ2xlIHJvdyBmcm9tIGRhdGFiYXNlXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Um93PFQgPSBhbnk+KFxyXG4gIHNxbDogc3RyaW5nLFxyXG4gIHBhcmFtczogYW55W10gPSBbXVxyXG4pOiBQcm9taXNlPFQgfCBudWxsPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgcXVlcnlPbmUgfSA9IGF3YWl0IGltcG9ydChcIi4vcG9zdGdyZXNcIik7XHJcbiAgICAvLyBDb252ZXJ0ID8gcGxhY2Vob2xkZXJzIHRvIFBvc3RncmVTUUwgJDEsICQyLCBldGMuXHJcbiAgICBjb25zdCBwZ1NxbCA9IGNvbnZlcnRUb1Bvc3RncmVzU1FMKHNxbCk7XHJcbiAgICByZXR1cm4gYXdhaXQgcXVlcnlPbmU8VD4ocGdTcWwsIHBhcmFtcyk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkRhdGFiYXNlIGVycm9yIGluIGdldFJvdzpcIiwge1xyXG4gICAgICBzcWwsXHJcbiAgICAgIHBhcmFtcyxcclxuICAgICAgZXJyb3I6IGVycm9yPy5tZXNzYWdlLFxyXG4gICAgICBjb2RlOiBlcnJvcj8uY29kZSxcclxuICAgIH0pO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogR2V0IG11bHRpcGxlIHJvd3MgZnJvbSBkYXRhYmFzZVxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFJvd3M8VCA9IGFueT4oXHJcbiAgc3FsOiBzdHJpbmcsXHJcbiAgcGFyYW1zOiBhbnlbXSA9IFtdXHJcbik6IFByb21pc2U8VFtdPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgcXVlcnlBbGwgfSA9IGF3YWl0IGltcG9ydChcIi4vcG9zdGdyZXNcIik7XHJcbiAgICAvLyBDb252ZXJ0ID8gcGxhY2Vob2xkZXJzIHRvIFBvc3RncmVTUUwgJDEsICQyLCBldGMuXHJcbiAgICBjb25zdCBwZ1NxbCA9IGNvbnZlcnRUb1Bvc3RncmVzU1FMKHNxbCk7XHJcbiAgICByZXR1cm4gYXdhaXQgcXVlcnlBbGw8VD4ocGdTcWwsIHBhcmFtcyk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkRhdGFiYXNlIGVycm9yIGluIGdldFJvd3M6XCIsIHtcclxuICAgICAgc3FsLFxyXG4gICAgICBwYXJhbXMsXHJcbiAgICAgIGVycm9yOiBlcnJvcj8ubWVzc2FnZSxcclxuICAgICAgY29kZTogZXJyb3I/LmNvZGUsXHJcbiAgICB9KTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFJ1biBhIHF1ZXJ5IChJTlNFUlQsIFVQREFURSwgREVMRVRFKVxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJ1blF1ZXJ5KFxyXG4gIHNxbDogc3RyaW5nLFxyXG4gIHBhcmFtczogYW55W10gPSBbXVxyXG4pOiBQcm9taXNlPHsgY2hhbmdlczogbnVtYmVyOyBsYXN0SW5zZXJ0Um93aWQ/OiBudW1iZXIgfT4ge1xyXG4gIGNvbnN0IHsgcXVlcnkgfSA9IGF3YWl0IGltcG9ydChcIi4vcG9zdGdyZXNcIik7XHJcbiAgY29uc3QgcGdTcWwgPSBjb252ZXJ0VG9Qb3N0Z3Jlc1NRTChzcWwpO1xyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHF1ZXJ5KHBnU3FsLCBwYXJhbXMpO1xyXG4gIHJldHVybiB7XHJcbiAgICBjaGFuZ2VzOiByZXN1bHQucm93Q291bnQgfHwgMCxcclxuICAgIGxhc3RJbnNlcnRSb3dpZDogdW5kZWZpbmVkLCAvLyBQb3N0Z3JlU1FMIGRvZXNuJ3QgaGF2ZSBsYXN0SW5zZXJ0Um93aWRcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogQ29udmVydCBTUUwgdG8gUG9zdGdyZVNRTCBTUUxcclxuICogLSBDb252ZXJ0cyA/IHBsYWNlaG9sZGVycyB0byAkMSwgJDIsIGV0Yy5cclxuICogLSBIYW5kbGVzIGJhc2ljIHN5bnRheCBkaWZmZXJlbmNlc1xyXG4gKi9cclxuZnVuY3Rpb24gY29udmVydFRvUG9zdGdyZXNTUUwoc3FsOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGxldCBwZ1NxbCA9IHNxbDtcclxuICBsZXQgcGFyYW1JbmRleCA9IDE7XHJcblxyXG4gIC8vIEZpcnN0LCByZXBsYWNlID8gd2l0aCAkMSwgJDIsIGV0Yy5cclxuICBwZ1NxbCA9IHBnU3FsLnJlcGxhY2UoL1xcPy9nLCAoKSA9PiBgJCR7cGFyYW1JbmRleCsrfWApO1xyXG5cclxuICAvLyBDb252ZXJ0IGNvbHVtbiBuYW1lcyB0aGF0IG5lZWQgcXVvdGluZyAoUG9zdGdyZVNRTCBpcyBjYXNlLXNlbnNpdGl2ZSlcclxuICAvLyBPbmx5IHJlcGxhY2UgaWYgbm90IGFscmVhZHkgcXVvdGVkXHJcbiAgY29uc3QgY29sdW1uc1RvUXVvdGUgPSBbXHJcbiAgICAnY3JlYXRlZEF0JywgJ3VwZGF0ZWRBdCcsICdvcmlnaW5hbFByaWNlJywgJ3ZpbkVuYWJsZWQnLCBcclxuICAgICdhaXJTaGlwcGluZ0VuYWJsZWQnLCAnc2VhU2hpcHBpbmdFbmFibGVkJywgJ3N0b2NrQ291bnQnLCBcclxuICAgICdpblN0b2NrJywgJ29yZGVyTnVtYmVyJywgJ3VzZXJJZCcsICdjdXN0b21lck5hbWUnLCBcclxuICAgICdjdXN0b21lclBob25lJywgJ2N1c3RvbWVyRW1haWwnLCAnc2hpcHBpbmdDb3N0JywgXHJcbiAgICAnc2hpcHBpbmdNZXRob2QnLCAnc2hpcHBpbmdBZGRyZXNzJywgJ3BheW1lbnRTdGF0dXMnLCAnaXNBY3RpdmUnXHJcbiAgXTtcclxuICBcclxuICBjb2x1bW5zVG9RdW90ZS5mb3JFYWNoKGNvbCA9PiB7XHJcbiAgICAvLyBSZXBsYWNlIGNvbHVtbiBuYW1lIG9ubHkgaWYgbm90IGFscmVhZHkgcXVvdGVkIGFuZCBub3QgcGFydCBvZiBhIHF1b3RlZCBzdHJpbmdcclxuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgXFxcXGIke2NvbH1cXFxcYig/IVteXCJdKlwiKD86W15cIl0qXCJbXlwiXSpcIikqW15cIl0qJClgLCAnZ2knKTtcclxuICAgIHBnU3FsID0gcGdTcWwucmVwbGFjZShyZWdleCwgYFwiJHtjb2x9XCJgKTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIHBnU3FsO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBkYXRhYmFzZVxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVEYXRhYmFzZSgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICBjb25zdCB7IGVuc3VyZURhdGFiYXNlLCBpbml0aWFsaXplVGFibGVzIH0gPSBhd2FpdCBpbXBvcnQoXCIuL3Bvc3RncmVzXCIpO1xyXG4gIGF3YWl0IGVuc3VyZURhdGFiYXNlKCk7XHJcbiAgYXdhaXQgaW5pdGlhbGl6ZVRhYmxlcygpO1xyXG59XHJcblxyXG4vKipcclxuICogVGVzdCBkYXRhYmFzZSBjb25uZWN0aW9uXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdGVzdENvbm5lY3Rpb24oKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgdGVzdENvbm5lY3Rpb24gfSA9IGF3YWl0IGltcG9ydChcIi4vcG9zdGdyZXNcIik7XHJcbiAgICByZXR1cm4gYXdhaXQgdGVzdENvbm5lY3Rpb24oKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBkYXRhYmFzZSB0eXBlXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGF0YWJhc2VUeXBlKCk6IFwicG9zdGdyZXNcIiB8IFwibm9uZVwiIHtcclxuICByZXR1cm4gXCJwb3N0Z3Jlc1wiO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJnZXRSb3ciLCJzcWwiLCJwYXJhbXMiLCJxdWVyeU9uZSIsInBnU3FsIiwiY29udmVydFRvUG9zdGdyZXNTUUwiLCJlcnJvciIsImNvbnNvbGUiLCJtZXNzYWdlIiwiY29kZSIsImdldFJvd3MiLCJxdWVyeUFsbCIsInJ1blF1ZXJ5IiwicXVlcnkiLCJyZXN1bHQiLCJjaGFuZ2VzIiwicm93Q291bnQiLCJsYXN0SW5zZXJ0Um93aWQiLCJ1bmRlZmluZWQiLCJwYXJhbUluZGV4IiwicmVwbGFjZSIsImNvbHVtbnNUb1F1b3RlIiwiZm9yRWFjaCIsImNvbCIsInJlZ2V4IiwiUmVnRXhwIiwiaW5pdGlhbGl6ZURhdGFiYXNlIiwiZW5zdXJlRGF0YWJhc2UiLCJpbml0aWFsaXplVGFibGVzIiwidGVzdENvbm5lY3Rpb24iLCJnZXREYXRhYmFzZVR5cGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/db/index.ts\n");

/***/ }),

/***/ "(rsc)/./lib/logger.ts":
/*!***********************!*\
  !*** ./lib/logger.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   logger: () => (/* binding */ logger)\n/* harmony export */ });\n/**\r\n * Centralized logging utility\r\n * Disables console.log in production for better performance\r\n */ class Logger {\n    shouldLog(level) {\n        // Always log errors and warnings\n        if (level === 'error' || level === 'warn') {\n            return true;\n        }\n        // Only log other levels in development\n        return this.isDevelopment;\n    }\n    log(...args) {\n        if (this.shouldLog('log')) {\n            console.log(...args);\n        }\n    }\n    error(...args) {\n        console.error(...args);\n    }\n    warn(...args) {\n        console.warn(...args);\n    }\n    info(...args) {\n        if (this.shouldLog('info')) {\n            console.info(...args);\n        }\n    }\n    debug(...args) {\n        if (this.shouldLog('debug')) {\n            console.debug(...args);\n        }\n    }\n    /**\r\n   * Log database query (only in development)\r\n   */ dbQuery(query, params) {\n        if (this.isDevelopment) {\n            console.log('[DB Query]', query.substring(0, 100), params ? `[${params.length} params]` : '');\n        }\n    }\n    /**\r\n   * Log API request (only in development)\r\n   */ apiRequest(method, path, statusCode) {\n        if (this.isDevelopment) {\n            console.log(`[API] ${method} ${path}${statusCode ? ` ${statusCode}` : ''}`);\n        }\n    }\n    constructor(){\n        this.isDevelopment = \"development\" === 'development';\n        this.isProduction = \"development\" === 'production';\n    }\n}\nconst logger = new Logger();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvbG9nZ2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7O0NBR0MsR0FJRCxNQUFNQTtJQUlJQyxVQUFVQyxLQUFlLEVBQVc7UUFDMUMsaUNBQWlDO1FBQ2pDLElBQUlBLFVBQVUsV0FBV0EsVUFBVSxRQUFRO1lBQ3pDLE9BQU87UUFDVDtRQUNBLHVDQUF1QztRQUN2QyxPQUFPLElBQUksQ0FBQ0MsYUFBYTtJQUMzQjtJQUVBQyxJQUFJLEdBQUdDLElBQVcsRUFBUTtRQUN4QixJQUFJLElBQUksQ0FBQ0osU0FBUyxDQUFDLFFBQVE7WUFDekJLLFFBQVFGLEdBQUcsSUFBSUM7UUFDakI7SUFDRjtJQUVBRSxNQUFNLEdBQUdGLElBQVcsRUFBUTtRQUMxQkMsUUFBUUMsS0FBSyxJQUFJRjtJQUNuQjtJQUVBRyxLQUFLLEdBQUdILElBQVcsRUFBUTtRQUN6QkMsUUFBUUUsSUFBSSxJQUFJSDtJQUNsQjtJQUVBSSxLQUFLLEdBQUdKLElBQVcsRUFBUTtRQUN6QixJQUFJLElBQUksQ0FBQ0osU0FBUyxDQUFDLFNBQVM7WUFDMUJLLFFBQVFHLElBQUksSUFBSUo7UUFDbEI7SUFDRjtJQUVBSyxNQUFNLEdBQUdMLElBQVcsRUFBUTtRQUMxQixJQUFJLElBQUksQ0FBQ0osU0FBUyxDQUFDLFVBQVU7WUFDM0JLLFFBQVFJLEtBQUssSUFBSUw7UUFDbkI7SUFDRjtJQUVBOztHQUVDLEdBQ0RNLFFBQVFDLEtBQWEsRUFBRUMsTUFBYyxFQUFRO1FBQzNDLElBQUksSUFBSSxDQUFDVixhQUFhLEVBQUU7WUFDdEJHLFFBQVFGLEdBQUcsQ0FBQyxjQUFjUSxNQUFNRSxTQUFTLENBQUMsR0FBRyxNQUFNRCxTQUFTLENBQUMsQ0FBQyxFQUFFQSxPQUFPRSxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUc7UUFDNUY7SUFDRjtJQUVBOztHQUVDLEdBQ0RDLFdBQVdDLE1BQWMsRUFBRUMsSUFBWSxFQUFFQyxVQUFtQixFQUFRO1FBQ2xFLElBQUksSUFBSSxDQUFDaEIsYUFBYSxFQUFFO1lBQ3RCRyxRQUFRRixHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUVhLE9BQU8sQ0FBQyxFQUFFQyxPQUFPQyxhQUFhLENBQUMsQ0FBQyxFQUFFQSxZQUFZLEdBQUcsSUFBSTtRQUM1RTtJQUNGOzthQXREUWhCLGdCQUFnQmlCLGtCQUF5QjthQUN6Q0MsZUFBZUQsa0JBQXlCOztBQXNEbEQ7QUFFTyxNQUFNRSxTQUFTLElBQUl0QixTQUFTIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXE1vaGFtYWRKYXZhZFxcT25lRHJpdmVcXERlc2t0b3BcXHNhZGVkIC0gQ29weSAoNClcXGxpYlxcbG9nZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDZW50cmFsaXplZCBsb2dnaW5nIHV0aWxpdHlcclxuICogRGlzYWJsZXMgY29uc29sZS5sb2cgaW4gcHJvZHVjdGlvbiBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXHJcbiAqL1xyXG5cclxudHlwZSBMb2dMZXZlbCA9ICdsb2cnIHwgJ2Vycm9yJyB8ICd3YXJuJyB8ICdpbmZvJyB8ICdkZWJ1Zyc7XHJcblxyXG5jbGFzcyBMb2dnZXIge1xyXG4gIHByaXZhdGUgaXNEZXZlbG9wbWVudCA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnO1xyXG4gIHByaXZhdGUgaXNQcm9kdWN0aW9uID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJztcclxuXHJcbiAgcHJpdmF0ZSBzaG91bGRMb2cobGV2ZWw6IExvZ0xldmVsKTogYm9vbGVhbiB7XHJcbiAgICAvLyBBbHdheXMgbG9nIGVycm9ycyBhbmQgd2FybmluZ3NcclxuICAgIGlmIChsZXZlbCA9PT0gJ2Vycm9yJyB8fCBsZXZlbCA9PT0gJ3dhcm4nKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgLy8gT25seSBsb2cgb3RoZXIgbGV2ZWxzIGluIGRldmVsb3BtZW50XHJcbiAgICByZXR1cm4gdGhpcy5pc0RldmVsb3BtZW50O1xyXG4gIH1cclxuXHJcbiAgbG9nKC4uLmFyZ3M6IGFueVtdKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5zaG91bGRMb2coJ2xvZycpKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKC4uLmFyZ3MpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZXJyb3IoLi4uYXJnczogYW55W10pOiB2b2lkIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoLi4uYXJncyk7XHJcbiAgfVxyXG5cclxuICB3YXJuKC4uLmFyZ3M6IGFueVtdKTogdm9pZCB7XHJcbiAgICBjb25zb2xlLndhcm4oLi4uYXJncyk7XHJcbiAgfVxyXG5cclxuICBpbmZvKC4uLmFyZ3M6IGFueVtdKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5zaG91bGRMb2coJ2luZm8nKSkge1xyXG4gICAgICBjb25zb2xlLmluZm8oLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBkZWJ1ZyguLi5hcmdzOiBhbnlbXSk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuc2hvdWxkTG9nKCdkZWJ1ZycpKSB7XHJcbiAgICAgIGNvbnNvbGUuZGVidWcoLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2cgZGF0YWJhc2UgcXVlcnkgKG9ubHkgaW4gZGV2ZWxvcG1lbnQpXHJcbiAgICovXHJcbiAgZGJRdWVyeShxdWVyeTogc3RyaW5nLCBwYXJhbXM/OiBhbnlbXSk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuaXNEZXZlbG9wbWVudCkge1xyXG4gICAgICBjb25zb2xlLmxvZygnW0RCIFF1ZXJ5XScsIHF1ZXJ5LnN1YnN0cmluZygwLCAxMDApLCBwYXJhbXMgPyBgWyR7cGFyYW1zLmxlbmd0aH0gcGFyYW1zXWAgOiAnJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2cgQVBJIHJlcXVlc3QgKG9ubHkgaW4gZGV2ZWxvcG1lbnQpXHJcbiAgICovXHJcbiAgYXBpUmVxdWVzdChtZXRob2Q6IHN0cmluZywgcGF0aDogc3RyaW5nLCBzdGF0dXNDb2RlPzogbnVtYmVyKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5pc0RldmVsb3BtZW50KSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBbQVBJXSAke21ldGhvZH0gJHtwYXRofSR7c3RhdHVzQ29kZSA/IGAgJHtzdGF0dXNDb2RlfWAgOiAnJ31gKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XHJcblxyXG4iXSwibmFtZXMiOlsiTG9nZ2VyIiwic2hvdWxkTG9nIiwibGV2ZWwiLCJpc0RldmVsb3BtZW50IiwibG9nIiwiYXJncyIsImNvbnNvbGUiLCJlcnJvciIsIndhcm4iLCJpbmZvIiwiZGVidWciLCJkYlF1ZXJ5IiwicXVlcnkiLCJwYXJhbXMiLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJhcGlSZXF1ZXN0IiwibWV0aG9kIiwicGF0aCIsInN0YXR1c0NvZGUiLCJwcm9jZXNzIiwiaXNQcm9kdWN0aW9uIiwibG9nZ2VyIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/logger.ts\n");

/***/ }),

/***/ "(rsc)/./lib/rate-limit.ts":
/*!***************************!*\
  !*** ./lib/rate-limit.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getClientId: () => (/* binding */ getClientId),\n/* harmony export */   rateLimit: () => (/* binding */ rateLimit),\n/* harmony export */   rateLimiter: () => (/* binding */ rateLimiter)\n/* harmony export */ });\n/**\r\n * Simple in-memory rate limiter\r\n * For production, consider using Redis-based rate limiting\r\n */ class RateLimiter {\n    /**\r\n   * Check if request should be rate limited\r\n   * @param key - Unique identifier (e.g., IP address, user ID)\r\n   * @param maxRequests - Maximum number of requests\r\n   * @param windowMs - Time window in milliseconds\r\n   * @returns true if rate limited, false otherwise\r\n   */ isRateLimited(key, maxRequests, windowMs) {\n        const now = Date.now();\n        const entry = this.store.get(key);\n        if (!entry || now > entry.resetTime) {\n            // Create new entry or reset expired entry\n            this.store.set(key, {\n                count: 1,\n                resetTime: now + windowMs\n            });\n            return false;\n        }\n        if (entry.count >= maxRequests) {\n            return true; // Rate limited\n        }\n        // Increment count\n        entry.count++;\n        return false;\n    }\n    /**\r\n   * Get remaining requests for a key\r\n   */ getRemaining(key, maxRequests) {\n        const entry = this.store.get(key);\n        if (!entry) {\n            return maxRequests;\n        }\n        return Math.max(0, maxRequests - entry.count);\n    }\n    /**\r\n   * Get reset time for a key\r\n   */ getResetTime(key) {\n        const entry = this.store.get(key);\n        return entry ? entry.resetTime : null;\n    }\n    /**\r\n   * Clear expired entries\r\n   */ cleanup() {\n        const now = Date.now();\n        for (const [key, entry] of this.store.entries()){\n            if (now > entry.resetTime) {\n                this.store.delete(key);\n            }\n        }\n    }\n    /**\r\n   * Start automatic cleanup\r\n   */ startCleanup(intervalMs = 60000) {\n        if (this.cleanupInterval) {\n            return;\n        }\n        this.cleanupInterval = setInterval(()=>{\n            this.cleanup();\n        }, intervalMs);\n    }\n    /**\r\n   * Stop automatic cleanup\r\n   */ stopCleanup() {\n        if (this.cleanupInterval) {\n            clearInterval(this.cleanupInterval);\n            this.cleanupInterval = null;\n        }\n    }\n    /**\r\n   * Clear all entries\r\n   */ clear() {\n        this.store.clear();\n    }\n    constructor(){\n        this.store = new Map();\n        this.cleanupInterval = null;\n    }\n}\n// Create singleton instance\nconst rateLimiter = new RateLimiter();\n// Start automatic cleanup every minute\nrateLimiter.startCleanup(60000);\n/**\r\n * Get client identifier from request\r\n */ function getClientId(request) {\n    // Try to get IP from various headers (for proxies/load balancers)\n    const forwarded = request.headers.get('x-forwarded-for');\n    const realIp = request.headers.get('x-real-ip');\n    const ip = forwarded?.split(',')[0] || realIp || 'unknown';\n    return ip;\n}\n/**\r\n * Rate limit middleware\r\n */ function rateLimit(maxRequests = 100, windowMs = 60000, keyGenerator) {\n    return async (request)=>{\n        const key = keyGenerator ? keyGenerator(request) : getClientId(request);\n        const fullKey = `${request.nextUrl.pathname}:${key}`;\n        if (rateLimiter.isRateLimited(fullKey, maxRequests, windowMs)) {\n            const resetTime = rateLimiter.getResetTime(fullKey);\n            const remaining = rateLimiter.getRemaining(fullKey, maxRequests);\n            return new Response(JSON.stringify({\n                success: false,\n                error: {\n                    message: 'Too many requests. Please try again later.',\n                    code: 'RATE_LIMIT_EXCEEDED'\n                }\n            }), {\n                status: 429,\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-RateLimit-Limit': maxRequests.toString(),\n                    'X-RateLimit-Remaining': remaining.toString(),\n                    'X-RateLimit-Reset': resetTime?.toString() || '',\n                    'Retry-After': Math.ceil((resetTime ? resetTime - Date.now() : windowMs) / 1000).toString()\n                }\n            });\n        }\n        return null; // Not rate limited\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmF0ZS1saW1pdC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7O0NBR0MsR0FTRCxNQUFNQTtJQUlKOzs7Ozs7R0FNQyxHQUNEQyxjQUFjQyxHQUFXLEVBQUVDLFdBQW1CLEVBQUVDLFFBQWdCLEVBQVc7UUFDekUsTUFBTUMsTUFBTUMsS0FBS0QsR0FBRztRQUNwQixNQUFNRSxRQUFRLElBQUksQ0FBQ0MsS0FBSyxDQUFDQyxHQUFHLENBQUNQO1FBRTdCLElBQUksQ0FBQ0ssU0FBU0YsTUFBTUUsTUFBTUcsU0FBUyxFQUFFO1lBQ25DLDBDQUEwQztZQUMxQyxJQUFJLENBQUNGLEtBQUssQ0FBQ0csR0FBRyxDQUFDVCxLQUFLO2dCQUNsQlUsT0FBTztnQkFDUEYsV0FBV0wsTUFBTUQ7WUFDbkI7WUFDQSxPQUFPO1FBQ1Q7UUFFQSxJQUFJRyxNQUFNSyxLQUFLLElBQUlULGFBQWE7WUFDOUIsT0FBTyxNQUFNLGVBQWU7UUFDOUI7UUFFQSxrQkFBa0I7UUFDbEJJLE1BQU1LLEtBQUs7UUFDWCxPQUFPO0lBQ1Q7SUFFQTs7R0FFQyxHQUNEQyxhQUFhWCxHQUFXLEVBQUVDLFdBQW1CLEVBQVU7UUFDckQsTUFBTUksUUFBUSxJQUFJLENBQUNDLEtBQUssQ0FBQ0MsR0FBRyxDQUFDUDtRQUM3QixJQUFJLENBQUNLLE9BQU87WUFDVixPQUFPSjtRQUNUO1FBQ0EsT0FBT1csS0FBS0MsR0FBRyxDQUFDLEdBQUdaLGNBQWNJLE1BQU1LLEtBQUs7SUFDOUM7SUFFQTs7R0FFQyxHQUNESSxhQUFhZCxHQUFXLEVBQWlCO1FBQ3ZDLE1BQU1LLFFBQVEsSUFBSSxDQUFDQyxLQUFLLENBQUNDLEdBQUcsQ0FBQ1A7UUFDN0IsT0FBT0ssUUFBUUEsTUFBTUcsU0FBUyxHQUFHO0lBQ25DO0lBRUE7O0dBRUMsR0FDRE8sVUFBZ0I7UUFDZCxNQUFNWixNQUFNQyxLQUFLRCxHQUFHO1FBQ3BCLEtBQUssTUFBTSxDQUFDSCxLQUFLSyxNQUFNLElBQUksSUFBSSxDQUFDQyxLQUFLLENBQUNVLE9BQU8sR0FBSTtZQUMvQyxJQUFJYixNQUFNRSxNQUFNRyxTQUFTLEVBQUU7Z0JBQ3pCLElBQUksQ0FBQ0YsS0FBSyxDQUFDVyxNQUFNLENBQUNqQjtZQUNwQjtRQUNGO0lBQ0Y7SUFFQTs7R0FFQyxHQUNEa0IsYUFBYUMsYUFBcUIsS0FBSyxFQUFRO1FBQzdDLElBQUksSUFBSSxDQUFDQyxlQUFlLEVBQUU7WUFDeEI7UUFDRjtRQUNBLElBQUksQ0FBQ0EsZUFBZSxHQUFHQyxZQUFZO1lBQ2pDLElBQUksQ0FBQ04sT0FBTztRQUNkLEdBQUdJO0lBQ0w7SUFFQTs7R0FFQyxHQUNERyxjQUFvQjtRQUNsQixJQUFJLElBQUksQ0FBQ0YsZUFBZSxFQUFFO1lBQ3hCRyxjQUFjLElBQUksQ0FBQ0gsZUFBZTtZQUNsQyxJQUFJLENBQUNBLGVBQWUsR0FBRztRQUN6QjtJQUNGO0lBRUE7O0dBRUMsR0FDREksUUFBYztRQUNaLElBQUksQ0FBQ2xCLEtBQUssQ0FBQ2tCLEtBQUs7SUFDbEI7O2FBMUZRbEIsUUFBUSxJQUFJbUI7YUFDWkwsa0JBQXlDOztBQTBGbkQ7QUFFQSw0QkFBNEI7QUFDckIsTUFBTU0sY0FBYyxJQUFJNUIsY0FBYztBQUU3Qyx1Q0FBdUM7QUFDdkM0QixZQUFZUixZQUFZLENBQUM7QUFFekI7O0NBRUMsR0FDTSxTQUFTUyxZQUFZQyxPQUFvQjtJQUM5QyxrRUFBa0U7SUFDbEUsTUFBTUMsWUFBWUQsUUFBUUUsT0FBTyxDQUFDdkIsR0FBRyxDQUFDO0lBQ3RDLE1BQU13QixTQUFTSCxRQUFRRSxPQUFPLENBQUN2QixHQUFHLENBQUM7SUFDbkMsTUFBTXlCLEtBQUtILFdBQVdJLE1BQU0sSUFBSSxDQUFDLEVBQUUsSUFBSUYsVUFBVTtJQUVqRCxPQUFPQztBQUNUO0FBRUE7O0NBRUMsR0FDTSxTQUFTRSxVQUNkakMsY0FBc0IsR0FBRyxFQUN6QkMsV0FBbUIsS0FBSyxFQUN4QmlDLFlBQStDO0lBRS9DLE9BQU8sT0FBT1A7UUFDWixNQUFNNUIsTUFBTW1DLGVBQWVBLGFBQWFQLFdBQVdELFlBQVlDO1FBQy9ELE1BQU1RLFVBQVUsR0FBR1IsUUFBUVMsT0FBTyxDQUFDQyxRQUFRLENBQUMsQ0FBQyxFQUFFdEMsS0FBSztRQUVwRCxJQUFJMEIsWUFBWTNCLGFBQWEsQ0FBQ3FDLFNBQVNuQyxhQUFhQyxXQUFXO1lBQzdELE1BQU1NLFlBQVlrQixZQUFZWixZQUFZLENBQUNzQjtZQUMzQyxNQUFNRyxZQUFZYixZQUFZZixZQUFZLENBQUN5QixTQUFTbkM7WUFFcEQsT0FBTyxJQUFJdUMsU0FDVEMsS0FBS0MsU0FBUyxDQUFDO2dCQUNiQyxTQUFTO2dCQUNUQyxPQUFPO29CQUNMQyxTQUFTO29CQUNUQyxNQUFNO2dCQUNSO1lBQ0YsSUFDQTtnQkFDRUMsUUFBUTtnQkFDUmpCLFNBQVM7b0JBQ1AsZ0JBQWdCO29CQUNoQixxQkFBcUI3QixZQUFZK0MsUUFBUTtvQkFDekMseUJBQXlCVCxVQUFVUyxRQUFRO29CQUMzQyxxQkFBcUJ4QyxXQUFXd0MsY0FBYztvQkFDOUMsZUFBZXBDLEtBQUtxQyxJQUFJLENBQUMsQ0FBQ3pDLFlBQVlBLFlBQVlKLEtBQUtELEdBQUcsS0FBS0QsUUFBTyxJQUFLLE1BQU04QyxRQUFRO2dCQUMzRjtZQUNGO1FBRUo7UUFFQSxPQUFPLE1BQU0sbUJBQW1CO0lBQ2xDO0FBQ0YiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcTW9oYW1hZEphdmFkXFxPbmVEcml2ZVxcRGVza3RvcFxcc2FkZWQgLSBDb3B5ICg0KVxcbGliXFxyYXRlLWxpbWl0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBTaW1wbGUgaW4tbWVtb3J5IHJhdGUgbGltaXRlclxyXG4gKiBGb3IgcHJvZHVjdGlvbiwgY29uc2lkZXIgdXNpbmcgUmVkaXMtYmFzZWQgcmF0ZSBsaW1pdGluZ1xyXG4gKi9cclxuXHJcbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5cclxuaW50ZXJmYWNlIFJhdGVMaW1pdEVudHJ5IHtcclxuICBjb3VudDogbnVtYmVyO1xyXG4gIHJlc2V0VGltZTogbnVtYmVyO1xyXG59XHJcblxyXG5jbGFzcyBSYXRlTGltaXRlciB7XHJcbiAgcHJpdmF0ZSBzdG9yZSA9IG5ldyBNYXA8c3RyaW5nLCBSYXRlTGltaXRFbnRyeT4oKTtcclxuICBwcml2YXRlIGNsZWFudXBJbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgcmVxdWVzdCBzaG91bGQgYmUgcmF0ZSBsaW1pdGVkXHJcbiAgICogQHBhcmFtIGtleSAtIFVuaXF1ZSBpZGVudGlmaWVyIChlLmcuLCBJUCBhZGRyZXNzLCB1c2VyIElEKVxyXG4gICAqIEBwYXJhbSBtYXhSZXF1ZXN0cyAtIE1heGltdW0gbnVtYmVyIG9mIHJlcXVlc3RzXHJcbiAgICogQHBhcmFtIHdpbmRvd01zIC0gVGltZSB3aW5kb3cgaW4gbWlsbGlzZWNvbmRzXHJcbiAgICogQHJldHVybnMgdHJ1ZSBpZiByYXRlIGxpbWl0ZWQsIGZhbHNlIG90aGVyd2lzZVxyXG4gICAqL1xyXG4gIGlzUmF0ZUxpbWl0ZWQoa2V5OiBzdHJpbmcsIG1heFJlcXVlc3RzOiBudW1iZXIsIHdpbmRvd01zOiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICBjb25zdCBlbnRyeSA9IHRoaXMuc3RvcmUuZ2V0KGtleSk7XHJcblxyXG4gICAgaWYgKCFlbnRyeSB8fCBub3cgPiBlbnRyeS5yZXNldFRpbWUpIHtcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBlbnRyeSBvciByZXNldCBleHBpcmVkIGVudHJ5XHJcbiAgICAgIHRoaXMuc3RvcmUuc2V0KGtleSwge1xyXG4gICAgICAgIGNvdW50OiAxLFxyXG4gICAgICAgIHJlc2V0VGltZTogbm93ICsgd2luZG93TXMsXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGVudHJ5LmNvdW50ID49IG1heFJlcXVlc3RzKSB7XHJcbiAgICAgIHJldHVybiB0cnVlOyAvLyBSYXRlIGxpbWl0ZWRcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbmNyZW1lbnQgY291bnRcclxuICAgIGVudHJ5LmNvdW50Kys7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgcmVtYWluaW5nIHJlcXVlc3RzIGZvciBhIGtleVxyXG4gICAqL1xyXG4gIGdldFJlbWFpbmluZyhrZXk6IHN0cmluZywgbWF4UmVxdWVzdHM6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICBjb25zdCBlbnRyeSA9IHRoaXMuc3RvcmUuZ2V0KGtleSk7XHJcbiAgICBpZiAoIWVudHJ5KSB7XHJcbiAgICAgIHJldHVybiBtYXhSZXF1ZXN0cztcclxuICAgIH1cclxuICAgIHJldHVybiBNYXRoLm1heCgwLCBtYXhSZXF1ZXN0cyAtIGVudHJ5LmNvdW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCByZXNldCB0aW1lIGZvciBhIGtleVxyXG4gICAqL1xyXG4gIGdldFJlc2V0VGltZShrZXk6IHN0cmluZyk6IG51bWJlciB8IG51bGwge1xyXG4gICAgY29uc3QgZW50cnkgPSB0aGlzLnN0b3JlLmdldChrZXkpO1xyXG4gICAgcmV0dXJuIGVudHJ5ID8gZW50cnkucmVzZXRUaW1lIDogbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsZWFyIGV4cGlyZWQgZW50cmllc1xyXG4gICAqL1xyXG4gIGNsZWFudXAoKTogdm9pZCB7XHJcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xyXG4gICAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2YgdGhpcy5zdG9yZS5lbnRyaWVzKCkpIHtcclxuICAgICAgaWYgKG5vdyA+IGVudHJ5LnJlc2V0VGltZSkge1xyXG4gICAgICAgIHRoaXMuc3RvcmUuZGVsZXRlKGtleSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0YXJ0IGF1dG9tYXRpYyBjbGVhbnVwXHJcbiAgICovXHJcbiAgc3RhcnRDbGVhbnVwKGludGVydmFsTXM6IG51bWJlciA9IDYwMDAwKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5jbGVhbnVwSW50ZXJ2YWwpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jbGVhbnVwSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuY2xlYW51cCgpO1xyXG4gICAgfSwgaW50ZXJ2YWxNcyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdG9wIGF1dG9tYXRpYyBjbGVhbnVwXHJcbiAgICovXHJcbiAgc3RvcENsZWFudXAoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5jbGVhbnVwSW50ZXJ2YWwpIHtcclxuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNsZWFudXBJbnRlcnZhbCk7XHJcbiAgICAgIHRoaXMuY2xlYW51cEludGVydmFsID0gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsZWFyIGFsbCBlbnRyaWVzXHJcbiAgICovXHJcbiAgY2xlYXIoKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0b3JlLmNsZWFyKCk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBDcmVhdGUgc2luZ2xldG9uIGluc3RhbmNlXHJcbmV4cG9ydCBjb25zdCByYXRlTGltaXRlciA9IG5ldyBSYXRlTGltaXRlcigpO1xyXG5cclxuLy8gU3RhcnQgYXV0b21hdGljIGNsZWFudXAgZXZlcnkgbWludXRlXHJcbnJhdGVMaW1pdGVyLnN0YXJ0Q2xlYW51cCg2MDAwMCk7XHJcblxyXG4vKipcclxuICogR2V0IGNsaWVudCBpZGVudGlmaWVyIGZyb20gcmVxdWVzdFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENsaWVudElkKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogc3RyaW5nIHtcclxuICAvLyBUcnkgdG8gZ2V0IElQIGZyb20gdmFyaW91cyBoZWFkZXJzIChmb3IgcHJveGllcy9sb2FkIGJhbGFuY2VycylcclxuICBjb25zdCBmb3J3YXJkZWQgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKTtcclxuICBjb25zdCByZWFsSXAgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LXJlYWwtaXAnKTtcclxuICBjb25zdCBpcCA9IGZvcndhcmRlZD8uc3BsaXQoJywnKVswXSB8fCByZWFsSXAgfHwgJ3Vua25vd24nO1xyXG4gIFxyXG4gIHJldHVybiBpcDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJhdGUgbGltaXQgbWlkZGxld2FyZVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHJhdGVMaW1pdChcclxuICBtYXhSZXF1ZXN0czogbnVtYmVyID0gMTAwLFxyXG4gIHdpbmRvd01zOiBudW1iZXIgPSA2MDAwMCwgLy8gMSBtaW51dGUgZGVmYXVsdFxyXG4gIGtleUdlbmVyYXRvcj86IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkgPT4gc3RyaW5nXHJcbikge1xyXG4gIHJldHVybiBhc3luYyAocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPFJlc3BvbnNlIHwgbnVsbD4gPT4ge1xyXG4gICAgY29uc3Qga2V5ID0ga2V5R2VuZXJhdG9yID8ga2V5R2VuZXJhdG9yKHJlcXVlc3QpIDogZ2V0Q2xpZW50SWQocmVxdWVzdCk7XHJcbiAgICBjb25zdCBmdWxsS2V5ID0gYCR7cmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lfToke2tleX1gO1xyXG5cclxuICAgIGlmIChyYXRlTGltaXRlci5pc1JhdGVMaW1pdGVkKGZ1bGxLZXksIG1heFJlcXVlc3RzLCB3aW5kb3dNcykpIHtcclxuICAgICAgY29uc3QgcmVzZXRUaW1lID0gcmF0ZUxpbWl0ZXIuZ2V0UmVzZXRUaW1lKGZ1bGxLZXkpO1xyXG4gICAgICBjb25zdCByZW1haW5pbmcgPSByYXRlTGltaXRlci5nZXRSZW1haW5pbmcoZnVsbEtleSwgbWF4UmVxdWVzdHMpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcclxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdUb28gbWFueSByZXF1ZXN0cy4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nLFxyXG4gICAgICAgICAgICBjb2RlOiAnUkFURV9MSU1JVF9FWENFRURFRCcsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN0YXR1czogNDI5LFxyXG4gICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAnWC1SYXRlTGltaXQtTGltaXQnOiBtYXhSZXF1ZXN0cy50b1N0cmluZygpLFxyXG4gICAgICAgICAgICAnWC1SYXRlTGltaXQtUmVtYWluaW5nJzogcmVtYWluaW5nLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICdYLVJhdGVMaW1pdC1SZXNldCc6IHJlc2V0VGltZT8udG9TdHJpbmcoKSB8fCAnJyxcclxuICAgICAgICAgICAgJ1JldHJ5LUFmdGVyJzogTWF0aC5jZWlsKChyZXNldFRpbWUgPyByZXNldFRpbWUgLSBEYXRlLm5vdygpIDogd2luZG93TXMpIC8gMTAwMCkudG9TdHJpbmcoKSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsOyAvLyBOb3QgcmF0ZSBsaW1pdGVkXHJcbiAgfTtcclxufVxyXG5cclxuIl0sIm5hbWVzIjpbIlJhdGVMaW1pdGVyIiwiaXNSYXRlTGltaXRlZCIsImtleSIsIm1heFJlcXVlc3RzIiwid2luZG93TXMiLCJub3ciLCJEYXRlIiwiZW50cnkiLCJzdG9yZSIsImdldCIsInJlc2V0VGltZSIsInNldCIsImNvdW50IiwiZ2V0UmVtYWluaW5nIiwiTWF0aCIsIm1heCIsImdldFJlc2V0VGltZSIsImNsZWFudXAiLCJlbnRyaWVzIiwiZGVsZXRlIiwic3RhcnRDbGVhbnVwIiwiaW50ZXJ2YWxNcyIsImNsZWFudXBJbnRlcnZhbCIsInNldEludGVydmFsIiwic3RvcENsZWFudXAiLCJjbGVhckludGVydmFsIiwiY2xlYXIiLCJNYXAiLCJyYXRlTGltaXRlciIsImdldENsaWVudElkIiwicmVxdWVzdCIsImZvcndhcmRlZCIsImhlYWRlcnMiLCJyZWFsSXAiLCJpcCIsInNwbGl0IiwicmF0ZUxpbWl0Iiwia2V5R2VuZXJhdG9yIiwiZnVsbEtleSIsIm5leHRVcmwiLCJwYXRobmFtZSIsInJlbWFpbmluZyIsIlJlc3BvbnNlIiwiSlNPTiIsInN0cmluZ2lmeSIsInN1Y2Nlc3MiLCJlcnJvciIsIm1lc3NhZ2UiLCJjb2RlIiwic3RhdHVzIiwidG9TdHJpbmciLCJjZWlsIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/rate-limit.ts\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5CMohamadJavad%5COneDrive%5CDesktop%5Csaded%20-%20Copy%20(4)%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CMohamadJavad%5COneDrive%5CDesktop%5Csaded%20-%20Copy%20(4)&isDev=true&tsconfigPath=&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5CMohamadJavad%5COneDrive%5CDesktop%5Csaded%20-%20Copy%20(4)%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CMohamadJavad%5COneDrive%5CDesktop%5Csaded%20-%20Copy%20(4)&isDev=true&tsconfigPath=&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handler: () => (/* binding */ handler),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/server/request-meta */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/request-meta.js\");\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var next_dist_server_app_render_encryption_utils__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/app-render/encryption-utils */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/app-render/encryption-utils.js\");\n/* harmony import */ var next_dist_server_app_render_encryption_utils__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_app_render_encryption_utils__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_app_render_action_utils__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/app-render/action-utils */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/app-render/action-utils.js\");\n/* harmony import */ var next_dist_server_app_render_action_utils__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_app_render_action_utils__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! next/dist/shared/lib/router/utils/app-paths */ \"next/dist/shared/lib/router/utils/app-paths\");\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! next/dist/server/base-http/node */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/base-http/node.js\");\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! next/dist/server/web/spec-extension/adapters/next-request */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/web/spec-extension/adapters/next-request.js\");\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_9__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_10__);\n/* harmony import */ var next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! next/dist/server/instrumentation/utils */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/instrumentation/utils.js\");\n/* harmony import */ var next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! next/dist/server/send-response */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/send-response.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! next/dist/server/web/utils */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/web/utils.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_13__);\n/* harmony import */ var next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! next/dist/server/lib/cache-control */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/lib/cache-control.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! next/dist/lib/constants */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/lib/constants.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_15___default = /*#__PURE__*/__webpack_require__.n(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_15__);\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! next/dist/shared/lib/no-fallback-error.external */ \"next/dist/shared/lib/no-fallback-error.external\");\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_16___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_16__);\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! next/dist/server/response-cache */ \"(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/server/response-cache/index.js\");\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_17___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_17__);\n/* harmony import */ var C_Users_MohamadJavad_OneDrive_Desktop_saded_Copy_4_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./app/api/chat/route.ts */ \"(rsc)/./app/api/chat/route.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/route\",\n        pathname: \"/api/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/route\"\n    },\n    distDir: \".next\\\\dev\" || 0,\n    relativeProjectDir:  false || '',\n    resolvedPagePath: \"C:\\\\Users\\\\MohamadJavad\\\\OneDrive\\\\Desktop\\\\saded - Copy (4)\\\\app\\\\api\\\\chat\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_MohamadJavad_OneDrive_Desktop_saded_Copy_4_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_18__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\nasync function handler(req, res, ctx) {\n    if (routeModule.isDev) {\n        (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.addRequestMeta)(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint());\n    }\n    let srcPage = \"/api/chat/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {} else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = false;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, parsedUrl, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname, clientReferenceManifest, serverActionsManifest } = prepareResult;\n    const normalizedSrcPage = (0,next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_7__.normalizeAppPath)(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    const render404 = async ()=>{\n        // TODO: should route-module itself handle rendering the 404\n        if (routerServerContext == null ? void 0 : routerServerContext.render404) {\n            await routerServerContext.render404(req, res, parsedUrl, false);\n        } else {\n            res.end('This page could not be found');\n        }\n        return null;\n    };\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                if (nextConfig.experimental.adapterPath) {\n                    return await render404();\n                }\n                throw new next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_16__.NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isStaticGeneration = isIsr && !supportsDynamicResponse;\n    // Before rendering (which initializes component tree modules), we have to\n    // set the reference manifests to our global store so Server Action's\n    // encryption util can access to them at the top level of the page module.\n    if (serverActionsManifest && clientReferenceManifest) {\n        (0,next_dist_server_app_render_encryption_utils__WEBPACK_IMPORTED_MODULE_5__.setReferenceManifestsSingleton)({\n            page: srcPage,\n            clientReferenceManifest,\n            serverActionsManifest,\n            serverModuleMap: (0,next_dist_server_app_render_action_utils__WEBPACK_IMPORTED_MODULE_6__.createServerModuleMap)({\n                serverActionsManifest\n            })\n        });\n    }\n    const method = req.method || 'GET';\n    const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.getTracer)();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            cacheComponents: Boolean(nextConfig.cacheComponents),\n            supportsDynamicResponse,\n            incrementalCache: (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'incrementalCache'),\n            cacheLifeProfiles: nextConfig.cacheLife,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_8__.NodeNextRequest(req);\n    const nodeNextRes = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_8__.NodeNextResponse(res);\n    const nextReq = next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_9__.NextRequestAdapter.fromNodeNextRequest(nodeNextReq, (0,next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_9__.signalFromNodeResponse)(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_10__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${srcPage}`);\n                }\n            });\n        };\n        const isMinimalMode = Boolean( false || (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode'));\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!isMinimalMode && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_13__.toNodeOutgoingHttpHeaders)(response.headers);\n                        if (cacheTags) {\n                            headers[next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_15__.NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_15__.INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_15__.INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_17__.CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_12__.sendResponse)(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_11__.getRevalidateReason)({\n                                isStaticGeneration,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil,\n                isMinimalMode\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_17__.CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!isMinimalMode) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_13__.fromNodeOutgoingHttpHeaders)(cacheEntry.value.headers);\n            if (!(isMinimalMode && isIsr)) {\n                headers.delete(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_15__.NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', (0,next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_14__.getCacheControlHeader)(cacheEntry.cacheControl));\n            }\n            await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_12__.sendResponse)(nodeNextReq, nodeNextRes, // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n            new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_10__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${srcPage}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_16__.NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_11__.getRevalidateReason)({\n                    isStaticGeneration,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_12__.sendResponse)(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbmV4dEAxNi4wLjNfQGJhYmVsK2NvcmVANy4yX2E2ZTdmZTdiMjEwN2JmZDVjOWU0NTAzMWUzMjJjNWMzL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtYXBwLWxvYWRlci9pbmRleC5qcz9uYW1lPWFwcCUyRmFwaSUyRmNoYXQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmNoYXQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZjaGF0JTJGcm91dGUudHMmYXBwRGlyPUMlM0ElNUNVc2VycyU1Q01vaGFtYWRKYXZhZCU1Q09uZURyaXZlJTVDRGVza3RvcCU1Q3NhZGVkJTIwLSUyMENvcHklMjAoNCklNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q01vaGFtYWRKYXZhZCU1Q09uZURyaXZlJTVDRGVza3RvcCU1Q3NhZGVkJTIwLSUyMENvcHklMjAoNCkmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9JmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCZpc0dsb2JhbE5vdEZvdW5kRW5hYmxlZD0hIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUNFO0FBQ1A7QUFDc0I7QUFDYjtBQUNGO0FBQ0s7QUFDbUM7QUFDakQ7QUFDTztBQUNmO0FBQ3NDO0FBQ3pCO0FBQ007QUFDQztBQUNoQjtBQUNpRDtBQUNuSDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFJQUFxSSw2RUFBZTtBQUNwSjtBQUNBLDJHQUEyRyxpSEFBaUg7QUFDNU47QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsd0ZBQTJCO0FBQ3ZEO0FBQ0EsK0JBQStCLDRFQUFzQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QywwRkFBcUI7QUFDbEU7QUFDQSxrQkFBa0IsNkVBQVk7QUFDOUI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDViw2RUFBNkUsaUZBQWM7QUFDM0YsaUNBQWlDLFFBQVEsRUFBRSxRQUFRO0FBQ25ELDBCQUEwQix1RUFBUTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLE1BQU07QUFDTiw2QkFBNkIsNkZBQWU7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsNEZBQW1CO0FBQ3JEO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLDZFQUFZO0FBQzFCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQSIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCB7IGFkZFJlcXVlc3RNZXRhLCBnZXRSZXF1ZXN0TWV0YSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JlcXVlc3QtbWV0YVwiO1xuaW1wb3J0IHsgZ2V0VHJhY2VyLCBTcGFuS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS90cmFjZXJcIjtcbmltcG9ydCB7IHNldFJlZmVyZW5jZU1hbmlmZXN0c1NpbmdsZXRvbiB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2FwcC1yZW5kZXIvZW5jcnlwdGlvbi11dGlsc1wiO1xuaW1wb3J0IHsgY3JlYXRlU2VydmVyTW9kdWxlTWFwIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvYXBwLXJlbmRlci9hY3Rpb24tdXRpbHNcIjtcbmltcG9ydCB7IG5vcm1hbGl6ZUFwcFBhdGggfSBmcm9tIFwibmV4dC9kaXN0L3NoYXJlZC9saWIvcm91dGVyL3V0aWxzL2FwcC1wYXRoc1wiO1xuaW1wb3J0IHsgTm9kZU5leHRSZXF1ZXN0LCBOb2RlTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvYmFzZS1odHRwL25vZGVcIjtcbmltcG9ydCB7IE5leHRSZXF1ZXN0QWRhcHRlciwgc2lnbmFsRnJvbU5vZGVSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3dlYi9zcGVjLWV4dGVuc2lvbi9hZGFwdGVycy9uZXh0LXJlcXVlc3RcIjtcbmltcG9ydCB7IEJhc2VTZXJ2ZXJTcGFuIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL2NvbnN0YW50c1wiO1xuaW1wb3J0IHsgZ2V0UmV2YWxpZGF0ZVJlYXNvbiB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2luc3RydW1lbnRhdGlvbi91dGlsc1wiO1xuaW1wb3J0IHsgc2VuZFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvc2VuZC1yZXNwb25zZVwiO1xuaW1wb3J0IHsgZnJvbU5vZGVPdXRnb2luZ0h0dHBIZWFkZXJzLCB0b05vZGVPdXRnb2luZ0h0dHBIZWFkZXJzIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvd2ViL3V0aWxzXCI7XG5pbXBvcnQgeyBnZXRDYWNoZUNvbnRyb2xIZWFkZXIgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvY2FjaGUtY29udHJvbFwiO1xuaW1wb3J0IHsgSU5GSU5JVEVfQ0FDSEUsIE5FWFRfQ0FDSEVfVEFHU19IRUFERVIgfSBmcm9tIFwibmV4dC9kaXN0L2xpYi9jb25zdGFudHNcIjtcbmltcG9ydCB7IE5vRmFsbGJhY2tFcnJvciB9IGZyb20gXCJuZXh0L2Rpc3Qvc2hhcmVkL2xpYi9uby1mYWxsYmFjay1lcnJvci5leHRlcm5hbFwiO1xuaW1wb3J0IHsgQ2FjaGVkUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcmVzcG9uc2UtY2FjaGVcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxNb2hhbWFkSmF2YWRcXFxcT25lRHJpdmVcXFxcRGVza3RvcFxcXFxzYWRlZCAtIENvcHkgKDQpXFxcXGFwcFxcXFxhcGlcXFxcY2hhdFxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY2hhdC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NoYXRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2NoYXQvcm91dGVcIlxuICAgIH0sXG4gICAgZGlzdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX0RJU1RfRElSIHx8ICcnLFxuICAgIHJlbGF0aXZlUHJvamVjdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX1BST0pFQ1RfRElSIHx8ICcnLFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxcTW9oYW1hZEphdmFkXFxcXE9uZURyaXZlXFxcXERlc2t0b3BcXFxcc2FkZWQgLSBDb3B5ICg0KVxcXFxhcHBcXFxcYXBpXFxcXGNoYXRcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcywgY3R4KSB7XG4gICAgaWYgKHJvdXRlTW9kdWxlLmlzRGV2KSB7XG4gICAgICAgIGFkZFJlcXVlc3RNZXRhKHJlcSwgJ2RldlJlcXVlc3RUaW1pbmdJbnRlcm5hbHNFbmQnLCBwcm9jZXNzLmhydGltZS5iaWdpbnQoKSk7XG4gICAgfVxuICAgIGxldCBzcmNQYWdlID0gXCIvYXBpL2NoYXQvcm91dGVcIjtcbiAgICAvLyB0dXJib3BhY2sgZG9lc24ndCBub3JtYWxpemUgYC9pbmRleGAgaW4gdGhlIHBhZ2UgbmFtZVxuICAgIC8vIHNvIHdlIG5lZWQgdG8gdG8gcHJvY2VzcyBkeW5hbWljIHJvdXRlcyBwcm9wZXJseVxuICAgIC8vIFRPRE86IGZpeCB0dXJib3BhY2sgcHJvdmlkaW5nIGRpZmZlcmluZyB2YWx1ZSBmcm9tIHdlYnBhY2tcbiAgICBpZiAocHJvY2Vzcy5lbnYuVFVSQk9QQUNLKSB7XG4gICAgICAgIHNyY1BhZ2UgPSBzcmNQYWdlLnJlcGxhY2UoL1xcL2luZGV4JC8sICcnKSB8fCAnLyc7XG4gICAgfSBlbHNlIGlmIChzcmNQYWdlID09PSAnL2luZGV4Jykge1xuICAgICAgICAvLyB3ZSBhbHdheXMgbm9ybWFsaXplIC9pbmRleCBzcGVjaWZpY2FsbHlcbiAgICAgICAgc3JjUGFnZSA9ICcvJztcbiAgICB9XG4gICAgY29uc3QgbXVsdGlab25lRHJhZnRNb2RlID0gcHJvY2Vzcy5lbnYuX19ORVhUX01VTFRJX1pPTkVfRFJBRlRfTU9ERTtcbiAgICBjb25zdCBwcmVwYXJlUmVzdWx0ID0gYXdhaXQgcm91dGVNb2R1bGUucHJlcGFyZShyZXEsIHJlcywge1xuICAgICAgICBzcmNQYWdlLFxuICAgICAgICBtdWx0aVpvbmVEcmFmdE1vZGVcbiAgICB9KTtcbiAgICBpZiAoIXByZXBhcmVSZXN1bHQpIHtcbiAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSA0MDA7XG4gICAgICAgIHJlcy5lbmQoJ0JhZCBSZXF1ZXN0Jyk7XG4gICAgICAgIGN0eC53YWl0VW50aWwgPT0gbnVsbCA/IHZvaWQgMCA6IGN0eC53YWl0VW50aWwuY2FsbChjdHgsIFByb21pc2UucmVzb2x2ZSgpKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHsgYnVpbGRJZCwgcGFyYW1zLCBuZXh0Q29uZmlnLCBwYXJzZWRVcmwsIGlzRHJhZnRNb2RlLCBwcmVyZW5kZXJNYW5pZmVzdCwgcm91dGVyU2VydmVyQ29udGV4dCwgaXNPbkRlbWFuZFJldmFsaWRhdGUsIHJldmFsaWRhdGVPbmx5R2VuZXJhdGVkLCByZXNvbHZlZFBhdGhuYW1lLCBjbGllbnRSZWZlcmVuY2VNYW5pZmVzdCwgc2VydmVyQWN0aW9uc01hbmlmZXN0IH0gPSBwcmVwYXJlUmVzdWx0O1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRTcmNQYWdlID0gbm9ybWFsaXplQXBwUGF0aChzcmNQYWdlKTtcbiAgICBsZXQgaXNJc3IgPSBCb29sZWFuKHByZXJlbmRlck1hbmlmZXN0LmR5bmFtaWNSb3V0ZXNbbm9ybWFsaXplZFNyY1BhZ2VdIHx8IHByZXJlbmRlck1hbmlmZXN0LnJvdXRlc1tyZXNvbHZlZFBhdGhuYW1lXSk7XG4gICAgY29uc3QgcmVuZGVyNDA0ID0gYXN5bmMgKCk9PntcbiAgICAgICAgLy8gVE9ETzogc2hvdWxkIHJvdXRlLW1vZHVsZSBpdHNlbGYgaGFuZGxlIHJlbmRlcmluZyB0aGUgNDA0XG4gICAgICAgIGlmIChyb3V0ZXJTZXJ2ZXJDb250ZXh0ID09IG51bGwgPyB2b2lkIDAgOiByb3V0ZXJTZXJ2ZXJDb250ZXh0LnJlbmRlcjQwNCkge1xuICAgICAgICAgICAgYXdhaXQgcm91dGVyU2VydmVyQ29udGV4dC5yZW5kZXI0MDQocmVxLCByZXMsIHBhcnNlZFVybCwgZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzLmVuZCgnVGhpcyBwYWdlIGNvdWxkIG5vdCBiZSBmb3VuZCcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gICAgaWYgKGlzSXNyICYmICFpc0RyYWZ0TW9kZSkge1xuICAgICAgICBjb25zdCBpc1ByZXJlbmRlcmVkID0gQm9vbGVhbihwcmVyZW5kZXJNYW5pZmVzdC5yb3V0ZXNbcmVzb2x2ZWRQYXRobmFtZV0pO1xuICAgICAgICBjb25zdCBwcmVyZW5kZXJJbmZvID0gcHJlcmVuZGVyTWFuaWZlc3QuZHluYW1pY1JvdXRlc1tub3JtYWxpemVkU3JjUGFnZV07XG4gICAgICAgIGlmIChwcmVyZW5kZXJJbmZvKSB7XG4gICAgICAgICAgICBpZiAocHJlcmVuZGVySW5mby5mYWxsYmFjayA9PT0gZmFsc2UgJiYgIWlzUHJlcmVuZGVyZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAobmV4dENvbmZpZy5leHBlcmltZW50YWwuYWRhcHRlclBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJlbmRlcjQwNCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm9GYWxsYmFja0Vycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IGNhY2hlS2V5ID0gbnVsbDtcbiAgICBpZiAoaXNJc3IgJiYgIXJvdXRlTW9kdWxlLmlzRGV2ICYmICFpc0RyYWZ0TW9kZSkge1xuICAgICAgICBjYWNoZUtleSA9IHJlc29sdmVkUGF0aG5hbWU7XG4gICAgICAgIC8vIGVuc3VyZSAvaW5kZXggYW5kIC8gaXMgbm9ybWFsaXplZCB0byBvbmUga2V5XG4gICAgICAgIGNhY2hlS2V5ID0gY2FjaGVLZXkgPT09ICcvaW5kZXgnID8gJy8nIDogY2FjaGVLZXk7XG4gICAgfVxuICAgIGNvbnN0IHN1cHBvcnRzRHluYW1pY1Jlc3BvbnNlID0gLy8gSWYgd2UncmUgaW4gZGV2ZWxvcG1lbnQsIHdlIGFsd2F5cyBzdXBwb3J0IGR5bmFtaWMgSFRNTFxuICAgIHJvdXRlTW9kdWxlLmlzRGV2ID09PSB0cnVlIHx8IC8vIElmIHRoaXMgaXMgbm90IFNTRyBvciBkb2VzIG5vdCBoYXZlIHN0YXRpYyBwYXRocywgdGhlbiBpdCBzdXBwb3J0c1xuICAgIC8vIGR5bmFtaWMgSFRNTC5cbiAgICAhaXNJc3I7XG4gICAgLy8gVGhpcyBpcyBhIHJldmFsaWRhdGlvbiByZXF1ZXN0IGlmIHRoZSByZXF1ZXN0IGlzIGZvciBhIHN0YXRpY1xuICAgIC8vIHBhZ2UgYW5kIGl0IGlzIG5vdCBiZWluZyByZXN1bWVkIGZyb20gYSBwb3N0cG9uZWQgcmVuZGVyIGFuZFxuICAgIC8vIGl0IGlzIG5vdCBhIGR5bmFtaWMgUlNDIHJlcXVlc3QgdGhlbiBpdCBpcyBhIHJldmFsaWRhdGlvblxuICAgIC8vIHJlcXVlc3QuXG4gICAgY29uc3QgaXNTdGF0aWNHZW5lcmF0aW9uID0gaXNJc3IgJiYgIXN1cHBvcnRzRHluYW1pY1Jlc3BvbnNlO1xuICAgIC8vIEJlZm9yZSByZW5kZXJpbmcgKHdoaWNoIGluaXRpYWxpemVzIGNvbXBvbmVudCB0cmVlIG1vZHVsZXMpLCB3ZSBoYXZlIHRvXG4gICAgLy8gc2V0IHRoZSByZWZlcmVuY2UgbWFuaWZlc3RzIHRvIG91ciBnbG9iYWwgc3RvcmUgc28gU2VydmVyIEFjdGlvbidzXG4gICAgLy8gZW5jcnlwdGlvbiB1dGlsIGNhbiBhY2Nlc3MgdG8gdGhlbSBhdCB0aGUgdG9wIGxldmVsIG9mIHRoZSBwYWdlIG1vZHVsZS5cbiAgICBpZiAoc2VydmVyQWN0aW9uc01hbmlmZXN0ICYmIGNsaWVudFJlZmVyZW5jZU1hbmlmZXN0KSB7XG4gICAgICAgIHNldFJlZmVyZW5jZU1hbmlmZXN0c1NpbmdsZXRvbih7XG4gICAgICAgICAgICBwYWdlOiBzcmNQYWdlLFxuICAgICAgICAgICAgY2xpZW50UmVmZXJlbmNlTWFuaWZlc3QsXG4gICAgICAgICAgICBzZXJ2ZXJBY3Rpb25zTWFuaWZlc3QsXG4gICAgICAgICAgICBzZXJ2ZXJNb2R1bGVNYXA6IGNyZWF0ZVNlcnZlck1vZHVsZU1hcCh7XG4gICAgICAgICAgICAgICAgc2VydmVyQWN0aW9uc01hbmlmZXN0XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgbWV0aG9kID0gcmVxLm1ldGhvZCB8fCAnR0VUJztcbiAgICBjb25zdCB0cmFjZXIgPSBnZXRUcmFjZXIoKTtcbiAgICBjb25zdCBhY3RpdmVTcGFuID0gdHJhY2VyLmdldEFjdGl2ZVNjb3BlU3BhbigpO1xuICAgIGNvbnN0IGNvbnRleHQgPSB7XG4gICAgICAgIHBhcmFtcyxcbiAgICAgICAgcHJlcmVuZGVyTWFuaWZlc3QsXG4gICAgICAgIHJlbmRlck9wdHM6IHtcbiAgICAgICAgICAgIGV4cGVyaW1lbnRhbDoge1xuICAgICAgICAgICAgICAgIGF1dGhJbnRlcnJ1cHRzOiBCb29sZWFuKG5leHRDb25maWcuZXhwZXJpbWVudGFsLmF1dGhJbnRlcnJ1cHRzKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhY2hlQ29tcG9uZW50czogQm9vbGVhbihuZXh0Q29uZmlnLmNhY2hlQ29tcG9uZW50cyksXG4gICAgICAgICAgICBzdXBwb3J0c0R5bmFtaWNSZXNwb25zZSxcbiAgICAgICAgICAgIGluY3JlbWVudGFsQ2FjaGU6IGdldFJlcXVlc3RNZXRhKHJlcSwgJ2luY3JlbWVudGFsQ2FjaGUnKSxcbiAgICAgICAgICAgIGNhY2hlTGlmZVByb2ZpbGVzOiBuZXh0Q29uZmlnLmNhY2hlTGlmZSxcbiAgICAgICAgICAgIHdhaXRVbnRpbDogY3R4LndhaXRVbnRpbCxcbiAgICAgICAgICAgIG9uQ2xvc2U6IChjYik9PntcbiAgICAgICAgICAgICAgICByZXMub24oJ2Nsb3NlJywgY2IpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQWZ0ZXJUYXNrRXJyb3I6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG9uSW5zdHJ1bWVudGF0aW9uUmVxdWVzdEVycm9yOiAoZXJyb3IsIF9yZXF1ZXN0LCBlcnJvckNvbnRleHQpPT5yb3V0ZU1vZHVsZS5vblJlcXVlc3RFcnJvcihyZXEsIGVycm9yLCBlcnJvckNvbnRleHQsIHJvdXRlclNlcnZlckNvbnRleHQpXG4gICAgICAgIH0sXG4gICAgICAgIHNoYXJlZENvbnRleHQ6IHtcbiAgICAgICAgICAgIGJ1aWxkSWRcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgbm9kZU5leHRSZXEgPSBuZXcgTm9kZU5leHRSZXF1ZXN0KHJlcSk7XG4gICAgY29uc3Qgbm9kZU5leHRSZXMgPSBuZXcgTm9kZU5leHRSZXNwb25zZShyZXMpO1xuICAgIGNvbnN0IG5leHRSZXEgPSBOZXh0UmVxdWVzdEFkYXB0ZXIuZnJvbU5vZGVOZXh0UmVxdWVzdChub2RlTmV4dFJlcSwgc2lnbmFsRnJvbU5vZGVSZXNwb25zZShyZXMpKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBpbnZva2VSb3V0ZU1vZHVsZSA9IGFzeW5jIChzcGFuKT0+e1xuICAgICAgICAgICAgcmV0dXJuIHJvdXRlTW9kdWxlLmhhbmRsZShuZXh0UmVxLCBjb250ZXh0KS5maW5hbGx5KCgpPT57XG4gICAgICAgICAgICAgICAgaWYgKCFzcGFuKSByZXR1cm47XG4gICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgJ2h0dHAuc3RhdHVzX2NvZGUnOiByZXMuc3RhdHVzQ29kZSxcbiAgICAgICAgICAgICAgICAgICAgJ25leHQucnNjJzogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCByb290U3BhbkF0dHJpYnV0ZXMgPSB0cmFjZXIuZ2V0Um9vdFNwYW5BdHRyaWJ1dGVzKCk7XG4gICAgICAgICAgICAgICAgLy8gV2Ugd2VyZSB1bmFibGUgdG8gZ2V0IGF0dHJpYnV0ZXMsIHByb2JhYmx5IE9URUwgaXMgbm90IGVuYWJsZWRcbiAgICAgICAgICAgICAgICBpZiAoIXJvb3RTcGFuQXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnNwYW5fdHlwZScpICE9PSBCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVW5leHBlY3RlZCByb290IHNwYW4gdHlwZSAnJHtyb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnNwYW5fdHlwZScpfScuIFBsZWFzZSByZXBvcnQgdGhpcyBOZXh0LmpzIGlzc3VlIGh0dHBzOi8vZ2l0aHViLmNvbS92ZXJjZWwvbmV4dC5qc2ApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gcm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5yb3V0ZScpO1xuICAgICAgICAgICAgICAgIGlmIChyb3V0ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYCR7bWV0aG9kfSAke3JvdXRlfWA7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5yb3V0ZSc6IHJvdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0LnNwYW5fbmFtZSc6IG5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4udXBkYXRlTmFtZShuYW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUoYCR7bWV0aG9kfSAke3NyY1BhZ2V9YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGlzTWluaW1hbE1vZGUgPSBCb29sZWFuKHByb2Nlc3MuZW52Lk1JTklNQUxfTU9ERSB8fCBnZXRSZXF1ZXN0TWV0YShyZXEsICdtaW5pbWFsTW9kZScpKTtcbiAgICAgICAgY29uc3QgaGFuZGxlUmVzcG9uc2UgPSBhc3luYyAoY3VycmVudFNwYW4pPT57XG4gICAgICAgICAgICB2YXIgX2NhY2hlRW50cnlfdmFsdWU7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZUdlbmVyYXRvciA9IGFzeW5jICh7IHByZXZpb3VzQ2FjaGVFbnRyeSB9KT0+e1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNNaW5pbWFsTW9kZSAmJiBpc09uRGVtYW5kUmV2YWxpZGF0ZSAmJiByZXZhbGlkYXRlT25seUdlbmVyYXRlZCAmJiAhcHJldmlvdXNDYWNoZUVudHJ5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMuc3RhdHVzQ29kZSA9IDQwNDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9uLWRlbWFuZCByZXZhbGlkYXRlIGFsd2F5cyBzZXRzIHRoaXMgaGVhZGVyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCd4LW5leHRqcy1jYWNoZScsICdSRVZBTElEQVRFRCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgnVGhpcyBwYWdlIGNvdWxkIG5vdCBiZSBmb3VuZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBpbnZva2VSb3V0ZU1vZHVsZShjdXJyZW50U3Bhbik7XG4gICAgICAgICAgICAgICAgICAgIHJlcS5mZXRjaE1ldHJpY3MgPSBjb250ZXh0LnJlbmRlck9wdHMuZmV0Y2hNZXRyaWNzO1xuICAgICAgICAgICAgICAgICAgICBsZXQgcGVuZGluZ1dhaXRVbnRpbCA9IGNvbnRleHQucmVuZGVyT3B0cy5wZW5kaW5nV2FpdFVudGlsO1xuICAgICAgICAgICAgICAgICAgICAvLyBBdHRlbXB0IHVzaW5nIHByb3ZpZGVkIHdhaXRVbnRpbCBpZiBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgaXQncyBub3Qgd2UgZmFsbGJhY2sgdG8gc2VuZFJlc3BvbnNlJ3MgaGFuZGxpbmdcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdXYWl0VW50aWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdHgud2FpdFVudGlsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LndhaXRVbnRpbChwZW5kaW5nV2FpdFVudGlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nV2FpdFVudGlsID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhY2hlVGFncyA9IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRUYWdzO1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcmVxdWVzdCBpcyBmb3IgYSBzdGF0aWMgcmVzcG9uc2UsIHdlIGNhbiBjYWNoZSBpdCBzbyBsb25nXG4gICAgICAgICAgICAgICAgICAgIC8vIGFzIGl0J3Mgbm90IGVkZ2UuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0lzcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IHJlc3BvbnNlLmJsb2IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvcHkgdGhlIGhlYWRlcnMgZnJvbSB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gdG9Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycyhyZXNwb25zZS5oZWFkZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWNoZVRhZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzW05FWFRfQ0FDSEVfVEFHU19IRUFERVJdID0gY2FjaGVUYWdzO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFoZWFkZXJzWydjb250ZW50LXR5cGUnXSAmJiBibG9iLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzWydjb250ZW50LXR5cGUnXSA9IGJsb2IudHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJldmFsaWRhdGUgPSB0eXBlb2YgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZFJldmFsaWRhdGUgPT09ICd1bmRlZmluZWQnIHx8IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRSZXZhbGlkYXRlID49IElORklOSVRFX0NBQ0hFID8gZmFsc2UgOiBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkUmV2YWxpZGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cGlyZSA9IHR5cGVvZiBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkRXhwaXJlID09PSAndW5kZWZpbmVkJyB8fCBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkRXhwaXJlID49IElORklOSVRFX0NBQ0hFID8gdW5kZWZpbmVkIDogY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZEV4cGlyZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgY2FjaGUgZW50cnkgZm9yIHRoZSByZXNwb25zZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhY2hlRW50cnkgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2luZDogQ2FjaGVkUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IEJ1ZmZlci5mcm9tKGF3YWl0IGJsb2IuYXJyYXlCdWZmZXIoKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlQ29udHJvbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBpcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhY2hlRW50cnk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZW5kIHJlc3BvbnNlIHdpdGhvdXQgY2FjaGluZyBpZiBub3QgSVNSXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZW5kUmVzcG9uc2Uobm9kZU5leHRSZXEsIG5vZGVOZXh0UmVzLCByZXNwb25zZSwgY29udGV4dC5yZW5kZXJPcHRzLnBlbmRpbmdXYWl0VW50aWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGJhY2tncm91bmQgcmV2YWxpZGF0ZSB3ZSBuZWVkIHRvIHJlcG9ydFxuICAgICAgICAgICAgICAgICAgICAvLyB0aGUgcmVxdWVzdCBlcnJvciBoZXJlIGFzIGl0IHdvbid0IGJlIGJ1YmJsZWRcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzQ2FjaGVFbnRyeSA9PSBudWxsID8gdm9pZCAwIDogcHJldmlvdXNDYWNoZUVudHJ5LmlzU3RhbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHJvdXRlTW9kdWxlLm9uUmVxdWVzdEVycm9yKHJlcSwgZXJyLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVyS2luZDogJ0FwcCBSb3V0ZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlUGF0aDogc3JjUGFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZVR5cGU6ICdyb3V0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0ZVJlYXNvbjogZ2V0UmV2YWxpZGF0ZVJlYXNvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzU3RhdGljR2VuZXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNPbkRlbWFuZFJldmFsaWRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgcm91dGVyU2VydmVyQ29udGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBjYWNoZUVudHJ5ID0gYXdhaXQgcm91dGVNb2R1bGUuaGFuZGxlUmVzcG9uc2Uoe1xuICAgICAgICAgICAgICAgIHJlcSxcbiAgICAgICAgICAgICAgICBuZXh0Q29uZmlnLFxuICAgICAgICAgICAgICAgIGNhY2hlS2V5LFxuICAgICAgICAgICAgICAgIHJvdXRlS2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgICAgICAgICBpc0ZhbGxiYWNrOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcmVyZW5kZXJNYW5pZmVzdCxcbiAgICAgICAgICAgICAgICBpc1JvdXRlUFBSRW5hYmxlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgaXNPbkRlbWFuZFJldmFsaWRhdGUsXG4gICAgICAgICAgICAgICAgcmV2YWxpZGF0ZU9ubHlHZW5lcmF0ZWQsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2VHZW5lcmF0b3IsXG4gICAgICAgICAgICAgICAgd2FpdFVudGlsOiBjdHgud2FpdFVudGlsLFxuICAgICAgICAgICAgICAgIGlzTWluaW1hbE1vZGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gd2UgZG9uJ3QgY3JlYXRlIGEgY2FjaGVFbnRyeSBmb3IgSVNSXG4gICAgICAgICAgICBpZiAoIWlzSXNyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKGNhY2hlRW50cnkgPT0gbnVsbCA/IHZvaWQgMCA6IChfY2FjaGVFbnRyeV92YWx1ZSA9IGNhY2hlRW50cnkudmFsdWUpID09IG51bGwgPyB2b2lkIDAgOiBfY2FjaGVFbnRyeV92YWx1ZS5raW5kKSAhPT0gQ2FjaGVkUm91dGVLaW5kLkFQUF9ST1VURSkge1xuICAgICAgICAgICAgICAgIHZhciBfY2FjaGVFbnRyeV92YWx1ZTE7XG4gICAgICAgICAgICAgICAgdGhyb3cgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ldyBFcnJvcihgSW52YXJpYW50OiBhcHAtcm91dGUgcmVjZWl2ZWQgaW52YWxpZCBjYWNoZSBlbnRyeSAke2NhY2hlRW50cnkgPT0gbnVsbCA/IHZvaWQgMCA6IChfY2FjaGVFbnRyeV92YWx1ZTEgPSBjYWNoZUVudHJ5LnZhbHVlKSA9PSBudWxsID8gdm9pZCAwIDogX2NhY2hlRW50cnlfdmFsdWUxLmtpbmR9YCksIFwiX19ORVhUX0VSUk9SX0NPREVcIiwge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCJFNzAxXCIsXG4gICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghaXNNaW5pbWFsTW9kZSkge1xuICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ3gtbmV4dGpzLWNhY2hlJywgaXNPbkRlbWFuZFJldmFsaWRhdGUgPyAnUkVWQUxJREFURUQnIDogY2FjaGVFbnRyeS5pc01pc3MgPyAnTUlTUycgOiBjYWNoZUVudHJ5LmlzU3RhbGUgPyAnU1RBTEUnIDogJ0hJVCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRHJhZnQgbW9kZSBzaG91bGQgbmV2ZXIgYmUgY2FjaGVkXG4gICAgICAgICAgICBpZiAoaXNEcmFmdE1vZGUpIHtcbiAgICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDYWNoZS1Db250cm9sJywgJ3ByaXZhdGUsIG5vLWNhY2hlLCBuby1zdG9yZSwgbWF4LWFnZT0wLCBtdXN0LXJldmFsaWRhdGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBmcm9tTm9kZU91dGdvaW5nSHR0cEhlYWRlcnMoY2FjaGVFbnRyeS52YWx1ZS5oZWFkZXJzKTtcbiAgICAgICAgICAgIGlmICghKGlzTWluaW1hbE1vZGUgJiYgaXNJc3IpKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVycy5kZWxldGUoTkVYVF9DQUNIRV9UQUdTX0hFQURFUik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiBjYWNoZSBjb250cm9sIGlzIGFscmVhZHkgc2V0IG9uIHRoZSByZXNwb25zZSB3ZSBkb24ndFxuICAgICAgICAgICAgLy8gb3ZlcnJpZGUgaXQgdG8gYWxsb3cgdXNlcnMgdG8gY3VzdG9taXplIGl0IHZpYSBuZXh0LmNvbmZpZ1xuICAgICAgICAgICAgaWYgKGNhY2hlRW50cnkuY2FjaGVDb250cm9sICYmICFyZXMuZ2V0SGVhZGVyKCdDYWNoZS1Db250cm9sJykgJiYgIWhlYWRlcnMuZ2V0KCdDYWNoZS1Db250cm9sJykpIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzLnNldCgnQ2FjaGUtQ29udHJvbCcsIGdldENhY2hlQ29udHJvbEhlYWRlcihjYWNoZUVudHJ5LmNhY2hlQ29udHJvbCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgc2VuZFJlc3BvbnNlKG5vZGVOZXh0UmVxLCBub2RlTmV4dFJlcywgLy8gQHRzLWV4cGVjdC1lcnJvciAtIEFyZ3VtZW50IG9mIHR5cGUgJ0J1ZmZlcjxBcnJheUJ1ZmZlckxpa2U+JyBpcyBub3QgYXNzaWduYWJsZSB0byBwYXJhbWV0ZXIgb2YgdHlwZSAnQm9keUluaXQgfCBudWxsIHwgdW5kZWZpbmVkJy5cbiAgICAgICAgICAgIG5ldyBSZXNwb25zZShjYWNoZUVudHJ5LnZhbHVlLmJvZHksIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIHN0YXR1czogY2FjaGVFbnRyeS52YWx1ZS5zdGF0dXMgfHwgMjAwXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gVE9ETzogYWN0aXZlU3BhbiBjb2RlIHBhdGggaXMgZm9yIHdoZW4gd3JhcHBlZCBieVxuICAgICAgICAvLyBuZXh0LXNlcnZlciBjYW4gYmUgcmVtb3ZlZCB3aGVuIHRoaXMgaXMgbm8gbG9uZ2VyIHVzZWRcbiAgICAgICAgaWYgKGFjdGl2ZVNwYW4pIHtcbiAgICAgICAgICAgIGF3YWl0IGhhbmRsZVJlc3BvbnNlKGFjdGl2ZVNwYW4pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdHJhY2VyLndpdGhQcm9wYWdhdGVkQ29udGV4dChyZXEuaGVhZGVycywgKCk9PnRyYWNlci50cmFjZShCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0LCB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW5OYW1lOiBgJHttZXRob2R9ICR7c3JjUGFnZX1gLFxuICAgICAgICAgICAgICAgICAgICBraW5kOiBTcGFuS2luZC5TRVJWRVIsXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLm1ldGhvZCc6IG1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnRhcmdldCc6IHJlcS51cmxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGhhbmRsZVJlc3BvbnNlKSk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgaWYgKCEoZXJyIGluc3RhbmNlb2YgTm9GYWxsYmFja0Vycm9yKSkge1xuICAgICAgICAgICAgYXdhaXQgcm91dGVNb2R1bGUub25SZXF1ZXN0RXJyb3IocmVxLCBlcnIsIHtcbiAgICAgICAgICAgICAgICByb3V0ZXJLaW5kOiAnQXBwIFJvdXRlcicsXG4gICAgICAgICAgICAgICAgcm91dGVQYXRoOiBub3JtYWxpemVkU3JjUGFnZSxcbiAgICAgICAgICAgICAgICByb3V0ZVR5cGU6ICdyb3V0ZScsXG4gICAgICAgICAgICAgICAgcmV2YWxpZGF0ZVJlYXNvbjogZ2V0UmV2YWxpZGF0ZVJlYXNvbih7XG4gICAgICAgICAgICAgICAgICAgIGlzU3RhdGljR2VuZXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgaXNPbkRlbWFuZFJldmFsaWRhdGVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmV0aHJvdyBzbyB0aGF0IHdlIGNhbiBoYW5kbGUgc2VydmluZyBlcnJvciBwYWdlXG4gICAgICAgIC8vIElmIHRoaXMgaXMgZHVyaW5nIHN0YXRpYyBnZW5lcmF0aW9uLCB0aHJvdyB0aGUgZXJyb3IgYWdhaW4uXG4gICAgICAgIGlmIChpc0lzcikgdGhyb3cgZXJyO1xuICAgICAgICAvLyBPdGhlcndpc2UsIHNlbmQgYSA1MDAgcmVzcG9uc2UuXG4gICAgICAgIGF3YWl0IHNlbmRSZXNwb25zZShub2RlTmV4dFJlcSwgbm9kZU5leHRSZXMsIG5ldyBSZXNwb25zZShudWxsLCB7XG4gICAgICAgICAgICBzdGF0dXM6IDUwMFxuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5CMohamadJavad%5COneDrive%5CDesktop%5Csaded%20-%20Copy%20(4)%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CMohamadJavad%5COneDrive%5CDesktop%5Csaded%20-%20Copy%20(4)&isDev=true&tsconfigPath=&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!**************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \**************************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!**************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \**************************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "./work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "next/dist/shared/lib/no-fallback-error.external":
/*!******************************************************************!*\
  !*** external "next/dist/shared/lib/no-fallback-error.external" ***!
  \******************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/no-fallback-error.external");

/***/ }),

/***/ "next/dist/shared/lib/router/utils/app-paths":
/*!**************************************************************!*\
  !*** external "next/dist/shared/lib/router/utils/app-paths" ***!
  \**************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/app-paths");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = import("pg");;

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3"], () => (__webpack_exec__("(rsc)/./node_modules/.pnpm/next@16.0.3_@babel+core@7.2_a6e7fe7b2107bfd5c9e45031e322c5c3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5CMohamadJavad%5COneDrive%5CDesktop%5Csaded%20-%20Copy%20(4)%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CMohamadJavad%5COneDrive%5CDesktop%5Csaded%20-%20Copy%20(4)&isDev=true&tsconfigPath=&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!")));
module.exports = __webpack_exports__;

})();